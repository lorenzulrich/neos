`7.0.0 (2020-12-10) <https://github.com/neos/neos-development-collection/releases/tag/7.0.0>`_
==============================================================================================

Overview of merged pull requests
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

`TASK: Remove old code migrations <https://github.com/neos/neos-development-collection/pull/3236>`_
---------------------------------------------------------------------------------------------------

Removes 38 code migrations that are not longer relevant

* Packages: ``ContentRepository`` ``Fusion`` ``Media`` ``Neos`` ``NodeTypes`` ``SiteKickstarter``

`BUGFIX: Add missing return tag for the flow query operation <https://github.com/neos/neos-development-collection/pull/3239>`_
------------------------------------------------------------------------------------------------------------------------------

Without this, the reference documentation can not be parsed. The Eel helper was not updated since version 4.3!!!

* Packages: ``Neos``

`DOCS: Add note about the read only state to the readme of fusion afx <https://github.com/neos/neos-development-collection/pull/3234>`_
---------------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Afx``

`TASK: Throw fusion exception with explanation also for afx parser errors <https://github.com/neos/neos-development-collection/pull/3235>`_
-------------------------------------------------------------------------------------------------------------------------------------------

Previously only AfxExceptions were converted to fusion exceptions which hid valuable information about the error source from the user. This change will also catch for AfxParserExceptions and convert those to Fusion\\Exceptions

This is non critical as the fusion side will catch this aswell but it should help to create error messages that are slightly easier to understand.

This replaces pr: https://github.com/neos/fusion-afx/pull/35 after moving afx to the neos development collection

* Packages: ``Afx``

`TASK: Raise PHPUnit version to 9 <https://github.com/neos/neos-development-collection/pull/3233>`_
---------------------------------------------------------------------------------------------------

`TASK: Adjust version numbers in tooling configuration <https://github.com/neos/neos-development-collection/pull/3231>`_
------------------------------------------------------------------------------------------------------------------------

Updates for the 7.0 branch:

- conf.py of neos/neos and neos/media
- .travis.yml
- apigen.yml

* Packages: ``Media`` ``Neos``

`TASK: Adjust phpunit version for Fusion.Afx <https://github.com/neos/neos-development-collection/pull/3232>`_
--------------------------------------------------------------------------------------------------------------

* Packages: ``Afx`` ``Neos`` ``SiteKickstarter``

`TASK: Extend the warning for the EmberUI <https://github.com/neos/neos-development-collection/pull/3224>`_
-----------------------------------------------------------------------------------------------------------

The most parts of the EmberUI has been already removed. So we should mention that.

Releates: #2531

* Packages: ``Neos``

`TASK: Remove aloha legacy information <https://github.com/neos/neos-development-collection/pull/3225>`_
--------------------------------------------------------------------------------------------------------

The aloha configuration is not working anymore as we removed that compatibility
layer in the neos-ui. So we can also remove the information in the docs.

The aloha editor served us well but now it is time to remove the last legacy pieces.

Relates to https://github.com/neos/neos-ui/pull/2802

* Packages: ``Neos``

`TASK: Use PhpUnit 9 <https://github.com/neos/neos-development-collection/pull/3229>`_
--------------------------------------------------------------------------------------

* Related: `#3227 <https://github.com/neos/neos-development-collection/issues/3227>`_
* Packages: ``Afx`` ``ContentRepository`` ``Fusion`` ``Neos``

`FEATURE: Stabilize and extend Frontend Routing <https://github.com/neos/neos-development-collection/pull/3218>`_
-----------------------------------------------------------------------------------------------------------------

This adjusts the `FrontendNodeRoutePartHandler` so that it
can more easily be used for custom routes:

# Allow to be used in conjunction with other static/dynamic
  route parts

An `uriPattern` of "{node}/some/custom/part" did not work with
the previous version since the `uriPath` was replaced completely
when the route resolved a given node.

# Allow custom routes to be filtered by node type.

With the bug above fixed the route part handler can be used in
custom routes, but it would work for all nodes.
So for every `valid/uri` a corresponding `valid/uri/some/custom/part`
would match to the same node.

To prevent that, a new option `nodeType` was added that allows the
route to only apply for nodes of the specified type:

```yaml
-
  name:  'Custom'
  uriPattern: '{node}/custom.html'
  defaults:
    '@package':    'Neos.Neos'
    '@controller': 'Frontend\\Node'
    '@action':     'show'
    '@format':     'html'
    custom:         true
  routeParts:
    'node':
      handler: 'Neos\\Neos\\Routing\\FrontendNodeRoutePartHandlerInterface'
      options:
        nodeType: 'Some.Package:Some.Node.Type'
```

With this route (registered _before_ the default Neos routes) the
URI `valid/uri/custom.html` would match the corresponding node only
if it implements `Some.Package:Some.Node.Type`.

The Fusion rendering can react to that by evaluating the `custom` request argument:

```
prototype(Some.Package:Some.Node.Type) < prototype(Neos.Fusion:Component) {
    renderer = Neos.Fusion:Case {
        custom {
            condition = ${request.arguments.custom}
            renderer = Some.Package:Some.Custom.Renderer
        }
        default {
            condition = true
            renderer = Some.Package:Some.Default.Renderer
        }
    }
    @cache {
        mode = 'dynamic'
        entryDiscriminator = ${request.arguments.custom ? 'custom' : 'default'}
        context {
            1 = 'node'
            2 = 'documentNode'
            3 = 'site'
        }
    }
}
```

Vice versa, to create a link using the custom route via Fusion:

```
link = Neos.Neos:NodeLink {
  node = ${someNode}
  arguments {
    custom = true
  }
}
```
...will create a link pointing to the custom rendering of the node
if `someNode` implements the configured node type.

* Related: `#3020 <https://github.com/neos/neos-development-collection/issues/3020>`_
* Packages: ``Neos``

`BUGFIX: Adjust fusion tests to match the InvalidPositionException <https://github.com/neos/neos-development-collection/pull/3226>`_
------------------------------------------------------------------------------------------------------------------------------------

Invalid positions has been skipped silently. Since https://github.com/neos/flow-development-collection/pull/2214 this leads to an InvalidPositionException.

This change adjusts the tests, so that the expected errors are also respected in the tests.

Related: https://github.com/neos/flow-development-collection/pull/2214

* Packages: ``Fusion`` ``Neos``

`TASK: Removes unused semantic-release <https://github.com/neos/neos-development-collection/pull/3208>`_
--------------------------------------------------------------------------------------------------------

Removes dependency to the `semantic-release` npm package.

Semantic-release has been added 2 years ago with the image variant change. But it was never used and as we need a changelog ruleset for Neos commit messages before we are able to use it we can just drop it.

When we plan to use it we can add it again anyways.

* Resolves: `#3209 <https://github.com/neos/neos-development-collection/issues/3209>`_
* Packages: ``Browser``

`FEATURE: Remove default prototype generator <https://github.com/neos/neos-development-collection/pull/3210>`_
--------------------------------------------------------------------------------------------------------------

Related to #3137

* Packages: ``Neos``

`TASK: Add new login wallpaper <https://github.com/neos/neos-development-collection/pull/3214>`_
------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`!!! FEATURE: Add getIconUri & getDescription to AssetSourceInterface <https://github.com/neos/neos-development-collection/pull/3211>`_
---------------------------------------------------------------------------------------------------------------------------------------

Extends the `Neos\\Media\\Domain\\Model\\AssetSource\\ AssetSourceInterface` by the two methods `getIconUri()` and `getDescription()`.

This is a breaking change if you created a custom Asset source (implementing the `AssetSourceInterface`) and didn't implement these methods yet.

Related to #3137

* Packages: ``Media`` ``Neos``

`TASK: Adjust deprecated notices for next release <https://github.com/neos/neos-development-collection/pull/3207>`_
-------------------------------------------------------------------------------------------------------------------

Related to #3137

* Packages: ``Neos``

`TASK: Include AFX in development collection <https://github.com/neos/neos-development-collection/pull/3205>`_
--------------------------------------------------------------------------------------------------------------

This merges the AFX repository as subtree of the development collection, additionally the splitter configuration will have to be adapted afterwards and the Neos.Fusion.AFX repository made read-only.

`BUGFIX: set tagMode explicitly for tag links in Media.Browser <https://github.com/neos/neos-development-collection/pull/3197>`_
--------------------------------------------------------------------------------------------------------------------------------

Add `tagMode: 0` to tag links rendered in Media.Browser.

* Fixes: `#3196 <https://github.com/neos/neos-development-collection/issues/3196>`_
* Packages: ``Browser`` ``Neos``

`BUGFIX: set tagMode explicitly for tag links in Media.Browser <https://github.com/neos/neos-development-collection/pull/3197>`_
--------------------------------------------------------------------------------------------------------------------------------

Add `tagMode: 0` to tag links rendered in Media.Browser.

* Fixes: `#3196 <https://github.com/neos/neos-development-collection/issues/3196>`_
* Packages: ``Browser`` ``Neos``

`BUGFIX: Respect already defined attributes in Neos.Neos:ConvertUris <https://github.com/neos/neos-development-collection/pull/3152>`_
--------------------------------------------------------------------------------------------------------------------------------------

* The `rel` value get merged with existent`rel` attributes
* If a value already exists, it will not get overridden. Example `<a href="https://external.site" target="external">` the target stays `external`
* When you set the external target to something different (e.g. `'external'`) or disable it with false, the `rel` attribute will still be set
* If you have `data-target` set, this will not be overwritten

* Fixes: `#2942 <https://github.com/neos/neos-development-collection/issues/2942>`_
* Packages: ``Neos``

`BUGFIX: Respect already defined attributes in Neos.Neos:ConvertUris <https://github.com/neos/neos-development-collection/pull/3152>`_
--------------------------------------------------------------------------------------------------------------------------------------

* The `rel` value get merged with existent`rel` attributes
* If a value already exists, it will not get overridden. Example `<a href="https://external.site" target="external">` the target stays `external`
* When you set the external target to something different (e.g. `'external'`) or disable it with false, the `rel` attribute will still be set
* If you have `data-target` set, this will not be overwritten

* Fixes: `#2942 <https://github.com/neos/neos-development-collection/issues/2942>`_
* Packages: ``Neos``

`BUGFIX: Add file and line information to fusion parser exceptions where possible <https://github.com/neos/neos-development-collection/pull/3204>`_
---------------------------------------------------------------------------------------------------------------------------------------------------

In many cases the currently parsed resource and line is known and it would help to
editors to show this information in the parser exception.

* Resolves: `#3206 <https://github.com/neos/neos-development-collection/issues/3206>`_
* Packages: ``Browser`` ``Fusion`` ``Neos``

`BUGFIX: Add file and line information to fusion parser exceptions where possible <https://github.com/neos/neos-development-collection/pull/3204>`_
---------------------------------------------------------------------------------------------------------------------------------------------------

In many cases the currently parsed resource and line is known and it would help to
editors to show this information in the parser exception.

* Resolves: `#3206 <https://github.com/neos/neos-development-collection/issues/3206>`_
* Packages: ``Browser`` ``Fusion`` ``Neos``

`TASK: Rename TYPO3CR where possible <https://github.com/neos/neos-development-collection/pull/3188>`_
------------------------------------------------------------------------------------------------------

Affects #2842 and #3137

* Packages: ``ContentRepository`` ``Fusion`` ``Neos`` ``NodeTypes``

`BUGFIX: Align fusion caching and service <https://github.com/neos/neos-development-collection/pull/3193>`_
-----------------------------------------------------------------------------------------------------------

* Fixes: `#3191 <https://github.com/neos/neos-development-collection/issues/3191>`_
* Packages: ``Neos``

`BUGFIX: Align fusion caching and service <https://github.com/neos/neos-development-collection/pull/3193>`_
-----------------------------------------------------------------------------------------------------------

* Fixes: `#3191 <https://github.com/neos/neos-development-collection/issues/3191>`_
* Packages: ``Neos``

`FEATURE: Replace Fusion:Collection with Fusion:Loop <https://github.com/neos/neos-development-collection/pull/3202>`_
----------------------------------------------------------------------------------------------------------------------

* Related: `#3137 <https://github.com/neos/neos-development-collection/issues/3137>`_
* Packages: ``ColumnLayouts`` ``ContentReferences`` ``Neos``

`FEATURE: Replace Neos.Fusion:Array with Neos.Fusion:Join <https://github.com/neos/neos-development-collection/pull/3198>`_
---------------------------------------------------------------------------------------------------------------------------

* Related: `#3137 <https://github.com/neos/neos-development-collection/issues/3137>`_ 
* Packages: ``Fusion``

`FEATURE: Replace test function names to map prototype name in Map test <https://github.com/neos/neos-development-collection/pull/3203>`_
-----------------------------------------------------------------------------------------------------------------------------------------

* Related: `#3137 <https://github.com/neos/neos-development-collection/issues/3137>`_
* Packages: ``Fusion``

`TASK: Adjust Node and NodeInterface deprecation annotations <https://github.com/neos/neos-development-collection/pull/3194>`_
------------------------------------------------------------------------------------------------------------------------------

* Reword the deprecation message in the interface doc comment
* For deprecated methods with a replacement (e.g. `getDepth()`):
  * Don't remove the method but keep the deprecation annotation
  * Remove any `@api` annotation from the method
* For deprecated methods without replacement (e.g. `getContextPath()`):
  * Don't remove the method
  * replace the `@deprecated` annotation by some comment

* Related: `#3137 <https://github.com/neos/neos-development-collection/issues/3137>`_ 
* Packages: ``ContentRepository`` ``Neos``

`TASK: Adjust Node and NodeInterface deprecation annotations <https://github.com/neos/neos-development-collection/pull/3194>`_
------------------------------------------------------------------------------------------------------------------------------

* Reword the deprecation message in the interface doc comment
* For deprecated methods with a replacement (e.g. `getDepth()`):
  * Don't remove the method but keep the deprecation annotation
  * Remove any `@api` annotation from the method
* For deprecated methods without replacement (e.g. `getContextPath()`):
  * Don't remove the method
  * replace the `@deprecated` annotation by some comment

* Related: `#3137 <https://github.com/neos/neos-development-collection/issues/3137>`_ 
* Packages: ``ContentRepository`` ``Neos``

`FEATURE: Replace RawArray with DataStructure <https://github.com/neos/neos-development-collection/pull/3200>`_
---------------------------------------------------------------------------------------------------------------

#3137 

* Packages: ``Fusion`` ``Neos``

`FEATURE: Replace TS in comments with Fusion <https://github.com/neos/neos-development-collection/pull/3201>`_
--------------------------------------------------------------------------------------------------------------

#3137 

* Packages: ``Fusion`` ``Neos``

`Fix doc comments in Node and NodeInterface <https://github.com/neos/neos-development-collection/pull/3195>`_
-------------------------------------------------------------------------------------------------------------

Tweaks some doc comments that were introduced with #3187 and referred to a non-existing class `TraversableNode`

* Packages: ``ContentRepository``

`TASK: Adjust Node and NodeInterface deprecation annotations <https://github.com/neos/neos-development-collection/pull/3187>`_
------------------------------------------------------------------------------------------------------------------------------

* Reword the deprecation message in the interface doc comment
* For deprecated methods with a replacement (e.g. `getDepth()`):
  * Don't remove the method but keep the deprecation annotation
  * Remove any `@api` annotation from the method
* For deprecated methods without replacement (e.g. `getContextPath()`):
  * Don't remove the method
  * replace the `@deprecated` annotation by some comment

* Related: `#3137 <https://github.com/neos/neos-development-collection/issues/3137>`_
* Packages: ``Browser`` ``ContentRepository``

`TASK: Unify indents to spaces in fusion files <https://github.com/neos/neos-development-collection/pull/3186>`_
----------------------------------------------------------------------------------------------------------------

Currently, we have a kind of a mess in the different fusion files. Sometimes we use spaces, sometimes tabs. This PR clean this up.

* Packages: ``Fusion``

`BUGFIX: Use autorotate filter to apply resize adjustments properly to images with exif-orientations <https://github.com/neos/neos-development-collection/pull/3147>`_
----------------------------------------------------------------------------------------------------------------------------------------------------------------------

The autorotate is applied before calculating the resize dimensions to work with correct size values.

How to test:
- Go to the media module
- Upload an image with exif orientation like https://github.com/recurser/exif-orientation-examples/blob/master/Landscape_6.jpg
- Look at the generated thumbnails (without this change the thumbnail is rotated 90°)

* Resolves: `#3148 <https://github.com/neos/neos-development-collection/issues/3148>`_ 
* Packages: ``Media``

`BUGFIX: Use autorotate filter to apply resize adjustments properly to images with exif-orientations <https://github.com/neos/neos-development-collection/pull/3147>`_
----------------------------------------------------------------------------------------------------------------------------------------------------------------------

The autorotate is applied before calculating the resize dimensions to work with correct size values.

How to test:
- Go to the media module
- Upload an image with exif orientation like https://github.com/recurser/exif-orientation-examples/blob/master/Landscape_6.jpg
- Look at the generated thumbnails (without this change the thumbnail is rotated 90°)

* Resolves: `#3148 <https://github.com/neos/neos-development-collection/issues/3148>`_ 
* Packages: ``Media``

`BUGFIX: Flush 1st level node caches after publishing <https://github.com/neos/neos-development-collection/pull/3174>`_
-----------------------------------------------------------------------------------------------------------------------

When a fresh variant is published outdated URLs may be generated if
the urlPathSegment was changed on the variant.

* Fixes: `#3173 <https://github.com/neos/neos-development-collection/issues/3173>`_
* Packages: ``Browser`` ``ContentRepository``

`BUGFIX: Flush 1st level node caches after publishing <https://github.com/neos/neos-development-collection/pull/3174>`_
-----------------------------------------------------------------------------------------------------------------------

When a fresh variant is published outdated URLs may be generated if
the urlPathSegment was changed on the variant.

* Fixes: `#3173 <https://github.com/neos/neos-development-collection/issues/3173>`_
* Packages: ``Browser`` ``ContentRepository``

`BUGFIX: Adjust NodeIdentityConverterAspect to typed persistence <https://github.com/neos/neos-development-collection/pull/3183>`_
----------------------------------------------------------------------------------------------------------------------------------

* Fixes: `#3181 <https://github.com/neos/neos-development-collection/issues/3181>`_

`TASK: Adjust to removal of ComponentContext <https://github.com/neos/neos-development-collection/pull/3175>`_
--------------------------------------------------------------------------------------------------------------

This removes all usages of `ComponentContext`.

Related: neos/flow-development-collection#2019

`TASK: Update gedmo/doctrine-extensions to 3.0 <https://github.com/neos/neos-development-collection/pull/3179>`_
----------------------------------------------------------------------------------------------------------------

depends on #3177
Related to neos/flow-development-collection#2122
Required for neos/flow-development-collection#2247 et.al.

`TASK: Remove use of resolveShortcuts argument <https://github.com/neos/neos-development-collection/pull/3182>`_
----------------------------------------------------------------------------------------------------------------

The LinkingService.createNodeUri() no longer uses/accepts this
parameter…

See https://github.com/neos/neos-development-collection/pull/3168

* Packages: ``Neos``

`!!! TASK: Adjust to doctrine/migrations v3 <https://github.com/neos/neos-development-collection/pull/3177>`_
-------------------------------------------------------------------------------------------------------------

* Packages: ``Media`` ``Neos``

`BUGFIX: Adjust to typed persistence code <https://github.com/neos/neos-development-collection/pull/3180>`_
-----------------------------------------------------------------------------------------------------------

See https://github.com/neos/flow-development-collection/issues/2231

* Packages: ``ContentRepository`` ``Media`` ``Neos``

`TASK: Apply migrations <https://github.com/neos/neos-development-collection/pull/3176>`_
-----------------------------------------------------------------------------------------

Apply core migrations to (some) Neos dev collection packages.

* Packages: ``ContentRepository``

`BUGFIX: Correct bug in migration of ContentCollectionConstraints <https://github.com/neos/neos-development-collection/pull/3178>`_
-----------------------------------------------------------------------------------------------------------------------------------

The adjustments were applied to all nodes with constraints because the existence of the superType "Neos.Neos:ContentCollection" was not properly checked. 

The fixed migration was introduced in #3163

* Packages: ``Browser`` ``Neos``

`!!! TASK: Raise minimum PHP version to 7.3 <https://github.com/neos/neos-development-collection/pull/3172>`_
-------------------------------------------------------------------------------------------------------------

See https://github.com/neos/flow-development-collection/issues/2236

* Packages: ``Neos``

`TASK: Remove PHP 7.2 builds <https://github.com/neos/neos-development-collection/pull/3171>`_
----------------------------------------------------------------------------------------------

See https://github.com/neos/flow-development-collection/issues/2236

* Packages: ``Neos``

`BUGFIX: set collection mode explicitly for custom collection links <https://github.com/neos/neos-development-collection/pull/3162>`_
-------------------------------------------------------------------------------------------------------------------------------------

**What I did**
I set the collection mode explicitly to 0 to correct the argument in the url for switching to a custom collection. This Fixes Issue https://github.com/neos/neos-development-collection/issues/3161 
**How I did it**
I adjusted the arguments in the link generation in the template for the index action. 
**How to verify it**
Switch to the All collection and than by clicking on an link for a custom collection the view switches to the selected collection. 
**Checklist**

- [ x] Code follows the PSR-2 coding style
- [ x] The PR is created against the `lowest maintained branch <https://www.neos.io/features/release-roadmap.html>`_ with the bug (5.3)

* Packages: ``Browser``

`BUGFIX: set collection mode explicitly for custom collection links <https://github.com/neos/neos-development-collection/pull/3162>`_
-------------------------------------------------------------------------------------------------------------------------------------

**What I did**
I set the collection mode explicitly to 0 to correct the argument in the url for switching to a custom collection. This Fixes Issue https://github.com/neos/neos-development-collection/issues/3161 
**How I did it**
I adjusted the arguments in the link generation in the template for the index action. 
**How to verify it**
Switch to the All collection and than by clicking on an link for a custom collection the view switches to the selected collection. 
**Checklist**

- [ x] Code follows the PSR-2 coding style
- [ x] The PR is created against the `lowest maintained branch <https://www.neos.io/features/release-roadmap.html>`_ with the bug (5.3)

* Packages: ``Browser``

`BUGFIX: Fix Compatibility fallback after switching from Neos.Fusion:Collection to Neos.Fusion:Loop <https://github.com/neos/neos-development-collection/pull/3170>`_
---------------------------------------------------------------------------------------------------------------------------------------------------------------------

Close: #3169

* Packages: ``Neos``

`BUGFIX: Fix Compatibility fallback after switching from Neos.Fusion:Collection to Neos.Fusion:Loop <https://github.com/neos/neos-development-collection/pull/3170>`_
---------------------------------------------------------------------------------------------------------------------------------------------------------------------

Close: #3169

* Packages: ``Neos``

`!!! FEATURE: Add Afx template for SiteKickstarter <https://github.com/neos/neos-development-collection/pull/3089>`_
--------------------------------------------------------------------------------------------------------------------

!!! FEATURE: Add Afx template for SiteKickstarter

This is the first approach for making the SiteKickstarter more versatile. Now you can easily add a custom generator package and kickstart some sorts of sites with one package.

* Add possibility to use more than one template for the site kickstarter
* Add Afx template in addition to the fluid template
* Add the generator selection to the backend module for site packages
* Removed the old generic generator service (this is breaking)

This is a breaking change because it removes the old, Fluid-based generator service.
In case you want to use the Fluid based rendering you can use the dedicated package at https://github.com/queoGmbH/FluidSiteGenerator

* Resolves: `#3074 <https://github.com/neos/neos-development-collection/issues/3074>`_

`!!! FEATURE: Faster frontend routing <https://github.com/neos/neos-development-collection/pull/3168>`_
-------------------------------------------------------------------------------------------------------

Moves most of the "expensive" logic from the `LinkingService` to the
`FrontendNodeRoutePartHandler` where it will be cached.

This leads to a great performance improvement because:
* The "current Site" is only determined once, not for every URI
* Previously we had *three* routes for the frontend, now it's
  a single one
* Shortcut resolution will happen in the handler, so it will
  be cached

Most of these performance improvements even hold true for uncached requests.

### Breaking Change

This might be a breaking change if you...:
* ...extend the `FrontendNodeRoutePartHandler` and rely on it's inner workings (for example
  with shortcut nodes¹).
  No methods were removed though, so chances are that you are not affected
* ...created (functional) tests that cover the Neos routing behavior.
  The `FrontendNodeRoutePartHandler` expects the `requestUriHost` routing
  parameter to be set (usually done via HTTP Middleware). You can simulate that behavior via:
  `$httpRequest = $httpRequest->withAttribute(ServerRequestAttributes::ROUTING_PARAMETERS, RouteParameters::createEmpty()->withParameter('requestUriHost', 'some-host'));`
* ...rely on the *internal* behavior of the `resolveShortcuts` argument of the `LinkingService`
  This is quite unlikely since we don't use that route part handler for the
  backend, where shortcut nodes are never resolved anyways.

---
¹ The Node instance passed to `resolveValue()` will no longer be the *target node* of a shortcut
  but the actual shortcut node itself. It is resolved to the target node/URI via `resolveShortcutNode()`.
  This method is `protected` so that it can be called from any subclass if needed.

* Related: `#3020 <https://github.com/neos/neos-development-collection/issues/3020>`_
* Packages: ``Neos``

`!!! FEATURE: Respect language plurals also in XliffService <https://github.com/neos/neos-development-collection/pull/3166>`_
-----------------------------------------------------------------------------------------------------------------------------

The neos-ui can not use language plurals as the UI only uses the xliff.json endpoint and the XliffService that creates the JSON returns only the singular. This change adds the plurals when they are available.

**What I did**

The XliffService always returned the first value of a translation unit. So even when a label has a plural the XliffService only used the singular. So I changed that and we are respecting now plural and singular. 

**How I did it**

Added a new method getTranslationUnitValue that iterates over the translation unit values and potentially scramble the singular and plural. When we have just a singular we just use the single value for the label. If we have singular and plural we use the whole array for the label key.

**How to verify it**
Clear the Xliff cache and http://domain.foo/neos/xliff.json?locale=en and check changesApplied from the neos ui for instance.

!`Screenshot 2020-11-09 at 13 25 12 <https://user-images.githubusercontent.com/1014126/98541066-2452b580-228f-11eb-95d9-9d283b35e174.png>`_


* Resolves: `#2786 <https://github.com/neos/neos-development-collection/issues/2786>`_
* Packages: ``Neos``

`TASK: Add migration to adjust constraints of \`Neos.Neos:ContentCollections\` <https://github.com/neos/neos-development-collection/pull/3163>`_
------------------------------------------------------------------------------------------------------------------------------------------------

In PR #2715 the constraints in the `Neos.Neos:ContentCollection` were altered from allow `*` and disallow `Neos.Neos:Document` to disallow `*` and allowing `Neos.Neos:Content`.

This change adds an automatic migration to alter NodeTypes that are derived from `Neos.Neos:ContentCollection` and constraints of childNodes that are of type `Neos.Neos:ContentCollection`.

The migration will replace constraints for `*` with constraints for `Neos.Neos:Content` while preserving order.

Limitations: This will not run on nodeTypes that indirectly inherit from `Neos.Neos:ContentCollection` and `childNodes`
that are of a derived ContentCollection nodeType. However i consider such cases exotic and hope this catches 99% of the cases.

* Resolves: `#3164 <https://github.com/neos/neos-development-collection/issues/3164>`_
* Packages: ``Neos``

`TASK: Apply core migrations for Neos.ContentRepository <https://github.com/neos/neos-development-collection/pull/3167>`_
-------------------------------------------------------------------------------------------------------------------------

The core migrations are not stored in the database anymore and therefore our travis tests are failing.

**What I did**
Applied core migrations for Neos.ContentRepository

* Packages: ``ContentRepository``

`FEATURE: Lazy loading images <https://github.com/neos/neos-development-collection/pull/3149>`_
-----------------------------------------------------------------------------------------------

This will solve issue #3084 

* Packages: ``NodeTypes``

`Apply fixes from StyleCI <https://github.com/neos/neos-development-collection/pull/3160>`_
-------------------------------------------------------------------------------------------

This pull request applies code style fixes from an analysis carried out by `StyleCI <https://github.styleci.io>`_.

---

For more information, click `here <https://github.styleci.io/analyses/PxlLxK>`_.

* Packages: ``Browser`` ``ContentRepository`` ``Neos``

`Apply fixes from StyleCI <https://github.com/neos/neos-development-collection/pull/3160>`_
-------------------------------------------------------------------------------------------

This pull request applies code style fixes from an analysis carried out by `StyleCI <https://github.styleci.io>`_.

---

For more information, click `here <https://github.styleci.io/analyses/PxlLxK>`_.

* Packages: ``Browser`` ``ContentRepository`` ``Neos``

`FEATURE: Add StaticResource helper to Fusion defaults <https://github.com/neos/neos-development-collection/pull/3134>`_
------------------------------------------------------------------------------------------------------------------------

Add the StaticResource EEL Helper from https://github.com/neos/flow-development-collection/pull/2174 to the Fusion defaultContext. 

StaticResource.uri (packageKey, pathAndFilename, localize)
- (string) packageKey
- (string) pathAndFilename
- (boolean, optional) localize = false

StaticResource.content (packageKey, pathAndFilename, localize)
- (string) packageKey
- (string) pathAndFilename
- (boolean, optional) localize = false

This makes this helper available in afx:

```
  <link rel="stylesheet" href={StaticResource.uri('Neos.Demo', 'Public/Styles/Main.css')} media="all" />

  <style>{StaticResource.content('Neos.Demo', 'Public/Styles/Main.css')}</style>
```

* Resolves: `#3133 <https://github.com/neos/neos-development-collection/issues/3133>`_
* Packages: ``Fusion``

`FEATURE: Introduce NodeTypePresetPostprocessor <https://github.com/neos/neos-development-collection/pull/3087>`_
-----------------------------------------------------------------------------------------------------------------

Introduce `NodeTypePresetPostprocessor` and extract `IconNameMappingPostprocessor` and `DefaultPropertyEditorPostprocessor` from `NodeTypeConfigurationEnrichmentAspect`.

This allows to configure nodeType presets via settings and apply them to nodeTypes via. Other than mixins this allows to ensure consistent configurations across differently named properties to ensure a consistent editor experience.

Note: This is mainly a core adaptation of the Sitegeist.Silhoettes package https://github.com/sitegeist/Sitegeist.Silhouettes.

The presets can be applied by definining the `options.preset` for childNodes or properties.

```
Neos:
  Neos:
    nodeTypes:

      presets:

        childNodes:
          vendor:
            defaultConstraints:
              constraints:
                'Neos.Neos:Content': true
                'Neos.NodeTypes.BaseMixins:TitleMixin': true

        properties:
          vendor:
            textBlock:
              type: string
              ui:
                inlineEditable
            type: string
            defaultValue: ''
            ui:
              inlineEditable: true
              inline:
                editorOptions:
                  placeholder: 'Vendor.Site:NodeTypes.Generic:text.placeholder'
                  autoparagraph: true
                  formatting:
                    strong: true
                    em: true
                    u: false
                    underline: false
```

Presets can then be applied to nodetypes via: 

```
'Vendor.Package:NodeTypeName':
  childNodes:
    column1:
      options:
        preset: 'vendor.defaultConstraints'    
    column2:
      options:
        preset: 'vendor.defaultConstraints'    
  properties:
    description:
      options:
        preset: 'vendor.textBlock'
```

* Resolves: `#3090 <https://github.com/neos/neos-development-collection/issues/3090>`_

This also solves two thirds of #2867  (get rid of NodeTypeConfigurationEnrichmentAspect). The last part cannot be extracted that easily as it converts the magic value `i18n` to a key built from the NodeType it was defined on.

* Packages: ``Neos``

`!!!TASK: Adjust constraints of \`Neos.Neos:ContentCollection\` to allow \`Content\` instead of denying \`Document\` <https://github.com/neos/neos-development-collection/pull/2715>`_
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

A ContentCollection did allow all children but Documents in the past which is unexpected and makes it needlessly harder to create derived nodetypes with custom constraints. 

This constraint is now adjusted to allow nodes of `Neos.Neos:Content` inside a `Neos.Neos:ContentCollection` as anyone would expect given the nodetype name. 

Additionally the test fixtures are adjusted as in one test a `ContentCollection` was moved into another. Now the respective node has a type that inherits from Content and ContentCollection.

**How to update:**  If you created NodeTypes derived from `Neos.Neos:ContentCollection` and altered the constraints to forbid `*`  you have to adjust the constraints and now forbid `Neos.Neos:Content` instead of `*`:

```
'Vendor.Site:ContentCollection':
  superTypes:
    'Neos.Neos:ContentCollection': true
  constraints:
    nodeTypes:
      // remove constraints like:
      // '*': false
      // and add the following instead
      'Neos.Neos:Content': false
      // everything else stays the same
      'Vendor.Site:Content': true
```

* Resolves: `#3119 <https://github.com/neos/neos-development-collection/issues/3119>`_
* Packages: ``Neos``

`TASK: Remove unused legacy UI setting <https://github.com/neos/neos-development-collection/pull/3130>`_
--------------------------------------------------------------------------------------------------------

Part of #3137

* Packages: ``Neos``

`FEATURE: Allow users to log in without access to the content module <https://github.com/neos/neos-development-collection/pull/3123>`_
--------------------------------------------------------------------------------------------------------------------------------------

Before, it was not possible to log in to the Neos backend without having access to the content module, as the user was automatically redirected to the content module.

With this feature, an available module is determined when a user logs in and the user is redirected to that module.

# High level features

- Users no longer need to have access to the content module to be able to log in
- There is a setting `Neos.Neos.moduleConfiguration.preferredStartModules` available to define the preferred start modules. The first module of that list, which a user has access to is chosen for the start module. If none of the listed modules can be accessed, the first module of the list of accessible modules of a user is chosen:
- The backend modules and sub modules can now be sorted using the positional array sorter

```
Neos:
  Neos:
    moduleConfiguration:
      preferredStartModules: [ 'content', 'user/usersettings' ]
```

## Details

- A user who has no access to the content module is redirected to the first (preferred) accessible content module
- A user who has access to the content module is still redirected to the content module by default
- A user without access to the content module does not see the available sites menu
- When the `preferredStartModule` is not `content`, the content module is still selectable

# Update notes

- This removes `Neos.Neos.userInterface.routeAfterLogin`, it can be dropped from custom configuration

* Resolves: `#2351 <https://github.com/neos/neos-development-collection/issues/2351>`_
Depends on: https://github.com/neos/neos-ui/pull/2793

* Packages: ``Neos``

`BUGFIX: Fix LinkingService for CLI mode <https://github.com/neos/neos-development-collection/pull/3129>`_
----------------------------------------------------------------------------------------------------------

Specifies the HTTP request from the ControllerContext as
fallback for the `BaseUriProvider` in order to prevent an
exception when trying to create Node URIs on the CLI.

Note: This requires https://github.com/neos/flow-development-collection/pull/2158

* Fixes: `#3128 <https://github.com/neos/neos-development-collection/issues/3128>`_
Related: https://github.com/neos/flow-development-collection/issues/2084

* Packages: ``Neos``

`BUGFIX: Fix LinkingService for CLI mode <https://github.com/neos/neos-development-collection/pull/3129>`_
----------------------------------------------------------------------------------------------------------

Specifies the HTTP request from the ControllerContext as
fallback for the `BaseUriProvider` in order to prevent an
exception when trying to create Node URIs on the CLI.

Note: This requires https://github.com/neos/flow-development-collection/pull/2158

* Fixes: `#3128 <https://github.com/neos/neos-development-collection/issues/3128>`_
Related: https://github.com/neos/flow-development-collection/issues/2084

* Packages: ``Neos``

`TASK: Remove unused backend content container <https://github.com/neos/neos-development-collection/pull/3127>`_
----------------------------------------------------------------------------------------------------------------

The view helper and the "corresponding" template seems
not to be used anywhere in the core anymore

* Packages: ``BaseMixins`` ``Neos``

`BUGFIX: Require jQuery Version 3.5.1 <https://github.com/neos/neos-development-collection/pull/3126>`_
-------------------------------------------------------------------------------------------------------

After the https://github.com/neos/neos-development-collection/pull/3023 the image selector in the backend was broken.

* Packages: ``Browser``

`TASK: Code cleanup in backend login area <https://github.com/neos/neos-development-collection/pull/3122>`_
-----------------------------------------------------------------------------------------------------------

Code cleanup and method typing in preparation of #2351 
No functional changes.

* Packages: ``Neos``

`!!! TASK: Remove the backend menu API controller <https://github.com/neos/neos-development-collection/pull/3125>`_
-------------------------------------------------------------------------------------------------------------------

Seems as this is a leftover of the old UI and is not used anywhere
in the current code.

* Packages: ``Browser`` ``Neos``

`TASK: Apply fixes from StyleCI <https://github.com/neos/neos-development-collection/pull/3106>`_
-------------------------------------------------------------------------------------------------

This pull request applies code style fixes from an analysis carried out by `StyleCI <https://github.styleci.io>`_.

---

For more information, click `here <https://github.styleci.io/analyses/RvbyGK>`_.

`TASK: Apply fixes from StyleCI <https://github.com/neos/neos-development-collection/pull/3107>`_
-------------------------------------------------------------------------------------------------

This pull request applies code style fixes from an analysis carried out by `StyleCI <https://github.styleci.io>`_.

---

For more information, click `here <https://github.styleci.io/analyses/4xEKGe>`_.

* Packages: ``Browser`` ``ContentRepository`` ``Diff`` ``Fusion`` ``Media`` ``Neos``

`FEATURE: Use breadcrumb for URL preview <https://github.com/neos/neos-development-collection/pull/3100>`_
----------------------------------------------------------------------------------------------------------

This replaces the (preview) URL by a "breadcrumb" to the homepage node.

Essentially applies https://github.com/neos/neos-development-collection/pull/2966
to the 4.3 branch, since the breadcrumb is a lot more user-friendly than the
URL.

* Packages: ``Neos``

`BUGFIX: Migrate icons from TYPO3.Media to Neos.Media <https://github.com/neos/neos-development-collection/pull/3101>`_
-----------------------------------------------------------------------------------------------------------------------

* Fixes: `#2341 <https://github.com/neos/neos-development-collection/issues/2341>`_
* Packages: ``Media``

`TASK: Add new login wallpaper for Neos 5.3 <https://github.com/neos/neos-development-collection/pull/3105>`_
-------------------------------------------------------------------------------------------------------------

* Packages: ``Media`` ``Neos``

`BUGFIX: Correctly set apply values for instantiated array objects <https://github.com/neos/neos-development-collection/pull/3103>`_
------------------------------------------------------------------------------------------------------------------------------------

With the introduction of lazy evaluation the apply values are stored as
an array of (absolute) paths and popped accordingly to the evaluation
stack. When an object is instantiated only the effective apply values
for this object must be set (and not all currently set apply values).

* Fixes: `#3003 <https://github.com/neos/neos-development-collection/issues/3003>`_

**What I did**

Adjusted the code in Runtime to only set applicable (stored) apply values when instantiating an object.

**How I did it**

- Reproduced the error
- Analyzed the rendering of the broken case with some added debugging output
- Found the case where `Case` will be instantiated with wrong props and spotted the issue introduced with `0642115d529237bd30ae1502a78409e7739c4718 <https://github.com/neos/neos-development-collection/commit/0642115d529237bd30ae1502a78409e7739c4718>`_
- Implemented a minimal functional test case that reproduces the error
- Implemented the fix by only setting the actual apply values for the Fusion object (we already remember these for popping them after leaving the evaluation stack) and not _everything_ ever `@apply`'d

**How to verify it**

- Check the new functional test without the change to Runtime, it exposes the error from #3003
- Add a NodeType like described in #3003 and check the rendering

* Packages: ``Fusion`` ``Media`` ``Neos``

`FEATURE: third parameter "sortFlags" for FlowQuery sort() <https://github.com/neos/neos-development-collection/pull/2989>`_
----------------------------------------------------------------------------------------------------------------------------

On enabling Psmb/FlatNav I stumbled over the FlowQuery sort operation having the demand for case insensitive sort.

Here's the solution: a third optional `sort()` parameter for sortOptions.

The FlowQuery `sort()` is executed utilizing PHP `arsort()`. According to the sort flags of `arsort()` (see `https://www.php.net/manual/en/function.sort <https://www.php.net/manual/en/function.sort>`_) the sort options are:

```
'SORT_REGULAR'
'SORT_NUMERIC'
'SORT_STRING'
'SORT_LOCALE_STRING'
'SORT_NATURAL'
'SORT_FLAG_CASE' (use as last option with SORT_STRING, SORT_LOCALE_STRING or SORT_NATURAL)
```
A single sort option can be supplied as string. Multiple sort options are supplied as array.

Other than the above listed sort options shall throw an error.

Omitting the third parameter leaves FlowQuery `sort()` in `SORT_REGULAR` sort mode.

How to use (example for Psmb/FlatNav) in `Settings.yaml`:
```
      frontendConfiguration:
        Psmb_FlatNav:
          presets:
            tree:
              type: tree
              label: tree
              icon: tree
            pressTags:
              label: 'Press Tags'
              icon: icon-hashtag
              type: flat
              query: 'q(node).find("[instanceof My.Site:Document.PressTag]").sort("title", "ASC", ["SORT_NATURAL", "SORT_FLAG_CASE"]).get()'
              ...
            numberTags:
              label: 'Number Tags'
              icon: arrow-circle-up
              type: flat
              query: 'q(node).find("[instanceof My.Site:Document.NumberTag]").sort("title", "ASC", "SORT_NUMERIC").get()'
              ...
```
In the line `query:` of `pressTags:` you can see FlowQuery `sort()`in action:
```
    sort("title", "ASC", ["SORT_NATURAL", "SORT_FLAG_CASE"])
```
with sort flags `["SORT_NATURAL", "SORT_FLAG_CASE"]` passed as array for natural, case insensitive sort.

The line `query:`of `numberTags:` has a single sort option `"SORT_NUMERIC"` passed as string:
```
    sort("title", "ASC", "SORT_NUMERIC")
```

* Packages: ``Neos``

`BUGFIX: TransientNodeCache must be able to return null <https://github.com/neos/neos-development-collection/pull/3097>`_
-------------------------------------------------------------------------------------------------------------------------

This is an important bugfix because right now non existing nodes will result in a fatal error 
due to the type hint, when the $getter() actually doesn't resolve a node but null, which can happen.
The current behavior is therefore broken for many installations.

Relate #2301

* Packages: ``ContentRepository`` ``Neos``

`BUGFIX: Migrate media browser icons <https://github.com/neos/neos-development-collection/pull/3091>`_
------------------------------------------------------------------------------------------------------

In Neos prior to 4.1, the media browser uses PNG resources to show thumbnails for non graphical documents from `…/Public/Icons/`, like `ppt.png`. In 4.1 the PNG ressources were removed and replaced by SVG resources from `…/Resources/Public/IconSets/vivid/`. When you add new files after the upgrade, the valid SVG resources are used, but old assets still refer to their old resources, which are missing. As a result, the media browser shows the rotating “loading” icon for these old documents.

This adds Doctrine migrations to replace the old with the  new icons in the database.

* Fixes: `#2341 <https://github.com/neos/neos-development-collection/issues/2341>`_
* Packages: ``Media``

`TASK: Bump elliptic from 6.5.0 to 6.5.3 in /Neos.Neos <https://github.com/neos/neos-development-collection/pull/3024>`_
------------------------------------------------------------------------------------------------------------------------

Bumps `elliptic <https://github.com/indutny/elliptic>`_ from 6.5.0 to 6.5.3.
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/indutny/elliptic/commit/`8647803dc3d90506aa03021737f7b061ba959ae1 <https://github.com/neos/neos-development-collection/commit/8647803dc3d90506aa03021737f7b061ba959ae1>`_"><code>8647803</code></a> 6.5.3</li>
<li><a href="https://github.com/indutny/elliptic/commit/`856fe4d99fe7b6200556e6400b3bf585b1721bec <https://github.com/neos/neos-development-collection/commit/856fe4d99fe7b6200556e6400b3bf585b1721bec>`_"><code>856fe4d</code></a> signature: prevent malleability and overflows</li>
<li><a href="https://github.com/indutny/elliptic/commit/`60489415e545efdfd3010ae74b9726facbf08ca8 <https://github.com/neos/neos-development-collection/commit/60489415e545efdfd3010ae74b9726facbf08ca8>`_"><code>6048941</code></a> 6.5.2</li>
<li><a href="https://github.com/indutny/elliptic/commit/`9984964457c9f8a63b91b01ea103260417eca237 <https://github.com/neos/neos-development-collection/commit/9984964457c9f8a63b91b01ea103260417eca237>`_"><code>9984964</code></a> package: bump dependencies</li>
<li><a href="https://github.com/indutny/elliptic/commit/`ec735edde187a43693197f6fa3667ceade751a3a <https://github.com/neos/neos-development-collection/commit/ec735edde187a43693197f6fa3667ceade751a3a>`_"><code>ec735ed</code></a> utils: leak less information in <code>getNAF()</code></li>
<li><a href="https://github.com/indutny/elliptic/commit/`71e4e8e2f5b8f0bdbfbe106c72cc9fbc746d3d60 <https://github.com/neos/neos-development-collection/commit/71e4e8e2f5b8f0bdbfbe106c72cc9fbc746d3d60>`_"><code>71e4e8e</code></a> 6.5.1</li>
<li><a href="https://github.com/indutny/elliptic/commit/`7ec66ffa255079260126d87b1762a59ea10de5ea <https://github.com/neos/neos-development-collection/commit/7ec66ffa255079260126d87b1762a59ea10de5ea>`_"><code>7ec66ff</code></a> short: add infinity check before multiplying</li>
<li><a href="https://github.com/indutny/elliptic/commit/`ee7970b92f388e981d694be0436c4c8036b5d36c <https://github.com/neos/neos-development-collection/commit/ee7970b92f388e981d694be0436c4c8036b5d36c>`_"><code>ee7970b</code></a> travis: really move on</li>
<li><a href="https://github.com/indutny/elliptic/commit/`637d0216b58de7edee4f3eb5641295ac323acadb <https://github.com/neos/neos-development-collection/commit/637d0216b58de7edee4f3eb5641295ac323acadb>`_"><code>637d021</code></a> travis: move on</li>
<li><a href="https://github.com/indutny/elliptic/commit/`5ed0babb6467cd8575a9218265473fda926d9d42 <https://github.com/neos/neos-development-collection/commit/5ed0babb6467cd8575a9218265473fda926d9d42>`_"><code>5ed0bab</code></a> package: update deps</li>
<li>See full diff in <a href="https://github.com/indutny/elliptic/compare/v6.5.0...v6.5.3">compare view</a></li>
</ul>
</details>
<br />

`![Dependabot compatibility score <https://dependabot-badges.githubapp.com/badges/compatibility_score?dependency-name=elliptic&package-manager=npm_and_yarn&previous-version=6.5.0&new-version=6.5.3>`_](https://help.github.com/articles/configuring-automated-security-fixes)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language

You can disable automated security fix PRs for this repo from the `Security Alerts page <https://github.com/neos/neos-development-collection/network/alerts>`_.

</details>

* Packages: ``Neos``

`TASK: Bump jquery from 3.4.1 to 3.5.0 in /Neos.Neos <https://github.com/neos/neos-development-collection/pull/3023>`_
----------------------------------------------------------------------------------------------------------------------

Bumps `jquery <https://github.com/jquery/jquery>`_ from 3.4.1 to 3.5.0.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/jquery/jquery/releases">jquery's releases</a>.</em></p>
<blockquote>
<h2>jQuery 3.5.0 Released!</h2>
<p>See the blog post:
<a href="https://blog.jquery.com/2020/04/10/jquery-3-5-0-released/">https://blog.jquery.com/2020/04/10/jquery-3-5-0-released/</a>
and the upgrade guide:
<a href="https://jquery.com/upgrade-guide/3.5/">https://jquery.com/upgrade-guide/3.5/</a></p>
<p><strong>NOTE:</strong> Despite being a minor release, this update includes a breaking change that we had to make to fix <a href="https://github.com/advisories/GHSA-gxr4-xjj5-5px2">a security issue</a> ( <a href="https://nvd.nist.gov/vuln/detail/CVE-2020-11022"><code>CVE-2020-11022</code></a>). Please follow the blog post &amp; the upgrade guide for more details.</p>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/jquery/jquery/commit/`7a0a850f3d41c0412609c1d32b1e602d4afe2f4e <https://github.com/neos/neos-development-collection/commit/7a0a850f3d41c0412609c1d32b1e602d4afe2f4e>`_"><code>7a0a850</code></a> 3.5.0</li>
<li><a href="https://github.com/jquery/jquery/commit/`8570a08f6689223aa06ca8cc51d488c6d81d44f9 <https://github.com/neos/neos-development-collection/commit/8570a08f6689223aa06ca8cc51d488c6d81d44f9>`_"><code>8570a08</code></a> Release: Update AUTHORS.txt</li>
<li><a href="https://github.com/jquery/jquery/commit/`da3dd85b63c4e3a6a768132c2a83a1a6eec24840 <https://github.com/neos/neos-development-collection/commit/da3dd85b63c4e3a6a768132c2a83a1a6eec24840>`_"><code>da3dd85</code></a> Ajax: Do not execute scripts for unsuccessful HTTP responses</li>
<li><a href="https://github.com/jquery/jquery/commit/`065143c2e93512eb0c82d1b344b71d06eb7cf01c <https://github.com/neos/neos-development-collection/commit/065143c2e93512eb0c82d1b344b71d06eb7cf01c>`_"><code>065143c</code></a> Ajax: Overwrite s.contentType with content-type header value, if any</li>
<li><a href="https://github.com/jquery/jquery/commit/`1a4f10ddc37c34c6dc3a451ee451b5c6cf367399 <https://github.com/neos/neos-development-collection/commit/1a4f10ddc37c34c6dc3a451ee451b5c6cf367399>`_"><code>1a4f10d</code></a> Tests: Blacklist one focusin test in IE</li>
<li><a href="https://github.com/jquery/jquery/commit/`9e15d6b469556eccfa607c5ecf53b20c84529125 <https://github.com/neos/neos-development-collection/commit/9e15d6b469556eccfa607c5ecf53b20c84529125>`_"><code>9e15d6b</code></a> Event: Use only one focusin/out handler per matching window &amp; document</li>
<li><a href="https://github.com/jquery/jquery/commit/`966a70909019aa09632c87c0002c522fa4a1e30e <https://github.com/neos/neos-development-collection/commit/966a70909019aa09632c87c0002c522fa4a1e30e>`_"><code>966a709</code></a> Manipulation: Skip the select wrapper for &lt;option&gt; outside of IE 9</li>
<li><a href="https://github.com/jquery/jquery/commit/`1d61fd9407e6fbe82fe55cb0b938307aa0791f77 <https://github.com/neos/neos-development-collection/commit/1d61fd9407e6fbe82fe55cb0b938307aa0791f77>`_"><code>1d61fd9</code></a> Manipulation: Make jQuery.htmlPrefilter an identity function</li>
<li><a href="https://github.com/jquery/jquery/commit/`04bf577e2f961c9dde85ddadc77f71bc7bc671cc <https://github.com/neos/neos-development-collection/commit/04bf577e2f961c9dde85ddadc77f71bc7bc671cc>`_"><code>04bf577</code></a> Selector: Update Sizzle from 2.3.4 to 2.3.5</li>
<li><a href="https://github.com/jquery/jquery/commit/`7506c9ca62a2f3ef773e19385918c31e9d62d412 <https://github.com/neos/neos-development-collection/commit/7506c9ca62a2f3ef773e19385918c31e9d62d412>`_"><code>7506c9c</code></a> Build: Resolve Travis config warnings</li>
<li>Additional commits viewable in <a href="https://github.com/jquery/jquery/compare/3.4.1...3.5.0">compare view</a></li>
</ul>
</details>
<details>
<summary>Maintainer changes</summary>
<p>This version was pushed to npm by <a href="https://www.npmjs.com/~mgol">mgol</a>, a new releaser for jquery since your current version.</p>
</details>
<br />

`![Dependabot compatibility score <https://dependabot-badges.githubapp.com/badges/compatibility_score?dependency-name=jquery&package-manager=npm_and_yarn&previous-version=3.4.1&new-version=3.5.0>`_](https://help.github.com/articles/configuring-automated-security-fixes)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language

You can disable automated security fix PRs for this repo from the `Security Alerts page <https://github.com/neos/neos-development-collection/network/alerts>`_.

</details>

* Packages: ``Neos``

`TASK: Bump acorn from 6.2.1 to 6.4.1 in /Neos.Neos <https://github.com/neos/neos-development-collection/pull/3022>`_
---------------------------------------------------------------------------------------------------------------------

Bumps `acorn <https://github.com/acornjs/acorn>`_ from 6.2.1 to 6.4.1.
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/acornjs/acorn/commit/`9a2e9b6678e243d66846b91179d650d28453e70c <https://github.com/neos/neos-development-collection/commit/9a2e9b6678e243d66846b91179d650d28453e70c>`_"><code>9a2e9b6</code></a> Mark version 6.4.1</li>
<li><a href="https://github.com/acornjs/acorn/commit/`90a9548ea0ce351b54f956e2c4ed27cca9631284 <https://github.com/neos/neos-development-collection/commit/90a9548ea0ce351b54f956e2c4ed27cca9631284>`_"><code>90a9548</code></a> More rigorously check surrogate pairs in regexp validator</li>
<li><a href="https://github.com/acornjs/acorn/commit/`df0cf1a3e2b1a51a26c14984dc0f5412b7151b10 <https://github.com/neos/neos-development-collection/commit/df0cf1a3e2b1a51a26c14984dc0f5412b7151b10>`_"><code>df0cf1a</code></a> Mark version 6.4.0</li>
<li><a href="https://github.com/acornjs/acorn/commit/`53034126864b492da4e278628bb972cb2a9313d4 <https://github.com/neos/neos-development-collection/commit/53034126864b492da4e278628bb972cb2a9313d4>`_"><code>5303412</code></a> Also export Parser via Parser.acorn</li>
<li><a href="https://github.com/acornjs/acorn/commit/`efe273e70123449a458157dbf578afaf109a49ab <https://github.com/neos/neos-development-collection/commit/efe273e70123449a458157dbf578afaf109a49ab>`_"><code>efe273e</code></a> give token types and etc to plugins</li>
<li><a href="https://github.com/acornjs/acorn/commit/`ac6decb94a3aa4eee99230fdaf5883dfaafe8479 <https://github.com/neos/neos-development-collection/commit/ac6decb94a3aa4eee99230fdaf5883dfaafe8479>`_"><code>ac6decb</code></a> Mark version 6.3.0</li>
<li><a href="https://github.com/acornjs/acorn/commit/`7e9817d17639d95cc6dbacfde734a0626b2a7dea <https://github.com/neos/neos-development-collection/commit/7e9817d17639d95cc6dbacfde734a0626b2a7dea>`_"><code>7e9817d</code></a> Allow sourceType: module even with ecmaVersion &lt; 6</li>
<li><a href="https://github.com/acornjs/acorn/commit/`e2b8cc087386eccc2ad6fd4a02b4257833557cb3 <https://github.com/neos/neos-development-collection/commit/e2b8cc087386eccc2ad6fd4a02b4257833557cb3>`_"><code>e2b8cc0</code></a> Fix broken parsing of new expressions when allowReserved==&quot;never&quot;</li>
<li><a href="https://github.com/acornjs/acorn/commit/`1555c528855b10320ce98b4154906d7898c92990 <https://github.com/neos/neos-development-collection/commit/1555c528855b10320ce98b4154906d7898c92990>`_"><code>1555c52</code></a> Update acorn.d.ts</li>
<li>See full diff in <a href="https://github.com/acornjs/acorn/compare/6.2.1...6.4.1">compare view</a></li>
</ul>
</details>
<br />

`![Dependabot compatibility score <https://dependabot-badges.githubapp.com/badges/compatibility_score?dependency-name=acorn&package-manager=npm_and_yarn&previous-version=6.2.1&new-version=6.4.1>`_](https://help.github.com/articles/configuring-automated-security-fixes)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language

You can disable automated security fix PRs for this repo from the `Security Alerts page <https://github.com/neos/neos-development-collection/network/alerts>`_.

</details>

* Packages: ``Neos``

`TASK: Remove deprecated code use from ContentCollectionRenderer <https://github.com/neos/neos-development-collection/pull/2772>`_
----------------------------------------------------------------------------------------------------------------------------------

This replaces the use of `Neos.Fusion:Collection` with `Neos.Fusion:Loop`
and `Neos.Fusion:Array` with `Neos.Fusion:Join`.

To ensure backwards compatibility there is a processor which overrides
`items` if the property `collection` is set.

* Packages: ``Neos``

`Bump lodash from 4.17.15 to 4.17.19 in /Neos.Neos <https://github.com/neos/neos-development-collection/pull/3016>`_
--------------------------------------------------------------------------------------------------------------------

Bumps `lodash <https://github.com/lodash/lodash>`_ from 4.17.15 to 4.17.19.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href="https://github.com/lodash/lodash/releases">lodash's releases</a>.</em></p>
<blockquote>
<h2>4.17.16</h2>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href="https://github.com/lodash/lodash/commit/`d7fbc52ee0466a6d248f047b5d5c3e6d1e099056 <https://github.com/neos/neos-development-collection/commit/d7fbc52ee0466a6d248f047b5d5c3e6d1e099056>`_"><code>d7fbc52</code></a> Bump to v4.17.19</li>
<li><a href="https://github.com/lodash/lodash/commit/`2e1c0f22f425e9c013815b2cd7c2ebd51f49a8d6 <https://github.com/neos/neos-development-collection/commit/2e1c0f22f425e9c013815b2cd7c2ebd51f49a8d6>`_"><code>2e1c0f2</code></a> Add npm-package</li>
<li><a href="https://github.com/lodash/lodash/commit/`1b6c282299f4e0271f932b466c67f0f822aa308e <https://github.com/neos/neos-development-collection/commit/1b6c282299f4e0271f932b466c67f0f822aa308e>`_"><code>1b6c282</code></a> Bump to v4.17.18</li>
<li><a href="https://github.com/lodash/lodash/commit/`a370ac81408de2da77a82b3c4b61a01a3b9c2fac <https://github.com/neos/neos-development-collection/commit/a370ac81408de2da77a82b3c4b61a01a3b9c2fac>`_"><code>a370ac8</code></a> Bump to v4.17.17</li>
<li><a href="https://github.com/lodash/lodash/commit/`1144918f3578a84fcc4986da9b806e63a6175cbb <https://github.com/neos/neos-development-collection/commit/1144918f3578a84fcc4986da9b806e63a6175cbb>`_"><code>1144918</code></a> Rebuild lodash and docs</li>
<li><a href="https://github.com/lodash/lodash/commit/`3a3b0fd339c2109563f7e8167dc95265ed82ef3e <https://github.com/neos/neos-development-collection/commit/3a3b0fd339c2109563f7e8167dc95265ed82ef3e>`_"><code>3a3b0fd</code></a> Bump to v4.17.16</li>
<li><a href="https://github.com/lodash/lodash/commit/`c84fe82760fb2d3e03a63379b297a1cc1a2fce12 <https://github.com/neos/neos-development-collection/commit/c84fe82760fb2d3e03a63379b297a1cc1a2fce12>`_"><code>c84fe82</code></a> fix(zipObjectDeep): prototype pollution (<a href="https://github-redirect.dependabot.com/lodash/lodash/issues/4759">#4759</a>)</li>
<li><a href="https://github.com/lodash/lodash/commit/`e7b28ea6cb17b4ca021e7c9d66218c8c89782f32 <https://github.com/neos/neos-development-collection/commit/e7b28ea6cb17b4ca021e7c9d66218c8c89782f32>`_"><code>e7b28ea</code></a> Sanitize sourceURL so it cannot affect evaled code (<a href="https://github-redirect.dependabot.com/lodash/lodash/issues/4518">#4518</a>)</li>
<li><a href="https://github.com/lodash/lodash/commit/`0cec225778d4ac26c2bac95031ecc92a94f08bbb <https://github.com/neos/neos-development-collection/commit/0cec225778d4ac26c2bac95031ecc92a94f08bbb>`_"><code>0cec225</code></a> Fix lodash.isEqual for circular references (<a href="https://github-redirect.dependabot.com/lodash/lodash/issues/4320">#4320</a>) (<a href="https://github-redirect.dependabot.com/lodash/lodash/issues/4515">#4515</a>)</li>
<li><a href="https://github.com/lodash/lodash/commit/`94c3a8133cb4fcdb50db72b4fd14dd884b195cd5 <https://github.com/neos/neos-development-collection/commit/94c3a8133cb4fcdb50db72b4fd14dd884b195cd5>`_"><code>94c3a81</code></a> Document matches* shorthands for over* methods (<a href="https://github-redirect.dependabot.com/lodash/lodash/issues/4510">#4510</a>) (<a href="https://github-redirect.dependabot.com/lodash/lodash/issues/4514">#4514</a>)</li>
<li>Additional commits viewable in <a href="https://github.com/lodash/lodash/compare/4.17.15...4.17.19">compare view</a></li>
</ul>
</details>
<details>
<summary>Maintainer changes</summary>
<p>This version was pushed to npm by <a href="https://www.npmjs.com/~mathias">mathias</a>, a new releaser for lodash since your current version.</p>
</details>
<br />

`![Dependabot compatibility score <https://dependabot-badges.githubapp.com/badges/compatibility_score?dependency-name=lodash&package-manager=npm_and_yarn&previous-version=4.17.15&new-version=4.17.19>`_](https://help.github.com/articles/configuring-automated-security-fixes)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language

You can disable automated security fix PRs for this repo from the `Security Alerts page <https://github.com/neos/neos-development-collection/network/alerts>`_.

</details>

* Packages: ``Neos``

`FEATURE: User management for non-admins <https://github.com/neos/neos-development-collection/pull/2322>`_
----------------------------------------------------------------------------------------------------------

This introduces a new role `Neos.Neos:UserManager`. When an editor has that role, he is able to manage users with roles not exceeding his own, without being an Administrator.

!`peek 2018-12-15 23-40 <https://user-images.githubusercontent.com/837032/50047249-cf1dc180-00c2-11e9-85d0-2fe681f70e26.gif>`_

* Packages: ``Neos``

`BUGFIX: Repair icon rendering for flash messages <https://github.com/neos/neos-development-collection/pull/3083>`_
-------------------------------------------------------------------------------------------------------------------

**What I did**
Changed the font-family to the correct value `Font Awesome 5 Free`

**How to verify it**
Change a user in the backend for instance and check the flashmessage.

* Fixes: `#3069 <https://github.com/neos/neos-development-collection/issues/3069>`_ 
* Packages: ``Neos``

`TASK: Bump websocket-extensions from 0.1.3 to 0.1.4 in /Neos.Media.Browser <https://github.com/neos/neos-development-collection/pull/3032>`_
---------------------------------------------------------------------------------------------------------------------------------------------

Bumps `websocket-extensions <https://github.com/faye/websocket-extensions-node>`_ from 0.1.3 to 0.1.4.

* Packages: ``Browser``

`TASK: Apply fixes from StyleCI <https://github.com/neos/neos-development-collection/pull/3076>`_
-------------------------------------------------------------------------------------------------

This pull request applies code style fixes from an analysis carried out by `StyleCI <https://github.styleci.io>`_.

---

For more information, click `here <https://github.styleci.io/analyses/e74pRP>`_.

* Packages: ``Fusion``

`TASK: Apply fixes from StyleCI <https://github.com/neos/neos-development-collection/pull/3075>`_
-------------------------------------------------------------------------------------------------

This pull request applies code style fixes from an analysis carried out by `StyleCI <https://github.styleci.io>`_.

---

For more information, click `here <https://github.styleci.io/analyses/4xRDKe>`_.

* Packages: ``Browser`` ``ContentRepository`` ``Fusion`` ``Media`` ``Neos``

`TASK: Apply fixes from StyleCI <https://github.com/neos/neos-development-collection/pull/3072>`_
-------------------------------------------------------------------------------------------------

This pull request applies code style fixes from an analysis carried out by `StyleCI <https://github.styleci.io>`_.

---

For more information, click `here <https://github.styleci.io/analyses/aj4pmk>`_.

`Apply fixes from StyleCI <https://github.com/neos/neos-development-collection/pull/3073>`_
-------------------------------------------------------------------------------------------

This pull request applies code style fixes from an analysis carried out by `StyleCI <https://github.styleci.io>`_.

---

For more information, click `here <https://github.styleci.io/analyses/KZx4WV>`_.

* Packages: ``Browser`` ``ContentRepository`` ``Diff`` ``Fusion`` ``Media`` ``Neos``

`FEATURE: Make login controller view configurable using Views.yaml <https://github.com/neos/neos-development-collection/pull/3009>`_
------------------------------------------------------------------------------------------------------------------------------------

The login controller view was not configurable using a `Views.yaml` (as was the case for Neos 3 & 4.)
This is fixed by adding a `Views.yaml` and removing `initializeView()` from `LoginController`.

Now the Login screen can be customized again by creating custom Fusion for rendering it (see
`Neos.Neos/Resources/Private/Fusion/Backend` for inspiration) and adjusting the path used
through `Views.yaml`, e.g.

    -
      requestFilter: 'isPackage("Neos.Neos") && isController("Login") && isAction("index") && isFormat("html")'
      options:
        fusionPathPatterns:
          - 'resource://Acme.Com/Private/Fusion/NeosLogin'

* Resolves: `#3041 <https://github.com/neos/neos-development-collection/issues/3041>`_
* Packages: ``Browser``

`TASK: Improve wording of include/exclude concepts where possible <https://github.com/neos/neos-development-collection/pull/2992>`_
-----------------------------------------------------------------------------------------------------------------------------------

Matching change with https://github.com/neos/flow-development-collection/pull/2024

* Packages: ``ContentRepository``

`BUGFIX: Prevent refetching nodes for policy checks <https://github.com/neos/neos-development-collection/pull/2302>`_
---------------------------------------------------------------------------------------------------------------------

When defining a policy targeting a static node the static node was
refetched for every subject, slowing down policy information retrieval.

This adds a simple caching mechanism to `NodePrivilegeContext::getNodeByIdentifier`
that prevents nodes from being refetched for static policy comparisons.

* Resolves: `#2301 <https://github.com/neos/neos-development-collection/issues/2301>`_
* Packages: ``Browser`` ``ContentRepository``

`TASK: Apply fixes from StyleCI <https://github.com/neos/neos-development-collection/pull/3059>`_
-------------------------------------------------------------------------------------------------

This pull request applies code style fixes from an analysis carried out by `StyleCI <https://github.styleci.io>`_.

---

For more information, click `here <https://github.styleci.io/analyses/OMdgkW>`_.

`Apply fixes from StyleCI <https://github.com/neos/neos-development-collection/pull/3060>`_
-------------------------------------------------------------------------------------------

This pull request applies code style fixes from an analysis carried out by `StyleCI <https://github.styleci.io>`_.

---

For more information, click `here <https://github.styleci.io/analyses/lKyEJV>`_.

* Packages: ``Browser`` ``ContentRepository`` ``Diff`` ``Fusion`` ``Media`` ``Neos``

`BUGFIX: Variants tab does not use mainRequest in form when opened from inspector <https://github.com/neos/neos-development-collection/pull/3008>`_
---------------------------------------------------------------------------------------------------------------------------------------------------

This adds a condition for using the parentRequest only if it is not the mainRequest already.

* Fixes: `#3005 <https://github.com/neos/neos-development-collection/issues/3005>`_
* Packages: ``Browser``

`BUGFIX: Make child nodes of hidden parents inaccessible <https://github.com/neos/neos-development-collection/pull/2998>`_
--------------------------------------------------------------------------------------------------------------------------

Since a couple of months child nodes of hidden nodes are accessible (outside the Neos backend). This change restores the initial behavior and makes sure that accessing child nodes from hidden nodes will lead to a 404 response.

resolves: https://github.com/neos/neos-development-collection/issues/2983

* Packages: ``ContentRepository`` ``Neos``

`TASK: Add types to workspace model <https://github.com/neos/neos-development-collection/pull/2921>`_
-----------------------------------------------------------------------------------------------------

* Packages: ``BaseMixins`` ``ContentRepository`` ``Neos``

`!!! BUGFIX: Speed up node move actions <https://github.com/neos/neos-development-collection/pull/3015>`_
---------------------------------------------------------------------------------------------------------

Due to an issue in how Doctrine 2.x handles the computation of changesets when given
entities to commit it recomputed the changesets for all entities for every entity.
Leading to n^2 change computations.

In a large project this improved the moving of ~750 nodes from 1.7m to 8.5s.
In the demo site moving the "features" page from 4s to 1.65s. 
Publishing seems to be only slightly (~10%) faster to its different behaviour in the CR.

**What I did**

Which this change this behaviour is circumvented by commiting all
entities at once. Including entities which might not have been included
with the previous code but would have been persisted at the end of the request
anyway.

**What is breaking**
This change leads to all entities scheduled for persistence to actually persist when a node is changed, see following comparison timelines:

Old:
1. Create Entity, mark for insertion
2. change node
3. controller call is done / persistAll was called -> entity from step one is now persisted

New:
1. Create Entity, mark for insertion
2. change node (entity will be persisted at this point)
3. controller call is done / persistAll was called -> nothing happens anymore.

**How I did it**

Replace the repeated flush calls to the entity manager with a single one.

This should only lead to a behavioural change if custom code would modify a node
then move other nodes and expect the the first node was not persisted yet.

**How to verify it**

1. Move a large set of pages with subpages and nodes in the Neos backend. 
2. Check the request time of the `change` xhr request.
3. Apply this patch
4. Repeat steps 1 + 2 and compare

Example screenshots:

Before:

<img width="600" alt="before-change" src="https://user-images.githubusercontent.com/596967/87766599-b4b94600-c819-11ea-9777-0bbe11f84d3a.png">

After:

<img width="600" alt="after-change" src="https://user-images.githubusercontent.com/596967/87766608-b7b43680-c819-11ea-83f9-2fbf1993cda7.png">


* Packages: ``ContentRepository``

`FEATURE: Configurable Asset Constraints <https://github.com/neos/neos-development-collection/pull/3013>`_
----------------------------------------------------------------------------------------------------------

Extends the Media Browser and Asset proxy search endpoint so
that it supports *constraints* that filter the asset lists
(on top of the user-specified filters).

This makes it possible to constraint asset source(s) and
media type(s) per node type property.

Example:

    'Some.Node:Type':
      properties:
        'asset':
          type: 'Neos\\Media\\Domain\\Model\\Asset'
          ui:
            inspector:
              group: 'asset'
              editorOptions:
                constraints:
                  mediaTypes: ['audio/*']
                  assetSources: ['neos', 'wikipedia_de']

(restricts the asset editor to only allow audio files of the `neos` or `wikipedia_de`
asset source when using the media browser modal, searchbox or file upload).

* Resolves: `#2984 <https://github.com/neos/neos-development-collection/issues/2984>`_
* Packages: ``BaseMixins`` ``Browser``

`TASK: Remove curly brace string offset access for PHP 7.4 compatibility <https://github.com/neos/neos-development-collection/pull/3011>`_
------------------------------------------------------------------------------------------------------------------------------------------

**What I did**
I changed string offset access from curly-braces to brackets

* Packages: ``Diff`` ``Neos``

`BUGFIX: Fix login screen if no background image is set <https://github.com/neos/neos-development-collection/pull/3007>`_
-------------------------------------------------------------------------------------------------------------------------

This will fix issue #3004 

* Packages: ``Neos``

`TASK: Update code documentation for TraversableNodeInterface <https://github.com/neos/neos-development-collection/pull/2999>`_
-------------------------------------------------------------------------------------------------------------------------------

Also improves deprecation warning for NodeInterface#getParent

1. The NodeInterface#getParent method is not fully equivalent to its deprecation replacement TraversableNodeInterface#findParentNode -> it should be at least mentioned on the deprecation waring, that those behaviors differ from each other
2. The comment on findParentNode was telling "two truths" about root node handling

* Packages: ``BaseMixins`` ``ContentRepository``

`BUGFIX: pass copied node to emitAfterNodeCopy signal <https://github.com/neos/neos-development-collection/pull/2995>`_
-----------------------------------------------------------------------------------------------------------------------

Pass copied node instead of current node instance to `emitAfterNodeCopy` signal.

This fixes #2994 

* Packages: ``Browser`` ``ContentRepository`` ``Neos``

`BUGFIX: Resolve error when backend session times out <https://github.com/neos/neos-development-collection/pull/3002>`_
-----------------------------------------------------------------------------------------------------------------------

**What I did**

Check view type before setting fusion paths

**How I did it**

See above

**How to verify it**

Close #2990 

* Packages: ``Browser`` ``Neos``

`BUGFIX: Fix path to Styles/<Lite.css> <https://github.com/neos/neos-development-collection/pull/2997>`_
--------------------------------------------------------------------------------------------------------

**What I did**
Remove the `/` in front of the Path for the resource.

**How to verify it**
Open Neos backend, e.g. User Manager and inspect the path in the HTML head for Lite.css

Closes #2996

* Packages: ``Browser`` ``Neos``

`BUGFIX: Add missing pagination styles for media browser <https://github.com/neos/neos-development-collection/pull/2993>`_
--------------------------------------------------------------------------------------------------------------------------

They got lost in the style split for 5.2 in #2874

* Packages: ``Browser`` ``Neos``

`FEATURE: Add option to disable the creation of redirects for assets <https://github.com/neos/neos-development-collection/pull/2964>`_
--------------------------------------------------------------------------------------------------------------------------------------

This feature adds a config parameter for the media browser to disable the option to create redirects for replaced assets resources. Might be useful for some projects, where these kind of redirects don't make any sense and therefore should be disabled by default.

<img width="987" alt="createAssetRedirectsOption" src="https://user-images.githubusercontent.com/36864084/79948497-46602400-8474-11ea-8859-46ef0a391eb2.png">

* Packages: ``BaseMixins`` ``Browser``

`BUGFIX: Passing glue string after array is deprecated <https://github.com/neos/neos-development-collection/pull/2982>`_
------------------------------------------------------------------------------------------------------------------------

Wrong parameter order leads to deprecation warning and to an exception
in PHP 7.4

* Packages: ``ContentRepository`` ``Neos``

`BUGFIX: Respect fallback rule "strictness" in FusionView <https://github.com/neos/neos-development-collection/pull/2976>`_
---------------------------------------------------------------------------------------------------------------------------

When Neos finds a content dimension named "language" it uses that
dimension to set the locale fallback order for rendering in the
`FusionView`.

In Neos 5.0 that rule was switched to "strict" mode, meaning the order
was used without falling back to implicit parents in locales. This
broke translations in case the "language" dimension was configured with
e.g. `de_DE` or `en_US` - for those cases translations were never used if
the respective XLIFF files were in `de` (or `en`) folders.

This change makes the `FusionView` use the strict flag from the settings,
giving back control to the user (in case non-strict is really needed).
At the same time it makes translations work as would be expected in
most cases, by using e.g. `de_DE` first, but falling back to `de` later.

* Fixes: `#2963 <https://github.com/neos/neos-development-collection/issues/2963>`_
* Packages: ``Neos``

`BUGFIX: Revert ContentCollection constraint change <https://github.com/neos/neos-development-collection/pull/2978>`_
---------------------------------------------------------------------------------------------------------------------

This reverts commit `b48660b28c1de596e74d4a95b8547d743b5199f1 <https://github.com/neos/neos-development-collection/commit/b48660b28c1de596e74d4a95b8547d743b5199f1>`_ as it’s breaking the „constraint“ best practices for node types and allows to many NodeTypes in existing projects suddenly.

As the previous fix is still necessary I will create a new PR for a next Neos version 5.3 or 6.0 depending on the final solution.

Without the fix the actual constraint to only allow Content NodeTypes is done by the Neos.Ui and NOT by our NodeType definition which causes an inconsistency when working with the CR via its API or when analysing the NodeType definitions.

* Packages: ``BaseMixins`` ``Neos``

`FEATURE: Add keyRenderer to render the key in the result map <https://github.com/neos/neos-development-collection/pull/2977>`_
-------------------------------------------------------------------------------------------------------------------------------

This adds a new fusionPath `keyRenderer` to render
the key of the resulting collection of `Neos.Fusion:Map`

Example:

```
keyRenderer = Neos.Fusion:Map {
  items = ${items}
  itemName = 'element'
  itemRenderer = ${'value-' + element}
  keyRenderer = ${'key-' + element}
}
```

will render:

```
['key-element1' => 'value-element1', 'key-element2' => 'value-element2']
```

* Packages: ``Fusion`` ``Neos``

`TASK: Fix failing evaluateReplaceResourceLinkTargetsInsideTag test <https://github.com/neos/neos-development-collection/pull/2972>`_
-------------------------------------------------------------------------------------------------------------------------------------

Fixes the test that is failing since merging https://github.com/neos/neos-development-collection/pull/2409

* Packages: ``Neos``

`TASK: Add release notes for Neos 5.2.0 <https://github.com/neos/neos-development-collection/pull/2970>`_
---------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`TASK: Throw exception when lazy props are attempted to be changed <https://github.com/neos/neos-development-collection/pull/2971>`_
------------------------------------------------------------------------------------------------------------------------------------

As per discussion in https://github.com/neos/neos-development-collection/pull/2738#discussion_r403867758

/cc @bwaidelich 

* Packages: ``Fusion``

`BUGFIX: Don’t override default button style in modules <https://github.com/neos/neos-development-collection/pull/2967>`_
---------------------------------------------------------------------------------------------------------------------------

The standard module stylesheet applied a lot of
styles to `<button>`. With this change this only
happens when using the backwards compatible
„Full“ stylesheet as the Lite and Minimal (introduced with 5.2) 
shouldn’t interfere with the modules styles.

* Packages: ``Neos``

`BUGFIX: Prevent exception in asset usage view via editor <https://github.com/neos/neos-development-collection/pull/2957>`_
---------------------------------------------------------------------------------------------------------------------------

* Resolves: `#2956 <https://github.com/neos/neos-development-collection/issues/2956>`_
* Packages: ``Browser``

`BUGFIX: Respect super types in CreateNodePrivilege <https://github.com/neos/neos-development-collection/pull/2961>`_
---------------------------------------------------------------------------------------------------------------------

Fixes the `createdNodeIsOfType()` matcher so that it works respects
the inheritance chain:

  privilegeTargets:
    'Neos\\ContentRepository\\Security\\Authorization\\Privilege\\Node\\CreateNodePrivilege':
      'Cornelsen.Webkatalog:Nodes.DisableCreation':
        matcher: 'createdNodeIsOfType("Some.Package:Some.Mixin")'

* Fixes: `#2960 <https://github.com/neos/neos-development-collection/issues/2960>`_
* Packages: ``ContentRepository``

`TASK: Replace login wallpaper <https://github.com/neos/neos-development-collection/pull/2969>`_
------------------------------------------------------------------------------------------------

Picture contributed by Matthias Widmer.

See: https://discuss.neos.io/t/neos-5-2-login-wallpaper/4912/8

* Packages: ``Neos``

`BUGFIX: Fix rendering of URLs in link- and reference editors <https://github.com/neos/neos-development-collection/pull/2966>`_
-------------------------------------------------------------------------------------------------------------------------------

This replaces the preview URL by a "breadcrumb" to the homepage
node.

Note: Due to a separate bug in `neos/neos-ui` the breadcrumb is
currently rendered twice, neos/neos-ui#2711 will fix that.

* Fixes: `#2965 <https://github.com/neos/neos-development-collection/issues/2965>`_
* Packages: ``AssetList`` ``BaseMixins`` ``Browser`` ``ColumnLayouts`` ``ContentReferences`` ``ContentRepository`` ``Form`` ``Html`` ``Navigation`` ``Neos`` ``NodeTypes``

`BUGFIX: NodeType inheritance is not working correct <https://github.com/neos/neos-development-collection/pull/2740>`_
----------------------------------------------------------------------------------------------------------------------

FIXES: #2663

* Packages: ``ContentRepository`` ``Neos``

`BUGFIX: Prevent black shapes in document thumbnails <https://github.com/neos/neos-development-collection/pull/2879>`_
----------------------------------------------------------------------------------------------------------------------

**What I did**
Tested with the following imagick versions:

- V. 6.7.8
- V. 6.9
- V. 7.0
**How I did it**

See below
**How to verify it**

You can verifiy it by running this small code local:

```php
<?php
$filePath = 'pdf.pdf[0]';
$width = 500;
$height = 500;

$im = new \\Imagick();
$im->setResolution(120, 120);
$im->readImage($filePath);
$im->setImageFormat('png');
$im->setImageBackgroundColor('white');
$im->setImageCompose(\\Imagick::COMPOSITE_OVER);

if (method_exists($im, 'mergeImageLayers')) {
    // Replace flattenImages in imagick 3.3.0
    // @see https://pecl.php.net/package/imagick/3.3.0RC2
    $im = $im->mergeImageLayers(\\Imagick::LAYERMETHOD_MERGE);
} else {
    $im->flattenImages();
}

if (defined('\\Imagick::ALPHACHANNEL_OFF')) {
    // ImageMagick >= 7.0, Imagick >= 3.4.3RC1
    // @see https://pecl.php.net/package/imagick/3.4.3RC1
    $im->setImageAlphaChannel(\\Imagick::ALPHACHANNEL_OFF);
} else {
    $im->setImageAlphaChannel(\\Imagick::ALPHACHANNEL_RESET);
}

$im->thumbnailImage($width, $height, true);

$im->writeImage('thumb.png');
$im->destroy();
```
* Packages: ``Media``

`BUGFIX: Neos.NodeTypes:Menu has no default class attribute <https://github.com/neos/neos-development-collection/pull/2518>`_
-----------------------------------------------------------------------------------------------------------------------------

This fixes a previous breaking change where "Menu" node-type is not
getting a default class attribute rendered for instance 'neos-nodetypes-menu'
where a website's stylesheet is relying on this CSS class

**What I did**
In fusion prototype Neos.NodeTypes.Navigation:Navigation loaded fusion  path 'attributes.class.@process' from Neos.Neos:Content.
**How I did it**

**How to verify it**
Add the Menu node type on the page and check in the console/page source it should have css class 'neos-nodetypes-menu'
* Packages: ``Navigation``

`BUGFIX: change regex for selecting \`<a href="">\` Tag <https://github.com/neos/neos-development-collection/pull/2409>`_
-------------------------------------------------------------------------------------------------------------------------

fixe the behaviour when the a Tag is inside a Tag with the name beginning with a

Example: `<article> test <a target="_blank" href="http://localhost/_Resources/01">example1</a></article>`

the function replaceLinkTargets returned  `<a target="_blank"rticle> test <a target="_blank" href="http://localhost/_Resources/01">example1</a></article>`

create new test evaluateReplaceResourceLinkTargetsInsideTag

this issue was already fixed in 4.2 release on 5 Nov 2018

* Fixes: `#2395 <https://github.com/neos/neos-development-collection/issues/2395>`_
* Packages: ``Neos``

`BUGFIX: Use correct default value for redirect in Neos SitesController <https://github.com/neos/neos-development-collection/pull/2774>`_
-----------------------------------------------------------------------------------------------------------------------------------------

https://github.com/neos/flow-development-collection/commit/`0cd533a64b44961fbe9e4b43ccc3fcf8e8325ab6 <https://github.com/neos/neos-development-collection/commit/0cd533a64b44961fbe9e4b43ccc3fcf8e8325ab6>`_ changed the default value of the `$arguments` parameter from `null` to `[]`, so we must change it here too.

I found nowhere else where `AbstractController->redirect()` may be called with `$arguments = null`.

* Packages: ``AssetList`` ``BaseMixins`` ``Browser`` ``ColumnLayouts`` ``ContentReferences`` ``ContentRepository`` ``Form`` ``Html`` ``Navigation`` ``Neos`` ``NodeTypes``

`Revert 2940 task/adjust to account interface <https://github.com/neos/neos-development-collection/pull/2959>`_
---------------------------------------------------------------------------------------------------------------

Reverts neos/neos-development-collection#2940 as it depends on neos/flow-development-collection#1939 which is not merged yet and it is unclear if this will land in 6.2 as is

* Packages: ``Fusion`` ``Neos``

`FEATURE: Fusion performance optimization (lazy Component props) <https://github.com/neos/neos-development-collection/pull/2738>`_
----------------------------------------------------------------------------------------------------------------------------------

**What I did**

* Components provide a nice way to structure Fusion code but prevent lazy evaluation as Fusion does by default by eagerly evaluating all properties as `props`
* If conditions are used inside the `renderer`, it's quite probable that not all props are used - so a large amount of unnecessary evaluations could be performed (we measured that to be in the range of 20-30% in a larger project)

**How I did it**

* Introduced a `LazyProps` object implementing `ArrayAccess` that evaluates the actually accessed props lazily (and caches the results)

**How to verify it**

* Components work as before (there could be edge-cases where explicit `array` type annotations are used for `props`)
* props are only evaluated if used (verified by test)

* Resolves: `#2793 <https://github.com/neos/neos-development-collection/issues/2793>`_
* Packages: ``Fusion``

`BUGFIX: Only count local assets within collections <https://github.com/neos/neos-development-collection/pull/2773>`_
---------------------------------------------------------------------------------------------------------------------

Since collections only show up if the current asset source is local
("Neos"), we should not sum up all assets from external asset sources.

We do not support collections for external asset sources and the
possibly much larger number is irritating, because when clicking
the "All" link the user will only see the local assets.

* Packages: ``Browser`` ``Neos``

`FEATURE: Reduced stylesheet for backend modules <https://github.com/neos/neos-development-collection/pull/2874>`_
------------------------------------------------------------------------------------------------------------------

The old stylesheets from pre-react times override a lot of basic styles for backend modules.
This makes it hard to implement custom styles there or use our react ui components.

With this change it's possible to configure a "Lite" and a "Minimal" variant of the Neos backend stylesheet via the module configuration.

The old "Main" stylesheet variant is kept for compatibility reasons.

The "Lite" stylesheet should be used with almost all modules and will also be used for the core modules. It also provides all relevant Neos CSS variables and is about 50% smaller than the old one.

The "Minimal" stylesheet should be used for modules that bring their own styles. For example modules that use the Neos react-components library. It also provides all relevant Neos CSS variables and is about 70% smaller than the old one.

Example:

```
  Neos:
    modules:
      management: # Or any other module group
        submodules:
          myModule:
            controller: \\My\\Site\\Controller\\MyModuleController
            label: 'My module'
            description: 'My module'
            icon: 'fas fa-camera'
            privilegeTarget: 'My.Site:ManageMyModule'
            mainStylesheet: 'Lite' # Or 'Minimal', default is 'Main'
```

* Packages: ``Neos``

`FEATURE: Nested Tags <https://github.com/neos/neos-development-collection/pull/2930>`_
---------------------------------------------------------------------------------------

This adds a naive implementation of nested tags using a parent field. 
It is intentionally not exposed in the UI, as nested Tags will be a feature of the new Media UI only.

#solves: https://github.com/Flowpack/media-ui/issues/3

* Packages: ``Media``

`FEATURE: Reduce backend load time with nodetype schema cache <https://github.com/neos/neos-development-collection/pull/2887>`_
-------------------------------------------------------------------------------------------------------------------------------

This prevents the generation of the nodetype schema on every backend reload.

Load times for Neos instances with lots of nodetypes
are reduced by several seconds depending on the setup.
Also the response has a cache header to allow the browser to keep the result longer.

This also helps in development context as the `version` parameter changes when the nodetypes change. Therefore changing Fusion and reloading is faster ;)

**What I did**

Cache the generated nodetype and vie schema

**How I did it**

Use the same caching behaviour as is already used for the xliff translations.

**How to verify it**

Load the backend twice and check response times.
The difference in projects with many nodetypes is much larger.

* Packages: ``Neos``

`FEATURE: Sortable NodeType Post processors <https://github.com/neos/neos-development-collection/pull/2869>`_
-------------------------------------------------------------------------------------------------------------

Allows a `position` to be specified in the NodeType `postprocessors` configuration:

```yaml
'Some.Custom:NodeType':
  # ...
  postprocessors:
    SomeCustomTypePostprocessor:
      position: 'end'
      postprocessor: 'Some\\TypePostprocessor'
```

* Resolves: `#2868 <https://github.com/neos/neos-development-collection/issues/2868>`_
* Packages: ``ContentRepository``

`FEATURE: Icons and description for asset sources <https://github.com/neos/neos-development-collection/pull/2937>`_
-------------------------------------------------------------------------------------------------------------------

Icons and descriptions can now be provided by the asset source. The icon makes the asset source easier to identify while the description can provide further information or a link to the asset source as required by some free asset source API guidelines.

To make your AssetSources compatible with Neos 6.x add the methods 
* `public function getIcon(): string`
* `public function getDescription(): string;`

to your asset source.

!`image <https://user-images.githubusercontent.com/642226/76680571-e612d280-65e9-11ea-999b-e6e5932b6cdd.png>`_

solves: https://github.com/Flowpack/media-ui/issues/2
solves: https://github.com/Flowpack/media-ui/issues/1

* Packages: ``Media``

`FEATURE: Upgrade to fontawesome 5.12.1 <https://github.com/neos/neos-development-collection/pull/2881>`_
---------------------------------------------------------------------------------------------------------

* Fixes: `#2880 <https://github.com/neos/neos-development-collection/issues/2880>`_ 
* Packages: ``BaseMixins`` ``Neos``

`FEATURE: Allow more than one authentication provider <https://github.com/neos/neos-development-collection/pull/2577>`_
-----------------------------------------------------------------------------------------------------------------------

**What I did**

Currently, only one authentication provider can be used with Neos as described in #940. I implemented the changes proposed by the issue creator to allow more than one authentication provider.

Although I tested it successfully, I might not be aware of all possible implications; it would be great if someone with a deeper insight into the security layer / user handling of Neos could have a look.

Please note: This PR does not cover the issues that arise when more than one account is associated with a single Neos user. It only allows one account per user (a limitation that already exists right now, though).

**How I did it**

Instead of always using the default authentication provider (Neos.Neos:Backend) to retrieve a user or username, the authentication provider associated with the respective account is used (also see #940).

* Packages: ``BaseMixins`` ``Browser`` ``Neos``

`BUGFIX: Ensure node query by identifier uses strings <https://github.com/neos/neos-development-collection/pull/2939>`_
-----------------------------------------------------------------------------------------------------------------------

Due to how the query is handled using an integer node identifier in a query by identifier 
will not break but result in severe performance problems as the query will not use 
the index for identifier anymore. Casting to string prevents that.

To expose the problem you can simply try to run such a query with an integer instead 
of a string and you will see extreme performance degradation.
Not giving numbers because it depends on the amount of nodes but it is VERY noticeable.

* Packages: ``ContentRepository`` ``Neos``

`Apply fixes from StyleCI <https://github.com/neos/neos-development-collection/pull/2951>`_
-------------------------------------------------------------------------------------------

This pull request applies code style fixes from an analysis carried out by `StyleCI <https://github.styleci.io>`_.

---

For more information, click `here <https://github.styleci.io/analyses/bQZjRl>`_.

* Packages: ``Browser`` ``Media``

`BUGFIX: Use Neos config when overriding FrontendRoutePartHandler <https://github.com/neos/neos-development-collection/pull/2949>`_
-----------------------------------------------------------------------------------------------------------------------------------

When overriding the FrontendRouterPartHandler with a custom implementation but inheriting from it the configuration was not read from Neos.Neos but from the package that did the override.
This causes the setting to always be false and makes the routing not work properly when
having empty segments for dimensions. This is then quite difficult to debug.

Custom implementations can still decide to override the config and read it from somewhere else if required.

* Packages: ``Browser`` ``Neos``

`TASK: Adjust codebase to support new Account and Roles API <https://github.com/neos/neos-development-collection/pull/2940>`_
-----------------------------------------------------------------------------------------------------------------------------

This change is to support the AccountInterface introduced in neos/flow-development-collection#1939

Cases covered is mentioned in #2938 

* Resolves: `#2938 <https://github.com/neos/neos-development-collection/issues/2938>`_ 


* Packages: ``Neos``

`BUGFIX: fix isDescendantNodeOf permission with UUIDs if specified node is hidden <https://github.com/neos/neos-development-collection/pull/2866>`_
---------------------------------------------------------------------------------------------------------------------------------------------------

* Resolves: `#2865 <https://github.com/neos/neos-development-collection/issues/2865>`_
* Packages: ``AssetList`` ``Browser`` ``ContentReferences`` ``ContentRepository`` ``Form`` ``Navigation`` ``Neos``

`TASK: Add Fusion performance benchmarks <https://github.com/neos/neos-development-collection/pull/2745>`_
----------------------------------------------------------------------------------------------------------

**What I did**

* Implemented performance benchmarks for the Fusion runtime with PHPBench

**How I did it**

* Slight modification in `Runtime` to have an optional `ControllerContext` (since it's hard to create outside of the bootstraped framework)
* Created PHPBench benchmarks to measure evaluation times and to verify further performance improvements

**How to verify it**

* Resolves: `#2795 <https://github.com/neos/neos-development-collection/issues/2795>`_
* Packages: ``AssetList`` ``BaseMixins`` ``Browser`` ``ContentReferences`` ``Form`` ``Fusion`` ``Navigation`` ``Neos``

`BUGFIX: redirect-to-last-visited-page broken with Fusion LoginForm rewrite <https://github.com/neos/neos-development-collection/pull/2926>`_
---------------------------------------------------------------------------------------------------------------------------------------------

When rewriting the Login form to Neos.Fusion.Form, the `name` attribute of the form has been lost.
This broke the JS code which sets the `lastVisitedNode`.

**How to verify it**

- open some nested page in the frontend
- open the login form to the backend
- log in
- EXPECTED with this change: you get the exact same page in the backend
- WITHOUT this change: you get the homepage

* Packages: ``Neos``

`BUGFIX: Only allow content nodetypes in content collections <https://github.com/neos/neos-development-collection/pull/2895>`_
------------------------------------------------------------------------------------------------------------------------------

This change makes sure that only nodetypes that inherit from `Neos.Neos:Content` are addable to `Neos.Neos:ContentCollection` as the comment of the nodetype specifically mentions.

Without this other nodetypes are reported as valid child types when getting the configuration from the `NodeType` class.

This caused only a problem when interacting with nodetypes via PHP as the UI already made sure you could not add something else than Content.

* Resolves: `#2894 <https://github.com/neos/neos-development-collection/issues/2894>`_ 
* Packages: ``Neos``

`BUGFIX: Don’t use technical workspace name in the UI <https://github.com/neos/neos-development-collection/pull/2920>`_
-------------------------------------------------------------------------------------------------------------------------

The technical name as title can be confusing as it doesn’t 
change when the workspace title is changed.

* Packages: ``Neos``

`BUGFIX: Have NeosAssetProxy return resource on getImportStream <https://github.com/neos/neos-development-collection/pull/2922>`_
---------------------------------------------------------------------------------------------------------------------------------

The `AssetProxyInterface` declares `getImportStream()` must return
`resource`. The `NeosAssetProxy` returns `?UriInterface` there, which
breaks the contract.

In some places `getImportStream()` is used to access the original URI
(see #2190), but for other proxies, the resulting link target is
`Resource id #x` since the resource is cast to string and used as is.

This fixes the issue by making `getImportStream()` in `NeosAssetProxy`
return `resource` as expected and add (back) `getOriginalUri()` to the
proxy. The URI can be used for a download.

An additional `ProvidesOriginalUriInterface` is added, which can be
implemented by asset sources at will.

* Fixes: `#2918 <https://github.com/neos/neos-development-collection/issues/2918>`_
* Packages: ``Media`` ``Neos``

`BUGFIX: Flush content cache on image variant change <https://github.com/neos/neos-development-collection/pull/2910>`_
----------------------------------------------------------------------------------------------------------------------

If you access an image property in a node and render an ImageVariant
from it via Fusion using an image variant preset, the cache is now
flushed if the image variant is changed afterwards, e.g. when changing
the crop in the media management module.

* Fixes: `#2897 <https://github.com/neos/neos-development-collection/issues/2897>`_
* Packages: ``Media`` ``Neos``

`BUGFIX: Access tags of asset in media list view <https://github.com/neos/neos-development-collection/pull/2917>`_
------------------------------------------------------------------------------------------------------------------

This uses `assetProxy.asset.tags` instead of just `assetProxy.tags`
as a simple way to fix the display of assigned tags in the media
browser list view.

Fixes neos/neos-development-collection#2350

* Packages: ``Browser``

`BUGFIX: Add \`Form\` key to configuration schema of Fusion package <https://github.com/neos/neos-development-collection/pull/2885>`_
-------------------------------------------------------------------------------------------------------------------------------------

When the package Neos.Fusion.Form is installed which it is by default since Neos 5.1 the key `Form` is
automatically created in the `Neos.Fusion` setting namespace. Since the schema for this namespace only allows predefined key this yields an error message in the Configuration module.

In addition the schema file is renamed and shortened to only validate inside Neos.Fusion. That ensures that the file is picked up by the command ./flow configuration:validate --type Settings. This will avoid things like this slipping trough in future.

* Packages: ``Fusion``

`BUGFIX: Don't use AbstractValidator::$result in PasswordValidator <https://github.com/neos/neos-development-collection/pull/2909>`_
------------------------------------------------------------------------------------------------------------------------------------

PasswordValidator was using the property $result of AbstractValidaor. That caused an Error 500 since Flow 6, because AbstractValidator::$result is private now.


**What I did**
Changed to AbstractValidator::addError() method

**How to verify it**
Use The PasswordValidator with a minimumLength and try to produce a validation-error.

* Packages: ``Neos``

`TASK: Remove unused template <https://github.com/neos/neos-development-collection/pull/2912>`_
-----------------------------------------------------------------------------------------------

This code should have been removed when the `UsageController` was
introduced in `ea7587374012b35d45d1c7402c43410353613f6d <https://github.com/neos/neos-development-collection/commit/ea7587374012b35d45d1c7402c43410353613f6d>`_.

* Packages: ``Browser``

`TASK: Remove unused code <https://github.com/neos/neos-development-collection/pull/2911>`_
-------------------------------------------------------------------------------------------

This code should have been removed when the `ImageVariantController`
was introduced in `0aa2eed015e02a468f9b2e8e1d08f8275349edde <https://github.com/neos/neos-development-collection/commit/0aa2eed015e02a468f9b2e8e1d08f8275349edde>`_. Which
means it should have never been there. ;)

* Packages: ``Browser``

`TASK: update documentation link for formatCldr formats <https://github.com/neos/neos-development-collection/pull/2913>`_
-------------------------------------------------------------------------------------------------------------------------

The link given in the documentation leads to a 404, I have set the correct link


* Packages: ``BaseMixins`` ``Neos``

`BUGFIX: Prevent double dash formatting in docs for node:repair command <https://github.com/neos/neos-development-collection/pull/2908>`_
-----------------------------------------------------------------------------------------------------------------------------------------

The readthedocs command reference formats double dashes
as one long dash. Copying the command into the CLI will therefore
not work properly as f.e. the node-type filter will not apply
and all nodes are repaired.

* Packages: ``Neos``

`BUGFIX: re-add lost variants update functionality <https://github.com/neos/neos-development-collection/pull/2892>`_
--------------------------------------------------------------------------------------------------------------------

Re-add lost variants update functionality to fix issue #2884 

**What I did**
I compared the changes of  PR #2751 with the code befor the changes of this PR and saw, that the line `$this->getRepository($variant)->update($variant);` was missing after the changes of the PR. I added the missing line where I think it is necessary. Additionally i added the  generation of the redirect to the else part in the replacement function, which was also missing. I think this fixes issue #2884.

**How to verify it**
Find an asset, for which the resource can not be replaced, for example on the demo site. Then  checkout my changes and try replacing the resource of the found asset. The replcement should be possible again.


* Packages: ``Media`` ``Neos``

`BUGFIX: Correct code blocks in documentation <https://github.com/neos/neos-development-collection/pull/2904>`_
---------------------------------------------------------------------------------------------------------------

* Packages: ``Media`` ``Neos``

`TASK: Fix validation warnings/errors on .travis.yml <https://github.com/neos/neos-development-collection/pull/2901>`_
----------------------------------------------------------------------------------------------------------------------

Fixes build config validation complaints:

- W jobs.include: deprecated key sudo (The key `sudo` has no effect anymore.)
- W notifications.slack: unknown key on_start (never)
- I root: missing os, using the default linux
- I root: key matrix is an alias for jobs, using jobs

* Packages: ``Browser`` ``Neos``

`BUGFIX: Make getThumbnail() return type nullable <https://github.com/neos/neos-development-collection/pull/2903>`_
-------------------------------------------------------------------------------------------------------------------

If the thumbnail strategy failed to generate a valid thumbnail, null
is returned. This needs to be allowed.

* Packages: ``Fusion`` ``Media``

`FEATURE: Keep tags and collections of assets when exporting sites <https://github.com/neos/neos-development-collection/pull/2835>`_
------------------------------------------------------------------------------------------------------------------------------------

With this change tags and collections of assets are included in site exports to XML and are imported properly, too.

See also #2503 and #2537.
* Fixes: `#1097 <https://github.com/neos/neos-development-collection/issues/1097>`_
* Packages: ``BaseMixins`` ``Browser`` ``Media`` ``Neos``

`BUGFIX: Replace baseUri in cache identifiers <https://github.com/neos/neos-development-collection/pull/2898>`_
---------------------------------------------------------------------------------------------------------------

Since Flow 6.0 the httpRequest.baseUri is gone and we
need to replace it in the cache identifiers to avoid wrong
cache behavior.

* Packages: ``Fusion``

`BUGFIX: Add code migration for MultiColumn* nodetypes <https://github.com/neos/neos-development-collection/pull/2872>`_
------------------------------------------------------------------------------------------------------------------------

Add missing code migration for nodetypes Neos.NodeTypes:MultiColumn and Neos.NodeTypes:MultiColumnItem for seamless upgrade process.

* Packages: ``Browser`` ``Neos`` ``NodeTypes``

`BUGFIX: Convert DateTimeImmutable "Now" into DateTime for account deactivation <https://github.com/neos/neos-development-collection/pull/2859>`_
-------------------------------------------------------------------------------------------------------------------------------------------------

Convert "Now" based on DateTimeImmutable to DateTime, as Account::setExpirationDate expects it.

* Fixes: `#2131 <https://github.com/neos/neos-development-collection/issues/2131>`_ 
* Packages: ``Neos``

`TASK: Pass on previous exception in getImageSize() <https://github.com/neos/neos-development-collection/pull/2877>`_
---------------------------------------------------------------------------------------------------------------------

* Packages: ``Browser`` ``Media`` ``Neos``

`BUGFIX: Respect arguments value as defined in Neos.Neos:NodeUri <https://github.com/neos/neos-development-collection/pull/2893>`_
----------------------------------------------------------------------------------------------------------------------------------

The prototype Neos.Neos:NodeUri defines `arguments = Neos.Fusion:RawArray`
but this value is never processed in the PHP implementation.
Instead, the additionalParams is processed and passed to
the parameter `arguments` of the NodeLiking service.

Now both parameters are used. `additionalParams` should be deprecated.

* Packages: ``Browser`` ``Neos``

`FEATURE: Freely position content collections <https://github.com/neos/neos-development-collection/pull/2891>`_
---------------------------------------------------------------------------------------------------------------

Together with https://github.com/neos/neos-ui/pull/2609 and https://github.com/neos/neos-ui/pull/2667
this change allows to have a `Neos.Neos:Content` nodetype
that is also a `Neos.Neos:ContentCollection` and have one
or more wrapping tags around the Fusion `Neos.Neos:ContentCollection`.

To specify the point for inserting children of a content collection in your markup,
you add an attribute on the container element: `data-__neos-insertion-anchor`.
If found, that container will be used for inserting new items, otherwise the parent
element (as usual).

Without the change in the UI new nodes are added into the outermost div instead
of the collection div.

* Packages: ``Neos``

`[TASK] Add .travis.yml <https://github.com/neos/neos-development-collection/pull/32>`_
---------------------------------------------------------------------------------------

Execute unit tests on Travis CI.

* Packages: ``Afx``

`[TASK] Add .travis.yml <https://github.com/neos/neos-development-collection/pull/32>`_
---------------------------------------------------------------------------------------

Execute unit tests on Travis CI.

`BUGFIX: Keep configured creationDialog elements <https://github.com/neos/neos-development-collection/pull/2883>`_
------------------------------------------------------------------------------------------------------------------

Keep configured creationDialog elements to keep dialog fields for NodeTemplates.

* Fixes: `#2882 <https://github.com/neos/neos-development-collection/issues/2882>`_
* Packages: ``Browser`` ``Neos``

`[TASK] Allow to override TYPO3.Form configuration from TS <https://github.com/neos/neos-development-collection/pull/31>`_
--------------------------------------------------------------------------------------------------------------------------

This change allow to override the Form configuration from TypoScript::

```
prototype(TYPO3.Neos.NodeTypes:Form) {
    overrideConfiguration = TYPO3.TYPO3TypoScript:RawArray {
        finishers = TYPO3.TypoScript:RawArray {
            copy = TYPO3.TypoScript:RawArray {
                options = TYPO3.TypoScript:RawArray {
                    recipientAddress = ${q(node).property('email')}
                }
            }
        }
    }
}
```

* Packages: ``Afx``

`[TASK] Allow to override TYPO3.Form configuration from TS <https://github.com/neos/neos-development-collection/pull/31>`_
--------------------------------------------------------------------------------------------------------------------------

This change allow to override the Form configuration from TypoScript::

```
prototype(TYPO3.Neos.NodeTypes:Form) {
    overrideConfiguration = TYPO3.TYPO3TypoScript:RawArray {
        finishers = TYPO3.TypoScript:RawArray {
            copy = TYPO3.TypoScript:RawArray {
                options = TYPO3.TypoScript:RawArray {
                    recipientAddress = ${q(node).property('email')}
                }
            }
        }
    }
}
```

`Bugfix: Use controller context to get FlashMessageContainer <https://github.com/neos/neos-development-collection/pull/2876>`_
------------------------------------------------------------------------------------------------------------------------------

Remove left over of rewrite FlashMessages.
See: https://github.com/neos/flow-development-collection/pull/1061

* Packages: ``Neos``

`BUGFIX: xhr request in backend modules <https://github.com/neos/neos-development-collection/pull/2841>`_
---------------------------------------------------------------------------------------------------------

With Neos 5.0 the nodetypeschema endpoint was removed from the backend modules
template but the request was still sent.
Without the uri the current url of the module was instead requested.
This caused other errors when using the backbutton of the browser when sometimes instead of the whole module only the json response was shown.

This resolves: #2791 

**What I did**

Prevent the duplicate request

**How I did it**

Check if the endpoint uri exists before calling it.

**How to verify it**

Go to any module and check whether a xhr request is sent to the current url.


* Packages: ``Browser`` ``Neos``

`TASK: PHP 7.4 compatibility <https://github.com/neos/neos-development-collection/pull/2804>`_
----------------------------------------------------------------------------------------------

See https://github.com/neos/flow-development-collection/issues/1866

* Packages: ``Neos``

`BUGFIX: Fix regression breaking login to Neos <https://github.com/neos/neos-development-collection/pull/2861>`_
----------------------------------------------------------------------------------------------------------------

* Fixes: `#2860 <https://github.com/neos/neos-development-collection/issues/2860>`_
* Packages: ``Neos``

`BUGFIX: Fix login behind basic auth <https://github.com/neos/neos-development-collection/pull/2857>`_
------------------------------------------------------------------------------------------------------

In the latest version of Chrome (79.0.3945.88) the login page will
remain white if it's protected by Basic Authentication.

Until now a 401 status code was returned whenever the login page was
opened, causing a faulty behavior in Chrome and resulting in a white
page in almost all cases.

We now use a custom header instead to identify if Authentication is
necessary to view the content.

resolves: https://github.com/neos/neos-development-collection/issues/2845

* Packages: ``Neos``

`BUGFIX: Hide inaccessible backend modules <https://github.com/neos/neos-development-collection/pull/2855>`_
------------------------------------------------------------------------------------------------------------

Adds a ViewHelper `ifModuleAccessible` that allows to evaluate whether a
given (sub) module is accessible to the currently authenticated user and
uses that ViewHelper in the SubmoduleOverview partial in order to hide
inaccessible modules from the module overview.

Background:

With #964 the `module.<submodule>.privilegeTarget` configuration became
deprecated in favor of `ModulePrivilege`s but the partial only checked
the "privilegeTarget" configuration.

Note: This is just a quick fix for the bug. In the long run we should
rewrite the whole backend module logic in order to move such crucial
conditions from the view to the domain layer.

* Fixes: `#2854 <https://github.com/neos/neos-development-collection/issues/2854>`_
* Packages: ``Neos``

`BUGFIX: Call getPersonalWorkspaceName just once <https://github.com/neos/neos-development-collection/pull/2852>`_
------------------------------------------------------------------------------------------------------------------

Use result of first call of getPersonalWorkspaceName() instead of calling it twice.

* Packages: ``Neos``

`BUGFIX: Avoid isRemoved() call on null <https://github.com/neos/neos-development-collection/pull/2843>`_
---------------------------------------------------------------------------------------------------------

The array returned by getNodes() may have null entries, e.g. if a
node was filtered in createFromNodeData().

* Packages: ``Neos``

`BUGFIX: Adjust PluginViewImplementation to PSR-7 <https://github.com/neos/neos-development-collection/pull/2844>`_
-------------------------------------------------------------------------------------------------------------------

This applies a fix that has been applied to PluginImplementation in
https://github.com/neos/neos-development-collection/pull/2777 to the
PluginViewImplementation. This makes plugin views work again as
expected, instead of replacing the full response content by the plugin
content.

* Packages: ``Browser`` ``Neos``

`BUGFIX: Avoid null as argument to recreateVariant() <https://github.com/neos/neos-development-collection/pull/2838>`_
----------------------------------------------------------------------------------------------------------------------

* Fixes: `#2837 <https://github.com/neos/neos-development-collection/issues/2837>`_
* Packages: ``Media``

`BUGFIX: Add FlowAnnotationDriver import to AssetRepository <https://github.com/neos/neos-development-collection/pull/2840>`_
-----------------------------------------------------------------------------------------------------------------------------

This fixes `array_map() expects parameter 1 to be a valid callback,
class ‘Neos\\Media\\Domain\\Repository\\FlowAnnotationDriver’ not found`

* Packages: ``Browser`` ``Media`` ``Neos``

`BUGFIX: #2664 set position to PHP_INT_MAX if nodeDimensionValue is no… <https://github.com/neos/neos-development-collection/pull/2736>`_
-------------------------------------------------------------------------------------------------------------------------------------------

Fix returning invalid nodes in reduceNodeVariantsByWorkspacesAndDimensions. * See: `#2664 <https://github.com/neos/neos-development-collection/issues/2664>`_ for further details.
* Packages: ``Browser`` ``ContentRepository`` ``Neos``

`BUGFIX: Invalid ratio mode during site import <https://github.com/neos/neos-development-collection/pull/2834>`_
----------------------------------------------------------------------------------------------------------------

Sigh… This fixes one blocking and one small issue with the ratio mode
that still occurred when importing sites from XML. The error fixed is:

`During the import of the "Sites.xml" from the package "Neos.Demo" an
exception occurred: Error: During import an exception occurred:
"Could not convert target type "Neos\\Media\\Domain\\Model\\ImageVariant":
Could not convert target type
"Neos\\Media\\Domain\\Model\\Adjustment\\ResizeImageAdjustment": Invalid
mode "" specified, supported modes are: "inset", "outbound" (but use
the ImageInterface::RATIOMODE_* constants)"., see log for further
information.`

The fix brings back setting the ratio mode to the default of
ImageInterface::RATIOMODE_INSET when an empty string is given and
fixes the error message sprintf pattern.

* Packages: ``Media``

`TASK: Cleanup thumbnail service code <https://github.com/neos/neos-development-collection/pull/2783>`_
-------------------------------------------------------------------------------------------------------

Fixes some code smells and does some code cleanup.

* Packages: ``Media``

`BUGFIX: Improve CreationDialogPostprocessor <https://github.com/neos/neos-development-collection/pull/2832>`_
--------------------------------------------------------------------------------------------------------------

Improves the `CreationDialogPostprocessor` so that it...

* does not access the `NodeType::getConfiguration()` but acts
  solely on the passed in `$configuration` array
* works for properties without `ui.inspector` configuration (for
  example inline editable properties)

* Related: `#2173 <https://github.com/neos/neos-development-collection/issues/2173>`_
* Packages: ``Browser`` ``Neos``

`BUGFIX: Fix version constraint after upmerge <https://github.com/neos/neos-development-collection/pull/2833>`_
---------------------------------------------------------------------------------------------------------------

Did miss that while up merging

`BUGFIX: Don't show empty Creation Dialog <https://github.com/neos/neos-development-collection/pull/2830>`_
-----------------------------------------------------------------------------------------------------------

Fixes the `CreationDialogPostprocessor` so that it doesn't create
an empty `ui.creationDialog.elements` configuration if no node
properties are flagged with `showInCreationDialog`

* Related: `#2173 <https://github.com/neos/neos-development-collection/issues/2173>`_
* Packages: ``Neos``

`FEATURE: Add new wallaper for Neos 5.1 <https://github.com/neos/neos-development-collection/pull/2827>`_
---------------------------------------------------------------------------------------------------------

* Resolves: `#2824 <https://github.com/neos/neos-development-collection/issues/2824>`_ 
* Packages: ``Neos``

`BUGFIX: Set default ratio mode in ResizeImageAdjustment <https://github.com/neos/neos-development-collection/pull/2781>`_
--------------------------------------------------------------------------------------------------------------------------

The default was assigned during runtime, but this lead to `getRatioMode()`
potentially failing, since it was declared to return a string, non-nullable.

This is a followup to #2716

* Fixes: `#2811 <https://github.com/neos/neos-development-collection/issues/2811>`_
* Packages: ``Media`` ``Neos``

`Make adjustments to the latest ES CR version <https://github.com/neos/neos-development-collection/pull/2828>`_
---------------------------------------------------------------------------------------------------------------

This adds support for explicit OriginDimensionSpacePoints as well as utility methods

* Packages: ``ContentRepository``

`TASK: Require concrete versions of fusion afx and forms for the 5.1 branch <https://github.com/neos/neos-development-collection/pull/2826>`_
---------------------------------------------------------------------------------------------------------------------------------------------

Until the both packages will become part of the dev dist we have to set the version constraints for each branch manually as master requires „*“

* Packages: ``Fusion`` ``Neos``

`BUGFIX: Add leave statements for apply early returns <https://github.com/neos/neos-development-collection/pull/2813>`_
-----------------------------------------------------------------------------------------------------------------------

Small bugfix to have an even count of enter and leave calls, even if
apply values cause an early return.

This should be refactored anyway to a more efficient solution (see
#2737) where no cache context is prepared unless an object is
evaluated - but it doesn't hurt and helps the Flowpack.Fusion.Tracing
package to produce correct traces.

Replaces #2739

* Packages: ``Fusion`` ``Neos``

`TASK: Render headerComment from Settings instead of fluid-template <https://github.com/neos/neos-development-collection/pull/2810>`_
-------------------------------------------------------------------------------------------------------------------------------------

This avoids needlessly instantiating the fluid template engine just to render single comment.
Additionally this allows to configure the licenseHeader via setting Neos.Neos.headerComment.

* Resolves: `#2812 <https://github.com/neos/neos-development-collection/issues/2812>`_
* Packages: ``Neos``

`FEATURE: Refactor login rendering to Fusion <https://github.com/neos/neos-development-collection/pull/2808>`_
--------------------------------------------------------------------------------------------------------------

This will also get rid of the following assets in the login screen

* The Google font api inclusion.
* Fontawesome icons
* jQuery and Bootstrap JS
* Packages: ``Neos``

`TASK: Fusion performance optimization (get configuration) <https://github.com/neos/neos-development-collection/pull/2734>`_
----------------------------------------------------------------------------------------------------------------------------

**What I did**

* Refactored the configuration processing in `Runtime` to a separate `RuntimeConfiguration` class for easier testing and separation of concerns
* Optimized getting the configuration for a Fusion path, since this is a very "hot" part of the code that is used for every evaluation

**How I did it**

* Measured and verified performance boost with a large production Neos project
* Performance boost might only be measurable if a lot of Fusion is evaluated (against the total overhead)

**How to verify it**

* See new unit test

* Resolves: `#2796 <https://github.com/neos/neos-development-collection/issues/2796>`_
* Packages: ``Fusion``

`FEATURE: Batch rendering of asset variants <https://github.com/neos/neos-development-collection/pull/2751>`_
-------------------------------------------------------------------------------------------------------------

This provides the following functionality:

- (re-)render variants based on presets
- re-render variants when replacing an asset resource

## Configuration

The feature comes with no configurable settings itself. But you will need to configure asset
variant presets. Here is an example for a square preset:

```yaml
Neos:
  Media:
    variantPresets:
      'AcmeCom:Square':
        label: 'AcmeCom Square Preset'
        mediaTypePatterns: ['~image/.*~']
        variants:
          'square':
            label: 'Square'
            adjustments:
              'crop':
                type: 'Neos\\Media\\Domain\\Model\\Adjustment\\CropImageAdjustment'
                options:
                  aspectRatio: '1:1'
```

See the variant presets documentation at https://neos-media.readthedocs.io/en/stable/VariantPresets.html for details.

## Usage

Simply run the command: `./flow media:rendervariants` to generate all missing variants for
configured presets. The option `--recreate` will also render existing variants again based
on their presets. Using `--limit` you can only generate an sepcified amount of variants.

* Resolves: `#2798 <https://github.com/neos/neos-development-collection/issues/2798>`_

`FEATURE: add index to column path on nodedata table <https://github.com/neos/neos-development-collection/pull/2685>`_
----------------------------------------------------------------------------------------------------------------------

This allows for faster results in case of prefixed path queries on the nodedata table. The
index speeds up queries like in `findNodesByPathPrefixAndRelatedEntities()` (used to
determine the asset usage.)

* Resolves: `#2684 <https://github.com/neos/neos-development-collection/issues/2684>`_
* Packages: ``ContentRepository``

`FEATURE: \`DataStructure\` assumes nesting for subkeys without specified type <https://github.com/neos/neos-development-collection/pull/2729>`_
------------------------------------------------------------------------------------------------------------------------------------------------

When a `DataStructure` is rendered for nested keys that have no specified type the fusion  type `DataStructure` is assumed. This makes it much easier to describe larger data structure in fusion for instance to create json ld structures or define complex mappings.

* Packages: ``Fusion``

`BUGFIX: Handle unavailable asset proxies in edit view <https://github.com/neos/neos-development-collection/pull/2771>`_
------------------------------------------------------------------------------------------------------------------------

When an asset is not found, some actions threw an 404 status, which
leads to Neos showing the "404 page" under certain circumstances.

This change assigns the exception just like in the case of a connection
error, leaving handling to the media browser.

Now when an asset is not available, the edit template reacts to the
`connectionError´. This avoids an error with the `format.relativeDate` VH
and informs the user correctly about the fact an asset could not be
found.

* Packages: ``Browser``

`BUGFIX: Allow content cache flush for asset references in other use workspaces <https://github.com/neos/neos-development-collection/pull/2582>`_
-------------------------------------------------------------------------------------------------------------------------------------------------

Asset change leads to exception if unpublished changes in others users workspaces exists, which are referenced to affected asset. Neos tries to access the others user workspace to get the node with the reference to flush there caches. By privilege `Neos.Neos:Backend.OtherUsersPersonalWorkspaceAccess` this is not allowed.

```
Access denied for method
Method: Neos\\ContentRepository\\Domain\\Service\\Context::validateWorkspace()

Evaluated following 1 privilege target(s):
"Neos.Neos:Backend.OtherUsersPersonalWorkspaceAccess": ABSTAIN
(0 granted, 0 denied, 1 abstained)

Authenticated roles: Neos.Flow:Everybody, Neos.Flow:AuthenticatedUser, Neos.Neos:Editor, Neos.Neos:AbstractEditor, Neos.ContentRepository:Administrator, Neos.ContentRepository:InternalWorkspaceAccess, Neos.Neos:LivePublisher, Neos.Neos:Administrator
```

This fixes that behaviour by allowing access to the content repository without authorization
checks during retrieval of affected nodes.

* Packages: ``Neos``

`BUGFIX: Allow HtmlAugmenter operate on script tags <https://github.com/neos/neos-development-collection/pull/2764>`_
---------------------------------------------------------------------------------------------------------------------

**What I did**
Regarding #2763 the HtmlAugmenter does not find script tags as root elements. Ths DomDocument->loadHTML() puts them automatically into `html/head` instead of `html/body` as it does with other tags.

**How I did it**
Extend XPath query to search in head AND body for root elements.

**How to verify it**
For script-tag:
```
$html = '<script>console.log("fooo");</script>';
$domDocument = new \\DOMDocument('1.0', 'UTF-8');
$domDocument->loadHTML((substr($html, 0, 5) === '<?xml') ? $html : '<?xml encoding="UTF-8"?>' . $html);
var_dump($domDocument->saveHTML());
``` 
it returns:
``` 
string(195) "<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<?xml encoding="UTF-8"?><html><head><script>console.log("fooo");</script></head></html>
"
```

For other tags:
```
$html = '<a>console.log("fooo");</a>';
$domDocument = new \\DOMDocument('1.0', 'UTF-8');
$domDocument->loadHTML((substr($html, 0, 5) === '<?xml') ? $html : '<?xml encoding="UTF-8"?>' . $html);
var_dump($domDocument->saveHTML());
```
it returns:
```
string(185) "<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<?xml encoding="UTF-8"?><html><body><a>console.log("fooo");</a></body></html>
"
```

* Packages: ``Fusion``

`BUGFIX: Prevent exception from logger in login controller <https://github.com/neos/neos-development-collection/pull/2805>`_
----------------------------------------------------------------------------------------------------------------------------

push already merged #2769 code into 5.0 branch 

* Packages: ``Neos``

`FEATURE: Custom Route for node preview <https://github.com/neos/neos-development-collection/pull/2654>`_
---------------------------------------------------------------------------------------------------------

Introduces a new Route `/neos/preview` that will be used for previewing/editing purposes in the content iFrame and to preview content that is not live or visible (yet).

## Advantages

### Greatly reduced amount of routing cache entries

Previously, URLs for nodes in the backend had the format `<the/node/url/path>@<workspace-name>;<dimensions>`
Thus leading to two routing cache entries (match & resolve) for each user, node & dimension combination.
With this change, there is only *one route* for those cases usinq query parameters to specify the node & context: `/neos/preview?node=<the/node/url/path>@<workspace-name>;<dimensions>`

### Explicit preview action

With a custom action just for the preview scenario, we can remove a lot of special magic (like displaying hidden nodes, shortcut handling, ...) from the regular frontend rendering path

### Faster backend navigation

Previously all links in the Backend triggered a `redirect` route, effectively resulting in two requests.

### Basis for further improvements and simplifications

With a different route (and action) we could greatly simplify the code of the `FrontendRoutePartHandler` and make way for new features like partial matching (#780), multi-format-support (#870) dedicated workspace previews, ...

*Note:* This requires https://github.com/neos/neos-ui/pull/2604 to work as expected

* Resolves: `#2653 <https://github.com/neos/neos-development-collection/issues/2653>`_

`TASK: Prevent AssetInterfaceConverter to run into an exception <https://github.com/neos/neos-development-collection/pull/2806>`_
---------------------------------------------------------------------------------------------------------------------------------

fix rebase of (#2754)

* Packages: ``AssetList`` ``BaseMixins`` ``ColumnLayouts`` ``ContentReferences`` ``Form`` ``Html`` ``Media`` ``Neos`` ``NodeTypes``

`FEATURE: Replace configuration tree <https://github.com/neos/neos-development-collection/pull/2789>`_
------------------------------------------------------------------------------------------------------

**What I did**
The configuration module used dynatree and some other javascript stuff.
This PR adjusts the CSS and removes the old related Javascript.

As replacement we use vanilla JS to rebuild the tree feature.
AS we save states in the local storage I also refactored the handling in the menu and extracted the 
storage handling to an own service.

So the menu need also to be tested again.

**How to verify it**
Just use the configuration module.

* Resolves: `#2797 <https://github.com/neos/neos-development-collection/issues/2797>`_
* Packages: ``BaseMixins`` ``Neos``

`TASK: Remove showInvisible query parameter handling again <https://github.com/neos/neos-development-collection/pull/2790>`_
----------------------------------------------------------------------------------------------------------------------------

The correct preview of a hidden document is not showing it, after all…

Related to https://github.com/neos/neos-ui/issues/2500

* Packages: ``AssetList`` ``BaseMixins`` ``ColumnLayouts`` ``ContentReferences`` ``Form`` ``Html`` ``Neos`` ``NodeTypes``

`FEATURE: Allow Node properties to appear in the Creation Dialog <https://github.com/neos/neos-development-collection/pull/2785>`_
----------------------------------------------------------------------------------------------------------------------------------

Introduces a new Node Type setting `properties.<propertyName>.ui.showInCreationDialog`
that, if `true` will add the corresponding property to the Node Creation Dialog.

Example:

    'Some.Package:SomeNodeType':
      # ...
      properties:
        'someProperty':
          ui:
            showInCreationDialog: true

In that case the configuration of the corresponding `ui.inspector.editor` is copied
to the corresponding Creation Dialog element and can be overridden using the already
existing `creationDialog` configuration::

    'Some.Package:SomeNodeType':
      creationDialog:
        elements:
          'someProperty':
            ui:
              label: 'Overridden label'
      properties:
        'someProperty':
          ui:
            showInCreationDialog: true

*Note:* This requires https://github.com/neos/neos-ui/pull/2596 to be merged first!

* Related: `#2173 <https://github.com/neos/neos-development-collection/issues/2173>`_
* Packages: ``Neos``

`FEATURE: Increasing the contrast in module tables <https://github.com/neos/neos-development-collection/pull/2784>`_
--------------------------------------------------------------------------------------------------------------------

**What I did**
Adjusted the SCSS of the backend module table to the suggested values of @creative-resort 
to higher the contrast and make it better readable.

**How to verify it**
Just open the package management in the backend.

Thanks to @creative-resort for the suggestion!

* Resolves: `#2782 <https://github.com/neos/neos-development-collection/issues/2782>`_
* Packages: ``Neos``

`BUGFIX: setting Headers while evaluating PluginView. <https://github.com/neos/neos-development-collection/pull/2788>`_
-----------------------------------------------------------------------------------------------------------------------

This results in redirects without delay working not only for Plugins but also for PluginViews.

While updating a Neos Project from 3.3 to 4.3 I encountered an issue with the PluginViewImplementation. Redirects without a delay inside controllers of the plugin views did not work anymore, while redirects in the controllers of the master plugin still worked.
This problem occurred because the implementation of AbstractController::redirectToUri() changed in Neos 4.
In Neos 3 the line `$this->response->setContent('<html><head><meta http-equiv="refresh" content="' . (int)$delay . ';url=' . $escapedUri . '"/></head></html>');` was always executed – in Neos 4 it is only executed if a delay is set. Without a delay only the "Location" in the Response-Header is set. 
The PluginViewImplementation (in contrast to the PluginImplementation) does not append these Headers to the ParentRequest. I copied the lines from the PluginImplementation to the PluginViewImplementation and the redirects worked fine again.

(Actually this was also kind of a Problem in Neos 3, because it resulted in redirects from PluginViews always having a visible delay in the Frontend, even if the delay was 0. But I don't know if you still want to patch it in Neos 3.3 or only in 4.3 where it does not work at all.)

* Packages: ``AssetList`` ``BaseMixins`` ``ColumnLayouts`` ``ContentReferences`` ``Form`` ``Html`` ``Neos`` ``NodeTypes``

`BUGFIX: Replace $this->systemLogger by $this->logger in LoginController <https://github.com/neos/neos-development-collection/pull/2769>`_
------------------------------------------------------------------------------------------------------------------------------------------

**What I did**
Replaced the old systemLogger by logger in LoginController in Neos.Neos.
**How I did it**
See code changes.
**How to verify it**
Run tests.
* Packages: ``AssetList`` ``BaseMixins`` ``ColumnLayouts`` ``ContentReferences`` ``Form`` ``Html`` ``Neos`` ``NodeTypes``

`TASK: Preparation for fixing plugin redirects <https://github.com/neos/neos-development-collection/pull/2777>`_
----------------------------------------------------------------------------------------------------------------

This prevents the plugin content to end up in the main ActionReponse,
which is a preparation for the fix to plugin redirects and needs to
happen first in order to stay backwards compatible.

This change alone should change absolutely nothing in no circumstance.

* Packages: ``Neos``

`BUGFIX: Fix links and outdated docs in NodeTypeDefinition <https://github.com/neos/neos-development-collection/pull/2787>`_
----------------------------------------------------------------------------------------------------------------------------

Replaces no longer working links in the `NodeTypeDefinition` reference by corresponding docs.neos.io links and marks the `editorListeners` option deprecated

* Packages: ``Neos``

`BUGFIX: Fix default variable value <https://github.com/neos/neos-development-collection/pull/2778>`_
-----------------------------------------------------------------------------------------------------

Fixes https://github.com/neos/neos-development-collection/issues/2775

* Packages: ``Browser`` ``Neos``

`[FEATURE] Node creation Wizard and actions on node creation <https://github.com/neos/neos-development-collection/pull/27>`_
----------------------------------------------------------------------------------------------------------------------------

WIP!

See `TYPO3.Neos.NodeTypes:Gallery` and `TYPO3.Neos.NodeTypes:Test` for ideas how to test this feature.

More info here: https://discuss.neos.io/t/rfc-allow-to-define-a-dialog-which-will-be-shown-on-node-creation/91/22

* Packages: ``Afx``

`[FEATURE] Node creation Wizard and actions on node creation <https://github.com/neos/neos-development-collection/pull/27>`_
----------------------------------------------------------------------------------------------------------------------------

WIP!

See `TYPO3.Neos.NodeTypes:Gallery` and `TYPO3.Neos.NodeTypes:Test` for ideas how to test this feature.

More info here: https://discuss.neos.io/t/rfc-allow-to-define-a-dialog-which-will-be-shown-on-node-creation/91/22

`[TASK] "Custom Backend Module" documentation <https://github.com/neos/neos-development-collection/pull/19>`_
-------------------------------------------------------------------------------------------------------------

* Packages: ``Afx``

`[TASK] "Custom Backend Module" documentation <https://github.com/neos/neos-development-collection/pull/19>`_
-------------------------------------------------------------------------------------------------------------

`BUGFIX: Change return types of some Fusion methods to mixed <https://github.com/neos/neos-development-collection/pull/2762>`_
------------------------------------------------------------------------------------------------------------------------------

https://github.com/neos/neos-development-collection/commit/`ba8d1412f34820971fe6f9c0137fd23196df6612 <https://github.com/neos/neos-development-collection/commit/ba8d1412f34820971fe6f9c0137fd23196df6612>`_ introduced the return type `string` for Fusions RenderViewHelper, so we must always return a `string` (not `null`).

* Packages: ``Fusion`` ``Neos``

`BUGFIX: Add missing translation in pagination <https://github.com/neos/neos-development-collection/pull/2727>`_
----------------------------------------------------------------------------------------------------------------

The labels were only partially translated in https://github.com/neos/neos-development-collection/commit/`8d1c98a9999fac1830b78f17c08f87c0f67a6065 <https://github.com/neos/neos-development-collection/commit/8d1c98a9999fac1830b78f17c08f87c0f67a6065>`_#diff-86d35dae35fd27aa00b7d0723d538960

* Packages: ``Browser`` ``ContentRepository``

`BUGFIX: MariaDB 10.4 compatibility for events migration <https://github.com/neos/neos-development-collection/pull/2735>`_
--------------------------------------------------------------------------------------------------------------------------

See https://jira.mariadb.org/browse/MDEV-19598

This will first rename the existing index before adding
a new primary key as MariaDB 10.4 would complain about
the existing unique key „uid“ and not allow adding
the primary key with the same name.

As the behavior for MariaDB 10.2 and 10.4 is different
we also need to check for the existence of the indices
before changing them or it will cause trouble with 10.2.

Replaces: #2665 
Resolves neos/flow-development-collection#1704

* Packages: ``Neos``

`BUGFIX: Change aloha.placeholder labels to new editorOptions <https://github.com/neos/neos-development-collection/pull/2761>`_
-------------------------------------------------------------------------------------------------------------------------------

This changs the language label ids for the placeholders of the base mixins.

* Packages: ``BaseMixins`` ``NodeTypes``

`TASK: Update showInvisible check to be upwards compatible <https://github.com/neos/neos-development-collection/pull/2766>`_
----------------------------------------------------------------------------------------------------------------------------

Uses `$this->request` instead of the http request, to stay upwards compatible with PSR-7 changes.

* Related: `#2711 <https://github.com/neos/neos-development-collection/issues/2711>`_ 
* Packages: ``BaseMixins`` ``Neos``

`TASK: Fusion performance optimizations (less calls) <https://github.com/neos/neos-development-collection/pull/2737>`_
----------------------------------------------------------------------------------------------------------------------

**What I did**

* Fusion performance optimizations for less function calls and faster code paths for expression and value evaluation

**How I did it**

* Inlined some functions
* Removed usage of `end()` to get last item in array (needs a micro benchmark)
* Introduced fast checks around apply, if and processors
* Implemented fast path for expressions and values

**How to verify it**

* Less function calls, smaller call stack
* Needs a benchmark to measure micro optimizations

* Packages: ``Fusion``

`TASK : Remove composer requirement for the BaseMixins package itself <https://github.com/neos/neos-development-collection/pull/2760>`_
---------------------------------------------------------------------------------------------------------------------------------------

The BaseMixin package lists itself as a dependency. This obviously doesn't make any sense (unless there is a very specific reason for this that I'm not aware of).

* Packages: ``BaseMixins`` ``Neos``

`TASK: Use RuntimeFactory to create FusionRuntime <https://github.com/neos/neos-development-collection/pull/2721>`_
-------------------------------------------------------------------------------------------------------------------

This allows to use `FusionView` without manually creating a `ControllerContext`, because `RuntimeFactory` will take an effort to create one itself, if none is provided.

* Packages: ``Fusion``

`TASK: Code cleanup in Neos.Media repositories <https://github.com/neos/neos-development-collection/pull/2723>`_
----------------------------------------------------------------------------------------------------------------

* Packages: ``Browser`` ``Media`` ``Neos``

`TASK: Allow preview of invisible nodes in live <https://github.com/neos/neos-development-collection/pull/2711>`_
-----------------------------------------------------------------------------------------------------------------

When opening the preview for a hidden page using the React UI a
validation error shows up instead of handling the error or showing
the preview.

This changes fixes that by

- https://github.com/neos/neos-ui/pull/2557
- and changing Neos to allow invisible nodes to be shown for
  requests that are granted `Neos.Neos:Backend.GeneralAccess`

See https://github.com/neos/neos-ui/issues/2500

* Packages: ``Browser`` ``Neos``

`TASK: Asset variant tweaks <https://github.com/neos/neos-development-collection/pull/2716>`_
---------------------------------------------------------------------------------------------

This PR

- cleans up code, applies (strict) typing
- allows numbers and dash in adjustment and variant identifiers
- tweaks value object README a bit

* Packages: ``Media``

`DOCS: Use working examples in VariantPresets documentation and mention the variants tab settings <https://github.com/neos/neos-development-collection/pull/2755>`_
-------------------------------------------------------------------------------------------------------------------------------------------------------------------

The previous examples were misleading and not helpful since they caused php-errors when used
as mentioned. The adjustments correct this and add a sentence and example about the VariantsTab that has to be enabled.

* Packages: ``Media``

`TASK: Add quiet flag to all Neos.Media CLI commands <https://github.com/neos/neos-development-collection/pull/2722>`_
----------------------------------------------------------------------------------------------------------------------

This unifies the CLI interface and makes the quiet flag available
consistently with all media commands.

* Packages: ``Media`` ``Neos``

`BUGFIX: Adjust wrong parameters for log call <https://github.com/neos/neos-development-collection/pull/2749>`_
---------------------------------------------------------------------------------------------------------------

This is probably an oversight during upmerges, the `log(…)` call expects
the level as first parameter. By now this should be a `warning(…)` call.

* Packages: ``Browser`` ``Media`` ``Neos``

`BUGFIX: Fix setup signature <https://github.com/neos/neos-development-collection/pull/2748>`_
----------------------------------------------------------------------------------------------

* Packages: ``Media`` ``Neos``

`BUGFIX: Add type="text" to title input field <https://github.com/neos/neos-development-collection/pull/2747>`_
---------------------------------------------------------------------------------------------------------------

Even though the input field is read-only, the type should be given. At least
that makes sure the styling is correct.

* Packages: ``Browser``

`TASK: Fix return value of getArguments() to be array <https://github.com/neos/neos-development-collection/pull/2733>`_
-----------------------------------------------------------------------------------------------------------------------

* Packages: ``Browser`` ``Fusion``

`BUGFIX: Call PSR logger with warning directly <https://github.com/neos/neos-development-collection/pull/2746>`_
----------------------------------------------------------------------------------------------------------------

* Fixes: `#2744 <https://github.com/neos/neos-development-collection/issues/2744>`_
* Packages: ``Browser`` ``Neos``

`BUGFIX: Always select local original asset in media browser <https://github.com/neos/neos-development-collection/pull/2743>`_
------------------------------------------------------------------------------------------------------------------------------

Only query for imported assets that are not a variant of an originally imported asset.

* Fixes: `#2742 <https://github.com/neos/neos-development-collection/issues/2742>`_
* Packages: ``Browser`` ``Media``

`TASK: Make countAll() in AssetRepository work as expected for subclasses <https://github.com/neos/neos-development-collection/pull/2725>`_
-------------------------------------------------------------------------------------------------------------------------------------------

Any repository extending AssetRepository would need to override the
countAll() method or would always return the count of all assets,
not only the type the repository dealt with.

Now countAll() counts all assets or the specific type as expected.

* Fixes: `#2724 <https://github.com/neos/neos-development-collection/issues/2724>`_
* Packages: ``Media`` ``Neos``

`TASK: Mention the basic development setup steps in the readme <https://github.com/neos/neos-development-collection/pull/2726>`_
--------------------------------------------------------------------------------------------------------------------------------

This should help people onboard for contribution, as it is not obvious that one has to install the development-distribution and the information for that is not that easy to find and then very elaborate. This is the perfect place to have it in a TL;DR style

`FEATURE: Add \`Neos.Fusion:Fragment\` prototype <https://github.com/neos/neos-development-collection/pull/2728>`_
------------------------------------------------------------------------------------------------------------------

A `Fragment` is a `Component` that renders the given `content` without additional markup.
That way conditions can be defined for bigger chunks of afx instead of single tags.

```
renderer = afx`
    <Neos.Fusion:Fragment @if.isEnabled={props.enable}>
        <h1>Example</h1>
        <h2>Content</h2>
    </Neos.Fusion:Fragment>
`
```

* Packages: ``Fusion`` ``Neos``

`!!!TASK: Fix getVariant() return type <https://github.com/neos/neos-development-collection/pull/2717>`_
--------------------------------------------------------------------------------------------------------

This is one way to solve the shortcoming of #2701 - or we leave out the
return type in the interface and implementations can specify their
concrete return type.

* Packages: ``Media``

`BUGFIX: Remove introduced integer type setting <https://github.com/neos/neos-development-collection/pull/2712>`_
-----------------------------------------------------------------------------------------------------------------

Introduced in https://github.com/neos/neos-development-collection/pull/2694

A property with a given name should not be defined as different
value types as this will fail as soon as you try to use
elasticsearch indexing.

With defining that in the Testing index, an elasticsearch mapping
in the tests cannot be build

* Packages: ``Neos``

`BUGFIX: PaginateViewHelper in CR calls method on string <https://github.com/neos/neos-development-collection/pull/2713>`_
--------------------------------------------------------------------------------------------------------------------------

This is PR #2706 for the 5.0 banch…

* Fixes: `#2705 <https://github.com/neos/neos-development-collection/issues/2705>`_
* Packages: ``ContentRepository`` ``Neos``

`BUGFIX: Remove Connection::PARAM_STR_ARRAY hint <https://github.com/neos/neos-development-collection/pull/2709>`_
------------------------------------------------------------------------------------------------------------------

This "fixes" https://github.com/doctrine/orm/issues/7827, by
actually passing the correct type as parameter. And the "type
hint" can be removed, as well.

* Packages: ``Browser`` ``ContentRepository`` ``Neos``

`BUGFIX: PaginateViewHelper in CR calls method on string <https://github.com/neos/neos-development-collection/pull/2706>`_
--------------------------------------------------------------------------------------------------------------------------

* Fixes: `#2705 <https://github.com/neos/neos-development-collection/issues/2705>`_
* Packages: ``ContentRepository`` ``Neos``

`!!! TASK: Add code migration to rename nodetypes that were extracted from Neos.NodeTypes to subpackages <https://github.com/neos/neos-development-collection/pull/2704>`_
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The NodeTypes that were migrated to subpackage namespace via node migration `20190304111200` are now migrated in yaml and fusion files aswell. So existing code that extended or altered those nodetypes will still work. 

In addition a wrong target nodetype for `Neos.NodeTypes:Records` in node migration `20190304111200` is corrected as this migration was not part of a release yet.

This is a follow up to pr: https://github.com/neos/neos-development-collection/pull/2385

Upgrade instructions: Run code migrations via `./flow flow:core:migrate Package.Key` or `./flow flow:core:migrate --version Neos.NodeTypes-20190917101945 Package.Key` to apply the migration to your code.

* Packages: ``AssetList`` ``BaseMixins`` ``Browser`` ``ColumnLayouts`` ``ContentReferences`` ``ContentRepository`` ``Form`` ``Html`` ``Navigation`` ``Neos`` ``NodeTypes``

`BUGFIX: CropIimageAdjustment::refit only produces int sizes <https://github.com/neos/neos-development-collection/pull/2702>`_
------------------------------------------------------------------------------------------------------------------------------

This is not a direct problem for Neos 3.3 but it becomes a problem
as soon as PHP type hints come into play. The ratio divided widths
and heights can easily be floats and that is unexpected. Therefore
rounding and casting to int makes sense to prevent problems.

In versions of Neos that include type hints this is an actual major
bug that prevents refitting to work.

* Packages: ``Media``

`!!! FEATURE: Add getVariant(string, string) to VariantSupportInterface <https://github.com/neos/neos-development-collection/pull/2701>`_
-----------------------------------------------------------------------------------------------------------------------------------------

This adds a new method to the `VariantSupportInterface`, allowing
to fetch a preset-generated variant of an image directly.

    public function getVariant(string $presetIdentifier, string $presetVariantName): ?ImageVariant;

* Packages: ``Media`` ``Neos``

`!!! FEATURE: Alter \`\`Neos.Fusion:Tag.attributes\`\` to \`\`Neos.Fusion:DataStructure\`\` <https://github.com/neos/neos-development-collection/pull/2698>`_
-------------------------------------------------------------------------------------------------------------------------------------------------------------

In the past integrators often expected to be able to pass data structures to `Tag.attributes` which was not possible since the Tag implementation expected attributes to be a string that usually was rendered by `Neos.Fusion:Attributes`.

This change extends the `Neos.Fusion:Tag` implementation to accept iterables (array and traversables) as `attributes` and changes the default value to `Neos.Fusion:DataStructure`. A fallback to cast non-iterable values to string is in place so if anyone uses Neos.Fusion:Attributes explicitly this will still work.

To control the wether or not empty attributes are allowed the key `allowEmptyAttributes` is added to `Neos.Fusion:Tag` that mimics the behavior of `@allowEmpty` on `Neos.Fusion:Attributes`.

`Neos.Fusion:Attributes` is marked as deprecated but will stay in there for a while. 

How to update: This change is almost 100% backwards compatible. Only if you used `attributes.@allowEmpty = false` inside a `Neos.Fusion:Tag` but did not define `attributes = Neos.Fusion:Attributes` the rendering of empty attributes will change. To fix this replace `attributes.@allowEmpty = false` with `allowEmptyAttributes = false`.

* Packages: ``Fusion``

`BUGFIX: Avoid count() call on null <https://github.com/neos/neos-development-collection/pull/2700>`_
-----------------------------------------------------------------------------------------------------

* Fixes: `#2699 <https://github.com/neos/neos-development-collection/issues/2699>`_
* Packages: ``Diff``

`[FEATURE] node:repair sub command for removing broken entity references <https://github.com/neos/neos-development-collection/pull/26>`_
----------------------------------------------------------------------------------------------------------------------------------------

This change introduces a new sub command for node:repair which detects
and removes node property references to entities which don't exist.

One practical example are Image nodes whose "image" property points to
ImageVariant objects which, for whatever reason, have been removed
in the meantime. For these nodes, node:repair will now set the "image"
property to NULL.

* Packages: ``Afx``

`[FEATURE] node:repair sub command for removing broken entity references <https://github.com/neos/neos-development-collection/pull/26>`_
----------------------------------------------------------------------------------------------------------------------------------------

This change introduces a new sub command for node:repair which detects
and removes node property references to entities which don't exist.

One practical example are Image nodes whose "image" property points to
ImageVariant objects which, for whatever reason, have been removed
in the meantime. For these nodes, node:repair will now set the "image"
property to NULL.

`!!! BUGFIX: Fix languages fallback order <https://github.com/neos/neos-development-collection/pull/2570>`_
-----------------------------------------------------------------------------------------------------------

The fallback order now corresponds to the order from the dimension "language".

`TASK: Remove Neos.NodeTypes uses from comments, docs, tests <https://github.com/neos/neos-development-collection/pull/2692>`_
------------------------------------------------------------------------------------------------------------------------------

* Packages: ``ContentRepository``

`BUGFIX: Repair language label handling <https://github.com/neos/neos-development-collection/pull/2687>`_
---------------------------------------------------------------------------------------------------------

While the adjusting the emberjs codebase the XliffCacheVersion view helper and  the xliffUrl has been removed. So the value was missing in the configuration in the initialisation of the l18n handling never worked out.

To get it running again the check for the initialisation has been removed. This patch now adds the view helper again. So that we can render the configuration in the template and the l18n initialisation works like expected.

Thanks to @Sebobo for helping out and finding the issue.

* Packages: ``Neos``

`TASK: Adapt to Flow base URI change <https://github.com/neos/neos-development-collection/pull/2693>`_
------------------------------------------------------------------------------------------------------

* Packages: ``Browser`` ``Neos``

`BUGFIX: Remove even more aloha leftovers in functional tests <https://github.com/neos/neos-development-collection/pull/2695>`_
-------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`TASK: Cleanup Aloha leftovers in tests <https://github.com/neos/neos-development-collection/pull/2694>`_
---------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`TASK: Convert ui.aloha to ui.inline.editorOptions <https://github.com/neos/neos-development-collection/pull/2683>`_
--------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`BUGFIX: Translate labels when modifying tag and collections <https://github.com/neos/neos-development-collection/pull/2691>`_
------------------------------------------------------------------------------------------------------------------------------

**What I did**

Allow all media browser controllers to use the modified `addFlashMessage` method.

**How I did it**

Use a trait for adding the method to all related controllers.

**How to verify it**

Add or delete a tag or collection in the media browser.

* Packages: ``Browser`` ``Neos``

`TASK: Fix Plugin reference regarding additional arguments, add example <https://github.com/neos/neos-development-collection/pull/2681>`_
-----------------------------------------------------------------------------------------------------------------------------------------

**What I did**

The documentation regarding internal arguments for controller-based plugins mentions that internal arguments can be accessed by using `_key`, while `__key` is correct. Besides fixing this, I added an example on how to access it in the controller.

* Packages: ``Neos``

`BUGFIX: Synchronize react-ui menu state with vanilla js <https://github.com/neos/neos-development-collection/pull/2688>`_
--------------------------------------------------------------------------------------------------------------------------

The new vanilla js menu did use the session storage to save the states and it turns out that the react-ui uses the local storage. This patch synchronizes the states and takes care that when you change a menu state in the content module (react-ui) the state is also available in the user module for instance.

**What I did**
Use also the local storage in the vanilla js based menu and adopt the data structure to behave like the react-ui.

**How to verify it**
Change menu states in the content module an check then if the state is also in the user module. And vice versa.

* Fixes: `#2682 <https://github.com/neos/neos-development-collection/issues/2682>`_
* Packages: ``Neos``

`BUGFIX: Add the last visited node handler <https://github.com/neos/neos-development-collection/pull/2690>`_
------------------------------------------------------------------------------------------------------------

While the refactoring of the javascript code in the Neos.Neos package the LastVisitedNode.js
file has been deleted. Sadly this is used by the react-ui and the removal leads to errors in the console.

Thanks to @Sebobo for reporting that :)

* Packages: ``Fusion`` ``Neos``

`Apply fixes from StyleCI <https://github.com/neos/neos-development-collection/pull/2686>`_
-------------------------------------------------------------------------------------------

This pull request applies code style fixes from an analysis carried out by `StyleCI <https://github.styleci.io>`_.

---

For more information, click `here <https://github.styleci.io/analyses/XZwxER>`_.

* Packages: ``Neos``

`!!!TASK: Migrate extracted NodeTypes from Neos.NodeTypes to subpackage namespace <https://github.com/neos/neos-development-collection/pull/2385>`_
---------------------------------------------------------------------------------------------------------------------------------------------------

Currently Neos.NodeTypes defines many nodes of subpackages abstract and extends them in its own namespace. This makes it hard to support setups with Neos.NodeTypes or only the subpackages from a single site-package. 

This is especially problematic since we are not recommending Neos.NodeTypes anymore but still have it in the development collection.

This changes adds a migration to convert all NodeTypes that were extracted from Neos.NodeTypes into the namespace of the respective subpackage.

To apply the migration run `./flow node:migrate 20190304111200` 

Note: With this change we can remove the dependency to Neos.NodeTypes from Neos.Demo and only require the subpackages we really need.

* Packages: ``NodeTypes``

`!!! TASK: Remove ember-js based content module <https://github.com/neos/neos-development-collection/pull/2672>`_
-----------------------------------------------------------------------------------------------------------------

Removes old emberjs ContentModule Code and replaces the top navigation bar with plain ES6.
For the new Codebase we use Webpack as toolchain.

* Packages: ``Neos``

`BUGFIX: Site imports with cropped images <https://github.com/neos/neos-development-collection/pull/2679>`_
-----------------------------------------------------------------------------------------------------------

Aspect ratio is stored as a string and there's no TypeConverter
available to reconstruct the AspectRatio object from a string

* Fixes: `#2538 <https://github.com/neos/neos-development-collection/issues/2538>`_

Replaces https://github.com/neos/neos-development-collection/pull/2598

* Packages: ``Browser`` ``Media``

`BUGFIX: HTML augmenter preserves multibyte characters in attributes <https://github.com/neos/neos-development-collection/pull/2675>`_
--------------------------------------------------------------------------------------------------------------------------------------

The html augmenter uses the `loadHml` method of php which assumes the html content being iso encoded. This caused attributes with umlauts being broken once on the outermost tag. The previous declaration of the `UTF-8` charset has no effect on the `loadHtml` behavior.

The change applies the mb_convert_encoding method to the html which allows to properly read unicode characters as suggested on  https://www.php.net/manual/en/domdocument.loadhtml.php

In addition this change adds a duck-emoji to the neos test codebase which is an important improvement.

* Fixes: `#2677 <https://github.com/neos/neos-development-collection/issues/2677>`_
* Packages: ``Fusion`` ``Neos``

`BUGFIX: Add missing controller to edit forms <https://github.com/neos/neos-development-collection/pull/2674>`_
---------------------------------------------------------------------------------------------------------------

The Media Browser has at the moment the issue that you get an exception when you change the tag name or the collection name.

**What I did**
I just added the correct controllers to the fluid forms.

**How I did it**
1. Go to media browser module
2. click the pencil for tags for instance
3. Choose a tag and click the edit button
4. Change the name and click save

**How to verify it**
!`Bildschirmfoto 2019-09-02 um 16 19 52 <https://user-images.githubusercontent.com/1014126/64121136-405eeb00-cd9e-11e9-8c76-fe2c3ae3e55a.png>`_


* Packages: ``Browser``

`BUGFIX: Fix PluginImplementation unit test <https://github.com/neos/neos-development-collection/pull/2676>`_
-------------------------------------------------------------------------------------------------------------

This adjusts the test to the PSR-7 changes.

* Packages: ``Neos``

`BUGFIX: Updating an asset throws an exception due to unavailable translation <https://github.com/neos/neos-development-collection/pull/2673>`_
-----------------------------------------------------------------------------------------------------------------------------------------------

**How to verify it**

1. Replace an asset


* Packages: ``Browser``

`BUGFIX: Rewrite additional usages of setStatus and setHeader <https://github.com/neos/neos-development-collection/pull/2661>`_
-------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`TASK: Further cleanup tests <https://github.com/neos/neos-development-collection/pull/2660>`_
----------------------------------------------------------------------------------------------

* Packages: ``Browser``

`BUGFIX: Fix calls to removed method / Fix method signature <https://github.com/neos/neos-development-collection/pull/2671>`_
-----------------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`TASK: Document RichTextEditor <https://github.com/neos/neos-development-collection/pull/2662>`_
------------------------------------------------------------------------------------------------

Merge after https://github.com/neos/neos-ui/pull/2546

* Packages: ``Neos``

`BUGFIX: Change leftover calls to setStatus and setHeader <https://github.com/neos/neos-development-collection/pull/2670>`_
---------------------------------------------------------------------------------------------------------------------------

* Packages: ``Media``

`TASK: Exchange login wallpaper for Neos 5.0 <https://github.com/neos/neos-development-collection/pull/2667>`_
--------------------------------------------------------------------------------------------------------------

Autumn sunrise in Saxon Switzerland by Fabian Tschök

* Packages: ``Neos``

`BUGFIX: Adjust setHeader to PSR-7 interfaces <https://github.com/neos/neos-development-collection/pull/2669>`_
---------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`!!! BUGFIX: Neos\\Eel\\Utility::evaluateEelExpression may contain null <https://github.com/neos/neos-development-collection/pull/2657>`_
---------------------------------------------------------------------------------------------------------------------------------------

`Node::getLabel()` has a return type set to `string` while the interface hasn’t.
The label is built by the ExpressionBasedNodeLabelGenerator which may return null.
Added an explicit string cast to get an empty string in that case.

* Packages: ``ContentRepository``

`BUGFIX: Use PSR-7 methods in AssetProxyController::importAction <https://github.com/neos/neos-development-collection/pull/2658>`_
----------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Browser`` ``Neos``

`TASK: Fixed Typo in ContentCache.rst <https://github.com/neos/neos-development-collection/pull/2647>`_
-------------------------------------------------------------------------------------------------------

**What I did**
fixed typo

* Packages: ``Neos``

`TASK: Fix documentation about f:widget.uri <https://github.com/neos/neos-development-collection/pull/2646>`_
-------------------------------------------------------------------------------------------------------------

its <f:widget.uri> / <f:widget.link> and not <f:uri.widget> / <f:link.widget>

* Packages: ``Neos``

`TASK: Postpone deprecation of NodeInterface <https://github.com/neos/neos-development-collection/pull/2643>`_
--------------------------------------------------------------------------------------------------------------

The nodeinterface is marked as deprecated with the announcement
to be replaced in Neos 5.0. This will not happen though.

The deprecation of the interface should be announced together
with replacement in the Neos core with one of the next minor versions.

* Packages: ``ContentRepository`` ``Fusion``

`BUGFIX: Avoid inheritance on unset Fusion pathes <https://github.com/neos/neos-development-collection/pull/2238>`_
-------------------------------------------------------------------------------------------------------------------

When Fusion pathes are unset with the `>` operator the operations was previously handled by the parser. The drawback was that the parser unset could not affect inherited pathes which were merged into the prototype by the runtime.

This change adds the internal-key `__stopInheritanceChain` to the fusion ast whenever a value is unset. The fusion runtime will stop merging parent prototypes for the pathes where this key is set.

As a common example the following code does not render an empty body but a will render the 
keys  `site` and `node` from the `Neos.Neos:Page` prototype which is totally unexpected and against the intention.
```
prototype(Vendor.Site:ExampleDocument) < prototype(Neos.Neos:Page) {
    body >
    body = Neos.Fusion:Array {
       @position = 'after bodyTag'
       message = "hello world"
   }
}
```

!!! While this is a clear bug this change might break code that relied on the old inconsitent behavior. It is also important that this also avoids inheriting of `@position` keys so if you rely on the ordering you have to add the @position keys again after unsetting like in the example above.

* Fixes: `#2213 <https://github.com/neos/neos-development-collection/issues/2213>`_, #1109
* Packages: ``Browser`` ``Fusion``

`BUGFIX: Prevent deleting or rebasing the live workspace <https://github.com/neos/neos-development-collection/pull/2632>`_
--------------------------------------------------------------------------------------------------------------------------

Doing so would completely break Neos when resolving
the content of a workspace that is based on live.

* Resolves: `#2631 <https://github.com/neos/neos-development-collection/issues/2631>`_
* Packages: ``Neos``

`TASK: Add more doc for Eel Translation.translate <https://github.com/neos/neos-development-collection/pull/2640>`_
-------------------------------------------------------------------------------------------------------------------

**What I did**

Add more information for Eel Translation helper:
- existence of I18n alias
- add more doc for Translation.translate's source argument
- add an example

**How to verify it**

Check that the doc is accurate

* Packages: ``Neos``

`TASK: Fix option name for NodeName filter <https://github.com/neos/neos-development-collection/pull/2641>`_
------------------------------------------------------------------------------------------------------------

**What I did**

Fix option name for NodeName filter in the documentation

**How to verify it**

Check that the doc is accurate with the source code of the Filter

* Packages: ``Neos``

`BUGFIX: Fix broken JS require implementation in Backend Modules <https://github.com/neos/neos-development-collection/pull/2639>`_
----------------------------------------------------------------------------------------------------------------------------------

With resolution of #2479 javascript blocks were put into CDATA
sections in order to prevent them to break the Fluid parser.

This introduced a regression that prevents Backend Modules to
work properly when `loadMinifiedJavascript` is disabled.

Background:

The string `resource://...` is replaced by the `ResourceInterceptor`
but that behavior is skipped for CDATA sections.

* Related: `#2479 <https://github.com/neos/neos-development-collection/issues/2479>`_
* Packages: ``Neos``

`!!!TASK: Adapt to PSR-7 HTTP separation <https://github.com/neos/neos-development-collection/pull/2485>`_
----------------------------------------------------------------------------------------------------------

This is the adjustment PR to https://github.com/neos/flow-development-collection/pull/1552

* Packages: ``Neos``

`TASK: Update documentation about inline validators <https://github.com/neos/neos-development-collection/pull/2626>`_
---------------------------------------------------------------------------------------------------------------------

Merge after https://github.com/neos/neos-ui/pull/2538

* Packages: ``Neos``

`TASK: Refactor unit tests to static assert calls <https://github.com/neos/neos-development-collection/pull/2624>`_
-------------------------------------------------------------------------------------------------------------------

The assert* methods are static methods in recent versions of PHPUnit. As calling static methods via $this-> feels odd, I replaced the method calls with static calls.
* Packages: ``Browser`` ``ContentRepository`` ``Media`` ``Neos``

`Moved documentation <https://github.com/neos/neos-development-collection/pull/2616>`_
--------------------------------------------------------------------------------------

Our big effort to move the documentation away from RTD to our own Neos instance is finally almost finished. Therefore this pull request will remove all (often outdated) documentation and only keep the references and deprecated Ember documentation in RTD.

**Related issues**

 - https://github.com/neos/documentation/issues/32
 - https://github.com/neos/neos-development-collection/issues/1771
 - https://github.com/neos/documentation/issues/22
 - Can we safely move Command Live Tools docs to References, and get rid of Operations folder?

* Packages: ``Neos``

`FEATURE: Make Neos independent from Setup package <https://github.com/neos/neos-development-collection/pull/2619>`_
--------------------------------------------------------------------------------------------------------------------

Removes the `neos/setup` composer dependency from the `neos/neos` package
and adds a root dependency to the new `neos/neos-setup` package that now
contains configuration and custom "setup step" implementations.

* Resolves: `#2618 <https://github.com/neos/neos-development-collection/issues/2618>`_

`Apply fixes from StyleCI <https://github.com/neos/neos-development-collection/pull/2625>`_
-------------------------------------------------------------------------------------------

This pull request applies code style fixes from an analysis carried out by `StyleCI <https://github.styleci.io>`_.

---

For more information, click `here <https://github.styleci.io/analyses/qJwPwk>`_.

* Packages: ``ContentRepository`` ``Media`` ``Neos``

`FEATURE: Add PropertyValue node migration filter <https://github.com/neos/neos-development-collection/pull/2465>`_
-------------------------------------------------------------------------------------------------------------------

Adds a new filter to match against property values in node migrations.

* Packages: ``ContentRepository``

`TASK: Removes duplicate condition <https://github.com/neos/neos-development-collection/pull/2608>`_
----------------------------------------------------------------------------------------------------

**What I did**
Removed a elseif condition that was exactly the same than the if condition before.

* Packages: ``Neos``

`BUGFIX: Don't render exception message in Production Context <https://github.com/neos/neos-development-collection/pull/2603>`_
-------------------------------------------------------------------------------------------------------------------------------

Synchronizes the behavior of the Fusion rendering exception handing with the one
from Flow to only render the exception *message* in `Development` Context.

* Fixes: `#2602 <https://github.com/neos/neos-development-collection/issues/2602>`_
* Packages: ``AssetList`` ``BaseMixins`` ``Browser`` ``ColumnLayouts`` ``ContentReferences`` ``Form`` ``Fusion`` ``Navigation`` ``Neos`` ``NodeTypes``

`TASK: Safelist branches for travis builds <https://github.com/neos/neos-development-collection/pull/2600>`_
------------------------------------------------------------------------------------------------------------

This prevents builds from running doubly on branches created on this repository for PRs, e.g. through the StyleCI bot or by github inline PRs.

See https://docs.travis-ci.com/user/customizing-the-build/#safelisting-or-blocklisting-branches
See also https://github.com/neos/flow-development-collection/pull/1660

Retargeted replacement for #2593 

`Apply fixes from StyleCI <https://github.com/neos/neos-development-collection/pull/2589>`_
-------------------------------------------------------------------------------------------

This pull request applies code style fixes from an analysis carried out by `StyleCI <https://github.styleci.io>`_.

---

For more information, click `here <https://github.styleci.io/analyses/q1QdDL>`_.

* Packages: ``Browser`` ``ContentRepository`` ``Media`` ``Neos``

`BUGFIX: Skip nodes if they cannot be resolved in ContentCacheFlusher <https://github.com/neos/neos-development-collection/pull/2595>`_
---------------------------------------------------------------------------------------------------------------------------------------

If a node cannot be resolved in the content cache flusher
skip this node instead of throwing an exception.

* Resolves: `#2594 <https://github.com/neos/neos-development-collection/issues/2594>`_
* Packages: ``Browser`` ``Neos``

`!!! FEATURE Improve standalone FusionView <https://github.com/neos/neos-development-collection/pull/2569>`_
------------------------------------------------------------------------------------------------------------

- The `fallbackView` and related options are removed as it only caused confusion and made debugging harder
- The `fusionPathPatterns` are now expected to point to a single fusion file instead of parsing all files in the while directory. If the path points to a directory the `Root.fusion` is loaded as starting point. 
- Below the Root.fusion all other fusion files have to be included explicitly!
- The cache `Neos_Fusion_ObjectTree` is added and connected to the FusionView via aspect. The cache is enabled only for production via Setting `Neos.Fusion.enableObjectTreeCache`

Upgrade Instructions: If you use the standalone FusionView make sure that a `Root.fusion` exist in your `fusionPathPatterns` and that all other fusion files are included from there.

* Packages: ``Browser`` ``Fusion`` ``Neos``

`TASK: Add sites default ordering <https://github.com/neos/neos-development-collection/pull/2372>`_
---------------------------------------------------------------------------------------------------

If you have many sites inside a Neos instance it is difficult to find a specific site, because they are ordered by creation date. I added default ordering by name and nodeName to SitesRepository.

* Packages: ``Neos``

`Apply fixes from StyleCI <https://github.com/neos/neos-development-collection/pull/2587>`_
-------------------------------------------------------------------------------------------

This pull request applies code style fixes from an analysis carried out by `StyleCI <https://github.styleci.io>`_.

---

For more information, click `here <https://github.styleci.io/analyses/zDEWyy>`_.

* Packages: ``Browser`` ``ContentRepository`` ``Media`` ``Neos``

`!!!TASK: Remove static robots.txt file for fresh installations <https://github.com/neos/neos-development-collection/pull/2583>`_
---------------------------------------------------------------------------------------------------------------------------------

Since the base distribution contains ´´neos/seo´´ 3.x which does a much
better job at providing a more valuable and accurate ``robots.txt`` file.

When the default ``robots.txt`` still remains in the projects Web
folder, this can cause a lot of confusion. To make matters worse, it's
recreated whenever the composer install scripts are executed.

In case a custom distribution does not install the ``neos/seo`` package,
we now have the meta tag within the Neos login page as a fallback, so
even then status quo remains without the standard ``robots.txt`` from a SEO perspective.

Closes: #2533

* Packages: ``AssetList`` ``Browser`` ``ContentReferences`` ``Form`` ``Navigation`` ``Neos``

`TASK: Create FUNDING.yml <https://github.com/neos/neos-development-collection/pull/2544>`_
-------------------------------------------------------------------------------------------

* Packages: ``github``

`BUGFIX: Flush affected document node on asset change <https://github.com/neos/neos-development-collection/pull/2527>`_
-----------------------------------------------------------------------------------------------------------------------

When an asset is replaced, the content cache is flushed, but in most
cases this does not have an effect. As most content nodes do not have
a cache entry, the cache entry higher in the chain needs to be
flushed.

This is now done by fetching the affected node for an asset usage and
passing that to `registerNodeChange(…)` in the `ContentCacheFlusher`.

* Fixes: `#2061 <https://github.com/neos/neos-development-collection/issues/2061>`_
* Packages: ``BaseMixins`` ``Navigation`` ``Neos``

`BUGFIX: Correctly pass current node to menu templates <https://github.com/neos/neos-development-collection/pull/2534>`_
------------------------------------------------------------------------------------------------------------------------

**What I did**
Correctly pass the current node to menu templates in a way that does not cause an infinite loop

See also: #2532 

**How I did it**
- Revert back to behaviour removed in https://github.com/neos/neos-development-collection/commit/`6f302f19d2d6dcf4293223d801d867d9fd1d208e <https://github.com/neos/neos-development-collection/commit/6f302f19d2d6dcf4293223d801d867d9fd1d208e>`_#diff-033bf88345978204633d4a60db6f410cL5

**How to verify it**
* See: `#2532 <https://github.com/neos/neos-development-collection/issues/2532>`_  
* Packages: ``Neos``

`TASK: Add StaleBot configuration file <https://github.com/neos/neos-development-collection/pull/2530>`_
--------------------------------------------------------------------------------------------------------

Add Stalebot configuration.
See https://discuss.neos.io/t/rfc-introduce-stale-bot-on-dev-collections/4371

* Packages: ``github``

`BUGFIX: The copyright notice of assets is lost when exporting to Sites.xml <https://github.com/neos/neos-development-collection/pull/2529>`_
---------------------------------------------------------------------------------------------------------------------------------------------

see also #2503

**What I did**

Included the copyright notice of assets in exports to `Sites.xml`.

**How I did it**

Added `copyrightNotice` in `ArrayConverter.php` the same way as `title`.

**How to verify it**

1. Add a copyright notice to an asset.
2. Export to `Sites.xml`.
3. Do a clean import.
4. Check that the copyright notice is preserved.

* Packages: ``Media`` ``Neos``

`BUGFIX: The caption of assets is lost when exporting to Sites.xml <https://github.com/neos/neos-development-collection/pull/2503>`_
------------------------------------------------------------------------------------------------------------------------------------

Notes:
1. I could not find tests covering this part of the code. If you point me to it, I will also add a test case for `caption`.
2. The copyright notice is also missing from the export, but afaik this was added in Neos 4.2, so I will open a separate PR.
3. Relations to tags and collections are also missing from the export, but they seem more complicated, so I will open separate PRs.

**What I did**

Included the caption of assets in exports to `Sites.xml`.

**How I did it**

Added `caption` in `ArrayConverter.php` the same way as `title`.

**How to verify it**

1. Add a caption to an asset.
2. Export to `Sites.xml`.
3. Do a clean import.
4. Check that the caption is preserved.



* Packages: ``Media``

`!!!TASK: Disable and deprecate plugin and content prototype generators <https://github.com/neos/neos-development-collection/pull/2487>`_
-----------------------------------------------------------------------------------------------------------------------------------------

The prototype generator classes are deprecated and removed from the nodeType configuration. This
helps to make the fusion-code more explict and understand the connection between nodeType and fusion prototype much simpler. The previously assigned base types were not recommended anymore and thus usually are overwritten anyways.

A very welcome effect is that the error message for missing node rendering prototypes will say just that and not any more that a template file is missing.

In addition this removes the documentPrototypeGenerator that was deprecated already for Neos 5.

Upgrade instructions:

To upgrade you have to make sure that content and plugin nodetypes have a matching fusion prototype that looks like the following examples:

```
prototype(Vendor.Site:ContentExample) < prototype(Neos.Fusion:Template) {
    templatePath = "resource://Vendor.Site/Private/Templates/NodeTypes/EContentExamplexample.html" 
    /* for all properties needed for rendering */
    title = ${q(node).property('title')}
}

prototype(Vendor.Site:PluginExample) < prototype(Neos.Neos:Plugin) {
        package = "Vendor.Site"
        subpackage = ""
        controller = "Example"
        action = "index"
}
```
Note: `Neos.Fusion:Template` is not considered best practice anymore in favor of fusion-afx.

* Packages: ``NodeTypes``

`!!! TASK: Remove deprecated registerAssetResourceChange() slot <https://github.com/neos/neos-development-collection/pull/2526>`_
---------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`BUGFIX: Changed Domains by UriConstraints will not no longer get destroyed by the LinkingService <https://github.com/neos/neos-development-collection/pull/2523>`_
-------------------------------------------------------------------------------------------------------------------------------------------------------------------

With `UriConstraints` we have the ability to modify the Host but there is a problem with the `LinkingService` in combination with `UriConstraints`. If you ask the `LinkingService` for a absolut Uri then it add the current base to the Url.

* Fixes: `#2398 <https://github.com/neos/neos-development-collection/issues/2398>`_
* Packages: ``Neos``

`BUGFIX: node label sanitizing regex strips characters <https://github.com/neos/neos-development-collection/pull/2524>`_
------------------------------------------------------------------------------------------------------------------------

**What I did**
[[^:print:]] resulted in the characters print: followed by ] being removed from the node label. Non-printable characters should be matched with [^[:print:]].

Resolves neos/neos-ui#2496

**How to verify it**
Output node labels normally including n], i] etc. e.g. in the document tree.

This PR replaces and closes #2515 which was targeting master.

* Packages: ``Neos``

`BUGFIX: Fix regression in ViewHelpers (render args removal) <https://github.com/neos/neos-development-collection/pull/2525>`_
------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Browser`` ``Media``

`!!! TASK: Remove discardall & publishall CLI commands <https://github.com/neos/neos-development-collection/pull/2521>`_
------------------------------------------------------------------------------------------------------------------------

They were deprecated since Neos 1.2 (!). Use `publish` and `discard`
instead.

* Packages: ``Neos``

`!!! TASK: Remove ConvertNodeUrisImplementation <https://github.com/neos/neos-development-collection/pull/2522>`_
-----------------------------------------------------------------------------------------------------------------

Use the `ConvertUrisImplementation` instead.

This was deprecated since 2014(!) already…

* Packages: ``Neos``

`!!! TASK: Correct method signature of DataSourceInterface <https://github.com/neos/neos-development-collection/pull/2208>`_
----------------------------------------------------------------------------------------------------------------------------

This adjusts the getData method signature of the DataSourceInterface,
because if the first parameter is optional, the following should also be
optional.

The new signature has a default for `$arguments`:

    public function getData(NodeInterface $node = null, array $arguments = []);

* Packages: ``Form`` ``Neos``

`TASK: Use PackageManager, not PackageManagerInterface <https://github.com/neos/neos-development-collection/pull/2519>`_
------------------------------------------------------------------------------------------------------------------------

The `PackageManagerInterface` is deprecated and will be removed with
Flow 6.0, so avoid it and use `PackageManager` directly.

* Packages: ``Browser`` ``ContentRepository`` ``Fusion`` ``Media`` ``Neos`` ``SiteKickstarter``

`TASK: Remove arguments from VH render methods <https://github.com/neos/neos-development-collection/pull/2506>`_
----------------------------------------------------------------------------------------------------------------

This removes the arguments from `render()` in Fluid ViewHelpers, and
registers them using `registerArgument` instead.

Arguments to `render()` were deprecated as of Flow 4.0 and support
is removed with Flow 6.0.

* Packages: ``Neos``

`FEATURE: Implement pager, ordering and search in user management module <https://github.com/neos/neos-development-collection/pull/2497>`_
------------------------------------------------------------------------------------------------------------------------------------------

This orders the results in the backend user management module by username and introduces a pager. Furthermore I implemented a search field to search in usernames and full names


* Packages: ``Fusion`` ``Neos``

`BUGFIX: Adjust warning text in setup <https://github.com/neos/neos-development-collection/pull/2510>`_
-------------------------------------------------------------------------------------------------------

Fixes Issue #2488
In this PR I adjusted the somewhat missleading warning text, which is displayed in the image driver setup step, if none of the requiered drivers is installed. Additionaly I added some javascript to the image driver and the database configuration step in the setup package to disable the next button, if an error message is shown. See the PR https://github.com/neos/setup/pull/53

* Packages: ``Neos``

`TASK: Add setNoOpener property to Neos.Neos:ConvertUris documentation <https://github.com/neos/neos-development-collection/pull/2483>`_
----------------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Browser`` ``Neos``

`BUGFIX: Use countAll of AssetRepository to get count of all assets <https://github.com/neos/neos-development-collection/pull/2403>`_
-------------------------------------------------------------------------------------------------------------------------------------

To get count of all assets, we should use the AssetRepository.
* Solves: `#2358 <https://github.com/neos/neos-development-collection/issues/2358>`_ 
* Packages: ``Browser`` ``Neos``

`BUGFIX: Accept valid settings rejected by broken schema <https://github.com/neos/neos-development-collection/pull/2507>`_
--------------------------------------------------------------------------------------------------------------------------

* Packages: ``Fusion``

`BUGFIX: Workspace review module no longer shows target dimension <https://github.com/neos/neos-development-collection/pull/2509>`_
-----------------------------------------------------------------------------------------------------------------------------------

Fix the behaviour Workspace review module don't shows target dimension

* Fixes: `#2423 <https://github.com/neos/neos-development-collection/issues/2423>`_
* Packages: ``BaseMixins`` ``Browser`` ``Neos``

`BUGFIX: Add translation for discard confirmation <https://github.com/neos/neos-development-collection/pull/2512>`_
-------------------------------------------------------------------------------------------------------------------

Fixes https://github.com/neos/neos-ui/issues/2283

* Packages: ``BaseMixins`` ``Browser`` ``Neos``

`BUGFIX: Assigned asset collections cannot be unassigned <https://github.com/neos/neos-development-collection/pull/2502>`_
--------------------------------------------------------------------------------------------------------------------------

Fix the behaviour when the asset can't be unassigned from collections

* Fixes: `#2473 <https://github.com/neos/neos-development-collection/issues/2473>`_

`TASK: Add flowQuery \`q\` helper to the Eel configuration <https://github.com/neos/neos-development-collection/pull/2505>`_
----------------------------------------------------------------------------------------------------------------------------

Once the magic `q` method is removed FlowQuery has to be registered in the configuration to have `q` in the defaultContext for Fusion and CR label generation. This makes FlowQuery work as before from an integration perspective.


* Packages: ``Fusion`` ``Neos``

`BUGFIX: Make exception for non renderable fusion path more helpful <https://github.com/neos/neos-development-collection/pull/2489>`_
-------------------------------------------------------------------------------------------------------------------------------------

The existing exception for non renderable fusion pathes was not very helpful hard to read and missed mentioning likely reasons like a typo in the prototype name. It also suggested a solution that is unlikely to fix the problem.

With this change the prototype name is moved to the front of the error message
as it is the most important information.

The path is removed from the message-body as the fusion exception handler will render it anyway.

The most likely reasons typo + missing prototype are mentioned first and other possible reasons
like missing parent-protopype, missing `@class` and missing `include:` later.

The proposed solution to inherit from `Neos.Fusion:Template` is removed as it was misleading

* Packages: ``Browser`` ``Fusion`` ``Neos``

`TASK: Updated fontawesome to 5.8 for old UI <https://github.com/neos/neos-development-collection/pull/2500>`_
--------------------------------------------------------------------------------------------------------------

This updates FontAwesome to 5.8 for the old UI backendModules (e.g. UserManagement)

* Packages: ``Neos``

`[TASK] Make the ConvertUrisImplementation extensible <https://github.com/neos/neos-development-collection/pull/24>`_
---------------------------------------------------------------------------------------------------------------------

With this change the ConvertUrisImplementation is more extensible.
The anonymous function is now a normal method, so now the URLs are better
expandable via an aspect.

* Resolves: `NEOS-1477 <https://jira.neos.io/browse/NEOS-1477>`_
* Packages: ``Afx``

`[TASK] Make the ConvertUrisImplementation extensible <https://github.com/neos/neos-development-collection/pull/24>`_
---------------------------------------------------------------------------------------------------------------------

With this change the ConvertUrisImplementation is more extensible.
The anonymous function is now a normal method, so now the URLs are better
expandable via an aspect.

* Resolves: `NEOS-1477 <https://jira.neos.io/browse/NEOS-1477>`_

`Show hidden in index nodes in dimensions menu <https://github.com/neos/neos-development-collection/pull/2504>`_
----------------------------------------------------------------------------------------------------------------

Re-add `renderHiddenInIndex` with default `true`, to show also hidden in index nodes in dimensions menu as before.

* Packages: ``Neos``

`TASK: Exchange injection of PsrSystemLoggerInterface to LoggerInterface <https://github.com/neos/neos-development-collection/pull/2493>`_
------------------------------------------------------------------------------------------------------------------------------------------

With Flow 6.0 PsrSystemLoggerInterface gets deprecated, so we exchange the PsrSystemLoggerInterface with LoggerInterface.

* Packages: ``ContentRepository`` ``Fusion`` ``Media`` ``Neos``

`BUGFIX: Remove usage of getproviders from UserController <https://github.com/neos/neos-development-collection/pull/2501>`_
---------------------------------------------------------------------------------------------------------------------------

Remove the usage of the deprecated and removed `AuthenticationProviderManager::getProviders()`method.

You find this change in https://github.com/neos/neos-development-collection/pull/2501/commits/`4492c3d3b2295e2ea01f3a69ad760ba7502da3f1 <https://github.com/neos/neos-development-collection/commit/4492c3d3b2295e2ea01f3a69ad760ba7502da3f1>`_ - a second commit improves the method typing and code style of that class.

* Packages: ``Neos``

`TASK: Avoid deprecated method in AuthenticationManager <https://github.com/neos/neos-development-collection/pull/2495>`_
-------------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`TASK: Raise PHP version by one minor version in travis.yaml <https://github.com/neos/neos-development-collection/pull/2494>`_
------------------------------------------------------------------------------------------------------------------------------

Raise PHP versions from 7.1 to 7.2 and 7.2 to 7.3 in the travis test matrix.

`[TASK] Create .codeclimate.yml <https://github.com/neos/neos-development-collection/pull/6>`_
----------------------------------------------------------------------------------------------

Adds a codeclimate configuration excluding Migrations, Tests and
JavaScript libraries.

* Packages: ``Browser`` ``Neos``

`!!! FEATURE: Refactor tests to phpunit v8.1 <https://github.com/neos/neos-development-collection/pull/2472>`_
--------------------------------------------------------------------------------------------------------------

* Resolves: `#2367 <https://github.com/neos/neos-development-collection/issues/2367>`_ 

Needs https://github.com/neos/flow-development-collection/pull/1565 to be merged before

* Packages: ``ContentRepository``

`TASK: Separate NodeTypes.yaml according to best practices <https://github.com/neos/neos-development-collection/pull/2490>`_
----------------------------------------------------------------------------------------------------------------------------

In this PR, I attempted to follow the best practice "Each NodeType SHOULD be defined in a dedicated yaml-file and the file-name MUST represent the namespace of the contained NodeType/s."

In order to achieve this, I separated the NodeTypes.yaml into individual yaml files.

* Packages: ``Neos``

`BUGFIX: Avoid PHP exception in NamespaceDetectionTemplateProcessor <https://github.com/neos/neos-development-collection/pull/2484>`_
-------------------------------------------------------------------------------------------------------------------------------------

Related to neos/neos-development-collection#2479

* Packages: ``Browser`` ``Neos``

`Bugfix: Do access objects by key 0 in canEvaluate() of sort-operation <https://github.com/neos/neos-development-collection/pull/2474>`_
----------------------------------------------------------------------------------------------------------------------------------------

For the current use of the sort operation, the element with key 0 must be present in $context. But this is not necessary for the sort itself. Consequently, the sort operation does not work using arrays without key 0. 

Access via pointer avoids this problem in this PR.

* Packages: ``Neos``

`TASK: Limit parentpath index length through annotation <https://github.com/neos/neos-development-collection/pull/2478>`_
-------------------------------------------------------------------------------------------------------------------------

As of Doctrine DBAL 2.9.0 this is actually possible, so we can finally
do it right.

* See: `#2475 <https://github.com/neos/neos-development-collection/issues/2475>`_
* Packages: ``ContentRepository`` ``Neos``

`Remove wrong property from component wiring property list <https://github.com/neos/neos-development-collection/pull/2480>`_
----------------------------------------------------------------------------------------------------------------------------

The property `node` is not a wired property

* Packages: ``Neos``

`TASK: Correct syntax <https://github.com/neos/neos-development-collection/pull/2476>`_
---------------------------------------------------------------------------------------

* Packages: ``ContentRepository`` ``Neos``

`BUGFIX: Fix \`parents\` flowQuery operation accidentally returning the \`/sites\` and \`/\` node <https://github.com/neos/neos-development-collection/pull/2464>`_
-------------------------------------------------------------------------------------------------------------------------------------------------------------------

The test that should verify this behavior failed to mock the root and sites node and thus the exclusion of `/sites` was not verified correctly.

* Resolves: `#2459 <https://github.com/neos/neos-development-collection/issues/2459>`_
* Packages: ``Neos``

`BUGFIX: Filtering by nodeType that has subtypes causes a php_error <https://github.com/neos/neos-development-collection/pull/2461>`_
-------------------------------------------------------------------------------------------------------------------------------------

When calculating constraints for nodeType filter the nodeDataRepository currently puts the nodeType that was given as filter-argument directly as string to the returned constraint-object but all superTypes as NodeType-objects. This later causes trouble once the types are passed to the isOfType method that expects (but not enforces) strings.

The problem exists since ages but is exposed in Neos 4.2 by the altered handling of removed NodeTypes. Before that `isOfType` implicitly accepted a NodeType as argument. The added checks for declaredSuperTypes that are null (removed by subtype) broke this implication.

Resolves: https://github.com/neos/neos-development-collection/issues/2460

* Packages: ``ContentRepository``

`TASK: Remove deprecated signals <https://github.com/neos/neos-development-collection/pull/2457>`_
--------------------------------------------------------------------------------------------------

Remove deprecated signals `Asset::emitAssetCreated` and `Thumbnail:: emitThumbnailCreated` which were moved to the according service classes.

* Packages: ``Browser`` ``Media``

`BUGFIX: Fix return type annotation <https://github.com/neos/neos-development-collection/pull/2456>`_
-----------------------------------------------------------------------------------------------------

The return type annotation for ``getParent()`` was wrong

* Packages: ``ContentRepository`` ``Neos``

`Apply fixes from StyleCI <https://github.com/neos/neos-development-collection/pull/2454>`_
-------------------------------------------------------------------------------------------

This pull request applies code style fixes from an analysis carried out by `StyleCI <https://github.styleci.io>`_.

---

For more information, click `here <https://github.styleci.io/analyses/q5w93B>`_.

* Packages: ``Browser`` ``Neos``

`DOCS: Fix code blocks <https://github.com/neos/neos-development-collection/pull/2455>`_
----------------------------------------------------------------------------------------

* Packages: ``Neos``

`TASK: Update release notes <https://github.com/neos/neos-development-collection/pull/2451>`_
---------------------------------------------------------------------------------------------

* Packages: ``Neos``

`BUGFIX: Use correct Flow version within 4.3 dev collection <https://github.com/neos/neos-development-collection/pull/2452>`_
-----------------------------------------------------------------------------------------------------------------------------

`BUGFIX: Fix site-package generator <https://github.com/neos/neos-development-collection/pull/2447>`_
-----------------------------------------------------------------------------------------------------

Somehow the classic site generator did not replace the occurrences of the package names
in fusion `reference://{packageKey}/...` strings any more while in other places this still worked.

This works around this by falling back to a very plain search replace based implementation that is only used on the fusion files.

With this change a site package created with the setup tool or the kickstart:site command will not directly welcome the user with fusion-errors which it did before.

* Packages: ``SiteKickstarter``

`FEATURE: Variant view in react and possibility of cropping <https://github.com/neos/neos-development-collection/pull/2426>`_
-----------------------------------------------------------------------------------------------------------------------------

This variant view based on React is a beta feature, just like the current
implementation of the variant view. It allows to crop any preset variant
with a crop, retaining the current aspect ratio.

* Packages: ``Browser`` ``Media``

`BUGFIX: Apply enforced image format conversions to all generated images <https://github.com/neos/neos-development-collection/pull/2431>`_
------------------------------------------------------------------------------------------------------------------------------------------

Previously the configured image format conversions were only applied when a target size was specified. That made the preview images in the media module still not show thumbnails for tiff images. 

In addition the new configuration is much more generic and is easier to support in future when we may improve the implementation.

This change removes the ConvertImageThumbnail Generator and the Configuration that came with it and introduces a setting `Neos.Media.image.defaultOptions.convertFormats` instead. The setting is a key-value-list that allows to specify which media types shall be converted whenever they are rendered. The key in the new configuration is the the source media-type and the value is the target media-type or file-extension.

By default the setting is empty since all format conversions have to be supported by by the imagine driver and especially ``Gd`` lacks some features. 

With the following setting you setup automatic conversion of tiff images to jpg:
```
Neos:
  Media:
    image:
      defaultOptions:
        # Image formats that shall always be converted regardless wether an adjustment was applied or not
        # The key is the the source media-type and the value is the target media-type or file-extension.
        convertFormats:
          image/tiff: image/jpeg
```

!!! This replaces the implementation for the default conversions in #2389 with a more generic approach wich is non breaking since it was not released yet.


* Packages: ``Media`` ``Neos``

`FEATURE: Add release notes <https://github.com/neos/neos-development-collection/pull/2440>`_
---------------------------------------------------------------------------------------------

* Packages: ``Neos``

`BUGFIX: add missing and new copyright field to the edit and new dialog in the media manager <https://github.com/neos/neos-development-collection/pull/2444>`_
--------------------------------------------------------------------------------------------------------------------------------------------------------------

add the missing copyright field again and also added a new on for the "new" dialog

* Packages: ``Browser``

`BUGFIX: add equals() methods on ContentStreamIdentifier and TraversableNode, use it in TraversableNodes <https://github.com/neos/neos-development-collection/pull/2442>`_
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------

* Packages: ``ContentRepository``

`BUGFIX: Fix tag rendering in media module <https://github.com/neos/neos-development-collection/pull/2439>`_
------------------------------------------------------------------------------------------------------------

The names of tags were not rendered in the sidebar of the media module since https://github.com/neos/neos-development-collection/pull/2408 was merged because of an incomplete renaming from `tag` to `retrievedTag`

* Packages: ``Browser``

`TASK: Adjust created responses to \`\`ActionResponse\`\` <https://github.com/neos/neos-development-collection/pull/2438>`_
---------------------------------------------------------------------------------------------------------------------------

This changes responses created in various areas of Neos to be
of the new ``ActionResponse`` class in preparation of the next
major version.

* Related: `#2437 <https://github.com/neos/neos-development-collection/issues/2437>`_
* Packages: ``Fusion`` ``Neos``

`Namespace and interface adjustments <https://github.com/neos/neos-development-collection/pull/2430>`_
------------------------------------------------------------------------------------------------------

This

* moves the new interfaces and value objects to conceptually matching namespaces (e.g. NodeAggregateIdentifier -> NodeAggregate, NodeTypeConstraintFactory -> NodeType)
* makes NodeName nullable
* moves getDimensionSpacePoint from NodeInterface to TraversableNodeInterface
* removes getSubgraph from TraversableNodeInterface
* removes the now obsolete RootNodeIdentifiers class
* removes the now obsolete NodeIdentifier class

* Packages: ``Browser``

`TASK: Contain dimension changes in tests to test case only <https://github.com/neos/neos-development-collection/pull/2427>`_
-----------------------------------------------------------------------------------------------------------------------------

The reset to empty array was technically wrong because dimensions were
configured. While this is not an issue at this time, it can be one
when other tests rely on the integrity of configured dimensions and
the repository.

* Packages: ``Neos``

` FEATURE: Set crop image adjustment by aspect ratio <https://github.com/neos/neos-development-collection/pull/2408>`_
----------------------------------------------------------------------------------------------------------------------

This change introduces a new property "aspectRatio" for the crop image
adjustment. It allows users to set a cropping area simply by providing
an aspect ratio, instead of x, y, width and height.

If an aspect ratio is specified, the x, y, width, and height parameters
are automatically deactivated. Likewise, if x, y, width or height are
specified, a potentially defined aspect ratio value will be reset.

* Packages: ``Media``

`TASK: Remove NodeInterface::getNodeIdentifier and add root node type name constant <https://github.com/neos/neos-development-collection/pull/2425>`_
-----------------------------------------------------------------------------------------------------------------------------------------------------

This change is required to adjust the codebase to our current Event Sourced CR refactoring, where we drop the NodeInterface::nodeIdentifier.

`TASK: Adjust Login Wallpaper for Neos 4.3 <https://github.com/neos/neos-development-collection/pull/2421>`_
------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`BUGFIX: Respect settings for quality and format even if images are smaller that target dimensions <https://github.com/neos/neos-development-collection/pull/2422>`_
--------------------------------------------------------------------------------------------------------------------------------------------------------------------

Thumbnail images always returned the original source if allowUpscaling is false and the target size is smaller than the original image. This is unexpected when quality and format are defined.

This change makes sure the new assets are rendered when quality and format is defined.
The dimension calculation of the target images respects the allowUpscaling if the source is smaller that the target dimension.

* Resolves: `#2416 <https://github.com/neos/neos-development-collection/issues/2416>`_
* Packages: ``AssetList`` ``BaseMixins`` ``Browser`` ``ColumnLayouts`` ``ContentReferences`` ``ContentRepository`` ``Form`` ``Html`` ``Media`` ``Navigation`` ``Neos`` ``NodeTypes``

`BUGFIX: Lowercase Node Names upon creation <https://github.com/neos/neos-development-collection/pull/2419>`_
-------------------------------------------------------------------------------------------------------------

This adjusts the `NodeName` Value Object to always convert the given
value to lower case when created via the `fromString()` constructor.

Background:
Node names are considered to be case insensitive. Internally they are
stored lower case but the `NodeInterface::MATCH_PATTERN_NAME` does not
allow for camel case names.

* Fixes: `#2418 <https://github.com/neos/neos-development-collection/issues/2418>`_
* Packages: ``ContentRepository`` ``Media``

`TASK: New FlowQuery filter operation!instanceof <https://github.com/neos/neos-development-collection/pull/23>`_
----------------------------------------------------------------------------------------------------------------

Checks if the value is not an instance of the operand.

Example of usage:

  node = ${q(node).filter('[!instanceof Acme:Node]')}

NEOS-1321 #close

* Packages: ``Afx``

`TASK: New FlowQuery filter operation!instanceof <https://github.com/neos/neos-development-collection/pull/23>`_
----------------------------------------------------------------------------------------------------------------

Checks if the value is not an instance of the operand.

Example of usage:

  node = ${q(node).filter('[!instanceof Acme:Node]')}

NEOS-1321 #close

`FEATURE: Trigger signal when Thumbnail is persisted <https://github.com/neos/neos-development-collection/pull/2390>`_
----------------------------------------------------------------------------------------------------------------------

PR for issue #2387 

**What I did**
Added a signal `thumbnailPersisted` and an ORM lifecycle callback that triggers the signal once the thumbnail is persisted.

**How I did it**
Added two methods in Neos\\Media\\Domain\\Model\\Thumbnail: one for the signal and one for the lifecycle callback that triggers the signal.

* Packages: ``Media``

`BUGFIX: Allow translation of the textareaeditor placeholder <https://github.com/neos/neos-development-collection/pull/2404>`_
------------------------------------------------------------------------------------------------------------------------------

This additionally requires a fix in the ui which will be done in the neos-ui package.

**What I did**

Add the textarea editor for configuration enrichment.

**How to verify it**

When using i18n in the placeholder it should show the full translation path in the textarea editor instead of just i18n.

* Packages: ``Neos``

`BUGFIX: No redirect with status 201 <https://github.com/neos/neos-development-collection/pull/2415>`_
------------------------------------------------------------------------------------------------------

Sending a redirect code of 201 does not cause the browser to redirect
and leads to a blank page.

* Fixes: `#2414 <https://github.com/neos/neos-development-collection/issues/2414>`_
* Packages: ``Browser`` ``Neos``

`BUGFIX: node:repair now handles node->getProperties() as ArrayObject <https://github.com/neos/neos-development-collection/pull/2411>`_
---------------------------------------------------------------------------------------------------------------------------------------

**What I did**
I changed the code of the node:repair command to handle the result of node->getProperties() as ArrayObject and not as array, because that recently changed.

**How I did it**
Instead of getting the key via array_keys the properties are now iterated to find undefinded properties.

**How to verify it**
* run the node:repair-command on a content repository that is fine already => it should not complain about anything
* add a undefinded property to a node (by editing a record in the nodedata-table directly) and run node:repair => you should be asked if you want to remove the undefinded property

* Packages: ``ContentRepository``

`BUGFIX: Image previews should be rendered for asset proxies as well <https://github.com/neos/neos-development-collection/pull/2412>`_
--------------------------------------------------------------------------------------------------------------------------------------

The previous code must be a leftover from an upmerge and it results in
fatal errors when trying to open the details of an asset coming from a
proxy source.

* Packages: ``Browser`` ``Neos``

`TASK: Add PgSQL migration to support variant presets <https://github.com/neos/neos-development-collection/pull/2410>`_
-----------------------------------------------------------------------------------------------------------------------

* Packages: ``Media`` ``Neos``

`BUGFIX: Add missing Eel FileHelper registration <https://github.com/neos/neos-development-collection/pull/2407>`_
------------------------------------------------------------------------------------------------------------------

Register the file helper by default so that they can be used in Fusion, without the need of separate registration.

Solves Issue: #2405 

* Packages: ``Fusion`` ``Neos``

`FEATURE: Automatic image variants generation <https://github.com/neos/neos-development-collection/pull/2396>`_
---------------------------------------------------------------------------------------------------------------

This change adds a feature which allows to automatically generate variants of an original image based on the newly introduced image variant presets configuration.

In this first version, variants are automatically created as soon as an asset is created – for example, when it has been uploaded by an editor or otherwise been imported. Future versions may defer this
generation into a job queue, or provide a way to put conditions of the generation of these variants.

See the included documentation for configuration syntax and further background.

This change also includes a basic view displaying all variants of an asset in the edit view of the Media Browser. While this new view (implemented as a tab) may be useful already, it is neither especially
polished nor does it provide additional features. Therefore it is disabled by a feature switch for now. See the Settings.yaml of Neos.Media.Browser for details on enabling the tab.

* Packages: ``Media``

`FEATURE: Add fallback from \`itemRenderer\` to \`content\` for \`Neos.Fusion:Map\` and derived prototypes <https://github.com/neos/neos-development-collection/pull/2400>`_
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

This allows to declare the itemRenderers in `afx` without `@children` annotation and avoids a 
common error in afx code.

Affected prototypes:
-  `Neos.Fusion:Map`
-  `Neos.Fusion:RawCollection`
-  `Neos.Fusion:Loop`
-  `Neos.Fusion:Collection`

* Packages: ``Fusion`` ``Neos``

`TASK: Translate Site Management <https://github.com/neos/neos-development-collection/pull/2397>`_
--------------------------------------------------------------------------------------------------

The Site Management uses labels both from `Main.xlf` and `Modules.xlf`. For the labels from `Module.xlf`, the `source` attribute must be set. Apart from that, some labels didn't have a translation at all. This change makes the Site Management fully localizable.

* Fixes: `#2394 <https://github.com/neos/neos-development-collection/issues/2394>`_ 
* Packages: ``Neos``

`FEATURE: Add native 404 error rendering that can be controlled via Fusion <https://github.com/neos/neos-development-collection/pull/2374>`_
--------------------------------------------------------------------------------------------------------------------------------------------

This change adds the default fusion path `error` that is used to render status messages
for the status codes 403, 404 and 410.

The matcher receives the context values `exception`, `renderingOptions`, `statusCode`,
 `statusMessage` and `referenceCode` and will by default render the previous template.

By extending the `error` Case you can add custom 404 rendering like in the example below.

```
#
# Extend error matcher to render the document with uriPathSegment `notfound`
# for exceptions with 4xx status code
#
error {
	@context.notfoundDocument = ${q(site).children('[instanceof Neos.Neos:Document]').filter('[uriPathSegment="notfound"]').get(0)}

	4xx {
		@position = 'start'
		condition = ${statusCode >= 400 && statusCode < 500 && notfoundDocument}
		renderer = Neos.Fusion:Renderer {
			@context.node = ${notfoundDocument}
			renderPath = '/root'
		}
	}
}
```

* Resolves: `#2325 <https://github.com/neos/neos-development-collection/issues/2325>`_
* Packages: ``Neos``

`BUGFIX: Remove coupling of functional tests to \`Neos:Demo\` and \`Neos.NodeTypes\` <https://github.com/neos/neos-development-collection/pull/2401>`_
------------------------------------------------------------------------------------------------------------------------------------------------------

The previous tests tested nodetypes from those external packages which lead to testing errors because of changes to the master of Neos.Demo. This change uses nodetypes local to the testing context of the cr itself. 

This is cleaner and a preparation to move Neos.NodeTypes out of the development collection someday. Right now it allows to run the functional tests without Neos.Demo or Neos.NodeTyoes beeing installed.

* Packages: ``Neos``

`BUGFIX: Forward \`removedContentShown\` in Context->getNodeByIdentifier() <https://github.com/neos/neos-development-collection/pull/2293>`_
--------------------------------------------------------------------------------------------------------------------------------------------

fixes #2292 

* Packages: ``ContentRepository``

`BUGFIX: Testing Policy has a working expression <https://github.com/neos/neos-development-collection/pull/2391>`_
------------------------------------------------------------------------------------------------------------------

The policy expression was wrong and leads to initialize*Action functions being included in the AllControllerActions privilege. That is wrong and can lead to errors in tests. Compared to the (non testing) policy the new expression now works as expected.

* Packages: ``Neos``

`FEATURE: Move new NodeInterface and TraversableNodeInterface to core <https://github.com/neos/neos-development-collection/pull/2202>`_
---------------------------------------------------------------------------------------------------------------------------------------

## Ready for final review / Merging.

This Pull Request does three things:

1. Introduce the Event-Sourced `NodeInterface` and `TraversableNodeInterface` in the core
2. make the "old" `Node` implement `TraversableNodeInterface` as far as possible.
3. adjust FlowQuery operation code to work on the new `TraversableNodeInterface` whereever it makes sense.

This change is necessary to ensure a **smooth upgrade lateron to the Event Sourced CR**; so people working with `NodeInterface` in their custom code can already start using `TraversableNodeInterface` today.

*The change is rather big, but **not breaking*** (at least it should not be breaking ;) )

## ToDo List

- [x] move new NodeInterface and TraversableNodeInterface to CR
- [x] adjust TraversableNodeInterface to have proper method namings. Everything which queries something should be called find*; as opposed to get*.
- [x] make old Node implement TraversableNodeInterface
- [x] make compatible to PHP 7.1 (not sure if things need to be done; travis will tell us!)
- [x] **fix test cases**
- [x] go through all FlowQueryOperations in Neos and ensure they work with TraversableNodeInterface / new NodeInterface (partially done)
- [x] ensure the new NodeInterface and TraversableNodeInterface have proper API descriptions; and the old NodeInterface has proper deprecation messages set up

* Packages: ``Neos``

`FEATURE: Add \`\`format\`\` option for image-prototypes, viewHelpers and presets <https://github.com/neos/neos-development-collection/pull/2389>`_
---------------------------------------------------------------------------------------------------------------------------------------------------

The option ``format`` is added to imagePresets, viewHelpers and FusionPrototypes.
The format is passed as string "jpg", "jpeg", "gif", "png", "wbmp", "xbm", "webp" and "bmp" are supported. If no format is given the crops will use the format of the original image.

This allows to to enforce rendering of crops in jpeg or png but also adds support for rendering 
of webp-images as alternate sources.

Additionally this pr adds the ConvertImageThumbnailGenerator that allows to specify images that should be converted for online-presentation to an optimized target format. While the default imageFormat is specified in the settings this can still be overridden via `format` option on
the thumbnail-configurations.

The ConvertImageThumbnailGenerator is configured via settings:

```
Neos:
  Media:
    thumbnailGenerators:
      Neos\\Media\\Domain\\Model\\ThumbnailGenerator\\ConvertImageThumbnailGenerator:
        supportedExtensions:
          - tiff
        targetExtension: jpg
```


Resolves. #2320

* Packages: ``Media`` ``Neos``

`FEATURE: Add \`Neos.Neos:MenuItems\`, \`Neos.Neos:DimensionMenuItems\` and \`Neos.Neos:BreadcrumbMenuItems\` prototypes <https://github.com/neos/neos-development-collection/pull/2381>`_
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Three new fusion prototypes are added that extract the rendering of the ``items`` that are passed to the template from ``Neos.Neos:Menu``, ``Neos.Neos:BreadcrumbMenu`` and ``Neos.Neos:DimensionsMenu`` and make those items available for direct Fusion use without Template.

In addition the ``Neos.Neos:*Menu`` prototypes are now based on ``Neos.Neos:Template`` and do not have a custom implementation any more. 

*Attention: This change removes the old MenuImplementation classes. Those are not part of the api so this is still non-breaking since the ``*Menu``fusion prototypes still support all previous options by beeing based on ``Neos.Fusion:Template`` now instead of extending the TemplateImplementation class.*

### ``Neos.Neos:MenuItems``

Create a list of menu items for nodes. Each menuItem has the properties: ``node``, ``originalNode``, ``state``, ``label`` and ``menuLevel``.

- ``entryLevel`` (integer) Start the menu at the given depth
- ``maximumLevels`` (integer) Restrict the maximum depth of items in the menu (relative to ``entryLevel``)
- ``startingPoint`` (Node) The parent node of the first menu level (defaults to ``node`` context variable)
- ``lastLevel`` (integer) Restrict the menu depth by node depth (relative to site node)
- ``filter`` (string) Filter items by node type (e.g. ``'!My.Site:News,Neos.Neos:Document'``), defaults to ``'Neos.Neos:Document'``
- ``renderHiddenInIndex`` (boolean) Whether nodes with ``hiddenInIndex`` should be rendered, defaults to ``false``
- ``itemCollection`` (array) Explicitly set the Node items for the menu (alternative to ``startingPoints`` and levels)

### ``Neos.Neos:BreadcrumbMenuItems``

Create a list of of menu-items for a breadcrumb (ancestor documents), based on ``Neos.Neos:MenuItems``.

### ``Neos.Neos:DimensionsMenuItems``

Create a list of menu-items for other node variants (e.g. variants of the current node in other dimensions) by using this Fusion object.

If the ``dimension`` setting is given, the menu will only include items for this dimension, with all other configured dimension being set to the value(s) of the current node. Without any ``dimension`` being configured, all possible variants will be included.

If no node variant exists for the preset combination, a ``NULL`` node will be included in the item with a state ``absent``.

- ``dimension`` (optional, string): name of the dimension which this menu should be based on. Example: "language".
- ``presets`` (optional, array): If set, the presets rendered will be taken from this list of preset identifiers
- ``includeAllPresets`` (boolean, default **false**) If TRUE, include all presets, not only allowed combinations
- ``renderHiddenInIndex`` (boolean, default **true**) If TRUE, render nodes which are marked as "hidded-in-index"

* Packages: ``Neos``

`BUGFIX: Allow using font awesome brand icons in backend modules <https://github.com/neos/neos-development-collection/pull/2388>`_
----------------------------------------------------------------------------------------------------------------------------------

This was broken with 4.0 as fontawesome styling changed.

**What I did**

Inherit the font family for the icon pseudo element from the surrounding fa* class.

**How to verify it**

Use `fab fa-google` as icon for a backend module, f.e. Media Browser.
Instead of an empty square you should see the Google icon.

* Packages: ``Neos``

`FEATURE: Add NodeLink fusion prototype <https://github.com/neos/neos-development-collection/pull/2370>`_
---------------------------------------------------------------------------------------------------------

The ``Neos.Neos:NodeLink`` fusion prototype is added which renders an ``<a>`` tag based on ``Neos.Neos:NodeUri``, similar to ``Neos.Neos:ImageTag`` and ``Neos.Neos:ImageUri``. 

- all properties of ``Neos.Neos:NodeUri`` are supported and passed over
- ``attributes`` (:ref:`Neos_Fusion__Attributes`) Link tag attributes
- ``content`` (string) The label of the link, defaults to the node label ``q(node).property('_label')``.

This helps reducing code lines especially when using fusion-afx, with this prototype you can now directly link nodes in an afx renderer.

* Packages: ``Neos``

`BUGFIX: Improve performance in findOneByResourceSha1 <https://github.com/neos/neos-development-collection/pull/2383>`_
-----------------------------------------------------------------------------------------------------------------------

AssetRepository::findOneByResourceSha1 forced case innsensitivity on the
SHA1 hash of the resource, so the query builder uses MySQL "LOWER"
function in its generated query, and as such the index cannot be used
in the intended way. Now we are just relying on sha1 to create lower
cased hash values.

* Packages: ``Media``

`TASK: More adjustments to Behat code <https://github.com/neos/neos-development-collection/pull/2382>`_
-------------------------------------------------------------------------------------------------------

* Packages: ``BaseMixins`` ``Browser`` ``ContentRepository`` ``Neos``

`BUGFIX: Improve performance in assetCollection operations <https://github.com/neos/neos-development-collection/pull/2376>`_
----------------------------------------------------------------------------------------------------------------------------

This changes how it is checked if an asset is contained
in an asset collection in order to improve performance.

It changes the complexity of O(n) while n is the amount of assets in an asset collection to O(n) where n is the amount of collections of an asset with the assumption that an asset has far less collections than a collection has assets.

close #2375 

* Packages: ``BaseMixins`` ``Media`` ``Neos``

`!!!TASK: Upgrade to latest neos/behat version <https://github.com/neos/neos-development-collection/pull/2343>`_
----------------------------------------------------------------------------------------------------------------

Test distribution for travis:
https://travis-ci.com/johannessteu/neos-development-distribution/builds/97495679

* Packages: ``Neos``

`!!! TASK: Tweak CR Value Objects <https://github.com/neos/neos-development-collection/pull/2362>`_
---------------------------------------------------------------------------------------------------

for better type safety and interoperability

* Packages: ``ContentRepository``

`BUGFIX: Avoid server-error when invalid/deleted identifiers are passed to the node service <https://github.com/neos/neos-development-collection/pull/2365>`_
-------------------------------------------------------------------------------------------------------------------------------------------------------------

When invalid node-identifiers, are passed to the node-service it mapped the list of identifier to the getNodeByIdentifier call, which rightly returned null. This is triggered especially in the LinkEditor when nodes are referenced that have been deleted in the meantime.

Since the result was not filtered the list containing a mix of null-values and nodeInterfaces is passed to the template of the nodeService where an error is triggered inside the `neos:node.closestDocument` view helper. 

This error in turn triggers the ui showing a red error box with the html content of the server-error that confused editors and is not helpful at all. 

The fix applies array_filter to the nodes array to avoid passing `null` nodes to the template.

* Packages: ``Neos``

`BUGFIX: Render missing icons in old ui parts <https://github.com/neos/neos-development-collection/pull/2349>`_
---------------------------------------------------------------------------------------------------------------

This is a backport of `b742d9e997a03f9fe343f8fa1fd3e5d42c94a5f0 <https://github.com/neos/neos-development-collection/commit/b742d9e997a03f9fe343f8fa1fd3e5d42c94a5f0>`_ of #2311 and `4a62c8958496454991287ada1df8c692ffcc3d8f <https://github.com/neos/neos-development-collection/commit/4a62c8958496454991287ada1df8c692ffcc3d8f>`_ of #2261 which fixes (most?) missing icons in 4.1.

* Packages: ``Browser`` ``Neos``

`BUGFIX: Revert "BUGFIX: Asynchronous and presets for media browser thumbnails" <https://github.com/neos/neos-development-collection/pull/2364>`_
-------------------------------------------------------------------------------------------------------------------------------------------------

Reverts neos/neos-development-collection#2331

* Packages: ``Browser`` ``Fusion``

`BUGFIX: Handle maximum cache lifetime of 0 <https://github.com/neos/neos-development-collection/pull/2300>`_
-------------------------------------------------------------------------------------------------------------

If a cached prototype had a `maximumLifetime` of 0
configured, which is meant as infinite cache
lifetime, this value is propagated upwards to all
surrounding prototypes as it is the selected
as minimum value

* Packages: ``Fusion`` ``Neos``

`TASK: Adjust behavior of NodePropertyConverterServiceTest <https://github.com/neos/neos-development-collection/pull/2359>`_
----------------------------------------------------------------------------------------------------------------------------

This adjusts the complexTypesWithGivenTypeConverterAreConvertedByTypeConverter
of NodePropertyConverterServiceTest to behave as if the new UI is installed
which is insalled when test are run on CI and probably the case in all
other installations.

* Packages: ``ContentRepository`` ``Neos``

`TASK: Fix documentation example for toggling visibility of properties in inspector <https://github.com/neos/neos-development-collection/pull/2334>`_
-----------------------------------------------------------------------------------------------------------------------------------------------------

I updated the example for *"Hiding one property when the other one is not set"* in the *"Dynamic Client-side Configuration Processing"* docs (https://neos.readthedocs.io/en/stable/CreatingASite/NodeTypes/DynamicConfigurationProcessing.html). The example didn't work, as stated here (https://github.com/neos/neos-ui/pull/2118#issuecomment-441986052), but the "hidden" property has been introduced with https://github.com/neos/neos-ui/pull/2118.
* Packages: ``Browser`` ``Neos``

`BUGFIX: Add cache control header to xliffAsJsonAction <https://github.com/neos/neos-development-collection/pull/2357>`_
------------------------------------------------------------------------------------------------------------------------

This is needed to get rid of https://github.com/neos/neos-ui/blob/`2239fe5465a84971d6aa6a94ea2f7a058959bf59 <https://github.com/neos/neos-development-collection/commit/2239fe5465a84971d6aa6a94ea2f7a058959bf59>`_/Classes/Aspects/XliffConfigurationCacheHeaderAspect.php in the Neos UI

* Packages: ``Browser`` ``Neos``

`BUGFIX: change aside bar in media browser for many tags <https://github.com/neos/neos-development-collection/pull/2352>`_
--------------------------------------------------------------------------------------------------------------------------

It's unfortunate, that the interactive fields are below the gallery, if the editors use too many tags in the media browser. It results in the odd behavior that the search bar is at the bottom of the page and limits the usability:

!`aside-bar-at-bottom <https://user-images.githubusercontent.com/6552092/51618692-063b8a00-1f2f-11e9-8477-68e7da329749.png>`_



I understand that it quickly turns unsightly, if there are too many tags in the side bar, but I've noticed that if we use the button-style tags, rather than the tag list in the aside-bar, it works out quite nicely:

!`aside-bar-to-the-left <https://user-images.githubusercontent.com/6552092/51618693-063b8a00-1f2f-11e9-8f96-cac9f0b82e5e.png>`_

* Packages: ``Browser`` ``Neos``

`BUGFIX: Removed super types can be added again regardless of order <https://github.com/neos/neos-development-collection/pull/2272>`_
-------------------------------------------------------------------------------------------------------------------------------------

I noticed the order of `superTypes` being of importance in one special case: re-adding a super type removed by a super type.
There already was a test, but it didn't catch one case: the re-addition being positioned **before** the super type where it was removed. Run the same test with only the changes in `NodeTypeTest.php <https://github.com/neos/neos-development-collection/pull/2272/files#diff-960a57534a39e75dc45c37535d2ba971R108>`_ and you'll get a `failed test <https://travis-ci.org/ComiR/neos-development-collection/jobs/454551553>`_.

By making the Method `addInheritedSuperTypes()` `static` and slightly modifying it to not handing over the array, I could get rid of `buildInheritanceChain()` completely and renamed the method to `getFlattenedSuperTypes()`.
The `array_unique()` present before wasn't useful anyway because the array was already indexed by the node type names.

As a reminder: The visibility is determined by class and not by object. You can just call `$nodeType->declaredSuperTypes`, even if it is another object (of the same class of course)!

Since I started working on the `master` branch, there also is a version for that: https://github.com/ComiR/neos-development-collection/commit/`a8076ae958676e1309a4e33a51491d3204847239 <https://github.com/neos/neos-development-collection/commit/a8076ae958676e1309a4e33a51491d3204847239>`_.

* Packages: ``ContentRepository``

`Add Pull Reminders badge <https://github.com/neos/neos-development-collection/pull/2335>`_
-------------------------------------------------------------------------------------------

Hi everyone!

Over 500 open-source organizations (like yours) use `Pull Reminders <http://pullreminders.com>`_ for free. We've created this README badge so we can hopefully drive some traffic back to our website and continue sustainably providing free accounts to open-source orgazniations.  Let me know if you have any concerns about adding it. Here's `more information <https://pullreminders.com/badge>`_ about the badge program.

`FEATURE: Hide property "target" of Neos.Neos.ShortCut depending on targetMode <https://github.com/neos/neos-development-collection/pull/2303>`_
------------------------------------------------------------------------------------------------------------------------------------------------

*What I did/How I did it*
I added configuration to the shortcut nodetype definition to hide the target-property in the UI when targetMode is not "selectedTarget"

*How to verify it*
Insert a shortcut node. You should not see the target-property untill you change the targetMode to "selectedTarget"

* Packages: ``Neos``

`BUGFIX: Asynchronous and presets for media browser thumbnails <https://github.com/neos/neos-development-collection/pull/2331>`_
--------------------------------------------------------------------------------------------------------------------------------

Fixes the usage of the `asyncThumbnails` option in the media browser
along with using the thumbnail preset to improve performance of the
media browser and avoid additional thumbnails being generated.

* Fixes: `#2330 <https://github.com/neos/neos-development-collection/issues/2330>`_
* Packages: ``Browser``

`BUGFIX: Allow primary domains to be removed via CLI <https://github.com/neos/neos-development-collection/pull/2345>`_
----------------------------------------------------------------------------------------------------------------------

* Fixes: `#2344 <https://github.com/neos/neos-development-collection/issues/2344>`_
* Packages: ``Neos``

`BUGFIX: Deletion of backend users <https://github.com/neos/neos-development-collection/pull/2323>`_
----------------------------------------------------------------------------------------------------

**What I did**
Backend users can now be deleted, even if they have a private workspace.

**How I did it**
Wrap deletePersonalWorkspace() in withoutAuthorizationChecks.

**How to verify it**
Create a backend user, log in and edit something. Log in as administrator and delete this user.

* Fixes: `#926 <https://github.com/neos/neos-development-collection/issues/926>`_ 
@nezaniel

* Packages: ``Neos``

`BUGFIX: Copyrightnotice migration for postgres needs default value <https://github.com/neos/neos-development-collection/pull/2342>`_
-------------------------------------------------------------------------------------------------------------------------------------

* Resolves: `#2333 <https://github.com/neos/neos-development-collection/issues/2333>`_
* Packages: ``Media`` ``Neos``

`TASK: Add new nodeTagForIdentifier() method to CachingHelper <https://github.com/neos/neos-development-collection/pull/2340>`_
-------------------------------------------------------------------------------------------------------------------------------

* Resolves: `#2339 <https://github.com/neos/neos-development-collection/issues/2339>`_ 
* Packages: ``Browser`` ``Neos``

`TASK: Remove useless ternary operator use <https://github.com/neos/neos-development-collection/pull/2338>`_
------------------------------------------------------------------------------------------------------------

The issue described in #2337 is not as bad as it seems. In fact, the
ternary operation is useless *and* no longer needed. The filtering is
applied via `applyAssetCollectionFilterFromBrowserState()` already.

* Resolves: `#2337 <https://github.com/neos/neos-development-collection/issues/2337>`_
* Packages: ``Browser`` ``Neos``

`Add deprecation annotations to methods that will be removed <https://github.com/neos/neos-development-collection/pull/2332>`_
------------------------------------------------------------------------------------------------------------------------------

Adds `@deprecated` annotations to methods from `NodeInterface`
and `Node` that will be replaced/removed with the CR rewrite.

* Packages: ``ContentRepository`` ``Neos``

`TASK: Update 3rd party dependency constraints <https://github.com/neos/neos-development-collection/pull/2318>`_
----------------------------------------------------------------------------------------------------------------

This allows semantically non-breaking updates for a number of 3rd
party dependencies. It includes PR #2299 and is related to
neos/flow-development-collection#1481

It makes `ImportedAsset` a non-final class to allow Doctrine to create
a proxy for it.

* Packages: ``Media``

`WIP: TASK: Cleanup Node and TraversableNode interfaces <https://github.com/neos/neos-development-collection/pull/2288>`_
-------------------------------------------------------------------------------------------------------------------------

* Introduce `TraversableNodes` as replacement for `array<TraversableNodeInterface>`
* Replace nullable param and return types where possible
* Add missing (return) type annotations
* Packages: ``ContentRepository``

`BUGFIX: Fix example in the documentation  <https://github.com/neos/neos-development-collection/pull/2319>`_
------------------------------------------------------------------------------------------------------------

`Neos.Fusion:Loop` had a incorrect example using the old Fusion prototype name

* Packages: ``Browser`` ``Neos``

`BUGFIX: Don't create duplicate auto-created child nodes <https://github.com/neos/neos-development-collection/pull/2307>`_
--------------------------------------------------------------------------------------------------------------------------

This checks for existing auto-created child nodes before they
are created in `createVariantForContext($context)`.

* Fixes: `#782 <https://github.com/neos/neos-development-collection/issues/782>`_
* Packages: ``ContentRepository`` ``Neos``

`BUGFIX: Fix wrong Neos.Fusion:Map prototype name <https://github.com/neos/neos-development-collection/pull/2315>`_
-------------------------------------------------------------------------------------------------------------------

This changes the wrong prototype name from `Neos.Fusion:Maping` to `Neos.Fusion:Map`

* Fixes: `#2313 <https://github.com/neos/neos-development-collection/issues/2313>`_
* Packages: ``Fusion`` ``Neos``

`BUGFIX: Broken layout in media browser when using more than 25 tags <https://github.com/neos/neos-development-collection/pull/2312>`_
--------------------------------------------------------------------------------------------------------------------------------------

This change just updates the compiled css and the scss source was already correct.

* Packages: ``Browser``

`BUGFIX: Render icons in old ui parts <https://github.com/neos/neos-development-collection/pull/2311>`_
-------------------------------------------------------------------------------------------------------

The old ui and some dialogs still use the old fontawesome integration and broke due to the last fontawesome update as the mixins changed.

* Packages: ``Browser``

`BUGFIX: Continue in switch targets surrounding foreach <https://github.com/neos/neos-development-collection/pull/2309>`_
-------------------------------------------------------------------------------------------------------------------------

* Packages: ``ContentRepository``

`BUGFIX: Return complete Neos.Fusion:Debug / DebugDump <https://github.com/neos/neos-development-collection/pull/2253>`_
------------------------------------------------------------------------------------------------------------------------

* Solves: `#2176 <https://github.com/neos/neos-development-collection/issues/2176>`_ 
* Packages: ``Fusion`` ``Neos``

`TASK: Remove the feature list <https://github.com/neos/neos-development-collection/pull/2306>`_
------------------------------------------------------------------------------------------------

According to neos/documentation#8, feature list was removed. A redirect
on RTD has been added.

* Packages: ``Neos``

`TASK: Documentation tweaks <https://github.com/neos/neos-development-collection/pull/2305>`_
---------------------------------------------------------------------------------------------

This includes:

- TASK: Remove outdated toctree reverse setup
- TASK: Fix embedded rST markup in command controller
- TASK: Fix rST markup errors
- TASK: Remove user guide (is on neos.io now)

Resolves https://github.com/neos/documentation/issues/11

* Packages: ``Neos``

`BUGFIX: Use nodeType instead of documentNodeType in history translations <https://github.com/neos/neos-development-collection/pull/2297>`_
-------------------------------------------------------------------------------------------------------------------------------------------

In the history module, the translation uses the documents NodeType instead of the actually modified nodes NodeType.

Additionally,  the `linkedNode` and `user` templates get trimmed to prevent ugly spaces.

* Packages: ``Neos``

`BUGFIX: fix generation of i18n lables for the creationDialog <https://github.com/neos/neos-development-collection/pull/2164>`_
-------------------------------------------------------------------------------------------------------------------------------

This fixes support for I18n labels of `editorOptions` in the `creationDialog`.

* Packages: ``Browser`` ``Neos``

`TASK: Add a hint for the user to avoid errors with incomplete site imports <https://github.com/neos/neos-development-collection/pull/2290>`_
---------------------------------------------------------------------------------------------------------------------------------------------

This adds a little hint that avoids frequent errors with the site import command crashing due to a memory limit, and users being confused about a breaky-looking site.

* Packages: ``Neos``

`TASK: Add a helpful hint about the parameter expected for site:prune <https://github.com/neos/neos-development-collection/pull/2291>`_
---------------------------------------------------------------------------------------------------------------------------------------

With this, a tiny hint will show up if the site who should be pruned is not found.

* Packages: ``Neos``

`BUGFIX: media:removeunused only works with limit flag <https://github.com/neos/neos-development-collection/pull/2289>`_
------------------------------------------------------------------------------------------------------------------------

This change fixes a regression introduced in `1804dc8e6edf79045fb318edf3e78c6e17232658 <https://github.com/neos/neos-development-collection/commit/1804dc8e6edf79045fb318edf3e78c6e17232658>`_ where a new command line flag "--limit" was introduced. The command did not detect any unused assets unless the --limit flag was specified, because the iteration would stop right away.

* Packages: ``Media``

`TASK: Continue during create missing child nodes if none defined <https://github.com/neos/neos-development-collection/pull/2286>`_
-----------------------------------------------------------------------------------------------------------------------------------

In `createChildNodesByNodeType` there is no need to iterate nodes of
types that have no child nodes defined in their type.

* Packages: ``Browser`` ``ContentRepository``

`BUGFIX: Fix parameters of internal method call <https://github.com/neos/neos-development-collection/pull/2285>`_
-----------------------------------------------------------------------------------------------------------------

The method `repairShadowNodes` calls `fixShadowNodesInWorkspace`
in turn. The call passes the `$nodeType` parameter in place of the
`$dryRun`.

This changes fixes that and corrects the return type annotation of
`fixShadowNodesInWorkspace` as well.

* Packages: ``Browser`` ``ContentRepository`` ``Neos``

`FEATURE: Health status and proper exit code for node:repair <https://github.com/neos/neos-development-collection/pull/2278>`_
------------------------------------------------------------------------------------------------------------------------------

This is a backward compatible rework of the `node:repair` command.

This introduces a new `EventDispatchingNodeCommandControllerPluginInterface`
that can be implemented by NodeCommandControllerPlugins in order to
dispatch repair events instead of having to interact with the console
output directly.

The two provided core plugins now implement this interface and dispatch
corresponding events.

Background:  
This rework allows the Command Controller to control the execution of tasks
and the rendering of their output which allows for a more streamlined
console output and serves as a basis for further improvements (e.g. verbosity
flag).
This also fixes the exit code of the command, that is now 1 if one of them
commands triggered an error.

* Resolves: `#1988 <https://github.com/neos/neos-development-collection/issues/1988>`_
* Packages: ``ContentRepository`` ``Neos``

`TASK: Change login wallpaper for V 4.2 <https://github.com/neos/neos-development-collection/pull/2280>`_
---------------------------------------------------------------------------------------------------------

Photographer: Daniel Bischoff

* Packages: ``Neos``

`TASK: Extract the methods \`\`render\`\`, \`\`prepare\`\` and \`\`getProps\`\` from the \`\`evaluate\`\` method of the fusion ComponentImplementation <https://github.com/neos/neos-development-collection/pull/2277>`_
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

This allows external packages to override those methods with aspects which, in turn, allows to implement things like CSS modules and propTypes. The behavior of the fusion-component is not modified.

* Packages: ``Fusion`` ``Neos``

`[TASK] Fix missing space and capitalization <https://github.com/neos/neos-development-collection/pull/13>`_
------------------------------------------------------------------------------------------------------------

* Packages: ``Afx``

`[TASK] Fix missing space and capitalization <https://github.com/neos/neos-development-collection/pull/13>`_
------------------------------------------------------------------------------------------------------------

`Replace a few occurrences of TYPO3 with Neos <https://github.com/neos/neos-development-collection/pull/2273>`_
---------------------------------------------------------------------------------------------------------------

This change replaces a few occurrences of "TYPO3" with "Neos",
mostly affecting code examples and documentation.

* Packages: ``Media`` ``Neos``

`TASK: Update FontAwesome Library from 5.2.0 to 5.5.0 <https://github.com/neos/neos-development-collection/pull/2261>`_
-----------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`BUGFIX: Revert supertype behaviour change <https://github.com/neos/neos-development-collection/pull/2265>`_
------------------------------------------------------------------------------------------------------------

This reverts #2217, since it is potentially breaking.

In #2147 this was fixed for master, and for lower branches it was once fixed in #2139 but reverted through #2145.

* Packages: ``ContentRepository`` ``Neos``

`TASK: Remove usage of deprecated Flow Logger and use PSR logger <https://github.com/neos/neos-development-collection/pull/2259>`_
----------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Fusion`` ``Neos``

`BUGFIX: Remove duplicated packageManager in WorkspacesController <https://github.com/neos/neos-development-collection/pull/2268>`_
-----------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Browser`` ``ContentRepository`` ``Neos``

`TASK: Catch error XMLReader when opening XML in site:import <https://github.com/neos/neos-development-collection/pull/2267>`_
------------------------------------------------------------------------------------------------------------------------------

This adds handling of XMLReaders open() returning false
during site import.

* Fixes: `#2199 <https://github.com/neos/neos-development-collection/issues/2199>`_
* Packages: ``Neos``

`TASK: Apply fixes from StyleCI <https://github.com/neos/neos-development-collection/pull/2266>`_
-------------------------------------------------------------------------------------------------

This pull request applies code style fixes from an analysis carried out by `StyleCI <https://github.styleci.io>`_.

* Packages: ``Browser`` ``ContentRepository`` ``Neos``

`BUGFIX: Do not cache non-existing accounts <https://github.com/neos/neos-development-collection/pull/2247>`_
-------------------------------------------------------------------------------------------------------------

When creating a new user and retrieving it within the same request from the user service will result in `null` even though, the user has been created successfully. This happens because of an error in the internal runtime cache. 

This regression was introduced in:
https://github.com/neos/neos-development-collection/commit/`dce483f9b0d17e3478777270eadebebbaca0d2dd <https://github.com/neos/neos-development-collection/commit/dce483f9b0d17e3478777270eadebebbaca0d2dd>`_

Since this is broken in the most recent bugfix release, I would like to propose to merge this into 2.3. (which is otherwise only open for security fixes).

`[TASK] Adapt Neos composer.json to new installer script <https://github.com/neos/neos-development-collection/pull/18>`_
------------------------------------------------------------------------------------------------------------------------

Adapts the Neos composer.json to the new configuration for
installer resources that works with joined repositories.
The old configuration (which won't be used anymore) is
kept for backwards compatibility reasons but should be removed
soon.

* Packages: ``Afx``

`[TASK] Adapt Neos composer.json to new installer script <https://github.com/neos/neos-development-collection/pull/18>`_
------------------------------------------------------------------------------------------------------------------------

Adapts the Neos composer.json to the new configuration for
installer resources that works with joined repositories.
The old configuration (which won't be used anymore) is
kept for backwards compatibility reasons but should be removed
soon.

`BUGFIX: Allow pinnedDimension argument on itemLabel to be null <https://github.com/neos/neos-development-collection/pull/2262>`_
---------------------------------------------------------------------------------------------------------------------------------

This fixes a regression not caught by https://github.com/neos/neos-development-collection/pull/2092

* Packages: ``Neos``

`BUGFIX: Return copyright in imageVariant <https://github.com/neos/neos-development-collection/pull/2260>`_
-----------------------------------------------------------------------------------------------------------

* Packages: ``Media`` ``Neos``

`BUGFIX: Limit image view in media browser to image  <https://github.com/neos/neos-development-collection/pull/2257>`_
----------------------------------------------------------------------------------------------------------------------

The image list view in the media browser list only image assets and
disable the rendering of the filter in the UI. So the asset type can
not changed in the image view.

* Fixes: `#2255 <https://github.com/neos/neos-development-collection/issues/2255>`_ 
* Packages: ``Browser`` ``Neos``

`BUGFIX: Set min-height to make errors visible <https://github.com/neos/neos-development-collection/pull/2254>`_
----------------------------------------------------------------------------------------------------------------

Solves Issue #2237 

* Packages: ``Neos``

`TASK: Adjust XSD domain to neos.io <https://github.com/neos/neos-development-collection/pull/1860>`_
-----------------------------------------------------------------------------------------------------

Set the correct XSD domain in the documentation.

* Resolves: `#1859 <https://github.com/neos/neos-development-collection/issues/1859>`_
* Packages: ``Media`` ``Neos``

`TASK: Replace legacy logger with psrLogger in media <https://github.com/neos/neos-development-collection/pull/2239>`_
----------------------------------------------------------------------------------------------------------------------

* Packages: ``Media``

`TASK: Redirect through Neos.Ui package if it is installed <https://github.com/neos/neos-development-collection/pull/2251>`_
----------------------------------------------------------------------------------------------------------------------------

The link to open a document node in edit view is not working with the React UI. This
change fixes that.

resolves #2081

* Packages: ``Neos``

`TASK: Refactor instances of logger to psrLogger <https://github.com/neos/neos-development-collection/pull/2244>`_
------------------------------------------------------------------------------------------------------------------

Refactor usages of the deprecated systemLogger to
the PSR system logger.
Fix some code style issues along the way.

* Packages: ``Neos``

`TASK: Redirect through Neos.Ui package if it is installed <https://github.com/neos/neos-development-collection/pull/2245>`_
----------------------------------------------------------------------------------------------------------------------------

The link to open a document node in edit view is not working with the React UI. This
change fixes that.

resolves #2081

* Packages: ``Neos``

`FEATURE: Add Fusion prototypes \`Join\`, \`Loop\`, \`Map\`, \`Reduce\` and \`DataStructure\` <https://github.com/neos/neos-development-collection/pull/2189>`_
---------------------------------------------------------------------------------------------------------------------------------------------------------------

The difference between ``RawArray``, ``Array``, ``RawCollection`` and ``Collection`` was often hard to get for new developers. To overcome this, the old confusing names are deprecated, and new prototypes are introduced which are easier to understand and emphasize the declarative nature of Fusion.

``Neos.Fusion:Join``

The prototype concatenates the fusion values of all fusion-properties and returns the result as a string. This prototype replaces ``Neos.Fusion:Array`` which is deprecated.

In addition to the behavior of the ``Array`` ``Join`` allows to define the ``@glue`` used for concatenating the parts.

``Neos.Fusion:Loop``

The ``Loop`` prototype iterates over the given items with the itemRenderer and returns the concatenated result as a string. The prototype replaces ``Neos.Fusion:Collection`` which is deprecated.

Other than in ``Collection`` the items are passed with the key ``items`` instead of ``collection``.

In addition to the behavior of the classic ``Collection`` ``Loop ``  allows defining the ``@glue`` used for concatenating the items. 

``Neos.Fusion:DataStructure``

The ``DataStructure`` prototype returns an associative array with all fusion keys evaluated. The prototype replaces ``Neos.Fusion:RawArray`` which is deprecated.

``Neos.Fusion:Map``

The ``Map`` iterates over the given ``items`` and returns the result as an array.  The prototype replaces ``Neos.Fusion:RawCollection`` which is deprecated.

Other than ``RawCollection`` the items are passed with the key ``items`` instead of ``collection`` and the keys of the given ``items`` are preserved.

``Neos.Fusion:Reduce``

The `Neos.Fusion:Reduce` prototype is added which reduces the given items to a single value by using ``itemRenderer`` with the following properties.

- `items` (array/Iterable, **required**) The array or iterable to iterate over
- `itemName`: (string, defaults to `item`) Context variable name for each item
- `itemKey`: (string, defaults to `itemKey`) Context variable name for each item key, when working with an array
- `carryName`: (string, defaults to `carry`) Context variable that contains the result of the last iteration
- `iterationName`: (string, defaults to `iterator`) A context variable with iteration information will be available under the given name: ``index`` (zero-based), ``cycle`` (1-based), ``isFirst``, ``isLast``
- `itemReducer`: (mixed, **required**) The reducer definition (simple value, expression or object) that will be applied for every item.
- `initialValue`: (mixed, defaults to `null`) The value that is passed to the first iteration or returned if the items are empty

* Packages: ``Fusion`` ``Neos``

`TASK: Apply fixes from StyleCI <https://github.com/neos/neos-development-collection/pull/2249>`_
-------------------------------------------------------------------------------------------------

This pull request applies code style fixes from an analysis carried out by `StyleCI <https://github.styleci.io>`_.

* Packages: ``Browser`` ``Neos``

`Apply fixes from StyleCI <https://github.com/neos/neos-development-collection/pull/2248>`_
-------------------------------------------------------------------------------------------

This pull request applies code style fixes from an analysis carried out by `StyleCI <https://github.styleci.io>`_.

* Packages: ``Browser`` ``Neos``

`FEATURE: Allow deletion of users from edit view <https://github.com/neos/neos-development-collection/pull/2228>`_
------------------------------------------------------------------------------------------------------------------

The user list already allows deleting users, and so does the detail
view (show action). With this change, admins can delete users also
from the *edit* form.
* Packages: ``ContentRepository`` ``Neos``

`FEATURE: Extend the asset model by a copyright notice <https://github.com/neos/neos-development-collection/pull/2240>`_
------------------------------------------------------------------------------------------------------------------------

This extends the asset model by a `copyrightNotice` field.
This field is automatically populated from the `copyrightNotice` IPTC
property when an asset is imported from an asset source.

* Resolves: `#2064 <https://github.com/neos/neos-development-collection/issues/2064>`_ 
* Packages: ``Browser`` ``Neos``

`FEATURE: Asset Sources support for Asset Editor <https://github.com/neos/neos-development-collection/pull/2200>`_
------------------------------------------------------------------------------------------------------------------

This change introduces the necessary backend code for enabling the Asset Editor (in the user interface's inspector panel) to use asset sources. A user can now search for assets which are stored in asset sources and import them on the fly.

* Resolves: `#2198 <https://github.com/neos/neos-development-collection/issues/2198>`_ 
* Packages: ``Browser`` ``Media`` ``Neos``

`FEATURE: Add \`\`@apply\`\` meta-keyword to the Fusion-language <https://github.com/neos/neos-development-collection/pull/2192>`_
----------------------------------------------------------------------------------------------------------------------------------

``@apply`` allows overriding multiple properties of a fusion-prototype with a single expression. This is useful when complex data structures are mapped to fusion prototypes.

The example shows the rendering of a ``teaserList``-array by using a Teaser-Component and passing all keys from each teaser to the fusion Object.

```
teasers = Neos.Fusion:Collection {
	collection = ${teaserList}
	itemName = 'teaser'
	itemRenderer = Vendor.Site:Teaser {
		@apply.teasers = ${teaser}
	}
}
```

The code avoids passing down each fusion-property explicitly to the child component. A similar concept with a different syntax from the JavaScript world is known as ES6-Spreads.

Another use-case is to use ``Neos.Fusion:Renderer`` to render a prototype while type and properties are based on data from the context.

```
example = Neos.Fusion:Renderer {
	type = ${data.type}
	element.@apply.properties = ${data.properties}
}
```

That way some meta-programming can use in fusion and both prototype and properties are decided late in the rendering by the fusion runtime.

The keys below ``@apply`` are evaluated before the fusion-object and the ``@context`` and are initialized. Each key below ``@apply`` must return a key-value map (values other than an array it is ignored). During the evaluation of each fusion-path, the values from ``@apply`` are always checked first.

If a property is defined via ``@apply`` this value is returned without evaluating the `fusionPath`.

The ``@process`` and ``@if``-rules of the original fusion-key are still applied even if a value from ``@apply`` is returned.

Since ``@apply`` is evaluated first the overwritten values are already present during the evaluation of ``@context`` and will overlay the properties of ``this`` if they are accessed.

``@apply`` supports the same extended syntax and ordering as fusion processors and supports multiple keys. The evaluation order is defined via ``@position``, the keys that are evaluated last will override previously defined keys. This is also similar to the rules for ``@process``.

```
test = Vendor.Site:Prototype {
	@apply.contextValue {
		@position = 'start'
		expression = ${ arrayValueFromContext }
	}
	@apply.fusionObject {
		@position = 'end'
		expression = Neos.Fusion:RawArray {
			value = "altered value"
		}
	}
}
```

Other than ``@context`` ``@apply`` is only valid for a single fusion path, so when subpaths or children are rendered they are not affected by the parents ``@apply`` unless they are explicitly passed down.

* Packages: ``Browser`` ``Fusion`` ``Neos``

`[TASK] Security warning about public Neos demo site <https://github.com/neos/neos-development-collection/pull/12>`_
--------------------------------------------------------------------------------------------------------------------

* Packages: ``Afx``

`[TASK] Security warning about public Neos demo site <https://github.com/neos/neos-development-collection/pull/12>`_
--------------------------------------------------------------------------------------------------------------------

`BUGFIX: NodeType->isOfType() respects explicitly removed supertypes <https://github.com/neos/neos-development-collection/pull/2217>`_
--------------------------------------------------------------------------------------------------------------------------------------

`NodeType->isOfType()` returned `true` if a node type inherited another node types inherited node type which was declared as `false` in the NodeTypes `superTypes`.

Check existence of node type in inheritance chain instead of recursing through super types.

* Packages: ``AssetList`` ``BaseMixins`` ``Browser`` ``ColumnLayouts`` ``ContentReferences`` ``ContentRepository`` ``Form`` ``Html`` ``Navigation`` ``Neos`` ``NodeTypes``

`BUGFIX: Fix SCSS import for Fontawesome files <https://github.com/neos/neos-development-collection/pull/2196>`_
----------------------------------------------------------------------------------------------------------------

This fixes an issue in Neos.scss which referred to wrong filenames
for importing Fontawesome styles.

* Packages: ``Browser`` ``Neos``

`BUGFIX: Fix SCSS import for Fontawesome files <https://github.com/neos/neos-development-collection/pull/2195>`_
----------------------------------------------------------------------------------------------------------------

This fixes an issue in Neos.scss which referred to wrong filenames
for importing Fontawesome styles.

* Packages: ``Browser`` ``Neos``

`BUGFIX: FileTypeIconViewHelper should work with new $asset argument <https://github.com/neos/neos-development-collection/pull/2191>`_
--------------------------------------------------------------------------------------------------------------------------------------

If the newly added `$asset` argument is used, it's ignored and overridden to the deprecated `$file` argument.

* Resolves: `#2186 <https://github.com/neos/neos-development-collection/issues/2186>`_
* Packages: ``AssetList`` ``BaseMixins`` ``Browser`` ``ColumnLayouts`` ``ContentReferences`` ``Form`` ``Html`` ``Media`` ``Navigation`` ``Neos`` ``NodeTypes``

`BUGFIX: Fix typo in cache documentation <https://github.com/neos/neos-development-collection/pull/2194>`_
----------------------------------------------------------------------------------------------------------

**What I did**
Fixed a small typo in the caching documentation.

**How I did it**

**How to verify it**

* Packages: ``AssetList`` ``BaseMixins`` ``Browser`` ``ColumnLayouts`` ``ContentReferences`` ``Form`` ``Html`` ``Navigation`` ``Neos`` ``NodeTypes``

`TASK: Moved editor documentation to neos.io <https://github.com/neos/neos-development-collection/pull/2112>`_
--------------------------------------------------------------------------------------------------------------

See also https://discuss.neos.io/t/refactoring-the-neos-user-guide/3256

* Packages: ``Browser`` ``Neos``

`BUGFIX: Fix condensed layout in Media Browser <https://github.com/neos/neos-development-collection/pull/2181>`_
----------------------------------------------------------------------------------------------------------------

**What I did**
Fixed the condensed layout of the media browser added when having more than 25 tags.

Regression of #1745

**How to verify it**
Have more than 25 tags or add the class `neos-media-aside-condensed` to the div with the class `neos-media-content`.

* Packages: ``Browser``

`BUGFIX: Avoid fatal error when asset not available <https://github.com/neos/neos-development-collection/pull/2177>`_
---------------------------------------------------------------------------------------------------------------------

This fixes what is basically a merge error. It lead to a method call
on an unset variable.

* Packages: ``Browser``

`BUGFIX: Use the possible new node name to check it's existance in the move to location <https://github.com/neos/neos-development-collection/pull/2161>`_
---------------------------------------------------------------------------------------------------------------------------------------------------------

The NodeExistsException was thrown even if the new nodeName does not exist in the new location, because only the old nodeName was checked.

Affected Versions: 3.3+ (I did not check the previous versions because it's not security critical)

* Packages: ``Browser`` ``ContentRepository`` ``Neos``

`BUGFIX: Add missing Layout to access mediabrowser from inspector <https://github.com/neos/neos-development-collection/pull/2171>`_
-----------------------------------------------------------------------------------------------------------------------------------

This fix a regressing introduced by https://github.com/neos/neos-development-collection/pull/1745

* Fixes: `#2170 <https://github.com/neos/neos-development-collection/issues/2170>`_
* Packages: ``Browser`` ``Neos``

`TASK: Update FontAwesome to version 5.2.0 <https://github.com/neos/neos-development-collection/pull/2160>`_
------------------------------------------------------------------------------------------------------------

Updated the font awesome assets to the latest version.

* Resolves: `#2159 <https://github.com/neos/neos-development-collection/issues/2159>`_
* Packages: ``Neos``

`BUGFIX: Remove accidental space in code migration <https://github.com/neos/neos-development-collection/pull/2158>`_
--------------------------------------------------------------------------------------------------------------------

Otherwise prototypes won't get migrated.

* Packages: ``Fusion``

`TASK: Minor fixes in command documentation <https://github.com/neos/neos-development-collection/pull/2155>`_
-------------------------------------------------------------------------------------------------------------

Fixes wrong order in documentation and adds missing task name

* Packages: ``Browser`` ``Neos``

`BUGFIX: Add null checks to Asset::getAssetProxy() <https://github.com/neos/neos-development-collection/pull/2154>`_
--------------------------------------------------------------------------------------------------------------------

* Fixes: `#2153 <https://github.com/neos/neos-development-collection/issues/2153>`_
* Packages: ``Media`` ``Neos``

`BUGFIX: Fix NodeTypes.schema.yaml broken by merge <https://github.com/neos/neos-development-collection/pull/2151>`_
--------------------------------------------------------------------------------------------------------------------

Fixes a merge regression introduced with `0481f5980fa64810178827b9d02a68b88caaf552 <https://github.com/neos/neos-development-collection/commit/0481f5980fa64810178827b9d02a68b88caaf552>`_

* Packages: ``Browser`` ``Media`` ``Neos``

`BUGFIX: Unable to replace asset from the media browser <https://github.com/neos/neos-development-collection/pull/2142>`_
-------------------------------------------------------------------------------------------------------------------------

This change add a missing use statement for `Neos\\RedirectHandler\\Storage\\RedirectStorageInterface` in `AssetService`. With this statement the replacement of an asset from the medialib browser is not possible.

This bug affect user with the RedirectHandler package, without this package the replacement works fine.

* Packages: ``Media`` ``Neos``

`BUGFIX: Fix DocTools settings <https://github.com/neos/neos-development-collection/pull/2148>`_
------------------------------------------------------------------------------------------------

The settings were defined in the wrong namespace and still used `TYPO3` in
some places.

* Packages: ``Media``

`Revert "BUGFIX: Respect disabled superTypes when filtering by Node Type" <https://github.com/neos/neos-development-collection/pull/2145>`_
-------------------------------------------------------------------------------------------------------------------------------------------

Reverts neos/neos-development-collection#2139 which fixes invalid
behavior but introduced a breaking change.

I will add another PR against the `master` branch to have this in the
next minor release though.

* Packages: ``ContentRepository`` ``Neos``

`FEATURE: Friendlier error pages for setup / missing homepage <https://github.com/neos/neos-development-collection/pull/2136>`_
-------------------------------------------------------------------------------------------------------------------------------

**What I did**
Changed the error template for "database error" and "missing homepage" to a friendly welcome message, since most users are irritated by the big fat "database error" we greet them with currently.

Old:
!`image <https://user-images.githubusercontent.com/10347669/43719553-4f510a70-998e-11e8-8016-3013a109a2e5.png>`_
!`image <https://user-images.githubusercontent.com/10347669/43719580-5ddb703a-998e-11e8-8812-2cacdf558728.png>`_

New:
!`image <https://user-images.githubusercontent.com/10347669/43719599-6f93af0e-998e-11e8-95f6-fe53c9c27139.png>`_
!`image <https://user-images.githubusercontent.com/10347669/43719624-7abda240-998e-11e8-8309-53003a107390.png>`_

* Packages: ``BaseMixins`` ``Neos``

`BUGFIX: Respect disabled superTypes when filtering by Node Type <https://github.com/neos/neos-development-collection/pull/2139>`_
----------------------------------------------------------------------------------------------------------------------------------

This fixes `NodeType::isOfType()` to return `false` when the given
type is explicitly disabled by the corresponding NodeType or one of
it's super types.

Example:

    'Acme:Animal':
      superTypes:
        'Acme:HasBonesMixin': true

    'Acme:Jellyfish':
      superTypes:
        'Acme:Animal': true
        'Acme:HasBonesMixin': false

With this `NodeTypeManager::getNodeType('Acme.Jellyfish')->isOfType('Acme:HasBonesMixin')`
should return `false` but it didn't.
Respectively a FlowQuery like the following should not return any "Jellyfish"-node (or
nodes with a sub-type): `q(node).find('[instanceof Acme:HasBonesMixin]')` but it did.

* Fixes: `#1983 <https://github.com/neos/neos-development-collection/issues/1983>`_
* Packages: ``ContentRepository``

`BUGFIX: Workspace preview only creates thumbnails for images <https://github.com/neos/neos-development-collection/pull/2138>`_
-------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Fusion`` ``Neos``

`BUGFIX: Fix caching of sub node types in NodeTypeManager <https://github.com/neos/neos-development-collection/pull/2127>`_
---------------------------------------------------------------------------------------------------------------------------

The method `NodeTypeManager->getSubNodeTypes(...)` cached results
regardless of the `$includeAbstractNodeTypes` flag. This causes issues
where the first invocation caches results including / not including abstract
node types for further invocations with different flag values.

* Fixes: `#2126 <https://github.com/neos/neos-development-collection/issues/2126>`_ 
* Packages: ``ContentRepository`` ``Neos``

`BUGFIX: Add missing support for inline.editorOptions.placeholder i18n <https://github.com/neos/neos-development-collection/pull/2125>`_
----------------------------------------------------------------------------------------------------------------------------------------

This adds the possibility to use i18n translation text at inline properties generated with the new inline.editorOptions property.

This is a follow on of #2120

`FEATURE: Add progress and time to workspace:publish command <https://github.com/neos/neos-development-collection/pull/2111>`_
------------------------------------------------------------------------------------------------------------------------------

**What I did**
Added a timestamp and progress indicator to the publish command of the WorkspaceCommandController
**How I did it**

**How to verify it**
./flow workspace:publish --workspace foo --verbose
* Packages: ``BaseMixins`` ``Browser`` ``Neos`` ``NodeTypes``

`BUGFIX: Fix readonly asset source action buttons <https://github.com/neos/neos-development-collection/pull/2119>`_
-------------------------------------------------------------------------------------------------------------------

This fixes an issue with the action buttons shown in the list view
of the media browser. The buttons were not referenced correctly to
the respective line if the asset source was a read-only source, which
resulted in only one "view" button being shown for the whole list of
assets.

* Packages: ``BaseMixins`` ``Browser`` ``Neos`` ``NodeTypes``

`TASK: Corrected description of the slice operation <https://github.com/neos/neos-development-collection/pull/2117>`_
---------------------------------------------------------------------------------------------------------------------

Resolves issue #1322

Corresponds to PR #2113, but for Neos 2.3

`TASK: Un-remove removed auto created child nodes in node repair <https://github.com/neos/neos-development-collection/pull/1995>`_
----------------------------------------------------------------------------------------------------------------------------------

When running the `createMissingChildNodes` in the `node:repair` command, check if a child node exists but has been removed, and if so un-remove it.

`BUGFIX: Fix docs formatting typo <https://github.com/neos/neos-development-collection/pull/2114>`_
---------------------------------------------------------------------------------------------------

* Packages: ``Browser`` ``Neos``

`FEATURE: CacheEntries should respect the workspace they rely on <https://github.com/neos/neos-development-collection/pull/2097>`_
----------------------------------------------------------------------------------------------------------------------------------

* Resolves: `#2096 <https://github.com/neos/neos-development-collection/issues/2096>`_

- [X] CacheHelper should prefix the Workspace correct
- [X] Use the CachingHelper instead of Hardcoded Tags 
- [x] ContentCacheFlusher should generate correct Tags to flush
- [x] Update Documentation
- [x] Check if some code migrations are possible

* Packages: ``Neos``

`TASK: Support --node-type for orphanRemoval in node:repair <https://github.com/neos/neos-development-collection/pull/2053>`_
-----------------------------------------------------------------------------------------------------------------------------

The oprhanRemoval in `node:repair` ignored the `--node-type` flag, leading
to confusion. This adds the needed code to use a given node type flag.

* Packages: ``Browser`` ``ContentRepository`` ``Neos``

`TASK: Refactor AssetController in the Media Browser <https://github.com/neos/neos-development-collection/pull/2110>`_
----------------------------------------------------------------------------------------------------------------------

This change is first iteration to refactor the AssetController and make it slimer and easier to work with. The current AssetController as a lots of responsability. This first step extract the relatedNodes action to a specific controller. We need to forward the request from the AssetController, because of how we use the routing in backend module

* Packages: ``Browser`` ``Neos``

`TASK: Change all uppercase TRUE and FALSE to lowercase in YAML <https://github.com/neos/neos-development-collection/pull/2098>`_
---------------------------------------------------------------------------------------------------------------------------------

This was a thing at some time I remember and I've found many leftover uppercase true and false.

* Packages: ``ContentRepository`` ``Fusion`` ``Neos``

`TASK: Change all uppercase TRUE and FALSE to lowercase in PHP <https://github.com/neos/neos-development-collection/pull/2099>`_
--------------------------------------------------------------------------------------------------------------------------------

This was a thing at some time I remember and I've found many leftover uppercase true and false.

related to #2098 

* Packages: ``ContentRepository``

`TASK: Change all uppercase TRUE and FALSE to lowercase in fusion <https://github.com/neos/neos-development-collection/pull/2100>`_
-----------------------------------------------------------------------------------------------------------------------------------

This was a thing at some time I remember and I've found many leftover uppercase true and false.

related to #2098

* Packages: ``Fusion`` ``Neos``

`TASK: Adapt adjusted NodeTypes from UI-package <https://github.com/neos/neos-development-collection/pull/2105>`_
-----------------------------------------------------------------------------------------------------------------

As the UI package adjusted some NodeTypes and the old UI
is deprecated since 4.0 we can put this into the original
NodeType configuration

related: https://github.com/neos/neos-ui/pull/1925

* Packages: ``Neos``

`TASK: Remove lastModified as it is not used anywhere <https://github.com/neos/neos-development-collection/pull/2106>`_
-----------------------------------------------------------------------------------------------------------------------

As @kitsunet figured out this property should be removed completely as it is not used in any way.

* Packages: ``Media``

`TASK: Enhance Code quality <https://github.com/neos/neos-development-collection/pull/2102>`_
---------------------------------------------------------------------------------------------

I enhanced code quality with stuff I noticed and grouped them by commit, should be pretty clear (:

* Packages: ``Media`` ``Neos``

`TASK: Remove unneeded ternerary operation <https://github.com/neos/neos-development-collection/pull/2101>`_
------------------------------------------------------------------------------------------------------------

I've found this while going through the code ...
I think there is no reason for this operation

* Packages: ``ContentRepository``

`DOCS: Add accept option to Asset- and Image-Editor  <https://github.com/neos/neos-development-collection/pull/2093>`_
----------------------------------------------------------------------------------------------------------------------

Documenting the new `accept`-option.

See: https://github.com/neos/neos-ui/pull/1900

* Packages: ``Neos``

`BUGFIX: Fix regression in dimension menu introduced by #1159 <https://github.com/neos/neos-development-collection/pull/2092>`_
-------------------------------------------------------------------------------------------------------------------------------

This fixes a regression in dimension menu (introduced by #1159) by 
adding `null` as default arguments back in.

* Packages: ``Neos``

`TASK: Fix sorting icon <https://github.com/neos/neos-development-collection/pull/2040>`_
-----------------------------------------------------------------------------------------

null

* Packages: ``Browser``

`BUGFIX: Adjust NodeTypes.schema.yaml in Neos.Neos <https://github.com/neos/neos-development-collection/pull/2080>`_
--------------------------------------------------------------------------------------------------------------------

Allows to omit some keys that are often (correctly) left out.

* Packages: ``Browser`` ``Neos``

`TASK: Fix documentation for inline.editorOptions <https://github.com/neos/neos-development-collection/pull/2073>`_
-------------------------------------------------------------------------------------------------------------------

The former`aloha` things need to go under `formatting` and have a new format.

* Packages: ``Browser`` ``Neos``

`BUGFIX: Make sure to materialize as few nodes as possible <https://github.com/neos/neos-development-collection/pull/2085>`_
----------------------------------------------------------------------------------------------------------------------------

For property changes there is no necessity to materialize
auto-created child nodes as well. In projects with deeply
nested auto-created node structures this behaviour could
quickly generate huge amounts of changed nodes therefore
we should only materialize child nodes for structural
changes.

All of this is only valid for workspace materializations though,
in case dimensions need to be materialized as well, we need to
materialize all child nodes as well for consistency.

`FEATURE: Integrate pdf.js to preview PDF in the Media Browser <https://github.com/neos/neos-development-collection/pull/1745>`_
--------------------------------------------------------------------------------------------------------------------------------

null

* Packages: ``Browser``

`TASK: Improve Fusion debugging experience <https://github.com/neos/neos-development-collection/pull/2066>`_
------------------------------------------------------------------------------------------------------------

This change introduce a DebugStack to store all the debugging
message created with `Neos.Fusion:Debug`, to avoid breaking
the rendering when using var_dump before the HTTP request has
been send, this change flush the DebugStack at the end of the
page rendering. The new `Neos.Fusion:DebugDump` can be used as a
Fusion processor to flush the stack at any point during the
rendering.

The `DebugMessage` is used as a DTO to transport the debugging
informations. It contains a currently unused property `level`.
This property can be used in the future to use a logging backend to
store debugging informations or integrate with protocols like Chrome
Logger to send the debugging informations in the browser directly.

* Packages: ``Neos``

`TASK: Allow DimensionsMenu item label to be overridden in sub class <https://github.com/neos/neos-development-collection/pull/1159>`_
--------------------------------------------------------------------------------------------------------------------------------------

This change extract the logic to build the menu item label to a
dedicated method. With this change applied it's more easy to change this
logic without the needs to override the full buildItems method.

`Kickstarted NodeType, Fusion & Page template more consistent & beginner-friendly <https://github.com/neos/neos-development-collection/pull/2083>`_
---------------------------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Browser`` ``SiteKickstarter``

`BUGFIX: On asset change flush entries tagged with AssetDynamicTag <https://github.com/neos/neos-development-collection/pull/2082>`_
------------------------------------------------------------------------------------------------------------------------------------

When using `registerAssetChange()` provided by `ContentCacheFlusher` not all affected
cache entries would always be flushed. This adds flushing of entries tagged `AssetDynamicTag_*`
as done through `ConvertUrisImplementation`–`Runtime`–`RuntimeContentCache` to solve
this.

`BUGFIX: Prevent stale object references in user runtime cache <https://github.com/neos/neos-development-collection/pull/2084>`_
--------------------------------------------------------------------------------------------------------------------------------

Holding a reference to an doctrine object can be dangerous
if something happens to the UOW during that time, so that
a new instance of the entity is produced, resulting in a
stale entity reference that must be considered detached.
We therefore should only cache the persistence identifier of
a user for easier retrieval. If said user was already loaded by
doctrine it will be available in the identity map and should not
trigger another query, making this not less efficient than the
original solution.

Additionally refactored so that the cache is flat.

`BUGFIX: Avoid duplicate results and respect filter in NodeSearchService <https://github.com/neos/neos-development-collection/pull/2087>`_
------------------------------------------------------------------------------------------------------------------------------------------

Moves the "search by node id" logic from the `NodesController` to the
`NodeSearchService` fixing the following regressions:

* Duplicate results will be filtered
* Respect `$searchableNodeTypeNames` argument
* Don't execute `getNodeByIdentifier()` twice for every search

* Fixes: `#2079 <https://github.com/neos/neos-development-collection/issues/2079>`_
* Related: `#1894 <https://github.com/neos/neos-development-collection/issues/1894>`_

* Packages: ``Browser`` ``Neos``

`BUGFIX: "inCacheEntryPoint" needs to be saved <https://github.com/neos/neos-development-collection/pull/2077>`_
----------------------------------------------------------------------------------------------------------------

It is necessary to save and restore the `incacheEntryPoint` state in the following situation:

* the dynamic cache segment is evaluated in the **preEvaluate** step of a fusion path which will set `inCacheEntryPoint` to `null`
* the **preEvaluate** returns a "cache miss" because not all segments could be replaced
* Fusion then evaluates the path as usual 
* the runtime content cache then sets `currentPathIsEntryPoint` to `true` in *enter*  bc `inCacheEntryPoint` is still `null`
* the *postProcess* step then processes the cache entry and removes all CONTENT_CACHE markers bc `currentPathIsEntryPoint` is `true`


BTW: In this situation, *uncached* and *dynamic* segments are evaluated twice. But this is outside the scope of this bugfix. 

`BUGFIX: Column NodeType should be abstract <https://github.com/neos/neos-development-collection/pull/2075>`_
-------------------------------------------------------------------------------------------------------------

The `Neos.NodeTypes:Column` NodeType was always abstract, the 
abtract property isn't inherited down so it must be set again
on any inheriting NodeType. So to have Column abstract it must
declare so (again).

* Fixes: `#2071 <https://github.com/neos/neos-development-collection/issues/2071>`_
* Packages: ``NodeTypes``

`BUGFIX: Do not insist on assetSourceOptions to be set <https://github.com/neos/neos-development-collection/pull/2065>`_
------------------------------------------------------------------------------------------------------------------------

assetSourceOptions are used to configure an asset source, but
they are not necessarily needed.

* Packages: ``Browser``

`DOCS: replace outdated Aloha configuration samples <https://github.com/neos/neos-development-collection/pull/2069>`_
---------------------------------------------------------------------------------------------------------------------

Resolves: https://github.com/neos/neos-ui/issues/1619

The new UI has this format as the default: https://github.com/neos/neos-ui/blob/`9219a78b7bb0e96e1caf7d570c18faef9061423f <https://github.com/neos/neos-development-collection/commit/9219a78b7bb0e96e1caf7d570c18faef9061423f>`_/packages/neos-ui-contentrepository/src/registry/NodeTypesRegistry.js#L192

I think it's time to start officially using it.

* Packages: ``Neos``

`BUGFIX: Switch to using EntityManagerInterface <https://github.com/neos/neos-development-collection/pull/2067>`_
-----------------------------------------------------------------------------------------------------------------

This avoids (potential) error caused by two Doctrine UoW instances
being in use, one in the EntityManager (of Flow) and one in the
ObjectManager injected here.

* Packages: ``Browser`` ``ContentRepository`` ``Media`` ``Neos``

`DOCS: document forceCrop feature <https://github.com/neos/neos-development-collection/pull/2049>`_
---------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`DOCS: document new events API of the new UI <https://github.com/neos/neos-development-collection/pull/2050>`_
--------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`BUGFIX: Fix pagination for ListView in Media Browser <https://github.com/neos/neos-development-collection/pull/2062>`_
-----------------------------------------------------------------------------------------------------------------------

Use `paginatedAssetProxies` instead of `assetProxies` in Neos.Media.Browser ListView to make pagination work again.

`DOCS: Document custom background color for editPreviewMode <https://github.com/neos/neos-development-collection/pull/2052>`_
-----------------------------------------------------------------------------------------------------------------------------

This PR adds documentation for the newlty introduced `backgroundColor` option for custom `editPreviewModes`

related: https://github.com/neos/neos-ui/pull/1864

`Tiny documentation typo bugfix <https://github.com/neos/neos-development-collection/pull/2063>`_
-------------------------------------------------------------------------------------------------

Added a colon to make syntax highlighting work.

* Packages: ``Neos``

`BUGFIX: Fix Node migration without filter <https://github.com/neos/neos-development-collection/pull/2058>`_
------------------------------------------------------------------------------------------------------------

This change test if the migration contains a filter before creating the
contrains. Without this change the migration fails with an empty WHERE
clause.

This bug impact the migration `20150716212459`. This migration is used to
define default dimensions on all nodes.

`BUGFIX: Fix icons in modules after FA5 change <https://github.com/neos/neos-development-collection/pull/2057>`_
----------------------------------------------------------------------------------------------------------------

* Resolves: `#2054 <https://github.com/neos/neos-development-collection/issues/2054>`_
* Packages: ``Browser`` ``Neos``

`TASK: Adjust test to change in Neos.Neos.Ui <https://github.com/neos/neos-development-collection/pull/2056>`_
--------------------------------------------------------------------------------------------------------------

The UI package comes with a new image serializer that needs to be
configured so the test sees it's expected result.

This change depends on ``1b4562c8b71a595b48fec03fac9cd52b9f8c7a5e <https://github.com/neos/neos-development-collection/commit/1b4562c8b71a595b48fec03fac9cd52b9f8c7a5e>`_ <https://github.com/neos/neos-ui/pull/1866/commits/`1b4562c8b71a595b48fec03fac9cd52b9f8c7a5e <https://github.com/neos/neos-development-collection/commit/1b4562c8b71a595b48fec03fac9cd52b9f8c7a5e>`_>`_ in the
UI package.

* Packages: ``Neos``

`BUGFIX: Use correct cache namespace for redis in documentation <https://github.com/neos/neos-development-collection/pull/2048>`_
---------------------------------------------------------------------------------------------------------------------------------

The old namespace was deprecated and is now gone with 4.0

* Packages: ``Browser`` ``Neos``

`Updated Icon Documentation to FA5 <https://github.com/neos/neos-development-collection/pull/2042>`_
----------------------------------------------------------------------------------------------------

Old version still referred developers to Fontawesome 3. Update includes information on including icons with prefix- and icon-class.

* Packages: ``Neos``

`TASK: Revert composer changes for master <https://github.com/neos/neos-development-collection/pull/2041>`_
-----------------------------------------------------------------------------------------------------------

* Packages: ``SiteKickstarter``

`TASK: Fix icons in filter menu <https://github.com/neos/neos-development-collection/pull/2039>`_
-------------------------------------------------------------------------------------------------

null

* Packages: ``Browser``

`TASK: Missing replace label <https://github.com/neos/neos-development-collection/pull/2038>`_
----------------------------------------------------------------------------------------------

null

* Packages: ``Browser``

`TASK: Fix the pencil icon in the mediabrowser <https://github.com/neos/neos-development-collection/pull/2037>`_
----------------------------------------------------------------------------------------------------------------

Look like `pencil` is only available in the pro version, we need to use `pencil-alt` 

* Packages: ``Browser`` ``ContentRepository``

`TASK: Defer initialisation of NodePriviliges <https://github.com/neos/neos-development-collection/pull/1883>`_
---------------------------------------------------------------------------------------------------------------

* Packages: ``ContentRepository``

`BUGFIX: Remove dashes from autogeneratd node types file <https://github.com/neos/neos-development-collection/pull/2035>`_
--------------------------------------------------------------------------------------------------------------------------

* Packages: ``SiteKickstarter``

`BUGFIX: Core migration must not fail if no Private dir exists <https://github.com/neos/neos-development-collection/pull/2034>`_
--------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Fusion``

`TASK: Document usage of Security Context in Content Cache <https://github.com/neos/neos-development-collection/pull/2033>`_
----------------------------------------------------------------------------------------------------------------------------

- [ x] The PR is created against the `lowest maintained branch <https://www.neos.io/features/release-roadmap.html>`_

`TASK: Completely rewrite the "Page Rendering" Section of the docs to reflect the new standards. <https://github.com/neos/neos-development-collection/pull/2025>`_
------------------------------------------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`Task/core migrations nodetypes navigation <https://github.com/neos/neos-development-collection/pull/2032>`_
------------------------------------------------------------------------------------------------------------

https://github.com/neos/neos-development-collection/issues/2014

* Packages: ``Navigation``

`Task/core migrations nodetypes html <https://github.com/neos/neos-development-collection/pull/2031>`_
------------------------------------------------------------------------------------------------------

https://github.com/neos/neos-development-collection/issues/2014

* Packages: ``Html``

`Task/core migrations nodetypes form <https://github.com/neos/neos-development-collection/pull/2030>`_
------------------------------------------------------------------------------------------------------

https://github.com/neos/neos-development-collection/issues/2014

* Packages: ``Form``

`Task/core migrations nodetypes contentreferences <https://github.com/neos/neos-development-collection/pull/2029>`_
-------------------------------------------------------------------------------------------------------------------

https://github.com/neos/neos-development-collection/issues/2014

* Packages: ``ContentReferences``

`Task/core migrations nodetypes columnlayouts <https://github.com/neos/neos-development-collection/pull/2028>`_
---------------------------------------------------------------------------------------------------------------

https://github.com/neos/neos-development-collection/issues/2014

* Packages: ``ColumnLayouts``

`!!! TASK: Add very basic document prototype and template <https://github.com/neos/neos-development-collection/pull/2012>`_
---------------------------------------------------------------------------------------------------------------------------

Add very basic prototype and template to ensure `Neos.NodeTypes:Page` works out of the box.

This is marked breaking since it can lead to unexpected behaviour if you only have the `page` path defined. But it is fairly easy to get your project up to speed with minimal code changes. See: 
https://github.com/neos/Neos.Demo/pull/42 (`page = Neos.NodeTypes:Page` as a fallback)

* Packages: ``NodeTypes``

`!!! FEATURE: Update auto-created \`\`Root.fusion\`\` to use prototypes instead of the \`\`page\`\` object <https://github.com/neos/neos-development-collection/pull/615>`_
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

A freshly created site package will now create a page protoype that extends `Neos.Neos:Page`. Using `/page` can be seen as deprecated and packages that rely on extending `page` should be updated to extend the page prototype instead. 

As a workaround the line `page = Neos.NodeTypes:Page` can be added to the `Root.fusion` as a fallback so extension points using the the `page` path as well as layout properties will still be in effect.

For further information see: http://neos.readthedocs.io/en/stable/HowTos/RenderingCustomDocumentTypes.html

* Packages: ``Fusion`` ``SiteKickstarter``

`TASK: Set default setting to enable the switch to old UI switch <https://github.com/neos/neos-development-collection/pull/2026>`_
----------------------------------------------------------------------------------------------------------------------------------

See discussion there for more details.

Related: https://github.com/neos/neos-development-collection/pull/2021
https://github.com/neos/neos-ui/pull/1809

* Packages: ``Neos``

`TASK: Larger ramfs for PostgreSQL builds on Travis CI <https://github.com/neos/neos-development-collection/pull/2024>`_
------------------------------------------------------------------------------------------------------------------------

This switches builds using PostgreSQL to be sudo-enabled and enlarges
the RAM disk at /var/ramfs to avoid "out of disk space" errors during
the test runs.

* Fixes: `#2016 <https://github.com/neos/neos-development-collection/issues/2016>`_
* Packages: ``ContentRepository``

`Task/core migrations Neos.Neos <https://github.com/neos/neos-development-collection/pull/2018>`_
-------------------------------------------------------------------------------------------------


I run the core migrations for Neos.Neos

#2014

* Packages: ``Neos``

`Task/core migrations nodetypes base <https://github.com/neos/neos-development-collection/pull/2022>`_
------------------------------------------------------------------------------------------------------

https://github.com/neos/neos-development-collection/issues/2014

* Packages: ``BaseMixins``

`Task/core migrations nodetypes assetlist <https://github.com/neos/neos-development-collection/pull/2020>`_
-----------------------------------------------------------------------------------------------------------

https://github.com/neos/neos-development-collection/issues/2014

* Packages: ``AssetList``

`Task/core migrations nodetypes <https://github.com/neos/neos-development-collection/pull/2019>`_
-------------------------------------------------------------------------------------------------

https://github.com/neos/neos-development-collection/issues/2014

* Packages: ``Neos`` ``NodeTypes``

`TASK: core migration for fontawesome5 usage and new icons for the old UI <https://github.com/neos/neos-development-collection/pull/2001>`_
-------------------------------------------------------------------------------------------------------------------------------------------

Core Migration to adjust all icon names in YAML-Files to new fontawesome 5 icon names. Needed to review and test the PR which updates the Neos.Neos.Ui to fontawesome 5.

This PR can't be merged until it adjusts the old Ui to support fontawesome5.

* Packages: ``Neos``

`FEATURE: Support search by property & exact value in NodeDataRepository <https://github.com/neos/neos-development-collection/pull/1>`_
---------------------------------------------------------------------------------------------------------------------------------------

Currently it is only possible to search through the properties by
giving a string that matches for any key or value found in the
jsonified properties field.

With this change, the term can also be an array to match exactly on a
given key / value combination.
The search term could be given as `['key' => 'value']`.

NEOS-1460 #close

* Packages: ``Neos``

`BUGFIX: Use single quote for default in Postgres migration <https://github.com/neos/neos-development-collection/pull/2015>`_
-----------------------------------------------------------------------------------------------------------------------------

null

* Packages: ``Browser`` ``Media``

`DOCS: Disable editors <https://github.com/neos/neos-development-collection/pull/2013>`_
----------------------------------------------------------------------------------------

This PR adds documentation regarding the ability to disable Editors, which is added in this PR:
https://github.com/neos/neos-ui/pull/1665

* Packages: ``Neos``

`FEATURE: Assets sources support for Neos Media <https://github.com/neos/neos-development-collection/pull/1979>`_
-----------------------------------------------------------------------------------------------------------------

This change introduces low-level support for third-party "asset sources" which allow for seamless integration of external asset management services.

The intention of this change is to establish a beta version of the API which can be used for developing first asset source plugins. The newly introduced API might change slightly during that process and thus should not be considered as stable. The native Neos asset source, which is part of this change, should work like it did before the introduction of this new feature.

* Packages: ``Browser`` ``Neos``

`BUGFIX: Show content dimensions with asset usages <https://github.com/neos/neos-development-collection/pull/2006>`_
--------------------------------------------------------------------------------------------------------------------

* Fixes: `#2005 <https://github.com/neos/neos-development-collection/issues/2005>`_

`TASK: Adjust usage of packages to changes in Flow <https://github.com/neos/neos-development-collection/pull/2008>`_
--------------------------------------------------------------------------------------------------------------------

* Packages: ``ContentRepository`` ``Fusion``

`!!!TASK: Change default charset and collation to utf8mb4 <https://github.com/neos/neos-development-collection/pull/1991>`_
---------------------------------------------------------------------------------------------------------------------------

This changes the charset and collation to create table statements in the
existing migrations. This make sure the tables are set up correctly
independent of the database default configuration.

This is breaking if you have existing tables that do not use ut8mb4 as
charset and utf8mb4_unicode_ci as collation. To solve this you need to
convert the existing tables. This can be done using the command::

  ./flow database:setcharset

This will convert the database configured in the settings and all tables
inside to use a default character set of utf8mb4 and a default collation
of utf8mb4_unicode_ci. It will also convert all character type columns
to that combination of charset and collation.

Background information on why this is done can be found in
https://medium.com/@adamhooper/in-mysql-never-use-utf8-use-utf8mb4-11761243e434

* Packages: ``Neos``

`TASK: Add rel="noopener" to external links with target="_blank" <https://github.com/neos/neos-development-collection/pull/1729>`_
----------------------------------------------------------------------------------------------------------------------------------

Check if an external link has a ``target="_blank"`` and if so add the attribute ``rel="noopener"`` to the tag for improved security.

More info https://mathiasbynens.github.io/rel-noopener/

`BUGFIX: replace deprecated validation Viewhelper <https://github.com/neos/neos-development-collection/pull/2011>`_
-------------------------------------------------------------------------------------------------------------------

fixes a part of https://github.com/neos/neos-development-collection/issues/2010

* Packages: ``Neos``

`TASK: Improve login screen accessibility <https://github.com/neos/neos-development-collection/pull/1994>`_
-----------------------------------------------------------------------------------------------------------

- Added aria-label attributes to form fields
- Added role=alert to error message to improve screen reader accessibility
- Changed header tag to h1 (could break custom CSS that relies on the header tag)

* Packages: ``Neos``

`TASK: Don't show protected package property as that will go away <https://github.com/neos/neos-development-collection/pull/2007>`_
-----------------------------------------------------------------------------------------------------------------------------------

The ``protected`` property of packages doesn't make much sense anymore
now that disabling is gone. It will be removed in Flow and in
preparation should no longer be shown here.

* Packages: ``Media`` ``Neos``

`!!! FEATURE: Add \`documentType\` matcher to default-fusion that is evaluated before \`default\` <https://github.com/neos/neos-development-collection/pull/1992>`_
-------------------------------------------------------------------------------------------------------------------------------------------------------------------

Add a `documentType` matcher before `default` matcher of the default fusion that checks wether a fusion-prototype named like the nodeType of the current documentNode exists and is renderable. If that is the case this prototype is rendered instead of `default`.

In addition the pr removes the prototype generators for `'Neos.Neos:Node` and `Neos.Neos:Document`. Those generators are neither actively used or promoted and since this feature is hardly usable it should be save to remove them. The reason to deactivate those fusion generators now is that the invisible fusion code got in the way of the protoype based document rendering we want to establish here.

Attention: If you use fusion-prototypes that have the same name as your documents but do not inherit from Neos.Neos:Page you will have to adjust your code. Same goes if you rely on the fusion prototypes that were autogenerated for `'Neos.Neos:Node` and `Neos.Neos:Document`. 

* Packages: ``ContentRepository`` ``Neos``

`BUGFIX: Adjustments after Doctrine updates <https://github.com/neos/neos-development-collection/pull/2004>`_
-------------------------------------------------------------------------------------------------------------

This adjusts some code in Neos to match the updated Doctrine DBAL and ORM libraries.

* Packages: ``ContentRepository``

`TASK: Adjust to changed CacheAwareInterface <https://github.com/neos/neos-development-collection/pull/2003>`_
--------------------------------------------------------------------------------------------------------------

Adds the string return type declaration to getCacheEntryIdentifier().

`TASK: Update to Doctrine DBAL 2.7 and ORM 2.6 <https://github.com/neos/neos-development-collection/pull/1993>`_
----------------------------------------------------------------------------------------------------------------

* Packages: ``Browser`` ``ContentRepository`` ``Fusion`` ``Media``

`TASK: Add translation for aria-labels of buttons introduced in neos/neos-ui#1595 <https://github.com/neos/neos-development-collection/pull/1878>`_
---------------------------------------------------------------------------------------------------------------------------------------------------

**What I did**
Added label translations for button aria labels
**How to verify it**
Check labels introduced in neos/neos-ui#1595

* Packages: ``Neos``

`BUGFIX: NodeTemplateConverter::convertFrom must respect parent method… <https://github.com/neos/neos-development-collection/pull/1776>`_
-------------------------------------------------------------------------------------------------------------------------------------------

This throw an error in PHP 7.2 (at least on the RC2)

* Packages: ``ContentRepository``

`BUGFIX: Exclude shadow nodes in findOneByIdentifier <https://github.com/neos/neos-development-collection/pull/1987>`_
----------------------------------------------------------------------------------------------------------------------

Added a filtering for `movedTo` like we already do in `filterNodeDataByBestMatchInContext`.

See description of the discovered behavior in https://github.com/neos/neos-ui/issues/1523#issuecomment-379247165.

Closes #1986

`BUGFIX: Use fusionValue instead of tsValue in ImageUriImplementation <https://github.com/neos/neos-development-collection/pull/1990>`_
---------------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`BUGFIX: Remove leftover references to removed \`tsValue\` method <https://github.com/neos/neos-development-collection/pull/1989>`_
-----------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Fusion`` ``Neos``

`BUGFIX: Dynamic cache entries should be evaluated via runtime <https://github.com/neos/neos-development-collection/pull/1964>`_
--------------------------------------------------------------------------------------------------------------------------------

Dynamic cache entries are complex and need a lot of information
to be evaluated correctly, therefore the runtime should always take
care of this. This is potentially a bit slower than the original
code but definitely more correct in outcome. Before tags were
definitely wrong as they were based on the parent elements
configuration.

`TASK: Remove deprecated methods <https://github.com/neos/neos-development-collection/pull/1954>`_
--------------------------------------------------------------------------------------------------

Removes deprecated methods that were marked for remove
with Neos 4.0

Includes: 
Drop support for the .ts2 suffix especially the root.ts2 as fusion root file

* Packages: ``Neos``

`BUGFIX: Avoid getPath() on null in LinkingService <https://github.com/neos/neos-development-collection/pull/1984>`_
--------------------------------------------------------------------------------------------------------------------

When the context of the "resolved" node does not have a "current" site
in `LinkingService.createNodeUri()` a fatal error was triggered. This
adds a check and handles the case like a site node path mismatch.

* Packages: ``Neos``

`BUGFIX: Skip CSRF protection in logout action <https://github.com/neos/neos-development-collection/pull/1981>`_
----------------------------------------------------------------------------------------------------------------

Since we overwrite the `logoutAction` from Flow, we need to annotate it with `@Flow\\SkipCsrfProtection` here too.

see neos/flow-development-collection#1014

`FEATURE: Expose NodeType.isOfType in Node eel helper <https://github.com/neos/neos-development-collection/pull/1957>`_
-----------------------------------------------------------------------------------------------------------------------

This introduces the Node.isOfType() eel method to check
if a node is of a given type

* Packages: ``Neos``

`TASK: Fix incorrect child node types in \`\`node:repair\`\` command <https://github.com/neos/neos-development-collection/pull/1956>`_
--------------------------------------------------------------------------------------------------------------------------------------

When checking for missing child nodes it doesn't check if the existing child nodes are the correct node type. This can happen when a node has been changed to the fallback node type or if the child node type is changed in the configuration.

`TASK: Use fully qualified names in Fusion reference <https://github.com/neos/neos-development-collection/pull/1975>`_
----------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`!!! TASK: Extract the \`layout\` root matcher from Neos.Neos and move it over to Neos.NodeTypes <https://github.com/neos/neos-development-collection/pull/1973>`_
------------------------------------------------------------------------------------------------------------------------------------------------------------------

Since the `layout` property is defined in `Neos.NodeTypes`, the `layout`-matcher is
moved to `Neos.NodeTypes` aswell.

If your project relies on the `layout` or `subpageLayout` property but does not use
`Neos.NodeTypes` you have to configure the layout matcher on your own.

* Packages: ``Neos``

`TASK: Remove base prototype and template path from autogenerated fusion for Node and Document <https://github.com/neos/neos-development-collection/pull/1969>`_
----------------------------------------------------------------------------------------------------------------------------------------------------------------

The base prototypes and templatePathes are not set by the prototypeGenrator for Neos.Neos:Node and Neos.Neos:Document any more.  For convenience reasons the prototypes for each NodeTypes are declared without base prototype and template all node properties are made accessible as fusion props.

* Packages: ``Neos``

`FEATURE: Add \`CanRender\` Fusion prototype <https://github.com/neos/neos-development-collection/pull/1974>`_
--------------------------------------------------------------------------------------------------------------

The prototype checks wether the given type is renderable by fusion. Which means
that the prototype exists and has an implementation class or is based on a prototype that
has one.

* Packages: ``Neos``

`BUGFIX: Fix Fusion exception after login to Neos <https://github.com/neos/neos-development-collection/pull/1972>`_
-------------------------------------------------------------------------------------------------------------------

The Fusion configuration of `neosBackendMetaData.attributes.data-preview-uri`
lacked a fully qualified Fusion object name, leading to an expansion to
`Neos.Fusion:NodeUri`. That does not exist, leading to an exception right after
login.

* Fixes: `#1971 <https://github.com/neos/neos-development-collection/issues/1971>`_
* Packages: ``ContentRepository`` ``Neos``

`BUGFIX: Typo in WorkspaceException #1395841899 <https://github.com/neos/neos-development-collection/pull/1968>`_
-----------------------------------------------------------------------------------------------------------------

Duplicate "in a".

`FEATURE: Add createMissingSitesNode to node:repair <https://github.com/neos/neos-development-collection/pull/1959>`_
---------------------------------------------------------------------------------------------------------------------

When the `/sites` node is missing, Neos can work quite well, but
at least `removeOrphanNodes` will wreck havoc! So this adds a
task to create the sites node if missing.

Note: since `removeOrphanNodes` is in the CR, which has no
notion of what the nodes inside it mean, this check was added
"separately".

* Packages: ``Neos``

`BUGFIX: Fix asset references detection for nodes even more <https://github.com/neos/neos-development-collection/pull/1966>`_
-----------------------------------------------------------------------------------------------------------------------------

Even after #1762 showing asset usage sometimes fails, with an error
that can only be explained by `documentNode` being null when trying
to render a reference.

This change adds another safety net for that case.

`BUGFIX: Only move children with the same dimensionHash in setPath() <https://github.com/neos/neos-development-collection/pull/1697>`_
--------------------------------------------------------------------------------------------------------------------------------------

This changes the code in setPath() to no longer move all children
across all dimension value combinations. Instead only children with
the same dimensionsHash as the currently moved node will be moved
along.

This avoids errors like the one described in #1696.

* Fixes: `#1696 <https://github.com/neos/neos-development-collection/issues/1696>`_

`TASK: Also search for $searchTerm as identifier <https://github.com/neos/neos-development-collection/pull/1894>`_
------------------------------------------------------------------------------------------------------------------

**What I did**
Added a search for NodeIdentifier when calling `\\Neos\\Neos\\Controller\\Service\\NodesController::indexAction()`.

That is very helpful, if you have to find one node under thousands (with same NodeType).

**How I did it**
See the diff... 

**How to verify it**
Put an Identifier into a reference/references field in inspector. You should get the correct Node back.
!`bildschirmfoto 2018-02-13 um 17 00 23 <https://user-images.githubusercontent.com/9807101/36159821-ff9fb058-10df-11e8-831e-6a9c01b12736.png>`_


* Packages: ``Neos``

`BUGFIX: Dynamic cache segments not correctly re-evaluated <https://github.com/neos/neos-development-collection/pull/1960>`_
----------------------------------------------------------------------------------------------------------------------------

...
Only a test to expose the wrong behavior at this point.

* Fixes: `#1958 <https://github.com/neos/neos-development-collection/issues/1958>`_

`FEATURE: Allow custom attributes to be added to \`ContentElementWrapping\` <https://github.com/neos/neos-development-collection/pull/1919>`_
---------------------------------------------------------------------------------------------------------------------------------------------

This extends the `ContentElementWrapping` in order to allow
additional attributes to be added via Fusion or PHP.

This is useful to augment content and/or to affect its styling
in the Neos backend.

Example (Fusion):
Add the wrapped node's type to a new `data-_node-type` attribute
for all `ContentElementWrapping` instances::

    prototype(Neos.Neos:ContentElementWrapping) {
        additionalAttributes {
            'data-_node-type' = ${node.nodeType.name}
        }
    }

Example (Fusion):
Add a custom class attribute to a single instance::

    @process.contentElementWrapping = Neos.Neos:ContentElementWrapping {
        additionalAttributes.class = 'some-additional-class'
    }

Example (PHP)::

    $this->contentElementWrappingService->wrapContentObject($node, $output, $fusionPath, ['custom-attribute' => 'attribute-value']);

* Resolves: `#1879 <https://github.com/neos/neos-development-collection/issues/1879>`_
* Packages: ``Neos``

`TASK: Pass affected entities to flush as array, not one-by-one <https://github.com/neos/neos-development-collection/pull/1949>`_
---------------------------------------------------------------------------------------------------------------------------------

The `NodeDataRepository.persistEntities()` method looped over the
entities and passed them to `flush()` one-by-one. They can be passed
as the array at hand directly.

* Packages: ``ContentRepository``

`TASK: Make sure documentnodeidentifier index is not overlooked <https://github.com/neos/neos-development-collection/pull/1950>`_
---------------------------------------------------------------------------------------------------------------------------------

The `documentnodeidentifier` index defined in `NodeEvent` is not picked
up by Doctrine Migrations when generating a migration. This leads to
it's removal being included in new migrations, and it has actually been
removed unnoticed in the past.

This change adds it to the `Event` class as well, so it is picked up
correctly. See https://github.com/doctrine/doctrine2/issues/6248

* Packages: ``Neos``

`TASK: Change NodeData movedTo from ManyToOne to OneToOne <https://github.com/neos/neos-development-collection/pull/1951>`_
---------------------------------------------------------------------------------------------------------------------------

A node can only be moved to one other node, so ManyToOne was never
correct.

See https://github.com/neos/neos-development-collection/issues/1908

* Packages: ``ContentRepository`` ``Neos``

`FEATURE: Add globbing to \`site\`,\`user\` and \`domain\` cli-commands <https://github.com/neos/neos-development-collection/pull/1884>`_
-----------------------------------------------------------------------------------------------------------------------------------------

Add globbing to the follwing cli-commands:

- `site:prune`
- `site:activate`
- `site:deactivate`
- `domain:delete`
- `domain:activate`
- `domain:deactivate`
- `user:delete`
- `user:activate`
- `user:deactivate`
- `user:addrole`
- `user:removerole`

Additionally the `siteNode` is made a required argument for `site:prune`.
To still remove all sites `./flow site:prune "*"` can be used.  

* Packages: ``Neos``

`!!! TASK: Scope fusion-namespaces to current file and remove default \`Neos.Neos\`-namespace <https://github.com/neos/neos-development-collection/pull/1888>`_
---------------------------------------------------------------------------------------------------------------------------------------------------------------

Namespaces were previously transported over `include` boundaries and
thus could end up being declared in packages differently depending on how
the Fusion code was included. This could easily lead to confusion.

With this change namespaces are handled like in PHP and are only valid for the
Fusion file they are declared in.

In addition this removes the overwriting of the `default` namespace `Neos.Fusion` 
with `Neos.Neos` inside of Neos wich could lead to Fusion code failing if used 
in another context.

* Packages: ``Fusion``

`BUGFIX: Add null check in getOtherNodeVariants() <https://github.com/neos/neos-development-collection/pull/1897>`_
-------------------------------------------------------------------------------------------------------------------

This avoids a fatal error in case variants of the node are not accessible
for some reason.

* Fixes: `#1896 <https://github.com/neos/neos-development-collection/issues/1896>`_

`BUGFIX: Call \`getAvailablePackages\` in packages-module <https://github.com/neos/neos-development-collection/pull/1940>`_
---------------------------------------------------------------------------------------------------------------------------

The previously called method `getActivePackages` has been removed in a previous commit.

* Packages: ``Neos``

`TASK: Improvements to the UserInitials view helper <https://github.com/neos/neos-development-collection/pull/1910>`_
---------------------------------------------------------------------------------------------------------------------

Improves the UserInitials view helper a bit by removing the odd dot and the end of "fullFirstName" and trims the result. Additionally strips special characters from "initials".

`BUGFIX: Filtering of baseNodeType for create new dialog in trees <https://github.com/neos/neos-development-collection/pull/1934>`_
-----------------------------------------------------------------------------------------------------------------------------------

The "baseNodeType" filtering of allowed child node types was not implemented correctly leading to issues when using multiple allow node type filters.

* Fixes: `#1933 <https://github.com/neos/neos-development-collection/issues/1933>`_ 

`BUGFIX: Ensure account identifier is always added to events <https://github.com/neos/neos-development-collection/pull/1916>`_
------------------------------------------------------------------------------------------------------------------------------

For some events (e.g. copying) the account identifier is not set since it's not initialized.
Instead of doing it manually for each event type it's done before generating an event so it's always done.

* Resolves: `#1914 <https://github.com/neos/neos-development-collection/issues/1914>`_

`TASK: Code cleanup in NodeEvent <https://github.com/neos/neos-development-collection/pull/1915>`_
--------------------------------------------------------------------------------------------------

`TASK: Improve history module event labels <https://github.com/neos/neos-development-collection/pull/1911>`_
------------------------------------------------------------------------------------------------------------

Improves the labels by adding "the" to give it a better flow.
Additionally ensures all labels are in quotation marks.

`TASK: Remove whitespace from history module node link <https://github.com/neos/neos-development-collection/pull/1912>`_
------------------------------------------------------------------------------------------------------------------------

Without it a space is inserted at first in the quoted link.

`TASK: Order event log child events by their uid <https://github.com/neos/neos-development-collection/pull/1917>`_
------------------------------------------------------------------------------------------------------------------

Ensure that child events are ordered by their uid to ensure chronological order

`BUGFIX: Fix two errors in media management caused by upmerge <https://github.com/neos/neos-development-collection/pull/1907>`_
-------------------------------------------------------------------------------------------------------------------------------

This change adds a missing namespace import to `AssetUsageInNodePropertiesStrategy`
and fixes references to label translations and a partial in the
RelatedNodes template.

* Packages: ``Browser`` ``Neos``

`BUGFIX: Enforce NodeTreePrivilege when filtering node tree <https://github.com/neos/neos-development-collection/pull/1868>`_
-----------------------------------------------------------------------------------------------------------------------------

When using the search field or node type filter in the node tree,
the NodeTreePrivilege policies aren't taken into account.

* Resolves: `#1867 <https://github.com/neos/neos-development-collection/issues/1867>`_

`BUGFIX: Fix asset references detection for nodes <https://github.com/neos/neos-development-collection/pull/1762>`_
-------------------------------------------------------------------------------------------------------------------

This solves several issues with the implementation of asset usages

* Can be used without logged in user (CLI)
* Lists all references without resulting in errors
* Speed gain if the usages are not actually needed (eg. only counted).

Gives minimal information about "inaccessible" references for now.

Also resolves #1599

`DOCS: document creationDialog <https://github.com/neos/neos-development-collection/pull/1892>`_
------------------------------------------------------------------------------------------------

* Resolves: `#1469 <https://github.com/neos/neos-development-collection/issues/1469>`_
* Packages: ``Neos``

`DOCS: document dynamic client-side configuration processing <https://github.com/neos/neos-development-collection/pull/1891>`_
------------------------------------------------------------------------------------------------------------------------------

Documentation for https://github.com/neos/neos-ui/pull/1618

* Packages: ``Neos``

`BUGFIX: Fix VH call quote escaping in RelatedAssets.html <https://github.com/neos/neos-development-collection/pull/1893>`_
---------------------------------------------------------------------------------------------------------------------------

A call to a VH inside another VH call was not using correctly escaped
single quotes, breaking parsing.

`TASK: Enable i18n for node creation dialog <https://github.com/neos/neos-development-collection/pull/1871>`_
-------------------------------------------------------------------------------------------------------------

In the same time, the "Title" label for a new Document node is
added to the language files. The creationDialog configuration
for this node type is inside Neos.Neos.Ui.

Fixes: neos/neos-ui#1539

* Packages: ``Neos``

`BUGFIX: Declare mixin node types as abstract <https://github.com/neos/neos-development-collection/pull/1885>`_
---------------------------------------------------------------------------------------------------------------

The mixins in this package are not declared abstract. This leads to issues with
Elasticsearch indexing. Abstract node types are not mapped, but these mixins
are not abstract, thus they are mapped. Any mapping configuration that is
applied to `Neos.Neos:Node` must therefore also be applied to all mixins,
if any conflicts appear between fields (e.g. `_all`).

* Packages: ``Neos`` ``NodeTypes``

`TASK: Fix test failure introduced through upmerge <https://github.com/neos/neos-development-collection/pull/1882>`_
--------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`TASK: Improve NodePrivilege performance <https://github.com/neos/neos-development-collection/pull/1870>`_
----------------------------------------------------------------------------------------------------------

Node privileges did a lot of unnecessary initialization
and didn't properly fetch the CompilingEvaluator instance
possibly wasting cache hits.

This fixes some of those problems which should improve Node
security performance quite a bit.

* Packages: ``ContentRepository``

`TASK: make format configurable of ContentDimensions controller <https://github.com/neos/neos-development-collection/pull/1881>`_
---------------------------------------------------------------------------------------------------------------------------------

Needed for the new UI

* Packages: ``Neos``

`[TASK] Create .codeclimate.yml <https://github.com/neos/neos-development-collection/pull/6>`_
----------------------------------------------------------------------------------------------

Adds a codeclimate configuration excluding Migrations, Tests and
JavaScript libraries.

* Packages: ``Afx``

`[TASK] Create .codeclimate.yml <https://github.com/neos/neos-development-collection/pull/6>`_
----------------------------------------------------------------------------------------------

Adds a codeclimate configuration excluding Migrations, Tests and
JavaScript libraries.

`TASK: \`\`ReadNodePrivilege\`\` evaluates EEL expression only once <https://github.com/neos/neos-development-collection/pull/1874>`_
-------------------------------------------------------------------------------------------------------------------------------------

The ``ReadNodePrivilege`` evaluates it's EEL evaluator twice unnecessarily,
there's some caching however it should optimize some cases.

`[TASK] Add trait to avoid duplicate code in ViewHelpers <https://github.com/neos/neos-development-collection/pull/3>`_
-----------------------------------------------------------------------------------------------------------------------

The new `TypoScriptContextTrait` can be used to get
variables from the TypoScript runtime context inside a
ViewHelper as long as it's used inside a
`TypoScriptAwareView`. This helps to avoid code duplication
while avoiding long inheritance chains.

* Packages: ``Afx``

`[TASK] Add trait to avoid duplicate code in ViewHelpers <https://github.com/neos/neos-development-collection/pull/3>`_
-----------------------------------------------------------------------------------------------------------------------

The new `TypoScriptContextTrait` can be used to get
variables from the TypoScript runtime context inside a
ViewHelper as long as it's used inside a
`TypoScriptAwareView`. This helps to avoid code duplication
while avoiding long inheritance chains.

`TASK: Add labels for UI DateInput Component neos/neos-ui#1534 <https://github.com/neos/neos-development-collection/pull/1869>`_
--------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Browser`` ``Neos``

`BUGFIX: Avoid errors on undefined array index <https://github.com/neos/neos-development-collection/pull/1865>`_
----------------------------------------------------------------------------------------------------------------

The use of the ternary operator with a potentially undefined array index
leads to errors, this change uses the null-coalesce operator (`??`) instead.

> In particular, this operator does not emit a notice if the left-hand
> side value does not exist, just like isset(). This is especially useful
> on array keys.

(http://php.net/manual/en/language.operators.comparison.php#language.operators.comparison.coalesce)

* Packages: ``ContentRepository``

`BUGFIX: Context structure tree only shows content <https://github.com/neos/neos-development-collection/pull/1785>`_
--------------------------------------------------------------------------------------------------------------------

Changes the base node type filter used in the context structure tree to explicitly include content collections and content elements instead of everything that's not a document node type.

* Resolves: `#1784 <https://github.com/neos/neos-development-collection/issues/1784>`_

`BUGFIX: Use XliffService label override for Neos UI <https://github.com/neos/neos-development-collection/pull/1708>`_
----------------------------------------------------------------------------------------------------------------------

Recently (Flow 4.2) introduced the feature to override labels from other packages or add own translations for other packages via neos/flow-development-collection#894. This was formerly suggested in JIRA-issue FLOW-61.

This works nicely but the Neos UI is not using `\\Neos\\Neos\\Service\\XliffService`. This Service deliveres a xliff-json that contains labels e.g. for the property editor. Currently you cannot override labels from other packages that are used in the property editor. `\\Neos\\Neos\\Service\\XliffService::parseXliffToArray` is annotated (todo) to be changed when FLOW-61 is resolved.

This change refactors the class to make use of `\\Neos\\Flow\\I18n\\Xliff\\Service\\XliffFileProvider::getFile` which handles the overrides.

* Packages: ``Neos`` ``SiteKickstarter``

`BUGFIX: Let fusion render preview URIs for the Neos backend <https://github.com/neos/neos-development-collection/pull/1815>`_
------------------------------------------------------------------------------------------------------------------------------

Preview links are now generated via Fusion instead of Javascript

`TASK: Rename folder for Node Migrations <https://github.com/neos/neos-development-collection/pull/1863>`_
----------------------------------------------------------------------------------------------------------

With this change node migrations are expected to be located
in a directory `Migrations/ContentRepository`.

For backwards compatibility migrations in `Migrations/TYPO3CR` are
still supported.

* Fixes: `#1861 <https://github.com/neos/neos-development-collection/issues/1861>`_
* Packages: ``Browser`` ``ContentRepository`` ``Fusion`` ``Media`` ``Neos`` ``NodeTypes`` ``SiteKickstarter``

`BUGFIX: Adjust the flow command for generatexsd <https://github.com/neos/neos-development-collection/pull/1858>`_
------------------------------------------------------------------------------------------------------------------

The generatexsd command has a little typo in the documentation.
So this fixes the command in the documentation.

* Fixes: `#1857 <https://github.com/neos/neos-development-collection/issues/1857>`_
* Packages: ``Neos``

`TASK: Update SPDX license identifier in composer.json <https://github.com/neos/neos-development-collection/pull/1862>`_
------------------------------------------------------------------------------------------------------------------------

`TASK: Adapt to removal of active state for packages <https://github.com/neos/neos-development-collection/pull/1828>`_
----------------------------------------------------------------------------------------------------------------------

See https://github.com/neos/flow-development-collection/pull/1156

`TASK: Remove any notion of \`active\` packages in package module <https://github.com/neos/neos-development-collection/pull/1826>`_
-----------------------------------------------------------------------------------------------------------------------------------

In preparation of removing active/deactivated states for packages
we remove notion of that in the Neos package module.

`TASK: Display changes in workspaces module when setting/unsetting a DateTime values <https://github.com/neos/neos-development-collection/pull/1783>`_
------------------------------------------------------------------------------------------------------------------------------------------------------

When a DateTime property value is either set for the first time or unset the workspace module will now show that change. Previously it would only display the change if the time was set changed to a different time.

`BUGFIX: Corrected ContentReferences translation namespace <https://github.com/neos/neos-development-collection/pull/1853>`_
----------------------------------------------------------------------------------------------------------------------------

#1659 splits the Neos.NodeTypes package into separate packaged. In the translation
rewrite script I had an error, so the Neos.NodeTypes.ContentReferences was set as
`Neos.NodeTypes.ContentReferences.ContentReferences` instead of
`Neos.NodeTypes.ContentReferences`. This bug makes sure that labels are correctly
available.

* Packages: ``ContentReferences``

`BUGFIX: Allow node transformations without setting <https://github.com/neos/neos-development-collection/pull/1849>`_
---------------------------------------------------------------------------------------------------------------------

This change allows to create/use node transformations that do not use settings.

Without this change, one always had to provide dummy settings.

* Packages: ``Browser`` ``ContentRepository`` ``NodeTypes``

`TASK: Document canvas width and height in editPreviewMode <https://github.com/neos/neos-development-collection/pull/1850>`_
----------------------------------------------------------------------------------------------------------------------------

**What I did**
I added missing components in documentation for custom preview modes

**How I did it**
I analysed the react frontend and found some editable variables for height and width. After searching the code for it, I found some optional variables, which were missing in the documentation. These variables are new and came with the new UI.

- [x] The PR is created against the `lowest maintained branch <https://www.neos.io/features/release-roadmap.html>`_

* Packages: ``BaseMixins`` ``Browser`` ``Neos``

`TASK: Fix dependency version constraints <https://github.com/neos/neos-development-collection/pull/1855>`_
-----------------------------------------------------------------------------------------------------------

Following up the changes in Flow and the `gedmo/doctrine-extensions` update this
change adjusts the required version of `doctrine/dbal` and raises the `php` version
to 7.1 to match Flow.

`TASK: Raise gedmo/doctrine-extensions requirement to ~2.4.0  <https://github.com/neos/neos-development-collection/pull/1854>`_
-------------------------------------------------------------------------------------------------------------------------------

After the required version of some dependencies have been raised in Flow,
Neos cannot be installed as `dev-master`, since no installable set of
dependencies can be computed.

This raises one suspect blocking this.

`BUGFIX: Remove duplicate entry in composer.json (neos/fluid-adaptor) <https://github.com/neos/neos-development-collection/pull/1848>`_
---------------------------------------------------------------------------------------------------------------------------------------

* Fixes: `#1847 <https://github.com/neos/neos-development-collection/issues/1847>`_
* Packages: ``Browser`` ``Fusion``

`TASK: Adapt ViewHelper to support changes in Flow <https://github.com/neos/neos-development-collection/pull/1844>`_
--------------------------------------------------------------------------------------------------------------------

null

* Packages: ``Neos``

`TASK: Check node migration filename before use <https://github.com/neos/neos-development-collection/pull/1845>`_
-----------------------------------------------------------------------------------------------------------------

This makes sure node migrations not named as expected are detected
and rejected properly.

* Packages: ``Browser`` ``ContentRepository``

`TASK: Adjust Travis CI build matrix to use PHP 7.1+ <https://github.com/neos/neos-development-collection/pull/1842>`_
----------------------------------------------------------------------------------------------------------------------

As of https://github.com/neos/flow-development-collection/pull/1160
Flow requires PHP 7.1 or higher.

The master of Neos needs to follow, so this adjusts the Travis CI
build matrix to skip PHP 7.0.

Additionally it removes some options no longer needed, since the
required PostgreSQL versions are meanwhile available without any
use of sudo in the default container infrastructure, as shown in

- https://docs.travis-ci.com/user/reference/overview/#Virtualization-environments
- https://docs.travis-ci.com/user/database-setup/#Using-a-different-PostgreSQL-Version

`TASK: Tweak Travis CI build matrix <https://github.com/neos/neos-development-collection/pull/1841>`_
-----------------------------------------------------------------------------------------------------

This removes some options no longer needed, since the required PostgreSQL
versions are meanwhile available without any use of sudo in the default
container infrastructure, as shown in

- https://docs.travis-ci.com/user/reference/overview/#Virtualization-environments
- https://docs.travis-ci.com/user/database-setup/#Using-a-different-PostgreSQL-Version

`BUGFIX Inject missing ImageService into AssetService <https://github.com/neos/neos-development-collection/pull/1834>`_
-----------------------------------------------------------------------------------------------------------------------

PR #1597 has introduced a missing service injection. 

The ImageService is used but never injected into AssetService.

See: https://github.com/neos/neos-development-collection/blob/master/Neos.Media/Classes/Domain/Service/AssetService.php#L269

* Packages: ``Media`` ``Neos``

`TASK: Fix legacy mentions of TYPO3 in the documentation <https://github.com/neos/neos-development-collection/pull/1824>`_
--------------------------------------------------------------------------------------------------------------------------

Fixes documentation examples.

* Packages: ``Neos``

`BUGFIX: Load thumbs in media browser asynchronous <https://github.com/neos/neos-development-collection/pull/1825>`_
--------------------------------------------------------------------------------------------------------------------

When you open the media module with a lot of high-res images while the thumbnails are not already generated and cached, loading can take a long time without noticable feedback.

The templates use a setting not available since the media browser was split into it's own package. Instead the setting needs to be read from the Media package.

* Packages: ``Browser`` ``Neos``

`TASK: merge in labels from the new UI <https://github.com/neos/neos-development-collection/pull/1829>`_
--------------------------------------------------------------------------------------------------------

We need to bring all UI labels in one place again to allow them to be translated.
After this PR is merged, there'll be a follow-up PR to update the labels used there.

* Packages: ``Neos``

`TASK: define missing schema for the creation dialog elements <https://github.com/neos/neos-development-collection/pull/1827>`_
-------------------------------------------------------------------------------------------------------------------------------

The creation dialog has been introduced in the new UI, for more details
see here: https://github.com/neos/neos-ui/issues/1469

* Packages: ``Neos``

`BUGFIX: Initialize overrideConfiguration in Fusion <https://github.com/neos/neos-development-collection/pull/1823>`_
---------------------------------------------------------------------------------------------------------------------

Initialize ``overrideConfiguration`` as empty ``array`` so it's not ``null`` when passed to the form template.

* Packages: ``Form`` ``Neos``

`BUGFIX: Add missing dependency to Neos.NodeTypes.Form to Neos.NodeTypes <https://github.com/neos/neos-development-collection/pull/1819>`_
------------------------------------------------------------------------------------------------------------------------------------------

Add missing dependency for ``neos/nodetypes-form``

* Packages: ``Form`` ``NodeTypes``

`BUGFIX: Add index that should exist but does not <https://github.com/neos/neos-development-collection/pull/1786>`_
-------------------------------------------------------------------------------------------------------------------

Adds an index that should exist but is not picked up by Doctrine, and
thus was deleted by accident in 20170110130253.

See https://github.com/neos/neos-development-collection/pull/1375

* Packages: ``Neos``

`BUGFIX: Off-by-one error in FlashMessage parameters <https://github.com/neos/neos-development-collection/pull/1808>`_
----------------------------------------------------------------------------------------------------------------------

The title parameter was missing, so the other parameters were used in strange ways.

* Packages: ``Neos``

`BUGFIX: Add missing neos/form dependency <https://github.com/neos/neos-development-collection/pull/1816>`_
-----------------------------------------------------------------------------------------------------------

This dependency was forgotten in the NodeTypes split.

* Packages: ``Form`` ``Neos``

`Replace deprecated method tsValue with fusionValue <https://github.com/neos/neos-development-collection/pull/1817>`_
---------------------------------------------------------------------------------------------------------------------



* Packages: ``Neos``

`BUGFIX: Add missing default value for weight of InterDimension/ContentSubgraph <https://github.com/neos/neos-development-collection/pull/1813>`_
-------------------------------------------------------------------------------------------------------------------------------------------------

Without that accessing getWeight caused a TypeError if no dimensions were configured since the getWeight method enforces the return-type array.

* Packages: ``ContentRepository``

`BUGFIX: Add missing dependencies for Neos.NodeTypes.BaseMixins <https://github.com/neos/neos-development-collection/pull/1814>`_
---------------------------------------------------------------------------------------------------------------------------------

* Packages: ``AssetList`` ``BaseMixins`` ``ColumnLayouts`` ``ContentReferences`` ``Form`` ``Html`` ``Navigation`` ``Neos`` ``NodeTypes``

`BUGFIX: Require correct version of neos/flow-development-collection <https://github.com/neos/neos-development-collection/pull/1812>`_
--------------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`BUGFIX: Fix Flow version constraint for dev collection <https://github.com/neos/neos-development-collection/pull/1811>`_
-------------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`TASK: Adjust the RouteCacheAspect to work with recent changes in Flow-routing <https://github.com/neos/neos-development-collection/pull/1809>`_
------------------------------------------------------------------------------------------------------------------------------------------------

This extracts the part of https://github.com/neos/neos-development-collection/pull/1769 that is needed for neos to work with the adjusted flow-routing.

* Packages: ``Neos``

`BUGFIX: Synchronize \`\`.composer.json\`\` with \`\`composer.json\`\` <https://github.com/neos/neos-development-collection/pull/1805>`_
----------------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`BUGFIX: Fix Flow dev dependency for 3.2 <https://github.com/neos/neos-development-collection/pull/1804>`_
----------------------------------------------------------------------------------------------------------

Maybe we can automate that within the create-branch script

`BUGFIX: Fix Flow dev dependency for 3.1 <https://github.com/neos/neos-development-collection/pull/1803>`_
----------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`BUGFIX: Avoid error if no dimension is set in DimensionsMenuImplementation <https://github.com/neos/neos-development-collection/pull/1777>`_
---------------------------------------------------------------------------------------------------------------------------------------------

When using the DimensionsMenuImplementation without a set `dimension`
(yes, there are use cases for that, e.g. hreflang tags for language _and_
country), the following could happen:

    Call to a member function getLabel() on null

This change avoids that.

`TASK: Fix border-radius on button elements <https://github.com/neos/neos-development-collection/pull/1799>`_
-------------------------------------------------------------------------------------------------------------

On Chrome (macOS), all `<button>` elements had a `border-radius` of `4px`, which is now removed.


`BUGFIX: Thumbnail generation is broken if quality is not set <https://github.com/neos/neos-development-collection/pull/1798>`_
-------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Media`` ``Neos``

`TASK: Remove tooltip in the document and context tree <https://github.com/neos/neos-development-collection/pull/1774>`_
------------------------------------------------------------------------------------------------------------------------

null

* Packages: ``Neos``

`BUGFIX: Make sure nodes that are to be discarded are actually publishable <https://github.com/neos/neos-development-collection/pull/1711>`_
--------------------------------------------------------------------------------------------------------------------------------------------

`TYPO3\\Neos\\Service\\PublishingService` traverses all children of a node to discard that node recursively. Not all those nodes are actually publishable though, so the following batch discard operation fails with the Exception `#1395841899: Nodes in a in a workspace without a base workspace cannot be discarded`.

So, I added a filter to `TYPO3\\Neos\\Service\\PublishingService::discardNode` that removes all nodes from the to-be-discarded list, that are in a different workspace than the given node.

* Resolves: `#1710 <https://github.com/neos/neos-development-collection/issues/1710>`_

`FEATURE: Allow configuring route after login to backend <https://github.com/neos/neos-development-collection/pull/1794>`_
--------------------------------------------------------------------------------------------------------------------------

This is to allow switching to the new UI seemlessly but
also allows to set a completely different module to be used
after login.

* Packages: ``Neos``

`TASK: Exchange login wallpaper for version 3.3 <https://github.com/neos/neos-development-collection/pull/1792>`_
-----------------------------------------------------------------------------------------------------------------

Exchanged the login wallpaper with the one for 3.3. Cause of the uniform white and blur areas, I was able to compress more pixels int the same file size.

`TASK: Image adjustment for image quality <https://github.com/neos/neos-development-collection/pull/1788>`_
-----------------------------------------------------------------------------------------------------------

Add adjustment for the image quality that can be used to override the global configuration.
Sometimes you might want to add a preview image with lower quality as a thumbnail, but you couldn't. I added the quality property to Neos:ImageUri to make this possible.

    previewImageUri = Neos.Neos:ImageUri {
        asset = ${q(node).property('image')}
        maximumWidth = 2560
        maximumHeight = 1280
        quality = 25
    }

* Resolves: `#768 <https://github.com/neos/neos-development-collection/issues/768>`_
* Packages: ``Media`` ``Neos``

`FEATURE: Allow modification of uploaded assets based on node <https://github.com/neos/neos-development-collection/pull/1728>`_
-------------------------------------------------------------------------------------------------------------------------------

Introduces a signal `ContentController::assetUploaded` that
sends the currently selected `node` and the `siteNodeName`
along with the asset that's about to be persisted.

This allows the asset to be tagged or added to collections
based on the node type or path etc.

For example, the following slot would assign assets of an
`Employee` node type to the corresponding tag:

```php
public function theSlot(Asset $asset, NodeInterface $node, string $propertyName, string $siteNodeName)
{
    if (!$node->getNodeType()->isOfType('Some.Package:Employee') || $propertyName !== 'image') {
        return;
    }
    $tag = $this->tagRepository->findOneByLabel('Employee');
    if ($tag === null) {
        return;
    }
    $asset->addTag($tag);
}
```

* Resolves: `#893 <https://github.com/neos/neos-development-collection/issues/893>`_
* Packages: ``Neos``

`TASK: Allow to configure if processed images must be interlaced <https://github.com/neos/neos-development-collection/pull/1780>`_
----------------------------------------------------------------------------------------------------------------------------------

This change adds a new setting in the Media package to enable image interlacing.

It's disabled by default, but you can change the setting to one of the values in
`Neos.Media.image.defaultOptions.interlace`:

- `%\\Imagine\\Image\\ImageInterface::INTERLACE_NONE%` (default)
- `%\\Imagine\\Image\\ImageInterface::INTERLACE_LINE%`
- `%\\Imagine\\Image\\ImageInterface::INTERLACE_PLANE%`
- `%\\Imagine\\Image\\ImageInterface::INTERLACE_PARTITION%`

* Packages: ``Media``

`FEATURE: Support search by property & exact value in NodeDataRepository <https://github.com/neos/neos-development-collection/pull/1>`_
---------------------------------------------------------------------------------------------------------------------------------------

Currently it is only possible to search through the properties by
giving a string that matches for any key or value found in the
jsonified properties field.

With this change, the term can also be an array to match exactly on a
given key / value combination.
The search term could be given as `['key' => 'value']`.

NEOS-1460 #close

* Packages: ``Afx``

`FEATURE: Support search by property & exact value in NodeDataRepository <https://github.com/neos/neos-development-collection/pull/1>`_
---------------------------------------------------------------------------------------------------------------------------------------

Currently it is only possible to search through the properties by
giving a string that matches for any key or value found in the
jsonified properties field.

With this change, the term can also be an array to match exactly on a
given key / value combination.
The search term could be given as `['key' => 'value']`.

NEOS-1460 #close

`BUGFIX: Fix wrong TS path in extending pages example <https://github.com/neos/neos-development-collection/pull/1754>`_
-----------------------------------------------------------------------------------------------------------------------

Fix exception when following documentation about extending pages.

See detailed description and discussion on https://discuss.neos.io/t/1952

`BUGFIX: \`\`NodePropertyConverterService\`\` converts default values <https://github.com/neos/neos-development-collection/pull/1782>`_
---------------------------------------------------------------------------------------------------------------------------------------

Apply property mapping to default value fallbacks in ``NodePropertyConverterService``

* Resolves: `#1781 <https://github.com/neos/neos-development-collection/issues/1781>`_

`FEATURE: Split useful NodeTypes into separate packages <https://github.com/neos/neos-development-collection/pull/1659>`_
-------------------------------------------------------------------------------------------------------------------------

Move the more often used node type ContentReferences out of the NodeTypes package to allow separate usage without the more nasty parts of Neos.NodeTypes.

The Neos.NodeTypes package inherits Neos.NodeTypes:ContentReferences from Neos.NodeTypesContentReferences.:ContentReferences to provide backwards compability.

The Menu was renamed into Neos.NodeTypes.Navigation because Mac interprets ".Menu" folders as packages and I wanted to prevent any confusion.

The compromise is that we now have two NodeTypes with the same functionality (one of them abstract when the NodeTypes package is included). There should be a breaking change in Neos 4 to get rid of the old namespace.

* Packages: ``Neos`` ``NodeTypes``

`TASK: Adjust Neos to work with PHP 7.2 <https://github.com/neos/neos-development-collection/pull/1789>`_
---------------------------------------------------------------------------------------------------------

This enables PHP 7.2 testing on Travis CI, fixes a functional test that broke
and adjusts one actual code error.

* Packages: ``ContentRepository`` ``Neos``

`FEATURE: Upload/MediaBrowser flags in Image and Asset editor <https://github.com/neos/neos-development-collection/pull/1727>`_
-------------------------------------------------------------------------------------------------------------------------------

Adds two new feature flags, `upload` and `mediaBrowser` that
allow to hide respective buttons in the `Image` and `Asset`
editors.

Usage:

```yaml
'Some.Node:Type':
  properties:
    'someImageProperty':
      type: Neos\\Media\\Domain\\Model\\ImageInterface
      ui:
        inspector:
          editorOptions:
            features:
              # disable uploads through the editor directly
              upload: false
    'someAssetProperty':
      type: Neos\\Media\\Domain\\Model\\Asset
      ui:
        inspector:
          editorOptions:
            features:
              # allow assets only to be uploaded through the editor
              mediaBrowser: false
```

Background:

When uploading assets through the property editors, that happens
within the context of a selected node (unlike when it's added
through the media module). This allows us to assign the resulting
asset to a collection/tag based on the node type or path for
example.

* Related: `#893 <https://github.com/neos/neos-development-collection/issues/893>`_
* Related: `#1131 <https://github.com/neos/neos-development-collection/issues/1131>`_

* Packages: ``Neos``

`BUGFIX: CreateContentContextTrait should use the available SiteReposi… <https://github.com/neos/neos-development-collection/pull/1779>`_
-------------------------------------------------------------------------------------------------------------------------------------------

`TASK: Add generateUriPathSegments check identifier <https://github.com/neos/neos-development-collection/pull/1778>`_
---------------------------------------------------------------------------------------------------------------------

This adds the `generateUriPathSegments` identifier to the `node:repair`
help text.

`TASK: Make FusionRuntime available to Form Renderers <https://github.com/neos/neos-development-collection/pull/1765>`_
-----------------------------------------------------------------------------------------------------------------------

Adjusts the `Neos.NodeTypes:Form` Fusion prototype to make
the current `Fusion\\Runtime` available to the Form renderer
via the forms rendering options.

Background:

This is especially useful for forms that are rendererd with
the `neos/form-fusionrenderer` which, otherwise, can't re-use
Fusion prototypes that are not explicitly loaded.

For forms rendered with the `neos/form-builder`, the runtime
is already set.

* Packages: ``Media`` ``NodeTypes``

`FEATURE: Add fusion-prototypes \`Component\`, \`Editable\`, \`ContentComponent\` and \`Augmenter\`  <https://github.com/neos/neos-development-collection/pull/1752>`_
----------------------------------------------------------------------------------------------------------------------------------------------------------------------

The prototypes `Component`, `Editable`, `ContentComponent` and `Augmenter` are transfered from the package PackageFactory.AtomicFusion (https://github.com/PackageFactory/atomic-fusion) into the Neos-core.

- `Neos.Fusion:Component`: Create a component that adds all properties to the props context and afterward evaluates the renderer.
- `Neos.Neos:Editable`: Create an editable tag for a property. In the frontend, only the content of the property gets rendered.
- `Neos.Neos:ContentComponent`: Base type to render component based content nodes, extends `Neos.Fusion:Component`
- `Neos.Fusion:Augmenter`: Add html-attributes to renderer code as processor or as a standalone prototype.

In addition the class `\\Neos\\Neos\\Service\\HtmlAugmenter` was moved to `\\Neos\\Fusion\\Service\\HtmlAugmenter` with a deprecated backwards compatible layer.

* Packages: ``Neos`` ``NodeTypes``

`TASK: Use whole package key for generating site node name <https://github.com/neos/neos-development-collection/pull/1758>`_
----------------------------------------------------------------------------------------------------------------------------

**What I did**

Refactor the siteNodeName generation. It is now based on the complete package key.
Also i did some code cleanup.

**How to verify it**

Simple use the `./flow kickstart:site` command. You can verify the siteNodeName inside the generated `Resources/Private/Content/Sites.xml`

* Packages: ``SiteKickstarter``

`TASK: Fix remove a selectbox option from an existing Node Type documentation <https://github.com/neos/neos-development-collection/pull/1761>`_
-----------------------------------------------------------------------------------------------------------------------------------------------

Based on this post: https://discuss.neos.io/t/solved-remove-properties-from-nodetype-of-included-package/2751/6

`BUGFIX: Long string literals should be supported in Fusion <https://github.com/neos/neos-development-collection/pull/1755>`_
-----------------------------------------------------------------------------------------------------------------------------

The regex matcher would halt with a catastrophic backtracing error 
if a very long string was given as string literal.

`BUGFIX: Fix wrong target class in RouteCacheAspect <https://github.com/neos/neos-development-collection/pull/1768>`_
---------------------------------------------------------------------------------------------------------------------

This fixes #1767 by changing the vendor name from TYPO3 to Neos in
the `RouteCacheAspect` in one place where it was obviously overlooked.

* Packages: ``Neos``

`BUGFIX: Support namespaces in fusion-dsls <https://github.com/neos/neos-development-collection/pull/1753>`_
------------------------------------------------------------------------------------------------------------

The declared Namespaces are now transferred to the parser that handles fusion-dsl's. Previously the returned dsl-code could not use namespaces. 

* Packages: ``Fusion``

`FEATURE: Support search by property & exact value in NodeDataRepository <https://github.com/neos/neos-development-collection/pull/1>`_
---------------------------------------------------------------------------------------------------------------------------------------

Currently it is only possible to search through the properties by
giving a string that matches for any key or value found in the
jsonified properties field.

With this change, the term can also be an array to match exactly on a
given key / value combination.
The search term could be given as `['key' => 'value']`.

NEOS-1460 #close

* Packages: ``Afx``

`FEATURE: Support search by property & exact value in NodeDataRepository <https://github.com/neos/neos-development-collection/pull/1>`_
---------------------------------------------------------------------------------------------------------------------------------------

Currently it is only possible to search through the properties by
giving a string that matches for any key or value found in the
jsonified properties field.

With this change, the term can also be an array to match exactly on a
given key / value combination.
The search term could be given as `['key' => 'value']`.

NEOS-1460 #close

`[TASK] "Custom Backend Module" documentation <https://github.com/neos/neos-development-collection/pull/19>`_
-------------------------------------------------------------------------------------------------------------

* Packages: ``Afx``

`[TASK] "Custom Backend Module" documentation <https://github.com/neos/neos-development-collection/pull/19>`_
-------------------------------------------------------------------------------------------------------------

`TASK: Add 2.3.17 changelog <https://github.com/neos/neos-development-collection/pull/1749>`_
---------------------------------------------------------------------------------------------

`BUGFIX: Assets used in moved nodes don't break media module asset view <https://github.com/neos/neos-development-collection/pull/1743>`_
-----------------------------------------------------------------------------------------------------------------------------------------

Prevent assets referenced in moved nodes from breaking the asset view in the media module.

* Fixes: `#1742 <https://github.com/neos/neos-development-collection/issues/1742>`_

`BUGFIX: Update publish button when copying page in node tree <https://github.com/neos/neos-development-collection/pull/1740>`_
-------------------------------------------------------------------------------------------------------------------------------

Make sure the publish button is updated so the new changes can be published.
Additionally selects the newly copied page similar to when inserting a new document.

* Resolves: `#914 <https://github.com/neos/neos-development-collection/issues/914>`_

`BUGFIX: Avoid Request URI Too Large when loading asset metadata <https://github.com/neos/neos-development-collection/pull/1748>`_
----------------------------------------------------------------------------------------------------------------------------------

When using too many assets in the inspector (AssetEditor), an error is
triggered, caused by the request URI becoming too long.

This change switches the request to a POST request. The data is sent as
the request body and the issue is solved.

* Fixes: `#1747 <https://github.com/neos/neos-development-collection/issues/1747>`_

`TASK: Streamline role selection for new user view <https://github.com/neos/neos-development-collection/pull/1744>`_
--------------------------------------------------------------------------------------------------------------------

Streamlines the role selection layout for create new user view with
edit user account view.

* Packages: ``Neos``

`BUGFIX: Shortcut nodes result in 404 if target is unavailable <https://github.com/neos/neos-development-collection/pull/1669>`_
--------------------------------------------------------------------------------------------------------------------------------

A non existing (or hidden) target node would result in an infinite
redirect chain but should actually result in a 404 error delivered.

* Fixes: `#1668 <https://github.com/neos/neos-development-collection/issues/1668>`_

`TASK: improve language <https://github.com/neos/neos-development-collection/pull/1734>`_
-----------------------------------------------------------------------------------------

`TASK: Adds a hint that \`@context\` cant access context variables on the same level <https://github.com/neos/neos-development-collection/pull/1733>`_
------------------------------------------------------------------------------------------------------------------------------------------------------

see https://neos-project.slack.com/archives/C050C8FEK/p1509054474000170

* Packages: ``Neos``

`Update FeatureList.rst <https://github.com/neos/neos-development-collection/pull/1724>`_
-----------------------------------------------------------------------------------------

fixed spelling

* Packages: ``Neos``

`BUGFIX: Show object in "missing template" message <https://github.com/neos/neos-development-collection/pull/1736>`_
--------------------------------------------------------------------------------------------------------------------

The sprintf() call should only get one parameter, usage of the first
one was dropped inside the message text previously.

`MERGE: Merge branch '3.1' into 3.2 <https://github.com/neos/neos-development-collection/pull/1739>`_
-----------------------------------------------------------------------------------------------------

* Packages: ``ContentRepository`` ``Fusion`` ``Neos``

`MERGE: Merge branch '3.0' into 3.1 <https://github.com/neos/neos-development-collection/pull/1738>`_
-----------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`TASK: Fix content cache tests after upmerge from 2.3 <https://github.com/neos/neos-development-collection/pull/1737>`_
-----------------------------------------------------------------------------------------------------------------------

* Packages: ``Fusion``

`BUGFIX: Allow cached content segments to be nested within dynamic ones <https://github.com/neos/neos-development-collection/pull/1664>`_
-----------------------------------------------------------------------------------------------------------------------------------------

Previously when nesting content with Content Cache mode `cached` within
segments with Content Cache mode `dynamic` the `CONTENT_CACHE` markers
weren't replaced at the second rendering.

* Fixes: `#1591 <https://github.com/neos/neos-development-collection/issues/1591>`_

`BUGFIX: Fixing wrong path in documentation to translations folder <https://github.com/neos/neos-development-collection/pull/1694>`_
------------------------------------------------------------------------------------------------------------------------------------

Like https://github.com/neos/neos-development-collection/pull/1566 but for older branch.

* Packages: ``Neos``

`FEATURE: Asset Constraints <https://github.com/neos/neos-development-collection/pull/1723>`_
---------------------------------------------------------------------------------------------

This introduces the following Privileges:

* `ReadAssetPrivilege`
* `ReadTagPrivilege`
* `ReadAssetCollectionPrivilege`

see added documentation.

Note:
The code for this change has been taken from
https://github.com/bwaidelich/Wwwision.AssetConstraints

* Packages: ``Media`` ``Neos``

`TASK: Remove TYPO3 from Neos Fusion Reference <https://github.com/neos/neos-development-collection/pull/1725>`_
----------------------------------------------------------------------------------------------------------------

**What I did**

Removed TYPO3 from fusion reference

* Packages: ``Neos``

`TASK: Update Code of Conduct <https://github.com/neos/neos-development-collection/pull/1722>`_
-----------------------------------------------------------------------------------------------

* Packages: ``Neos``

`FEATURE: Introduce command to remove unused assets <https://github.com/neos/neos-development-collection/pull/1720>`_
---------------------------------------------------------------------------------------------------------------------

This command iterates over all existing assets, checks their usage count
and lists the assets which are not reported as used by any AssetUsageStrategies.
The unused assets can than be removed.

### Example command output (with unused assets): 
```
Searching for unused assets:
 12/12 [============================] 100%
Found the following unused assets:
- 2a2952ce-ba38-45bc-9b88-03d013831fd6 (Bildschirmfoto 2016-11-01 um 14.14.15.png)
- 5279fcc0-4557-4033-be66-5fbe766aa2e2 (Bildschirmfoto 2016-11-01 um 14.11.43.png)
- 5890c270-9f35-4327-8876-46388403bacf (Bildschirmfoto 2016-11-01 um 14.14.57.png)
Do you want to remove 3 unused assets?y
 3/3 [============================] 100%
```

### Example command output (without unused assets):
```
./flow media:removeunused
Searching for unused assets:
 9/9 [============================] 100%
No unused assets found.
```

* Packages: ``Media``

`TASK: Allow using the context variable in node privileges <https://github.com/neos/neos-development-collection/pull/1661>`_
----------------------------------------------------------------------------------------------------------------------------

This makes it possible to access global objects via the context variable in node privileges.

For example this can be used to hide nodes based on a node property which needs to
match a username or group. One use case is to have several sites in one Neos and restrict
each user to one site.

How it works: The values given to the `ConditionGenerator` of the node privileges are
first put through `getValueForOperand` instead of treating them just as string.

* Packages: ``ContentRepository`` ``Neos``

`TASK: Replaced "wrong" quotation marks <https://github.com/neos/neos-development-collection/pull/1716>`_
---------------------------------------------------------------------------------------------------------

We have open/close quotation marks (””) in code examples so i replaced them with normal ("") quotation marks.

**What I did**
Replaced quotation marks

* Packages: ``Neos``

`TASK: Fix wrong comment <https://github.com/neos/neos-development-collection/pull/1719>`_
------------------------------------------------------------------------------------------

* Packages: ``Fusion``

`BUGFIX: Fix NodeType schema to pass validation <https://github.com/neos/neos-development-collection/pull/1702>`_
-----------------------------------------------------------------------------------------------------------------

In #1678 childNodes were allowed to be nullable. But the way the schema
was adjusted did not pass validation. This change fixes it.

`BUGFIX: Allow childNode definitions to be reset <https://github.com/neos/neos-development-collection/pull/1678>`_
------------------------------------------------------------------------------------------------------------------

A NodeType can reset the `childNode` definitions of a
superType by setting it to `null`:

```yaml
'Some:NodeType':
  superTypes:
    'Some:Other.NodeType': true
  childNodes:
    'someChildNodes': ~
```

But doing so lead to a schema error.
This patch adjusts the schema accordingly.

`TASK: Use interface to inject NodeSearchService in NodeController <https://github.com/neos/neos-development-collection/pull/1692>`_
------------------------------------------------------------------------------------------------------------------------------------

This makes it possible to use your own implementation of the NodeSearchService.

`BUGFIX: Register pending change must be called during editor init <https://github.com/neos/neos-development-collection/pull/1629>`_
------------------------------------------------------------------------------------------------------------------------------------

This change makes sure editor listeners are called in the init of the editor. This can help in situations like hiding an editor based on depending properties on the first page load or inspector initialization.

`TASK: Replace occurrences of TypoScript in fusion file comments <https://github.com/neos/neos-development-collection/pull/1693>`_
----------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`TASK: Make Fusion file inclusion docs more clear <https://github.com/neos/neos-development-collection/pull/1671>`_
-------------------------------------------------------------------------------------------------------------------

Based on input from Aftab, improved the clarity of this docs section.

* Packages: ``Neos``

`TASK: Explain how to disable NodeTypes in documentation <https://github.com/neos/neos-development-collection/pull/1680>`_
--------------------------------------------------------------------------------------------------------------------------

This adds documentation about how to disable NodeTypes. This was discussed
in https://github.com/neos/neos-development-collection/issues/1674

* Packages: ``Neos``

`TASK: Fix documentation of Debug Object <https://github.com/neos/neos-development-collection/pull/1682>`_
----------------------------------------------------------------------------------------------------------

Example is missing the namespace.

`BUGFIX: Set empty array for overrideConfiguration as default <https://github.com/neos/neos-development-collection/pull/1690>`_
-------------------------------------------------------------------------------------------------------------------------------

To prevent errors within the form view helper it's necessary to set `overrideConfiguration` as array per default instead of null. The change of the signature of the form view helper has made this change necessary:
https://github.com/neos/form/commit/`0cac9ef02043c9ae5e25eb41a7f746ba75e80f2d <https://github.com/neos/neos-development-collection/commit/0cac9ef02043c9ae5e25eb41a7f746ba75e80f2d>`_

The default tempate just by-pass the `overrideConfiguration`:
https://github.com/neos/neos-development-collection/blob/3.0/Neos.NodeTypes/Resources/Private/Templates/NodeTypes/Form.html

* Packages: ``Neos`` ``NodeTypes``

`BUGFIX: Add missing feature to release notes <https://github.com/neos/neos-development-collection/pull/1688>`_
---------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`TASK: Remove old changelogs <https://github.com/neos/neos-development-collection/pull/1687>`_
----------------------------------------------------------------------------------------------

* Packages: ``Neos``

`TASK: Final release related adjustments for 3.2 <https://github.com/neos/neos-development-collection/pull/1686>`_
------------------------------------------------------------------------------------------------------------------

* Packages: ``ContentRepository`` ``Fusion`` ``Neos``

`TASK: Exchange login wallpaper for version 3.2 <https://github.com/neos/neos-development-collection/pull/1679>`_
-----------------------------------------------------------------------------------------------------------------

Exchange the login wallpaper vor version 3.2. 
As the image is very good compressible, I chose a width of 2400 px this time.

* Packages: ``Neos`` ``SiteKickstarter``

`BUGFIX: Build correct paths to nodes with hidden parents <https://github.com/neos/neos-development-collection/pull/1654>`_
---------------------------------------------------------------------------------------------------------------------------

If a node is visible but lies beneath a hidden parent, the URI path
generated for that node had "holes" and did not work. This adjusts the
route part handler to return the complete URI including the URI path
segments of hidden nodes in the chain up to the site node.

To disallow showing a node actually hidden itself has to be ensured
in matching a request path, not in building one.

`FEATURE: Allow non-uuid node identifiers <https://github.com/neos/neos-development-collection/pull/1477>`_
-----------------------------------------------------------------------------------------------------------

This replaces all occurrences of node identifier validation against the UUID pattern with a validation against a less restrictive NodeIdentifier pattern

In addition to removing the restriction that characters have to appear in a specific order, it also allows all other lowercase characters.

* Packages: ``ContentRepository`` ``Fusion``

`BUGFIX: Allow Prototype names starting with digits <https://github.com/neos/neos-development-collection/pull/1656>`_
---------------------------------------------------------------------------------------------------------------------

Prototype declarations starting with digits previously were wrongly
parsed and resulted in broken names, this change fixes it by only
casting numeric strings to integers as object keys.

* Fixes: `#1114 <https://github.com/neos/neos-development-collection/issues/1114>`_ 

`BUGFIX: TypoScriptView should set response headers correctly <https://github.com/neos/neos-development-collection/pull/1653>`_
-------------------------------------------------------------------------------------------------------------------------------

The httpVersion which could be set in the `ResponseHeadImplementation`
was not used.

Additionally, if a header had multiple values (which can easily be done in
TypoScript via RawArray) only the first header was actually transferred to
the sent HTTP response.

`TASK: Rework CacheSegmentParser to a recursive pattern <https://github.com/neos/neos-development-collection/pull/683>`_
------------------------------------------------------------------------------------------------------------------------

Rewrite the internals of the CacheSegmentParser to use a recursive
approach which should safe some memory and makes the code more readable.
Also refactors common logic for fetching tokens and content to methods
to avoid code duplication.

Additionally adds calculation of uncached segments in the currently parsed
content to make solid cache entries (full page cache) possible.

* Packages: ``Fusion``

`FEATURE: Allow to select all changes in a document with one click <https://github.com/neos/neos-development-collection/pull/1657>`_
------------------------------------------------------------------------------------------------------------------------------------

The workspace module shows changes grouped by document, but until now
there it was only possible to select individual or all changes for
further action.

This change adds the possibility to select all changes on a document
with a single click.

* Packages: ``Neos``

`FEATURE: Allow setting authentication provider on new user creation in user backend module <https://github.com/neos/neos-development-collection/pull/612>`_
------------------------------------------------------------------------------------------------------------------------------------------------------------

Allow setting authentication provider on new user creation in user backend module.

If less then two providers are given, the selector does not appear and the default authentication provider is used. Same as no authentication provider is explicit selected.

* Packages: ``Media`` ``Neos``

`TASK: Keep asset adjustments if asset size did not change <https://github.com/neos/neos-development-collection/pull/1597>`_
----------------------------------------------------------------------------------------------------------------------------

This adds a condition to compare the size of the old and new asset in order to verify
the size did not change. In this case the method `refit()` will not be executed to keep
asset adjustments. This is very handy if you upload/replace a image with enriched
meta data (eg. IPTC or Exif.)

* Packages: ``ContentRepository`` ``Media``

`BUGFIX: Fix nodetype thumbnail path in NodeTypeDefinition.rst <https://github.com/neos/neos-development-collection/pull/1652>`_
--------------------------------------------------------------------------------------------------------------------------------

corrected path in documentation for thumbnail of nodetype

`TASK: Don't cache dynamic segments with disabled \`entryDiscriminator\` <https://github.com/neos/neos-development-collection/pull/1633>`_
------------------------------------------------------------------------------------------------------------------------------------------

With this change the caching can be disabled by setting the `entryDiscriminator`
to `false` when using Content Cache mode `dynamic`.

Previously a cache entry was created anyways with the `entryDiscriminator` casted
to an (in this case empty) string.

Background:
The Content Cache mode `dynamic` was introduced in order to allow for more flexible
caching behaviors depending on the context.
But one important feature did not work yet: Being able to *disable* the cache
for certain requests.
With this change performance can be improved by caching the display of an interactive
element (i.e. cache Forms for GET requests)

* Related: `#1630 <https://github.com/neos/neos-development-collection/issues/1630>`_

`TASK: Ignore preset value if \`\`false\`\` <https://github.com/neos/neos-development-collection/pull/1648>`_
-------------------------------------------------------------------------------------------------------------

Until now the ``ImageUri`` prototype would return no image if the preset was set to ``false`` (only accepted fallback until now was ``null``). With this change it's also possible to reset the preset with ``false``.

* Packages: ``Neos``

`BUGFIX: Moving node back and forth in nested workspace causes SQL error <https://github.com/neos/neos-development-collection/pull/1640>`_
------------------------------------------------------------------------------------------------------------------------------------------

This change fixes a problem in the content repository which can lead to a uniqueness constraint error when a node is moved back and forth in a nested workspace.

* Fixes: `#1639 <https://github.com/neos/neos-development-collection/issues/1639>`_ 

`BUGFIX: Prevent space if no css class is given <https://github.com/neos/neos-development-collection/pull/1650>`_
-----------------------------------------------------------------------------------------------------------------

If no `attributes.class` is given the attribute always starts with space. Like that the attributes get trimmed.

### Output before:
`class=" foo-bar-content"`

### Output after:
`class="foo-bar-content"`

`BUGFIX: Valid URLs with \`supportEmptySegmentForDimensions\` <https://github.com/neos/neos-development-collection/pull/1645>`_
-------------------------------------------------------------------------------------------------------------------------------

Makes sure that generated URLs observe the setting.

* Fixes: `#1644 <https://github.com/neos/neos-development-collection/issues/1644>`_

`BUGFIX: cut off long-form processor syntax in ContentElementWrappingImplementation <https://github.com/neos/neos-development-collection/pull/1635>`_
-----------------------------------------------------------------------------------------------------------------------------------------------------

In the change https://github.com/neos/neos/commit/`c4f64615297503b5577e5c863758d2a9b480433d <https://github.com/neos/neos-development-collection/commit/c4f64615297503b5577e5c863758d2a9b480433d>`_,
the default @process.contentElementWrapping on Neos.Neos:Content was changed from
@process.contentElementWrapping to the long form
"@process.contentElementWrapping.expression" (so it was possible to specify
a position).

However, this meant the Fusion path in Frontend for such an element was calculated wrongly;
It appended __meta/process/contentElementWrapping/expression<Neos.Neos:ContentElementWrapping>
to the fusionPath in the DOM.

For the "old" Neos (ember-based) UI, everything works pretty much as expected (it's
quite hard to construct a scenario where this would trigger an actual bug); but
the new React UI gets confused with rendering the element when the Fusion path is wrong.
And as it is a core bug, let's fix it in the core.

* Packages: ``Neos``

`BUGFIX: Trigger ContentCacheFlusher on asset update <https://github.com/neos/neos-development-collection/pull/1646>`_
----------------------------------------------------------------------------------------------------------------------

The content cache does not invalidate on changes to an asset. Expected behavior would be to flush the content cache on changes to an asset (e.g title, caption).

Neos 2.3 PR of: https://github.com/neos/neos-development-collection/pull/1636

`BUGFIX: Hide disabled modules in submodule overviews <https://github.com/neos/neos-development-collection/pull/1643>`_
-----------------------------------------------------------------------------------------------------------------------

When a module has been disabled using the `disabled` flag, the module is hidden from the main menu and cannot be accessed, however it was still being displayed in submodule overviews.

* Packages: ``Neos``

`FEATURE: Add ModulePrivilege to protect Neos Backend modules <https://github.com/neos/neos-development-collection/pull/1542>`_
-------------------------------------------------------------------------------------------------------------------------------

Introduces a new Privilege `ModulePrivilege` that should be used to
access-protect Neos Backend modules.

Usage:

    privilegeTargets:

      'Neos\\Neos\\Security\\Authorization\\Privilege\\ModulePrivilege':

        'SomePrivilegeTargetIdentifier':
          matcher: 'module/path'

This new privilege will be used to hide links to inaccessible modules
in the Backend. Furthermore they automatically protect access to all
actions of the configured controller of the affected module.

Setting a `privilegeTarget` in the module settings is still supported
but deprecated as of Neos 3.2.

* Related: `#964 <https://github.com/neos/neos-development-collection/issues/964>`_
* Packages: ``Neos``

`[TASK] Add composer manifest template <https://github.com/neos/neos-development-collection/pull/17>`_
------------------------------------------------------------------------------------------------------

Adds the template composer.json used to autogenerate
the joined composer.json for this joined repository.

* Packages: ``Afx``

`[TASK] Add composer manifest template <https://github.com/neos/neos-development-collection/pull/17>`_
------------------------------------------------------------------------------------------------------

Adds the template composer.json used to autogenerate
the joined composer.json for this joined repository.

`FEATURE: HtmlAugmenter will augment plaintext with the given fallback-tag <https://github.com/neos/neos-development-collection/pull/1638>`_
--------------------------------------------------------------------------------------------------------------------------------------------

If plaintext is given to the html augmenter now uses the fallback-tag
as it already does if multiple tags are found on the same level.

This fixed the problem of contents not beeing selectable in the backend 
if no tags are found but just some text.

* Packages: ``Neos``

`[FEATURE] Use headers from plugin response in parent response <https://github.com/neos/neos-development-collection/pull/16>`_
------------------------------------------------------------------------------------------------------------------------------

Enables possibility of server-side redirects, triggered within
a plugin e.g. after successful frontend login.

* Packages: ``Afx``

`[FEATURE] Use headers from plugin response in parent response <https://github.com/neos/neos-development-collection/pull/16>`_
------------------------------------------------------------------------------------------------------------------------------

Enables possibility of server-side redirects, triggered within
a plugin e.g. after successful frontend login.

`BUGFIX: Trigger ContentCacheFlusher on asset update <https://github.com/neos/neos-development-collection/pull/1636>`_
----------------------------------------------------------------------------------------------------------------------

The content cache does not invalidate on changes to an asset. Expected behavior would
be to flush the content cache on changes to an asset (e.g title, caption).

* Packages: ``Neos``

`[BUGFIX] Add inversedBy attribute to association <https://github.com/neos/neos-development-collection/pull/14>`_
-----------------------------------------------------------------------------------------------------------------

When running a doctrine:validate an error is shown for the Tag model
since it does not contain the required inversedBy attribute. This
change fixes that by adding it.

* Fixes: `NEOS-1507 <https://jira.neos.io/browse/NEOS-1507>`_
* Packages: ``Afx``

`[BUGFIX] Add inversedBy attribute to association <https://github.com/neos/neos-development-collection/pull/14>`_
-----------------------------------------------------------------------------------------------------------------

When running a doctrine:validate an error is shown for the Tag model
since it does not contain the required inversedBy attribute. This
change fixes that by adding it.

* Fixes: `NEOS-1507 <https://jira.neos.io/browse/NEOS-1507>`_

`FEATURE: Add \`async\` flag to the \`Neos.Neos:ImageUri\` and \`Neos.Neos:ImageTag\` fusion-objects <https://github.com/neos/neos-development-collection/pull/1637>`_
----------------------------------------------------------------------------------------------------------------------------------------------------------------------

Adds support for generating asynchronous image URIs in case the requested image does
not exist already. The feature is already supported in the `ImageViewHelper` but was missing
in the fusion objects.

This works as follows:

- If a resource still has to be processed a /media/thumbnail-uri is rendered that will do the
  actual processing and return the image.
- Later if the resource is already processed the _Resource-uri is rendered as previously.

* Packages: ``Neos``

`[TASK] Record owner of created workspaces <https://github.com/neos/neos-development-collection/pull/15>`_
----------------------------------------------------------------------------------------------------------

This records the owner of Workspace instances as they are created.

No owner will be recorded for "system" workspaces like the "live"
workspace.

* Packages: ``Afx``

`[TASK] Record owner of created workspaces <https://github.com/neos/neos-development-collection/pull/15>`_
----------------------------------------------------------------------------------------------------------

This records the owner of Workspace instances as they are created.

No owner will be recorded for "system" workspaces like the "live"
workspace.

`BUGFIX: Set default value for event uid on PostgreSQL <https://github.com/neos/neos-development-collection/pull/1620>`_
------------------------------------------------------------------------------------------------------------------------

It seems that the default value set previously does not survive
renaming the sequence. This leads to errors when events are to be
persisted.

This change adds the expected default value (back).

* Packages: ``Neos``

`BUGFIX: Use strict comparison to avoid nesting level error <https://github.com/neos/neos-development-collection/pull/1627>`_
-----------------------------------------------------------------------------------------------------------------------------

Comparing objects in Fluid templates using `==` may lead to "nesting
level too deep" errors, depending on the objects being compared.

This change adjusts all non-strict comparisons against strict ones.

* Fixes: `#1626 <https://github.com/neos/neos-development-collection/issues/1626>`_
* Packages: ``Browser`` ``Neos``

`BUGFIX: Skip apply change handler if the editor is undefined <https://github.com/neos/neos-development-collection/pull/1628>`_
-------------------------------------------------------------------------------------------------------------------------------

This change fix a JS console error, when ember try to call _applyChangeHandler
on property like _nodeType, because this property is not really an editor.

`BUGFIX: Correct merge of RelatedNodes template/xliff <https://github.com/neos/neos-development-collection/pull/1624>`_
-----------------------------------------------------------------------------------------------------------------------

This moves added labels to the Neos.Media.Browser package and adjusts
the RelatedNodes.html template as needed.

Some german translations are moved as well.

Related to `d5824fd4097bb658d22d0abc633ce68341c735c1 <https://github.com/neos/neos-development-collection/commit/d5824fd4097bb658d22d0abc633ce68341c735c1>`_ and the merge in
`00f07ee986fcecf284f3548dc8b687780ccdb272 <https://github.com/neos/neos-development-collection/commit/00f07ee986fcecf284f3548dc8b687780ccdb272>`_.

* Packages: ``Browser`` ``Neos``

`BUGFIX: Publish moved nodes in nested workspaces <https://github.com/neos/neos-development-collection/pull/1609>`_
-------------------------------------------------------------------------------------------------------------------

This change contains a fix and additional Behat tests which solves an issue with moving and publishing nodes in a nested workspace scenario which can lead to data corruption in the content repository.

* Resolves: `#1608 <https://github.com/neos/neos-development-collection/issues/1608>`_ 

`BUGFIX: Fix missing translation for inspector file uploads <https://github.com/neos/neos-development-collection/pull/1621>`_
-----------------------------------------------------------------------------------------------------------------------------

This changes the occurrences of `Neos.Neos:Main:upload` to `Neos.Neos:Main:choose` in Settings.yaml, as this has been the label formerly used for upload-related Inspector editors.

The label `Neos.Neos:Main:upload` does not seem to exist currently, so the tooltips above upload buttons in the Inspector haven't been translated.

**What I did**
Fix the missing translation for the upload buttons in the image and asset inspector editors.

**How I did it**
Change all occurrences of `Neos.Neos:Main:upload` to `Neos.Neos:Main:choose` in Settings.yaml.

**How to verify it**

Hover above the upload Button of the image editor. Without this change, the tooltip contains the fallback label "Upload file" in every language. 

* Packages: ``Neos``

`BUGFIX: NodeData property exists even if set to NULL <https://github.com/neos/neos-development-collection/pull/1211>`_
-----------------------------------------------------------------------------------------------------------------------

Even if the property is set to `null` `AbstractNodeData::hasProperty()` should return `true`.

`FEATURE: Fallback graph visualization <https://github.com/neos/neos-development-collection/pull/1476>`_
--------------------------------------------------------------------------------------------------------

The content repository is extended by two essential features,

* The Intra Dimensional Fallback Graph
* The Inter Dimensional Fallback Graph

which are supposed to be used for graph-aware projections in future versions.

These can be populated in-memory from the registered ``DimensionPresetSourceInterface`` by an application service and thus provide a read-only interface for applications in need of fallback logic.

In addition, Neos is extended by a backend module that visualizes these fallbacks.
They are displayed as an interactive graph using SVG and vanilla JS.

This can be tested/verified by setting up an arbitrary dimension configuration and visiting the Dimensions administration module

* Packages: ``Neos``

`FEATURE: Add extension point for domain specific languages to fusion <https://github.com/neos/neos-development-collection/pull/1495>`_
---------------------------------------------------------------------------------------------------------------------------------------

DSLs are implemented for fusion-assignments using the tagged-template-string syntax of es6.
DSL-identifiers are configured in the configuration key `Neos.Fusion.dsl`. The configured objects must satisfy the `DslInterface` and return fusion code that is parsed by the fusion-parser afterwards.

```
value = dslExample`... the code that is passed to the dsl ...`
```
In addition this pr adds a schema for the fusion part of the Settings and integrates it into the automatic schema-validation.

- [x] Code follows the PSR-2 coding style
- [x] Tests have been created, run and adjusted as needed
- [x] The PR is created against the `lowest maintained branch <https://www.neos.io/features/release-roadmap.html>`_

* Packages: ``Neos``

`BUGFIX: Detect asset://so-me-uu-id links in node properties <https://github.com/neos/neos-development-collection/pull/1576>`_
------------------------------------------------------------------------------------------------------------------------------

To detect links to assets as "usage" in the media management, the
search in the NodeDataRepository is amended as needed.

* Fixes: `#1575 <https://github.com/neos/neos-development-collection/issues/1575>`_

`BUGFIX: Only show link to accessible nodes <https://github.com/neos/neos-development-collection/pull/1579>`_
-------------------------------------------------------------------------------------------------------------

Fixed some misleading text on the listing page and added i18n.

related to #1578.

for 3.x upmerge have a look at https://github.com/ComiR/neos-development-collection/commit/`e2d0e44dd6f21179b2e9eeeac1481ae3a4f8a3f6 <https://github.com/neos/neos-development-collection/commit/e2d0e44dd6f21179b2e9eeeac1481ae3a4f8a3f6>`_.

`BUGFIX: render asset changes correctly in workspaces overview <https://github.com/neos/neos-development-collection/pull/1605>`_
--------------------------------------------------------------------------------------------------------------------------------

This change fixes asset rendering in the workspace overview.

* Fixes: `#1592 <https://github.com/neos/neos-development-collection/issues/1592>`_.

`TASK: Fix code example in CustomTypoScriptObjects docs <https://github.com/neos/neos-development-collection/pull/1619>`_
-------------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`BUGFIX: Avoid orphaned content nodes when calling publishNode() <https://github.com/neos/neos-development-collection/pull/1618>`_
----------------------------------------------------------------------------------------------------------------------------------

This changes an issue with using the `PublishingService::publishNode()`
which can result in an inconsistent structure in a user's workspace.

This change also changes the behavior of `PublishingService::discardNode()`
which now will also discard content of a given document node to protect
consistency.

Document nodes and their content must be published or discarded together
in order to protect against inconsistencies when the document node is
moved or removed in one of the base workspaces.

* Fixes: `#1617 <https://github.com/neos/neos-development-collection/issues/1617>`_

`BUGFIX: Behat tests fail with fresh checkout <https://github.com/neos/neos-development-collection/pull/1616>`_
---------------------------------------------------------------------------------------------------------------

This change fixes an issue with failing Behat tests caused by
missing isolation between tests.

When certain tests were run in a specific order, they might fail
with an access denied error because no user is authenticated.

* Fixes: `#1613 <https://github.com/neos/neos-development-collection/issues/1613>`_

`BUGFIX: Use null, not empty string in Workspace->setOwner <https://github.com/neos/neos-development-collection/pull/1611>`_
----------------------------------------------------------------------------------------------------------------------------

A workspace having an owner of `null` (plus some other factors) is considered
an internal workspace. This change makes sure the owner is set to null if an
empty string is passed to `setOwner()`.

* Fixes: `#1610 <https://github.com/neos/neos-development-collection/issues/1610>`_

`BUGFIX: Nodes are inaccessible after base workspace switch <https://github.com/neos/neos-development-collection/pull/1603>`_
-----------------------------------------------------------------------------------------------------------------------------

This change fixes a problem with the routing cache which results in
inaccessible document nodes for cases where nodes with different
identifiers but the same URI path exist in separate workspaces.

* Fixes: `#1602 <https://github.com/neos/neos-development-collection/issues/1602>`_

`TASK: Remove further TypoScript references <https://github.com/neos/neos-development-collection/pull/1583>`_
-------------------------------------------------------------------------------------------------------------

This removes even more uses of TypoScript from various places in the codebase:

- TASK: Rename typoScriptPath to fusionPath in FE/BE interaction
- TASK: Fusion RenderViewHelper adjustments
- TASK: Rename BaseTypoScript.fusion test fixture to Base.fusion
- TASK: Remove unused NoTypoScriptConfigurationException
- TASK: Remove TypoScript from internal variable/function names

* Packages: ``Neos``

`BUGFIX: Reset broken properties to array <https://github.com/neos/neos-development-collection/pull/1601>`_
-----------------------------------------------------------------------------------------------------------

If the content of the `properties` property cannot be decoded from JSON
correctly, it will be `null`. This leads to errors when any operation is done
that expects it to always be an array.

This change adds a PostLoad Doctrine lifecycle method to reset `properties`
to an empty array if it is `null` after reconstitution.

Fixes issue #1580

`BUGFIX: Add missing namespace import in AssetService <https://github.com/neos/neos-development-collection/pull/1598>`_
-----------------------------------------------------------------------------------------------------------------------

This adds a missing namespace import for `Uri` after the upmerge of #1574.

* Packages: ``Media`` ``Neos``

`BUGFIX: Fix sample code <https://github.com/neos/neos-development-collection/pull/1594>`_
------------------------------------------------------------------------------------------

The sample code inside the DocBlock used the wrong view helper

`[TASK] Security warning about public Neos demo site <https://github.com/neos/neos-development-collection/pull/12>`_
--------------------------------------------------------------------------------------------------------------------

* Packages: ``Afx``

`[TASK] Security warning about public Neos demo site <https://github.com/neos/neos-development-collection/pull/12>`_
--------------------------------------------------------------------------------------------------------------------

`[BUGFIX] site:import throws Unexpected element exception <https://github.com/neos/neos-development-collection/pull/11>`_
-------------------------------------------------------------------------------------------------------------------------

While importing site-exports containing documents having the hiddenBeforeDateTime attribute set, `site:import` fails with this error:

```
Error: During the import of the file "Site.xml" an exception occurred:
Unexpected element <hiddenBeforeDateTime>
```

* Packages: ``Afx``

`[BUGFIX] site:import throws Unexpected element exception <https://github.com/neos/neos-development-collection/pull/11>`_
-------------------------------------------------------------------------------------------------------------------------

While importing site-exports containing documents having the hiddenBeforeDateTime attribute set, `site:import` fails with this error:

```
Error: During the import of the file "Site.xml" an exception occurred:
Unexpected element <hiddenBeforeDateTime>
```

`BUGFIX: Fix a typo in the docs <https://github.com/neos/neos-development-collection/pull/1590>`_
-------------------------------------------------------------------------------------------------

* Packages: ``ContentRepository`` ``Media`` ``Neos``

`BUGFIX: Create resource redirects correctly <https://github.com/neos/neos-development-collection/pull/1574>`_
--------------------------------------------------------------------------------------------------------------

The redirects for replaced resources were created using full URLs,
but the redirect handler expects relative URL paths to be given.

* Fixes: `#1573 <https://github.com/neos/neos-development-collection/issues/1573>`_

`BUGFIX: Add missing Noto Sans fonts to Media.Browser <https://github.com/neos/neos-development-collection/pull/1584>`_
-----------------------------------------------------------------------------------------------------------------------

* Packages: ``Browser``

`TASK: Correct kickstarter package name in documentation <https://github.com/neos/neos-development-collection/pull/1581>`_
--------------------------------------------------------------------------------------------------------------------------

The kickstart package name is outdated in documentation (Creating a plugin: http://neos.readthedocs.io/en/stable/ExtendingNeos/CreatingAPlugin.html). I replaced it with the current and right one (https://packagist.org/packages/neos/kickstarter).

* Packages: ``Fusion`` ``Neos``

`!!!TASK: Replace occurrences of 'typoScript' with 'fusion' <https://github.com/neos/neos-development-collection/pull/1538>`_
-----------------------------------------------------------------------------------------------------------------------------

* Deprecates methods with 'TypoScript' in name
* Replaces 'typoScript' with 'fusion' in variable names, doc blocks

* Packages: ``Fusion``

`TASK: Add functional-test that validates the integrity of the configuration and schemas in neos-packages <https://github.com/neos/neos-development-collection/pull/1521>`_
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

This change adds a functional test to neos to validate that the configurations defined in the packages that are part of the flow base distribution are all valid and that the contained schema files are valid as well.

This extends a flow test case with an extended set of packages and configurations that is taken into account.

* Packages: ``Neos``

`TASK: Remove comparison to TYPO3 CMS in documentation <https://github.com/neos/neos-development-collection/pull/1556>`_
------------------------------------------------------------------------------------------------------------------------

Do we really need the comparison to TYPO3 CMS? I think this is a nice background information but not related anymore.

http://neos.readthedocs.io/en/stable/CreatingASite/NodeTypes/ContentStructure.html#nodes-inside-the-neos-content-repository

* Packages: ``Neos``

`FEATURE: Evaluate \`@if\` in fusion as falsy or truthy values <https://github.com/neos/neos-development-collection/pull/1560>`_
--------------------------------------------------------------------------------------------------------------------------------

The behavior of `@if` is altered to make the distinction between falsy or truthy values
and no longer check for an exactly `false` value in the condition-expression. For the
distinction the php rules for casting to boolean are applied.

Examples for falsy-values that are now detected in `@if`:
- empty array
- number zero
- null
- empty string

* Packages: ``Fusion``

`TASK: Update ViewHelper and Command references <https://github.com/neos/neos-development-collection/pull/1567>`_
-----------------------------------------------------------------------------------------------------------------

Replaces some left over occurrences of "typo3" and updates
ViewHelper and Command references accordingly.

* Fixes: `#1558 <https://github.com/neos/neos-development-collection/issues/1558>`_
* Packages: ``Fusion`` ``Media`` ``Neos``

`BUGFIX: Asset list should be correctly converted for UI <https://github.com/neos/neos-development-collection/pull/1569>`_
--------------------------------------------------------------------------------------------------------------------------

Since PR #1472 was merged the asset list was not correctly converted anymore,
this had two reasons, first the wrong converter was used for the array
itself (``ArrayTypeConverter`` vs. ``TypedArrayConverter``). This is
corrected by setting the correct converter for the respective node property
data type in the settings.

Note that user code should follow the added comment in settings on how to
configure custom types, especially array of objects. It is important to define
the ``TypedArrayConverter`` for the array data type.

Additionally the ``PropertyMapper`` prevent conversion of the inner objects
as with the change the targetType suddenly matched the expected type and so
the PropertyMapper just skipped those objects. That was an unexpected side
effect as the expectation was, that the configured type converter is used no
matter what. By setting the inner target type to the dummy value "string" the
``PropertyMapper`` will proceed with the configured ``TypeConverter``.

* Fixes: `#1568 <https://github.com/neos/neos-development-collection/issues/1568>`_
* Fixes: `#1565 <https://github.com/neos/neos-development-collection/issues/1565>`_

* Packages: ``Neos``

`FEATURE: Allow strings and arrays in \`\`CachingHelper::nodeTypeTag\`\` <https://github.com/neos/neos-development-collection/pull/1541>`_
------------------------------------------------------------------------------------------------------------------------------------------

This makes the `CachingHelper::nodeTypeTag` method much more flexible
for it's use case by allowing also strings and arrays (or `\\Traversable`) as
input, always returning an array of tags to be applied and gracefully
ignoring anything that won't result in a valid tag.

* Fixes: `#871 <https://github.com/neos/neos-development-collection/issues/871>`_
* Packages: ``Neos``

`BUGFIX: An empty string is not rendered as a valid node name <https://github.com/neos/neos-development-collection/pull/1546>`_
-------------------------------------------------------------------------------------------------------------------------------

Making sure that ``Utility::renderValidNodeName()`` actually only
result in strings with length greater zero.

* Fixes: `#1091 <https://github.com/neos/neos-development-collection/issues/1091>`_

`BUGFIX: Correctly require a stable version of neos/imagine <https://github.com/neos/neos-development-collection/pull/1570>`_
-----------------------------------------------------------------------------------------------------------------------------

The ``neos/image`` version should be a stable version. Additionally
corrects the ``PHP`` version requirement to 7.0 an higher.

* Packages: ``Media`` ``Neos``

`BUGFIX: Avoid null being used in trimExplode() <https://github.com/neos/neos-development-collection/pull/1553>`_
-----------------------------------------------------------------------------------------------------------------

* Fixes: `#1552 <https://github.com/neos/neos-development-collection/issues/1552>`_
* Packages: ``ContentRepository``

`[TASK] Add missing typo3/party requirement <https://github.com/neos/neos-development-collection/pull/10>`_
-----------------------------------------------------------------------------------------------------------

This change adds typo3/party to the collections requirements
as it is not installed automatically but is a requirement
for Neos.

* Packages: ``Afx``

`[TASK] Add missing typo3/party requirement <https://github.com/neos/neos-development-collection/pull/10>`_
-----------------------------------------------------------------------------------------------------------

This change adds typo3/party to the collections requirements
as it is not installed automatically but is a requirement
for Neos.

`TASK: Corrected required php version in documentation <https://github.com/neos/neos-development-collection/pull/1555>`_
------------------------------------------------------------------------------------------------------------------------

Replaced 5.5.0 with 7.0.0

_Please note that this should be also changed in 3.1 and master branch_

* Packages: ``Neos``

`TASK: Rewrite Node Type Constraint docs for correctness and clarity <https://github.com/neos/neos-development-collection/pull/1492>`_
--------------------------------------------------------------------------------------------------------------------------------------

Completely rewrote that chapter of the docs in order to make it more explicit and understandable.

* Packages: ``Neos``

`BUGFIX: Context variable \`site\` is available in Plugin prototype <https://github.com/neos/neos-development-collection/pull/1544>`_
-------------------------------------------------------------------------------------------------------------------------------------

As plugins are uncached the prototype defines which context variables
will be available inside. As ``node``, ``documentNode`` and ``site`` are
defaults that apply everywhere else, the missing ``site`` variable
was added to the context for consistency.

* Fixes: `#841 <https://github.com/neos/neos-development-collection/issues/841>`_

`BUGFIX: Avoid loading original image unless cropping occurs <https://github.com/neos/neos-development-collection/pull/1460>`_
------------------------------------------------------------------------------------------------------------------------------

The image inspector used to load the full image for preview. With this change a much smaller thumbnail will be loaded instead, unless the image has been cropped or is being cropped in the cropping editor. In that case we need to load the full image to give the user a crisp preview of the selected image segment.

`TASK: Add content to 3.0.0 release notes <https://github.com/neos/neos-development-collection/pull/1548>`_
-----------------------------------------------------------------------------------------------------------

* Fixes: `#1420 <https://github.com/neos/neos-development-collection/issues/1420>`_
* Packages: ``Neos``

`BUGFIX: Typo in User Settings doc <https://github.com/neos/neos-development-collection/pull/1551>`_
----------------------------------------------------------------------------------------------------

Fixed a typo in documentation in the User Settings document.

Can we verified using : https://neos.readthedocs.io/en/stable/UserGuide/UserSettings.html

* Packages: ``Neos``

`BUGFIX: Detect recursive prototype inheritance <https://github.com/neos/neos-development-collection/pull/1537>`_
-----------------------------------------------------------------------------------------------------------------

This throws an exception if there is a direct or indirect prototype inheritance recursion.

Fix #1115

* Packages: ``ContentRepository`` ``Fusion`` ``Neos``

`BUGFIX: Clarified doc block for LiveViewHelper <https://github.com/neos/neos-development-collection/pull/1547>`_
-----------------------------------------------------------------------------------------------------------------

If the ``LiveViewHelper`` doesn't get a node as argument and neither
there is a node in the template variables it will always return true.
The adjusted doc block clarifies that you need either.

* Fixes: `#1416 <https://github.com/neos/neos-development-collection/issues/1416>`_

`TASK: Remove un-necessary \`toString\` method in FusionPathProxy <https://github.com/neos/neos-development-collection/pull/1500>`_
-----------------------------------------------------------------------------------------------------------------------------------

This was needed at some point to evaluate the proxy to a string in a Fluid template,
but the way a proxy is handled was changed some time ago so that the respective
methods are called to get the content of the proxy instead of just string casting,
therefore it was no longer needed.

And the exception handling in the toString is not a good idea anyway (but necessary
because toString cannot raise exceptions) so all in all this method is undesirable and
as we don't use it anymore it should be removed.

This is basically the result of a long debugging session at the last sprint where we
implemented a short term bugfix and figured that we don't need this method anymore
and should remove it in one of the next releases.

* Packages: ``Fusion``

`BUGFIX: Clean TypoScript of windows line-breaks <https://github.com/neos/neos-development-collection/pull/1543>`_
------------------------------------------------------------------------------------------------------------------

Multi-line EEL expressions fail if the TypoScript file had
Windows linebreaks as the explode on line feed leaves the
carriage return in every line which then stops the parser
from detecting the end of a multi-line EEL expression.

`BUGFIX: Fix the NodeTypes schema files and allow properties \`search\` and \`options\` <https://github.com/neos/neos-development-collection/pull/1432>`_
---------------------------------------------------------------------------------------------------------------------------------------------------------

The NodeType schemas can now handle the case that a property in a NodeType definition can be either a dictionary or null.

Additionally the keys `search`  and `options` as extension point for package-configuration.

The key `search` is used by several search implementations and currently causes validation errors.
The key `options` is allowed to avoid such problems in the future and to create a place where packages can place custom configuration.

`[TASK] Resolve test trait paths relatively <https://github.com/neos/neos-development-collection/pull/9>`_
----------------------------------------------------------------------------------------------------------

In order to accomodate running the tests with the new joined
repositories as well as the read-only ones the require path
must be relative to the current path to avoid passing the
Application/Neos folder.

* Packages: ``Afx``

`[TASK] Resolve test trait paths relatively <https://github.com/neos/neos-development-collection/pull/9>`_
----------------------------------------------------------------------------------------------------------

In order to accomodate running the tests with the new joined
repositories as well as the read-only ones the require path
must be relative to the current path to avoid passing the
Application/Neos folder.

`TASK: Add release notes for 3.1 <https://github.com/neos/neos-development-collection/pull/1532>`_
--------------------------------------------------------------------------------------------------

Release notes for Neos 3.1

* Fixes: `#1488 <https://github.com/neos/neos-development-collection/issues/1488>`_ 
* Packages: ``Neos``

`BUGFIX: Fix Neos.Fusion:Debug example <https://github.com/neos/neos-development-collection/pull/1540>`_
--------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`TASK: Rename legacy strings in comments <https://github.com/neos/neos-development-collection/pull/1533>`_
----------------------------------------------------------------------------------------------------------

This change renames TS / TypoScript and TYPO3
left overs in comments all over the package.
No code changes included.

* Packages: ``Neos``

`TASK: Improve documentation on plugin creation <https://github.com/neos/neos-development-collection/pull/1454>`_
-----------------------------------------------------------------------------------------------------------------

The file Policy.yaml is missing in Sarkosh.CdCollection, clearly point out
it needs to be created.

Also explain that packages need to be rescanned (or the cache needs to
be flushed) before you can use the plugin after the optional move to a
"Plugins" folder.

* Packages: ``ContentRepository`` ``Neos`` ``NodeTypes``

`BUGFIX: Allow content dimension preset translation <https://github.com/neos/neos-development-collection/pull/1522>`_
---------------------------------------------------------------------------------------------------------------------

**What I did**
Tranlate content dimension labels.

**How I did it**
Just like it is already done for dimension labels

**How to verify it**
Add content dimension. Enter translation id as label. Add id in your translation. Enjoy!

`TASK: Update badges to 3.1 branch <https://github.com/neos/neos-development-collection/pull/1531>`_
----------------------------------------------------------------------------------------------------

`BUGFIX: Fix code migrations to prevent unnecessary changes <https://github.com/neos/neos-development-collection/pull/1530>`_
-----------------------------------------------------------------------------------------------------------------------------

This change adjusts two code migrations (in a backwards compatible manner)
so that they don't produce invalid YAML files.

Background:

The two migrations `TYPO3.TYPO3CR-130523180140` and `TYPO3.Neos.NodeTypes-201309111655`
both replace some "superType"/"childNode" NodeType settings.
In cases where those already use the suggested format `['<value>' => true]` this leads
to invalid results (`['<value>' => '1']`).
With `TYPO3.TYPO3CR-20150510103823` these invalid values are fixed again, but applying
all migrations lead to three unnecessary commits, possibly corrupting the configuration
and/or removing important comments.

* Fixes: `#1351 <https://github.com/neos/neos-development-collection/issues/1351>`_

`[TASK] Resolve test trait paths relatively <https://github.com/neos/neos-development-collection/pull/7>`_
----------------------------------------------------------------------------------------------------------

In order to accomodate running the tests with the new joined
repositories as well as the read-only ones the require path
must be relative to the current path to avoid passing the
Application/Neos folder.

* Packages: ``Afx``

`[TASK] Resolve test trait paths relatively <https://github.com/neos/neos-development-collection/pull/7>`_
----------------------------------------------------------------------------------------------------------

In order to accomodate running the tests with the new joined
repositories as well as the read-only ones the require path
must be relative to the current path to avoid passing the
Application/Neos folder.

`[TASK] Create .codeclimate.yml <https://github.com/neos/neos-development-collection/pull/6>`_
----------------------------------------------------------------------------------------------

Adds a codeclimate configuration excluding Migrations, Tests and
JavaScript libraries.

* Packages: ``Afx``

`[TASK] Create .codeclimate.yml <https://github.com/neos/neos-development-collection/pull/6>`_
----------------------------------------------------------------------------------------------

Adds a codeclimate configuration excluding Migrations, Tests and
JavaScript libraries.

`[TASK] Get all nodes in a single request in ReferencesEditor <https://github.com/neos/neos-development-collection/pull/5>`_
----------------------------------------------------------------------------------------------------------------------------

This change introduce a new method in the NodeSearchServiceInterface
to find node by identifiers. The NodeController and the
ReferencesEditor is adapted to use this new method based on the
given request arguments.

* Resolves: `NEOS-1261 <https://jira.neos.io/browse/NEOS-1261>`_
* Packages: ``Afx``

`[TASK] Get all nodes in a single request in ReferencesEditor <https://github.com/neos/neos-development-collection/pull/5>`_
----------------------------------------------------------------------------------------------------------------------------

This change introduce a new method in the NodeSearchServiceInterface
to find node by identifiers. The NodeController and the
ReferencesEditor is adapted to use this new method based on the
given request arguments.

* Resolves: `NEOS-1261 <https://jira.neos.io/browse/NEOS-1261>`_

`TASK: allow to require stable version of \`flow-development-collection\` <https://github.com/neos/neos-development-collection/pull/1528>`_
-------------------------------------------------------------------------------------------------------------------------------------------

This relaxes the constraints in order to be able to run stable versions of our development collections.

This is useful when you want to say use beard in production, without having to use the -dev versions.

`[TASK] Improved \`\`countByParentAndNodeType\`\` performance <https://github.com/neos/neos-development-collection/pull/4>`_
----------------------------------------------------------------------------------------------------------------------------

Uses a direct count query to fetch the count of child nodes.
As we do not need to take care which variant is the better one just
doing a DISTINCT on the identifier should be fine to get an accurate
result.

* Resolves: `NEOS-1444 <https://jira.neos.io/browse/NEOS-1444>`_
* Packages: ``Afx``

`[TASK] Improved \`\`countByParentAndNodeType\`\` performance <https://github.com/neos/neos-development-collection/pull/4>`_
----------------------------------------------------------------------------------------------------------------------------

Uses a direct count query to fetch the count of child nodes.
As we do not need to take care which variant is the better one just
doing a DISTINCT on the identifier should be fine to get an accurate
result.

* Resolves: `NEOS-1444 <https://jira.neos.io/browse/NEOS-1444>`_

`[TASK] Add trait to avoid duplicate code in ViewHelpers <https://github.com/neos/neos-development-collection/pull/3>`_
-----------------------------------------------------------------------------------------------------------------------

The new `TypoScriptContextTrait` can be used to get
variables from the TypoScript runtime context inside a
ViewHelper as long as it's used inside a
`TypoScriptAwareView`. This helps to avoid code duplication
while avoiding long inheritance chains.

* Packages: ``Afx``

`[TASK] Add trait to avoid duplicate code in ViewHelpers <https://github.com/neos/neos-development-collection/pull/3>`_
-----------------------------------------------------------------------------------------------------------------------

The new `TypoScriptContextTrait` can be used to get
variables from the TypoScript runtime context inside a
ViewHelper as long as it's used inside a
`TypoScriptAwareView`. This helps to avoid code duplication
while avoiding long inheritance chains.

`BUGFIX: Correct the NodeType schema of a nulled fusion.prototypeGenerator <https://github.com/neos/neos-development-collection/pull/1473>`_
--------------------------------------------------------------------------------------------------------------------------------------------

The type 'null' has to be written in quotes to be distinguished from the NULL value of yaml.

* Packages: ``ContentRepository`` ``Neos``

`TASK: Add tests for node name generation <https://github.com/neos/neos-development-collection/pull/1525>`_
-----------------------------------------------------------------------------------------------------------

Tests to prove neos/neos-development-collection#1524

`BUGFIX: No uppercase characters allowed in node names <https://github.com/neos/neos-development-collection/pull/1524>`_
------------------------------------------------------------------------------------------------------------------------

The changed generation of node names must avoid uppercase characters.

This is a followup to neos/neos-development-collection#1523

`[BUGFIX] Service\\NodesController should stick to interfaces <https://github.com/neos/neos-development-collection/pull/2>`_
---------------------------------------------------------------------------------------------------------------------------

The `Service\\NodesController` should refer to the
`NodeSearchServiceInterface` instead of the implementation class
to avoid hard dependencies and allow overwriting the implementation
from the outside.

* Packages: ``Afx``

`[BUGFIX] Service\\NodesController should stick to interfaces <https://github.com/neos/neos-development-collection/pull/2>`_
---------------------------------------------------------------------------------------------------------------------------

The `Service\\NodesController` should refer to the
`NodeSearchServiceInterface` instead of the implementation class
to avoid hard dependencies and allow overwriting the implementation
from the outside.

`TASK: Use generateRandomString() instead of uniqid() <https://github.com/neos/neos-development-collection/pull/1523>`_
-----------------------------------------------------------------------------------------------------------------------

This reduces the risk of collision on temporary names for nodes and
files, as well as cache markers.

`BUGFIX: Asset should return same extension as attached resource <https://github.com/neos/neos-development-collection/pull/1519>`_
----------------------------------------------------------------------------------------------------------------------------------

Using the resource media type to find an extension for an asset
is suboptimal because the asset knows the extension directly and
the media type -> extension conversion is ambiguous so you might
end up with a different extension than the resource has afterwards.

`TASK: Corrected naming in documentation <https://github.com/neos/neos-development-collection/pull/1518>`_
----------------------------------------------------------------------------------------------------------

Replaces ``TYPO3.Neos`` with ``Neos.Neos``

* Packages: ``Neos``

`TASK: Enable translations for labels of the Site Management module <https://github.com/neos/neos-development-collection/pull/1501>`_
-------------------------------------------------------------------------------------------------------------------------------------

**What I did**

- Add translation for labels with none in the XLIFF files to enable the translation to other languages
- Eliminated labels with duplicated IDs and different values
- Some simple sorting and cleanup of the XLIFF files

**How I did it**
- I took the labels of the templates and searched the XLIFF files for them
- I put the specific Site Management labels to `Modules.xlf`
- I put the generic labels to `Main.xlf`

**How to verify it**
- Login to the backend and go to the Site Management module
- Click through it and check whether there are corrupted labels
- The labels should look like before

* Packages: ``Neos``

`TASK: Remove occurences of TYPO3 in Neos.Fusion <https://github.com/neos/neos-development-collection/pull/1502>`_
------------------------------------------------------------------------------------------------------------------

* Packages: ``Fusion``

`BUGFIX: Fix upmerge mistake in ResizeImageAdjustment <https://github.com/neos/neos-development-collection/pull/1516>`_
-----------------------------------------------------------------------------------------------------------------------

The wrong namespace/vendor name was pulled in from the 2.3 branch
during an upmerge.

* Packages: ``ContentRepository`` ``Media``

`BUGFIX: Include configuration reference in TOC <https://github.com/neos/neos-development-collection/pull/1515>`_
-----------------------------------------------------------------------------------------------------------------

The configuration reference was no longer included in the documentation TOC
at all, after a recent fix aimed at no longer including it twice.

`BUGFIX: Allow choice of filter for resizing images <https://github.com/neos/neos-development-collection/pull/1513>`_
---------------------------------------------------------------------------------------------------------------------

The resize filter can have considerable impact on file size and
processing power needed to do the resize, it's therefore sensible
to give the user a choice in this.

Additionally removes copying the image as that is entirely unnecessary
and impacts memory usage profoundly.

`TASK: Improve documentation Installation <https://github.com/neos/neos-development-collection/pull/1499>`_
-----------------------------------------------------------------------------------------------------------

This change

- updates screenshots with new logo in documentation
- adds step "Neos requirements" to documentation
- adds info on "AllowOverride directive" to documentation

* Packages: ``Neos``

`TASK: Add "User Settings" to documentation <https://github.com/neos/neos-development-collection/pull/1508>`_
-------------------------------------------------------------------------------------------------------------

This adds a page on „User Settings“ to the documentation, explaining how to change
your personal data.

* Packages: ``Neos``

`TASK: Update screenshots in "User Interface Basics" <https://github.com/neos/neos-development-collection/pull/1504>`_
----------------------------------------------------------------------------------------------------------------------

This updates the screenshots of the complete user interface
and adds screenshots of user interface details.

* Packages: ``Neos``

`TASK: Change login wallpaper for 3.1 <https://github.com/neos/neos-development-collection/pull/1503>`_
-------------------------------------------------------------------------------------------------------

**What I did**
Changed the picture.

**How I did it**
Travelled to iceland, walked up the canyon. Fearlessly leant over the cliff.

* Resolves: `#1481 <https://github.com/neos/neos-development-collection/issues/1481>`_
* Packages: ``Neos``

`BUGFIX: Fix the infinite loop if a fusion object can not be resolved <https://github.com/neos/neos-development-collection/pull/1496>`_
---------------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Fusion``

`BUGFIX: Fix some Sphinx rendering errors <https://github.com/neos/neos-development-collection/pull/1487>`_
-----------------------------------------------------------------------------------------------------------

- TASK: Bring back old release notes
- BUGFIX: Fix some Sphinx rendering errors

* Packages: ``Neos``

`FEATURE: Add default editorOptions to settings <https://github.com/neos/neos-development-collection/pull/1505>`_
-----------------------------------------------------------------------------------------------------------------

Add default editorOptions to settings for the new react ui `https://github.com/neos/neos-ui/issues/641 <https://github.com/neos/neos-ui/issues/641>`_

`BUGFIX: Correct typo in plugin's Settings.yaml <https://github.com/neos/neos-development-collection/pull/1498>`_
-----------------------------------------------------------------------------------------------------------------

**What I did**
- Changed  to  in Settings.yaml. It needs to be lower-case in order to work properly.

* Packages: ``Neos``

`TASK: Set \`ArrayConverter\` as node property default type converter <https://github.com/neos/neos-development-collection/pull/1472>`_
---------------------------------------------------------------------------------------------------------------------------------------

Hi @kitsunet,

this refactoring was done at the NEOS Sprint. Let's review it together.

Best
Jo (@joachimmathes) and Dani (@dgrammlich)

* Packages: ``Neos``

`TASK: Adjust DocTools settings <https://github.com/neos/neos-development-collection/pull/1491>`_
-------------------------------------------------------------------------------------------------

* Fixes: `#1490 <https://github.com/neos/neos-development-collection/issues/1490>`_
* Packages: ``ContentRepository`` ``Media`` ``Neos``

`BUGFIX: Use findNodesByPathPrefixAndRelatedEntities <https://github.com/neos/neos-development-collection/pull/1497>`_
----------------------------------------------------------------------------------------------------------------------

 in getRelatedNodeMethod

`BUGFIX: Add mysql-index for the field \`parentpath\` in the \`nodeData\`-table <https://github.com/neos/neos-development-collection/pull/1478>`_
-------------------------------------------------------------------------------------------------------------------------------------------------

The find operation is currently very expensive because of an unoptimized LIKE statement.
This index will to optimize the performance for find operations especially in larger cr-instances

The size of the index is a compromise between space and an assumption of the normal length of the nodePath.

`BUGFIX: MediaModule asset edit should not fail <https://github.com/neos/neos-development-collection/pull/1485>`_
-----------------------------------------------------------------------------------------------------------------

if no Site is defined.

**How to verify it**

- delete your sites in the site management
- got to the media browser and open an image

An exception occurres.

See: https://github.com/neos/neos-development-collection/issues/1483

`BUGFIX: NodePropertiesStrategy in Neos should only handle site nodes <https://github.com/neos/neos-development-collection/pull/1486>`_
---------------------------------------------------------------------------------------------------------------------------------------

Currently the AssetUsageInNodePropertiesStrategy handles
all asset references in all nodes in the node data table.
The handling than is specific for nodes under the `/site` root node
and fails when a node references an asset that is located under another root.

This fixes the issue by only selecting site nodes.

**What I did**
Filter the nodes by site root.

**How to verify it**
Add an asset reference to a node that is not under sites.
The edit view of an asset fails.

`TASK: Add transitive dependencies to Neos packages <https://github.com/neos/neos-development-collection/pull/1455>`_
---------------------------------------------------------------------------------------------------------------------

* Packages: ``Browser`` ``ContentRepository`` ``Fusion`` ``Media`` ``Neos`` ``NodeTypes`` ``SiteKickstarter``

`BUGFIX: Configuration reference nested twice <https://github.com/neos/neos-development-collection/pull/1484>`_
---------------------------------------------------------------------------------------------------------------

This causes issues with search results and creates confusion.

`BUGFIX: Fix EXTRACT_CONTENT_TYPE_PATTERN namespace use <https://github.com/neos/neos-development-collection/pull/1467>`_
-------------------------------------------------------------------------------------------------------------------------

Make NodeTemplateConverter::EXTRACT_CONTENT_TYPE_PATTERN match against
`Neos\\ContentRepository\\…`.

* Fixes: `#1466 <https://github.com/neos/neos-development-collection/issues/1466>`_
* Packages: ``ContentRepository``

`BUGFIX: Opening context menu in media browser list view <https://github.com/neos/neos-development-collection/pull/1409>`_
--------------------------------------------------------------------------------------------------------------------------

Backports `f169275c9a05071531dc5bd9b3d2533ebf093184 <https://github.com/neos/neos-development-collection/commit/f169275c9a05071531dc5bd9b3d2533ebf093184>`_ and `d4efa8b305c925aa4e8482db74d5eaf8da9817dc <https://github.com/neos/neos-development-collection/commit/d4efa8b305c925aa4e8482db74d5eaf8da9817dc>`_ from the 3.0 branch.

closes #1408

`BUGFIX: Check for existing node data property works with null <https://github.com/neos/neos-development-collection/pull/1440>`_
--------------------------------------------------------------------------------------------------------------------------------

The ``AbstractNodeData::hasProperty()`` method checked
the existence of the given property with ``isset`` but that
leads to an exception if the property has a ``null`` value.
The check has been changed to ``array_key_exists``.

Same is done in the optimization check to avoid setting
existing values again in ``AbstractNodeData::setProperty``.

* Resolves: `#1174 <https://github.com/neos/neos-development-collection/issues/1174>`_

`TASK: Fix "undefined class" warnings <https://github.com/neos/neos-development-collection/pull/1465>`_
-------------------------------------------------------------------------------------------------------

Mostly fixes comments, but some use statements as well.

Also removes some dead code that was not removed along with the
deprecated NodeDataLabelGeneratorInterface.

* Packages: ``ContentRepository`` ``Media`` ``Neos``

`BUGFIX: If thumbnail refresh fails, handle gracefully <https://github.com/neos/neos-development-collection/pull/1459>`_
------------------------------------------------------------------------------------------------------------------------

If refreshing a thumbnail fails (e.g. because a PDF cannot be converted
correctly), the media module dies with an exception screen.

This change catches and logs the error, and returns null as result. This
leads to a missing thumbnail, but the media management stays usable.

`TASK: Adjust more Behat-related code to PhpUnit 6 <https://github.com/neos/neos-development-collection/pull/1464>`_
--------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`TASK: Adjust Behat-related code to PhpUnit 6 <https://github.com/neos/neos-development-collection/pull/1461>`_
---------------------------------------------------------------------------------------------------------------

* Packages: ``ContentRepository`` ``Neos``

`TASK: Declare dependency on PHP 7 for Neos.Neos <https://github.com/neos/neos-development-collection/pull/1462>`_
------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`TASK: remove arguments argument for NodeUri <https://github.com/neos/neos-development-collection/pull/1423>`_
--------------------------------------------------------------------------------------------------------------

The fusion argument 'arguments' in NodeUriImplementation was never used. The documentation was confusing saying it is possible to use 'arguments' argument in Fusion.

**What I did**

Removed `arguments` argument from `NodeUri` documentation.
Removed `getArguments()` method from `NodeUriImplementation` because it was never used.

* Packages: ``Neos``

`BUGFIX: Avoid stuck tooltip in node tree <https://github.com/neos/neos-development-collection/pull/1450>`_
-----------------------------------------------------------------------------------------------------------

This switches (bootstrap) tooltips from being triggered on hover
and focus to just hover. This avoids the tooltip being activated e.g.
by expand a subtree.

Should fix #1386

`FEATURE: Add support for image presets in Fusion <https://github.com/neos/neos-development-collection/pull/1437>`_
-------------------------------------------------------------------------------------------------------------------

Add image preset support for `Neos.Neos:ImageUri` and `Neos.Neos:ImageTag`.

* Packages: ``Neos``

`BUGFIX: Only show remove button when image selected in ImageEditor <https://github.com/neos/neos-development-collection/pull/1446>`_
-------------------------------------------------------------------------------------------------------------------------------------

Do not show the "remove" button in ImageEditor when no image is selected.

`BUGFIX: Limit VIE to predicates with custom namespace <https://github.com/neos/neos-development-collection/pull/1452>`_
------------------------------------------------------------------------------------------------------------------------

Instead of applying VIE to all elements with `[rel]` or `[property]` attributes,
only apply to those starting prefixed with the `typo3` namespace.

This prevents side effects for other tags like `<a href="#" rel="nofollow">Link</a>`.

* Resolves: `#1449 <https://github.com/neos/neos-development-collection/issues/1449>`_

`BUGFIX: Add missing colons to resourcepaths in documentation <https://github.com/neos/neos-development-collection/pull/1444>`_
-------------------------------------------------------------------------------------------------------------------------------

This adds missing colons to the resource paths in the examples on selecting a page template.

`TASK: Only show remove button when image selected in ImageEditor <https://github.com/neos/neos-development-collection/pull/1426>`_
-----------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`BUGFIX: Fix changelog and release note rendering <https://github.com/neos/neos-development-collection/pull/1441>`_
-------------------------------------------------------------------------------------------------------------------

This fixes a few places and adjusts some files so the 3.0 branch has proper
release notes and changelog rendering.

* Packages: ``Neos``

`BUGFIX: Adjust policy-matchers after deprecation of userWorkspaceName to personalWorkspaceName <https://github.com/neos/neos-development-collection/pull/1442>`_
-----------------------------------------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`BUGFIX: getPersonalWorkspace()->getName() replaced with getPersonalWorkspaceName() <https://github.com/neos/neos-development-collection/pull/1436>`_
-----------------------------------------------------------------------------------------------------------------------------------------------------

`f13a82c2d9d5a3185889d21c4cbfca4dbdfde579 <https://github.com/neos/neos-development-collection/commit/f13a82c2d9d5a3185889d21c4cbfca4dbdfde579>`_ introduced a regression: No workspace is created for new users.

This fixes it.

* Packages: ``Media`` ``Neos``

`TASK: Document width and height property in ImageUri Fusion-prototype <https://github.com/neos/neos-development-collection/pull/1431>`_
----------------------------------------------------------------------------------------------------------------------------------------

This documents changes that were introduced in Neos 2.0 with revision `75430099fe2dbd3646eb549dac5e9778abf4c82a <https://github.com/neos/neos-development-collection/commit/75430099fe2dbd3646eb549dac5e9778abf4c82a>`_.

`BUGFIX: Make layout sliding query match properly <https://github.com/neos/neos-development-collection/pull/1422>`_
-------------------------------------------------------------------------------------------------------------------

The page layout determination in `DefaultTypoScript.ts2` contains the query

`q(node).parents('[subpageLayout]').first().property('subpageLayout')`

However that immediately also matches nodes which have `subpageLayout` being an empty string, hence this being taken into account. This results in an empty value, even if there would be actual set layouts higher above.

The `.parents()` part need to be replaced with `.parents('[subpageLayout][subpageLayout != ""]')`

* Fixes: `#1117 <https://github.com/neos/neos-development-collection/issues/1117>`_

`TASK: Remove note about behavior in unsupported version 1.2 <https://github.com/neos/neos-development-collection/pull/1433>`_
------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`TASK: Documentation adjustments <https://github.com/neos/neos-development-collection/pull/1430>`_
--------------------------------------------------------------------------------------------------

Adds a small example to the Eel Helpers Reference (Array.indexOf).
Adds an example on how to use the help messages inside properties (Property Editor Reference).

`TASK: Prefix \`uriPathSegment\` field inspector validator <https://github.com/neos/neos-development-collection/pull/1428>`_
----------------------------------------------------------------------------------------------------------------------------

I changed the non prefixed `regularExpression`-validator to the correct `TYPO3.Neos/Validation/RegularExpressionValidator`-validator

**How to test**

You could easily try to change the `uriPathSegment` on every document node type.

`BUGFIX: Initialization of asset usage strategies <https://github.com/neos/neos-development-collection/pull/1427>`_
-------------------------------------------------------------------------------------------------------------------

Fixes a regression introduced in https://github.com/neos/neos-development-collection/pull/1323,
causing the asset usage strategies to never be initialized.

Closes #1425

`BUGFIX: Require ~4.0 of neos/form <https://github.com/neos/neos-development-collection/pull/1424>`_
----------------------------------------------------------------------------------------------------

The 3.0 branch of neos/form is not compatible with the current codebase.

* Packages: ``Neos``

`BUGFIX: Adding media element to tag or asset collection <https://github.com/neos/neos-development-collection/pull/1414>`_
--------------------------------------------------------------------------------------------------------------------------

Adding a media asset to a tag or collection in the thumbnail in the media browser by dragging it fails.

* Resolves: `#1413 <https://github.com/neos/neos-development-collection/issues/1413>`_
* Packages: ``Browser``

`TASK: Remove deprecated getters for \`\`userWorkspace\`\` and name <https://github.com/neos/neos-development-collection/pull/1393>`_
-------------------------------------------------------------------------------------------------------------------------------------

These are fully replaced by
``\\Neos\\Neos\\Service\UserService::getPersonalWorkspace``
and
``\\Neos\\Neos\\Service\UserService::getPersonalWorkspaceName``

* Packages: ``Neos``

`TASK: Remove TYPO3 & TypoScript in the Fusion documentation <https://github.com/neos/neos-development-collection/pull/1418>`_
------------------------------------------------------------------------------------------------------------------------------

In the `documentation <https://neos.readthedocs.io/en/stable/References/>`_ are still some references to TYPO3 and TypoScript. This PR fix it for the fusion part

* Packages: ``Fusion`` ``Neos``

`TASK: Replace leftover occurrence of \`\`typoScriptRenderingPath\`\` <https://github.com/neos/neos-development-collection/pull/1419>`_
---------------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`BUGFIX: Make fusion-parser aspectable <https://github.com/neos/neos-development-collection/pull/1410>`_
--------------------------------------------------------------------------------------------------------

The fusion parser cloned itself previously to handle includes but to keep the defined namespaces.
That made the use of aspects impossible since they were only applied on the initially created instance of the parser.

This change fixes this by using a new instance of the parser for each include and transfers the namespaces explicitly to the new parser.

`BUGFIX: Correctly require \`\`exec\`\` instead of \`\`system\`\` <https://github.com/neos/neos-development-collection/pull/1415>`_
-----------------------------------------------------------------------------------------------------------------------------------

The documentation requested ``system`` to be enabled but in fact ``exec``
is used for proxy building in Flow.

Related: neos/flow-development-collection#634

* Packages: ``Neos``

`BUGFIX: Use setFusionPathPattern() in HistoryController <https://github.com/neos/neos-development-collection/pull/1411>`_
--------------------------------------------------------------------------------------------------------------------------

The view was updated to `FusionView`, but `setTypoScriptPathPattern` was still called.
I updated it to the correct method `setFusionPathPattern`.

* Packages: ``Neos``

`TASK: Replace TYPO3 by Neos <https://github.com/neos/neos-development-collection/pull/1405>`_
----------------------------------------------------------------------------------------------

This change contains various further replacements of "TYPO3" by "Neos".

Related to https://github.com/neos/flow-development-collection/issues/823

* Packages: ``Neos``

`BUGFIX: Creating thumbnails on asset creation <https://github.com/neos/neos-development-collection/pull/1407>`_
----------------------------------------------------------------------------------------------------------------

Merge regression of `d03079cb90fbade6fae5748c0dd9acb94543c761 <https://github.com/neos/neos-development-collection/commit/d03079cb90fbade6fae5748c0dd9acb94543c761>`_

`BUGFIX: Don’t use deprecated hostpattern methods <https://github.com/neos/neos-development-collection/pull/1403>`_
---------------------------------------------------------------------------------------------------------------------

`getHostPattern` was deprecated in Neos 3.0

* Packages: ``Neos``

`BUGFIX: Selecting image in media browser thumbnail view <https://github.com/neos/neos-development-collection/pull/1401>`_
--------------------------------------------------------------------------------------------------------------------------

Regression of `f169275c9a05071531dc5bd9b3d2533ebf093184 <https://github.com/neos/neos-development-collection/commit/f169275c9a05071531dc5bd9b3d2533ebf093184>`_

* Packages: ``Browser`` ``Neos``

`BUGFIX: make moving a content node across document nodes work from the tree <https://github.com/neos/neos-development-collection/pull/1396>`_
----------------------------------------------------------------------------------------------------------------------------------------------

**What I did**

Moving a content node across document nodes used to give a JS error:
!`image <https://cloud.githubusercontent.com/assets/837032/22254950/0ac9dd9e-e267-11e6-8d81-efe7906e4106.png>`_

**How I did it**

The error happens inside DynaTree, the code which we do not control. The only way I found to prevent it is to check for existence of child nodes before calling DynaTree's move.

**How to verify it**

Cut some content node from the tree on one page and paste it on another.

`TASK: Apply migration Neos.Flow-20170125103800 to package "Neos.Neos" <https://github.com/neos/neos-development-collection/pull/1400>`_
----------------------------------------------------------------------------------------------------------------------------------------

Migrate usages of the path [TYPO3][Flow][Security][Authentication] to
[Neos][Flow][Security][Authentication]

See https://github.com/neos/flow-development-collection/pull/838

* Packages: ``Browser`` ``Neos``

`TASK: Rename default authentication backend provider name <https://github.com/neos/neos-development-collection/pull/1381>`_
----------------------------------------------------------------------------------------------------------------------------

Remove ``TYPO3`` reference from default authentication backend provider name and rename to ``Neos.Neos:Backend``.

#related https://github.com/neos/Neos.Demo/pull/23
#related https://github.com/Flowpack/Flowpack.Neos.FrontendLogin/pull/15

* Packages: ``Browser`` ``Fusion`` ``Neos``

`TASK: Adapt to removed \`\`ResourcePublisher\`\` <https://github.com/neos/neos-development-collection/pull/1398>`_
-------------------------------------------------------------------------------------------------------------------

Although the test actually uses the ``ResourceManager`` the doc block says it's
the deprecated ``ResourcePublisher`` this is fixed as the publisher is
bound to be removed.

* Packages: ``Fusion`` ``Neos``

`BUGFIX: Fix mediabrowser regressions, improve configuration <https://github.com/neos/neos-development-collection/pull/1305>`_
------------------------------------------------------------------------------------------------------------------------------

This acts on feedback after merge of #159 

Closes #1284 

# Things to be worked on

- [x] Add useful description to package
- [x] Clean up the two AssetController classes
- [x] Auto include routes
- [x] Fix requestPatterns regression
- [X] Fix whitespace regression document breadcrumb
- [x] Move translation labels to media browser package
- [x] Move the stylesheets to the new package
- [x] Move thumbnail configuration the Neos.Neos
- [x] Upload broken is user select a tag before upload (affect only master, confirmed by @gerhard-boden see https://neos-project.slack.com/archives/team-unicorn/p1481721419000067)
- [x] Drag'n drop to Collection / Tag don't work

# Infrastructure

- [x] Sync CrowdIn (translation move, see https://github.com/neos/neos-development-collection/pull/1305/commits/`94ff76913907cfe80743ecbe9e11591de5b4e846 <https://github.com/neos/neos-development-collection/commit/94ff76913907cfe80743ecbe9e11591de5b4e846>`_)
- [x] Update Jenkins build script to build CSS/JS

* Packages: ``Browser``

`TASK: Remove deprecated hostnamePattern from \`\`Domain\`\` <https://github.com/neos/neos-development-collection/pull/1394>`_
------------------------------------------------------------------------------------------------------------------------------

Fully replaced by ``hostname`` and not used anymore.

* Packages: ``Neos``

`BUGFIX: Incorrect default sort direction in media browser <https://github.com/neos/neos-development-collection/pull/1392>`_
----------------------------------------------------------------------------------------------------------------------------

Changes the default sort direction in the media browser back to descending (latest modified first).

Regression introduced in `c7aed058d3a363db8e51e8e9b84a557e90bffd0e <https://github.com/neos/neos-development-collection/commit/c7aed058d3a363db8e51e8e9b84a557e90bffd0e>`_

* Resolves: `#1230 <https://github.com/neos/neos-development-collection/issues/1230>`_

`FEATURE: Support search by property & exact value in NodeDataRepository <https://github.com/neos/neos-development-collection/pull/1>`_
---------------------------------------------------------------------------------------------------------------------------------------

Currently it is only possible to search through the properties by
giving a string that matches for any key or value found in the
jsonified properties field.

With this change, the term can also be an array to match exactly on a
given key / value combination.
The search term could be given as `['key' => 'value']`.

NEOS-1460 #close

* Packages: ``Browser``

`Task: Rename TypoScript variables and methods in Fusion <https://github.com/neos/neos-development-collection/pull/1391>`_
--------------------------------------------------------------------------------------------------------------------------

Internal variables and methods that contained TypoScipt are renamed. For renamed methods a fallback method with deprecation note was added.

The major changes are:
- `AbstractFusionObject`: Rename internal variables `tsRuntime` and `typoScriptObjectName` and methods `getTsRuntime` and `tsValue`. The old method names are deprecated. 
- `ArrayImplementation`: Rename method `sortNestedTypoScriptKeys`. The old method name is deprecated. 
- `TypoScriptAwareViewInterface`: The interface is deprecated and extended by the new FusionAwareViewInterface that defines the method name `getFusionObject`.
- `FluidView`: Rename method `getTypoScriptObject`. The old method name is deprecated. 

* Packages: ``Fusion`` ``Neos``

`BUGFIX: Path parameter correctly annotated as string <https://github.com/neos/neos-development-collection/pull/1389>`_
-----------------------------------------------------------------------------------------------------------------------

For `\\Neos\\Fusion\\Core\\Runtime->handleRenderingException()`.

Also changed `$typoScriptPath` and `$typoScriptConfiguration` to `$fusionPath` and `$fusionConfiguration` within this function.

* Packages: ``Fusion``

`BUGFIX: Path parameter correctly annotated as string <https://github.com/neos/neos-development-collection/pull/1390>`_
-----------------------------------------------------------------------------------------------------------------------

For `\\TYPO3\\TypoScript\\Core\\Runtime->handleRenderingException()`.

Fixed for 3.0 in #1389.

`TASK: Add additional Fusion object migration <https://github.com/neos/neos-development-collection/pull/1388>`_
---------------------------------------------------------------------------------------------------------------

* Fixes: `#1363 <https://github.com/neos/neos-development-collection/issues/1363>`_
* Packages: ``Browser`` ``ContentRepository`` ``Fusion`` ``Media`` ``Neos`` ``NodeTypes`` ``SiteKickstarter``

`TASK: Use AssetUsageStrategies in AssetController::deleteAction <https://github.com/neos/neos-development-collection/pull/1379>`_
----------------------------------------------------------------------------------------------------------------------------------

This avoid code duplication by using the central AssetUsageStrategies to
detect if an Asset is used in the current website. This change also remove
a dependency to NodeDataRepository in the controller.

* Packages: ``Browser``

`BUGFIX: Undo accidental changes from PR #1375 <https://github.com/neos/neos-development-collection/pull/1383>`_
----------------------------------------------------------------------------------------------------------------

In https://github.com/neos/neos-development-collection/pull/1375 some
changes were done that do not fir the 3.0 branch.

This reverts those, only leaving the migrations in place, that should
have been added.

* Packages: ``Browser`` ``ContentRepository`` ``Fusion`` ``Media`` ``Neos`` ``NodeTypes`` ``SiteKickstarter``

`BUGFIX: Changing NodeType is broken <https://github.com/neos/neos-development-collection/pull/1378>`_
------------------------------------------------------------------------------------------------------

Without this change, it's impossible to change the NodeType (from the inspector) for a NodeType with a default value for a non-scalar property (e.g. DateTime). The service tries to trim a non-scalar value, and throws an error. 

This change checks if the value is a scalar before trimming and adds a check for null value.

`BUGFIX: Set correct timezoneOffset in DateTime-picker <https://github.com/neos/neos-development-collection/pull/1209>`_
------------------------------------------------------------------------------------------------------------------------

Fixes the bug that the DateTime-picker gets an hour off after
daylight-saving-time switch.

* Fixes: `#851 <https://github.com/neos/neos-development-collection/issues/851>`_

`TASK: Remove deprecated \`\`asset\`\` argument <https://github.com/neos/neos-development-collection/pull/1371>`_
-----------------------------------------------------------------------------------------------------------------

Remove the deprecated ``asset`` argument within the ImageViewHelpers and also replace ``asset`` with ``image`` within various templates.

* Packages: ``Fusion`` ``Neos`` ``NodeTypes``

`TASK: Change Content Repository file monitor identifier <https://github.com/neos/neos-development-collection/pull/1369>`_
--------------------------------------------------------------------------------------------------------------------------

From ``TYPO3CR_NodeTypesConfiguration `` to ``ContentRepository_NodeTypesConfiguration``

* Packages: ``ContentRepository`` ``Fusion``

`BUGFIX: Remove role check when deleting workspaces for users <https://github.com/neos/neos-development-collection/pull/1377>`_
-------------------------------------------------------------------------------------------------------------------------------

This was broken by `5279a7489efcd3c5f5e411b6b5bda11ad1b4ca75 <https://github.com/neos/neos-development-collection/commit/5279a7489efcd3c5f5e411b6b5bda11ad1b4ca75>`_.
Before, checks were done for the role TYPO3.Neos:Editor. However,
checking for AbstractEditor is pointless; workspaces are
now never deleted when a user is deleted. Since the deletePersonalWorkspace
method checks for existence anyway, there's no reason to do
this role check at all. If a user is deleted, his workspaces should be
deleted as well.

* Fixes: `#1376 <https://github.com/neos/neos-development-collection/issues/1376>`_.

`TASK: Rename TypoScript to Fusion in Fusion Package <https://github.com/neos/neos-development-collection/pull/1367>`_
----------------------------------------------------------------------------------------------------------------------

Rename TypoScript to Fusion in the Fusion package in comments and error messages.

* Packages: ``Fusion``

`BUGFIX: Use neos.flow as step definition prefix <https://github.com/neos/neos-development-collection/pull/1368>`_
------------------------------------------------------------------------------------------------------------------

The cach clearing steps compared to the wrong step identifiers
which are now neos.flow.

**What I did**
Fixed the identifiers

**How to verify it**
Content Cache and Fusion file caches are not automatically
cleared in development mode without this patch.

* Packages: ``ContentRepository`` ``Fusion``

`TASK: Replace TYPO3 and TypoScript in documentation <https://github.com/neos/neos-development-collection/pull/1366>`_
----------------------------------------------------------------------------------------------------------------------

**What I did**
This changeset replaces occurences of TYPO3 and
TypoScript in the documentation with corresponding
Neos and Fusion.

Also removes some now wrong references to TYPO3
resources.

**How I did it**
Hand made search-and replace

**How to verify it**
Read it :)

* Packages: ``Neos``

`TASK: PackageManager module must be read only <https://github.com/neos/neos-development-collection/pull/1321>`_
----------------------------------------------------------------------------------------------------------------

This change change the Package Manager backend module to a read only
module. For package management, users needs to use composer from the
CLI.

* Packages: ``Neos``

`BUGFIX: Return \`\`null\`\` if image property comes back empty <https://github.com/neos/neos-development-collection/pull/1359>`_
---------------------------------------------------------------------------------------------------------------------------------

Images removed within the backend no longer return an empty string instead of ``null``. This also fixes regression `2a1c89c7a4ee43c934d9e154fc9164cefc736a06 <https://github.com/neos/neos-development-collection/commit/2a1c89c7a4ee43c934d9e154fc9164cefc736a06>`_ which returns ``null`` even if a default value like empty string or false is set.

* Packages: ``ContentRepository``

`TASK: Use introduced \`\`Parser\\Configuration\`\` access to set package <https://github.com/neos/neos-development-collection/pull/1360>`_
------------------------------------------------------------------------------------------------------------------------------------------

Now that there is a way to access the Interceptors the template
package for the Fusion object can be set as default package for the
resource interceptor.

To reproduce use a relative resource path in a Neos template.

* Packages: ``Fusion`` ``SiteKickstarter``

`TASK: Rename setting \`\`typoScript.autoInclude\`\` to \`\`fusion.autoInclude\`\` <https://github.com/neos/neos-development-collection/pull/1352>`_
----------------------------------------------------------------------------------------------------------------------------------------------------

Additionally the pending core migrations were marked as applied for this package. They were executed but yielded no changes.

* Packages: ``NodeTypes``

`TASK: Adjust conf.py to new branch <https://github.com/neos/neos-development-collection/pull/1357>`_
-----------------------------------------------------------------------------------------------------

* Packages: ``Media`` ``Neos``

`TASK: Adjust package dependencies to new branch(es) <https://github.com/neos/neos-development-collection/pull/1355>`_
----------------------------------------------------------------------------------------------------------------------

* Fixes: `#1353 <https://github.com/neos/neos-development-collection/issues/1353>`_
* Packages: ``Browser`` ``ContentRepository`` ``Fusion`` ``Media`` ``Neos`` ``NodeTypes`` ``SiteKickstarter``

`TASK: Adjust various things to 3.0 branch <https://github.com/neos/neos-development-collection/pull/1356>`_
------------------------------------------------------------------------------------------------------------

This adjusts the configuration for TravisCI, CodeClimate and apigen. On top it
adjusts badges in Readme.rst.

* Packages: ``Neos``

`BUGFIX: RemoveNodePrivilege blocks editing <https://github.com/neos/neos-development-collection/pull/341>`_
------------------------------------------------------------------------------------------------------------

The RemoveNodePrivilege would block editing of nodes completely, since
the inspector would send all properties of a node, but the setter for
"removed" was blocked by the privilege.

Now the privilege only matches on setRemoved(true) and thus only blocks
what it should block.

* Fixes: `#896 <https://github.com/neos/neos-development-collection/issues/896>`_ 

`!!! TASK: Change the autoInclude path for fusion <https://github.com/neos/neos-development-collection/pull/1345>`_
-------------------------------------------------------------------------------------------------------------------

This change also provides a migration to the no longer supported Setting ``Neos.Neos.typoScript`` to ``Neos.Neos.fusion``

* Resolves: `#1344 <https://github.com/neos/neos-development-collection/issues/1344>`_
* Packages: ``Neos``

`TASK: Don’t include removed \`\`Breadcrumb.fusion\`\` file <https://github.com/neos/neos-development-collection/pull/1346>`_
-------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`!!! TASK: Load Neos Routes from settings <https://github.com/neos/neos-development-collection/pull/1343>`_
-----------------------------------------------------------------------------------------------------------

This adjusts the Configuration to include Neos default routes
via Settings.

Background:
Since version 3.1 Flow supports sub routes to be included via configuration
(see http://flowframework.readthedocs.io/en/stable/TheDefinitiveGuide/PartIII/Routing.html#subroutes-from-settings).
This is the recommended way to register routes as it provides greater flexibility.
Note: Any existing `Routes.yaml` file in the global `Configuration` folder take
precedence over routes loaded via Settings.

This change should not break existing installations, but it might lead to routes being loaded twice
or (in rare cases) in a different order.
To make sure, any existing `Routes.yaml` file should be removed from the global `Configuration`
folders and the respective routes should be loaded via Settings (see documentation above).

In order to change the "defaultUriSuffix" from Neos Routes, add the following to your
`Settings.yaml`:

    Neos:
      Flow:
        mvc:
          routes:
            'Neos.Neos':
              variables:
                'defaultUriSuffix': ''

(an empty string will remove the suffix)

* Resolves: `#1342 <https://github.com/neos/neos-development-collection/issues/1342>`_
Related: neos/flow-development-collection#789

* Packages: ``Neos``

`BUGFIX: Adjust exception page title <https://github.com/neos/neos-development-collection/pull/1227>`_
------------------------------------------------------------------------------------------------------

Remove "TYPO3" from error page title tag and NeosBackendMessage title tag

`!!! TASK: Remove deprecated old node label code <https://github.com/neos/neos-development-collection/pull/1313>`_
------------------------------------------------------------------------------------------------------------------

This removes the ``NodeDataLabelGeneratorInterface`` as well
as the respective adaptor and implementation. Additionally
the deprecated ``getFullLabel`` method is removed from the
node interface and implementation. Finally the deprecated
``crop`` argument was removed as well.

This is breaking if you still rely on the old interface or
method. Make sure to migrate to the ``NodeLabelGeneratorInterface``
it's implementations and the ``getLabel`` method.

* Packages: ``ContentRepository``

`TASK: Remove deprecated \`\`reset\`\` method in NodeDataRepository <https://github.com/neos/neos-development-collection/pull/1333>`_
-------------------------------------------------------------------------------------------------------------------------------------

The ``NodeDataRepository::reset`` method was deprecated in previous
releases to be replaced by ``NodeDataRepository::flushNodeRegistry``
which is a full replacement for it. Consequently the former is hereby
removed.

* Packages: ``ContentRepository``

`TASK: Remove deprecated \`\`siteNodeName\`\` argument <https://github.com/neos/neos-development-collection/pull/1334>`_
------------------------------------------------------------------------------------------------------------------------

The ``\\Neos\\Neos\\Command\SiteCommandController::pruneCommand`` now
only reacts to the ``siteNode`` argument. Previously it also accepted
``siteNodeName`` which was deprecated in favor of ``siteNode`` both
having the same effect.

* Packages: ``Neos``

`BUGFIX: Adjust Policy to removed Party relations <https://github.com/neos/neos-development-collection/pull/1337>`_
-------------------------------------------------------------------------------------------------------------------

This adjusts the `Policy.yaml` to use the `UserService` in order to
determine the currently authenticated backend user rather than
`Security\\Context::getParty()` which has been deprecated with 2.0 and
removed with 3.0.

* Fixes: `#1336 <https://github.com/neos/neos-development-collection/issues/1336>`_
* Packages: ``Neos``

`TASK: Add new login screen wallpaper for the new release <https://github.com/neos/neos-development-collection/pull/1340>`_
---------------------------------------------------------------------------------------------------------------------------

* Resolves: `#1335 <https://github.com/neos/neos-development-collection/issues/1335>`_ 
* Packages: ``Neos``

`TASK: Add tests for FusionService::generateFusionForNodeType <https://github.com/neos/neos-development-collection/pull/1248>`_
-------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`BUGFIX: Fix edit preview mode switching <https://github.com/neos/neos-development-collection/pull/1331>`_
----------------------------------------------------------------------------------------------------------

The current path in the UserInterfaceMode object was renamed to fusion and thus the switching of the rendering mode that relied on the expression ``${documentNode.context.currentRenderingMode.typoScriptPath}`` did not work any more.

This change alters the used expression to  ``${documentNode.context.currentRenderingMode.fusionPath}`` and
additionally provides deprecated methods ``getTyoScriptPath`` and ``setTypoScriptPath`` for the UserInterface mode as backwards compatibility layer.

* Packages: ``Neos``

`!!! TASK: Deprecate and rename TypoScript classes <https://github.com/neos/neos-development-collection/pull/1299>`_
--------------------------------------------------------------------------------------------------------------------

This changes adjusts several classes to our new name Fusion. Therefore the ``TypoScriptContextTrait`` and the ``TypoScriptCachingAspect`` as well as the fusion cache key are renamed.
Also the current ``TypoScriptView`` will now be flagged as deprecated in favor for the new introduced ``FusionView``

* Packages: ``Fusion``

`!!! TASK: Adjust cache keys to the new namespace <https://github.com/neos/neos-development-collection/pull/1329>`_
-------------------------------------------------------------------------------------------------------------------

This change provides core migrations to adjust the cache keys to the new vendor namespace. This change is considered as breaking as the old cache keys are no longer supported

* Packages: ``Neos``

`BUGFIX: Adapt to changes in \`\`ConfigurationManager\`\` <https://github.com/neos/neos-development-collection/pull/1327>`_
---------------------------------------------------------------------------------------------------------------------------

Some internals of the Flow ``ConfigurationManager`` changed,
making ``clearConfigurationCache`` the wrong method to call
in the setup, which could lead to broken configuration.

* Packages: ``Neos``

`TASK: Remove deprecated Fusion context variable \`\`editPreviewMode\`\` <https://github.com/neos/neos-development-collection/pull/1322>`_
------------------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`TASK: Removed duplicate line in NodeUri prototype <https://github.com/neos/neos-development-collection/pull/1324>`_
--------------------------------------------------------------------------------------------------------------------

`BUGFIX: Initialize usageStrategies as empty array <https://github.com/neos/neos-development-collection/pull/1323>`_
--------------------------------------------------------------------------------------------------------------------

Currently, the Asset models of the Media package cannot be used without having an AssetUsageStrategy implemented. If no such strategy is implemented (e.g. by using Media without Neos and no need for usage information), using an Asset model will lead to a fatal error because the AssetService is trying to loop $usageStrategies which is not an empty array, but null. Therefore, $usageStrategies must be initialized as an empty array.

`TASK: Rename Setting \`\`typoScriptRenderingPath\`\` to \`\`fusionRenderingPath\`\` <https://github.com/neos/neos-development-collection/pull/1319>`_
------------------------------------------------------------------------------------------------------------------------------------------------------

The setting ``typoScriptRenderingPath`` is deprecated but still supported.
The new setting name is ``fusionRenderingPath``.

* Packages: ``Neos``

`TASK: Build JS & CSS <https://github.com/neos/neos-development-collection/pull/1310>`_
---------------------------------------------------------------------------------------

* Fixes: `#1302 <https://github.com/neos/neos-development-collection/issues/1302>`_
* Packages: ``Neos``

`TASK: Update PHP coding guidelines <https://github.com/neos/neos-development-collection/pull/1300>`_
-----------------------------------------------------------------------------------------------------

`TASK: Adapt Kickstarter to Fusion renaming <https://github.com/neos/neos-development-collection/pull/1308>`_
-------------------------------------------------------------------------------------------------------------

Fixes some wrong paths and internal method names.

* Packages: ``SiteKickstarter``

`BUGFIX: Remove "TypoScript" from method explanation <https://github.com/neos/neos-development-collection/pull/1306>`_
----------------------------------------------------------------------------------------------------------------------

* Packages: ``SiteKickstarter``

`TASK: Do not use deprecated \`\`PropertyMappingConfigurationBuilder\`\` <https://github.com/neos/neos-development-collection/pull/1304>`_
------------------------------------------------------------------------------------------------------------------------------------------

The ``PropertyMappingConfigurationBuilder`` should no longer be used
and can be replaced by calling the
``PropertyMapper::buildPropertyMappingConfiguration`` method.

* Packages: ``Neos``

`TASK: Do not use deprecated \`\`Http\\Request::createActionRequest\`\` <https://github.com/neos/neos-development-collection/pull/1303>`_
----------------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Fusion``

`BUGFIX: Move existing live node in publish <https://github.com/neos/neos-development-collection/pull/1293>`_
-------------------------------------------------------------------------------------------------------------

In order to retain integrity for nodes we need to move an already
existing node that is to be reused to the target path including
all children. Afterwards the node can be published. That keeps
child nodes together with the published parent and avoids orphan
nodes. Also makes sure child nodes will not exist in two paths.

* Fixes: `#1277 <https://github.com/neos/neos-development-collection/issues/1277>`_

`!!! TASK: Rename fusion content cache key to \`\`Neos_Fusion_Content\`\` <https://github.com/neos/neos-development-collection/pull/1296>`_
-------------------------------------------------------------------------------------------------------------------------------------------

This changes the fusion content cache key to ``Neos_Fusion_Content`` and also provides a code migration to adjust the name in yaml and php files

* Packages: ``Fusion`` ``Neos``

`!!! TASK: Change fusions default path pattern to \`\`Resources/Private/Fusion\`\` <https://github.com/neos/neos-development-collection/pull/1287>`_
----------------------------------------------------------------------------------------------------------------------------------------------------

This change adjusts the default path pattern where Fusion will look for `.fusion` files to ``Resources/Private/Fusion``. This change also provides a code migration to move your fusion files to the new path pattern.

This change also drops support for the legacy ``Private/TypoScripts`` path pattern.

* Resolves: `#1286 <https://github.com/neos/neos-development-collection/issues/1286>`_
* Packages: ``Fusion`` ``Neos``

`TASK: Adjust some internal variables and methods for FusionView <https://github.com/neos/neos-development-collection/pull/1295>`_
----------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Fusion``

`TASK: Move all TypoScriptObjects to a new namespace FusionObjects <https://github.com/neos/neos-development-collection/pull/1294>`_
------------------------------------------------------------------------------------------------------------------------------------

This change moves all classes and Templates under ``TypoScriptObject`` to the new path ``FusionObjects``.

Also the two classes ``AbstractTypoScriptObject`` and ``AbstractArrayTypoScriptObject`` are now marked as deprecated and will be dropped with 4.0

* Packages: ``Neos``

`TASK: Add PHP 7.1 to .travis.yml <https://github.com/neos/neos-development-collection/pull/1291>`_
---------------------------------------------------------------------------------------------------

Now that PHP 7.1 is released, we should make sure we are compatible.

`TASK: Change namespace for fusion implementation and helper classes w… <https://github.com/neos/neos-development-collection/pull/1289>`_
-------------------------------------------------------------------------------------------------------------------------------------------

This change moves the namespace `Neos\\Neos\\TypoScript` to `Neos\\Neos\\Fusion`. There is also a code migration provided in case an implementation or helper class is extended.

* Resolves: `#1288 <https://github.com/neos/neos-development-collection/issues/1288>`_
* Packages: ``Neos``

`BUGFIX: Show changes in ContentCollection-Nodes in review-module <https://github.com/neos/neos-development-collection/pull/1184>`_
-----------------------------------------------------------------------------------------------------------------------------------

This change adds the visualization of changes on ``TYPO3.Neos:ContentCollection`` nodes that also have the type ``TYPO3.Neos:Content`` to the review module. 

Previously those changes were filtered out which prevented the visualization of changes and lead to the page beeing visualized as having changes without showing them in the review module.

`FEATURE: Introduce new FusionView <https://github.com/neos/neos-development-collection/pull/1276>`_
----------------------------------------------------------------------------------------------------

This change will introduce a new FusionView wich is the new default and deprecate the old TypoScriptView wich will be removed with the next major version.

* Resolves: `#1268 <https://github.com/neos/neos-development-collection/issues/1268>`_
* Packages: ``Fusion``

`TASK: Adjust StyleCI config to changed & new names <https://github.com/neos/neos-development-collection/pull/1281>`_
---------------------------------------------------------------------------------------------------------------------




`TASK: Rename TypoScriptPathProxy to FusionPathProxy <https://github.com/neos/neos-development-collection/pull/1273>`_
----------------------------------------------------------------------------------------------------------------------

* Resolves: `#1269 <https://github.com/neos/neos-development-collection/issues/1269>`_
* Packages: ``Fusion``

`TASK: Use defined version constraints in 2.3 manifests <https://github.com/neos/neos-development-collection/pull/1275>`_
-------------------------------------------------------------------------------------------------------------------------

The composer manifests for Neos 2.3 were not correctly adapted
to use release versions only. Therefore installations could break
after we tag stable versions of the next major as these would
be pulled in by the current constraints.

This change adds the missing constraints to Neos packages to
prevent that.

* Fixes: `#1247 <https://github.com/neos/neos-development-collection/issues/1247>`_

`!!! TASK: Remove deprecated \`\`LegacySiteImportService\`\` <https://github.com/neos/neos-development-collection/pull/1265>`_
------------------------------------------------------------------------------------------------------------------------------

The ``LegacySiteImportService`` was deprecated since Neos 1.1
and is therefore removed in this major release.

If you still have files in the legacy format you should import
them to a Neos 2.x and re-export to the current format.

* Packages: ``Neos``

`BUGFIX: Use type cast in PostgreSQL migration 20161125125249 <https://github.com/neos/neos-development-collection/pull/1266>`_
-------------------------------------------------------------------------------------------------------------------------------

The properties column is of type jsonb, so REPLACE needs to use CAST.

* Packages: ``Neos``

`BUGFIX: preview/edit modes share content cache <https://github.com/neos/neos-development-collection/pull/1251>`_
-----------------------------------------------------------------------------------------------------------------

This change fixes an issue with the edit and preview modes in Neos which result in unexpected output if modes are based on the same Fusion object path.

Prior to this change, preview mode "Desktop" and the edit mode "In-Place" shared a Fusion content
cache. If a site integrator wanted to react on the current mode in her Fluid template (using the
{neos:rendering.inEditMode()} view helper calls) she will get wrong results, depending on which
mode has been called first with an empty cache.

This change now introduces the mode identifier as a new part of the content cache identifier.
Additionally, edit / preview mode buttons will now trigger a reload even for modes which are
based on the same Fusion object path.

* Resolves: `#1249 <https://github.com/neos/neos-development-collection/issues/1249>`_

`!!! TASK: Add autoload-dev section to composer.json for loading test classes <https://github.com/neos/neos-development-collection/pull/1250>`_
-----------------------------------------------------------------------------------------------------------------------------------------------

Tis necessary since the special logic of the class loader for loading tests will be removed from flow.

`BUGFIX: Adjust package names in \`\`travis.yaml\`\` <https://github.com/neos/neos-development-collection/pull/1264>`_
----------------------------------------------------------------------------------------------------------------------

`BUGFIX: Fix broken test suite <https://github.com/neos/neos-development-collection/pull/1263>`_
------------------------------------------------------------------------------------------------

`TASK: Rename \`\`TYPO3CRIntegrationService\`\` to \`\`ContentRepositoryInte… <https://github.com/neos/neos-development-collection/pull/1261>`_
-------------------------------------------------------------------------------------------------------------------------------------------------

* Packages: ``Neos``

`BUGIFX: Add missing comments in Settings.yaml <https://github.com/neos/neos-development-collection/pull/1260>`_
----------------------------------------------------------------------------------------------------------------

The code migration is not able to keep comments within yaml files. This change will add missing comments.

* Resolves: `#1255 <https://github.com/neos/neos-development-collection/issues/1255>`_ 
* Packages: ``Media`` ``Neos``

`TASK: Use neos-* as composer package type consistently <https://github.com/neos/neos-development-collection/pull/1242>`_
-------------------------------------------------------------------------------------------------------------------------

Related to #1241 

* Packages: ``Browser`` ``Media``

`TASK: Add Doctrine migrations to rename tables <https://github.com/neos/neos-development-collection/pull/1256>`_
-----------------------------------------------------------------------------------------------------------------

Related to the vendor name change, see neosneos-development-collection#1240

* Packages: ``ContentRepository`` ``Media`` ``Neos`` ``SiteKickstarter``

`!!!TASK: Adjust to the new Package API <https://github.com/neos/neos-development-collection/pull/1234>`_
---------------------------------------------------------------------------------------------------------

`BUGFIX: Adjust test to removed setParty() method <https://github.com/neos/neos-development-collection/pull/1247>`_
-------------------------------------------------------------------------------------------------------------------

Related to neos/flow-development-collection#457

`TASK: Use partyService instead of deprecated method \`\`securityContext… <https://github.com/neos/neos-development-collection/pull/1246>`_
---------------------------------------------------------------------------------------------------------------------------------------------

This implements the neos-side of pr neos/flow-development-collection#457
wich removed the direct party account relation in flow.

`!!! FEATURE: Configurable Fusion node type prototype generators <https://github.com/neos/neos-development-collection/pull/767>`_
---------------------------------------------------------------------------------------------------------------------------------

- If `fusion.prototypeGenerator` is set to a className the class has to implement the interface
  `\\TYPO3\\Neos\\Domain\\Service\\DefaultPrototypeGeneratorInterface` and is used to generate the prototype-code
  for this node.
- If `fusion.prototypeGenerator` is set to `null` no prototype is created for this type.

For nodeTypes based on `TYPO3.Neos:Node`, `TYPO3.Neos:Document` or `TYPO3.Neos:Content` a backwards compatible implementation is added to the configuration and a new prototype generator for `TYPO3.Neos:Plugin` is added.

`BUGFIX: Remove outdated CommonMarkConverter setup <https://github.com/neos/neos-development-collection/pull/1245>`_
--------------------------------------------------------------------------------------------------------------------

Removed in neos/neos-development-collection#1208 the configuration
for CommonMarkConverter in Objects.yaml was left in place.

`TASK: translate help messages on the client side <https://github.com/neos/neos-development-collection/pull/1208>`_
-------------------------------------------------------------------------------------------------------------------

The help messages feature was implemented on the server side. Because of that, the help messages were cached and would not refresh during language switching. Also, it slowed down every request.
This moves the logic to the client.

I implemented the same functionality on the client side: help messages are translated and parsed in JavaScript using this markdown parser: https://github.com/chjj/marked

`BUGFIX: Use correct namespaces in EditableViewHelperTests <https://github.com/neos/neos-development-collection/pull/1244>`_
----------------------------------------------------------------------------------------------------------------------------

This resolves the issue #723 on the Neos side and complements PR neos/flow-development-collection#722

`BUGFIX: on editing changes and backend reload, ensure the content area updates properly <https://github.com/neos/neos-development-collection/pull/1243>`_
----------------------------------------------------------------------------------------------------------------------------------------------------------

## How to reproduce

- see #1238
- Changes applied in the inspector are only visible in the user interface
  after a manual browser reload. Appears on the Demo Website.


## Problem Description

* it turns out that the *content replacement* on-reload was broken.
* this led to the content area not-refreshing
* ... and also updated the publish button wrongly (as this data is loaded
  from the content area).

The content-replacement on-reload was broken because of wrong HTML ordering
in the Page prototype; i.e. the "neosBackendContainer" is supposed to be
rendered at the *end* of the page (directly before the closing body tag);
but it was rendered even before the body.

This error is a regression introduced by https://github.com/neos/neos-development-collection/pull/684 - while adding another level of indirection,
the @position element was moved downwards and not kept at the top-level.

* Resolves: `#1238 <https://github.com/neos/neos-development-collection/issues/1238>`_

`FEATURE: Add prototype \`\`TYPO3.TypoScript:Renderer\`\` <https://github.com/neos/neos-development-collection/pull/1217>`_
---------------------------------------------------------------------------------------------------------------------------

The Renderer object will evaluate to a result using either ``renderer``, ``renderPath`` or ``type`` on the configuration.

`FEATURE: Add fusion-prototype \`\`TYPO3.TypoScript:RawCollection\`\` <https://github.com/neos/neos-development-collection/pull/1216>`_
---------------------------------------------------------------------------------------------------------------------------------------

Other than ``TYPO3.TypoScript:Collection`` the ``TYPO3.TypoScript:RawCollection`` returns
an array of the rendered items instead of a concatenated string.

`TASK: Adjust to renamed Object and Resource namespaces/classes <https://github.com/neos/neos-development-collection/pull/1221>`_
---------------------------------------------------------------------------------------------------------------------------------

This adjusts the code as needed for neos/flow-development-collection#719

`TASK: Depend on Fluid Adaptor <https://github.com/neos/neos-development-collection/pull/1236>`_
------------------------------------------------------------------------------------------------

As the Neos packages rely on Fluid to render their templates
it makes sense to require the fluid adaptor in those packages.

* Resolves: `#1235 <https://github.com/neos/neos-development-collection/issues/1235>`_ 

`TASK: Refactor TYPO3.Neos.Kickstarter to use PSR-4 <https://github.com/neos/neos-development-collection/pull/1188>`_
---------------------------------------------------------------------------------------------------------------------

`BUGFIX: Return \`\`null\`\` for empty node properties <https://github.com/neos/neos-development-collection/pull/1232>`_
------------------------------------------------------------------------------------------------------------------------

Node properties that are empty now return ``null`` without propertyMapping instead of the value stored in the properties-json. This fixes a problem if an asset was selected but later on deleted that previously lead to the asset property returning an empty string.

`BUGFIX: Set default sort direction of the media browser to \`DESC\` <https://github.com/neos/neos-development-collection/pull/1231>`_
--------------------------------------------------------------------------------------------------------------------------------------

Changed sortDirection of the media browser back to DESC, so we see the most current media files in the media browser on the top.

This is a possible fix for Issue: https://github.com/neos/neos-development-collection/issues/1230 without the possibility for configuration.

`TASK: Rename hostPattern to hostname in Domain <https://github.com/neos/neos-development-collection/pull/606>`_
----------------------------------------------------------------------------------------------------------------

Since 2013 the `hostPattern` has a `HostnameValidator` attached, so setting
a wildcard was not supported any longer.

This change renames `hostPattern` to `hostname` throughout the code and
adjusts the `DomainMatchingStrategy` to no longer support the `*` wildcard.
It therefore makes things clearer and avoid misconceptions about how
Domain entries work in Neos.

`FEATURE: Create empty sites for existing site packages in sites backend module <https://github.com/neos/neos-development-collection/pull/757>`_
------------------------------------------------------------------------------------------------------------------------------------------------

Currently the backend module to create a new site only allows to import a site from an existing site-package or to create a new site-package if the kickstarter is installed.

This change allows to create a new site-node for an existing site-package in the administration-site module. Therefore a new section was added to the module where the user selects site-package-key and rootNode document-type and site-name.

`BUGFIX: Fix error in editAction in the siteController <https://github.com/neos/neos-development-collection/pull/1229>`_
------------------------------------------------------------------------------------------------------------------------

The editAction threw an error because a not existing title property in the sitePackageMetaData was accessed. Since getPackageMetaData is deprecated this is refactored to use the informations from the package domain model. The code to display the package title was removed since this property does not exist in composer files.

`BUGFIX: Fix wrong indentations in documentation <https://github.com/neos/neos-development-collection/pull/1228>`_
------------------------------------------------------------------------------------------------------------------

Adjust wrong indentations in PropertyEditorReference documentation.

`TASK: Documentation example of using multiple EEL filters <https://github.com/neos/neos-development-collection/pull/571>`_
---------------------------------------------------------------------------------------------------------------------------

`TASK: Testing checkout must not be git repository <https://github.com/neos/neos-development-collection/pull/1224>`_
--------------------------------------------------------------------------------------------------------------------

`TASK: Use ComposerManifestUpdater in TravisCI builds <https://github.com/neos/neos-development-collection/pull/1223>`_
-----------------------------------------------------------------------------------------------------------------------

`TASK: Make Neos backend parts fully cacheable in frontend <https://github.com/neos/neos-development-collection/pull/684>`_
---------------------------------------------------------------------------------------------------------------------------

`TASK: Use class constant instead of strings <https://github.com/neos/neos-development-collection/pull/1219>`_
--------------------------------------------------------------------------------------------------------------

`TASK: Adapt to standalone fluid <https://github.com/neos/neos-development-collection/pull/633>`_
-------------------------------------------------------------------------------------------------

Adapt Neos to the standalone Fluid integration in Flow.

`FEATURE: Add setting \`\`TYPO3.Neos.defaultSiteNodeName\`\` <https://github.com/neos/neos-development-collection/pull/1183>`_
------------------------------------------------------------------------------------------------------------------------------

This change adds a setting defaultSiteNodeName wich allows to configure the behavior for requests without matching host name pattern.

If a request is not mapped to a site via domain pattern Neos currently uses the first active site. 
This is difficult in multisite environments especially since there is no manual order of the sites and currently there is no way to control which site is shown in this case.

`FEATURE: Add Commands \`\`site:create\`\`, \`\`site:activate\`\` and \`\`site:decativate\`\` <https://github.com/neos/neos-development-collection/pull/636>`_
--------------------------------------------------------------------------------------------------------------------------------------------------------------

This command adds the `site:create`command that allows to create a blank site with just a single empty document in the default dimension. The name of the site, the packageKey must be specified.

If no nodeType option is specified the command will use `TYPO3.Neos.NodeTypes:Page` as fallback. The node type must already exists and have the superType `TYPO3.Neos:Document`.

If no `nodeName` option is specified the command will create a unique node-name from the name of the site. If a node name is given it has to be unique.

If the flag ``inactivate` is set the new site will not be activated.

The commands `site:activate` and `site:deactivate` are added to bring the according feature of the neos-ui to the cli.

The command `site:list` is extended to display the online state of the sites now.

Additional the  error format of the `site:import` and `site:export` command is altered to use the error format instead of an "Error:" prefix.

`How to Contribute to the Neos Documentation <https://github.com/neos/neos-development-collection/pull/725>`_
-------------------------------------------------------------------------------------------------------------

This is a step by step Sphinx-Guide of how to Contribute to the Neos Documentation. Please check if that is a good workflow, if there is some steps missing or if you would change something.

`BUGFIX: Render empty \`alt\` attribute in ImageViewHelper <https://github.com/neos/neos-development-collection/pull/1207>`_
----------------------------------------------------------------------------------------------------------------------------

With this the ImageViewHelper will always include an alt attribute, even if
not given.

Includes some namespace imports only present in 2.2 branch.

* Fixes: `#1075 <https://github.com/neos/neos-development-collection/issues/1075>`_ 

`!!!TASK: Remove deprecated class \`\`IncludeJavaScriptViewHelper\`\` <https://github.com/neos/neos-development-collection/pull/695>`_
--------------------------------------------------------------------------------------------------------------------------------------

`BUGFIX: Let DateStringConverter accept \`\`DateTimeInterface\`\` <https://github.com/neos/neos-development-collection/pull/1215>`_
-----------------------------------------------------------------------------------------------------------------------------------

This lowers the matching possibility for this specialized type
converter to avoid it being used accidentally on DateTime instances
instead of the Flow ``StringConverter``.

This indirectly fixes a problem with tests exhibited in master
because Flow master has a changed ``StringConverter`` that is now
assigned a lower priority for ``DateTime`` objects than this
converter, which is unexpected.

`TASK: Update composer.json <https://github.com/neos/neos-development-collection/pull/1196>`_
---------------------------------------------------------------------------------------------

This updates the composer.json in `TYPO3.Neos.NodeTypes` and removes the packge-key entry wich was added by mistake and also updates the root `composer.json` with an autogenerated version of our ComposreManifestMerger.php

`TASK: remove duplicate privilege check from NodeController <https://github.com/neos/neos-development-collection/pull/682>`_
----------------------------------------------------------------------------------------------------------------------------

This check is already handled by policies:
- TYPO3.Neos:PublicFrontendAccess
- TYPO3.Neos:Backend.GeneralAccess

If that redundancy is removed it makes it possible to use the
`TYPO3.Neos:Backend.OtherUsersPersonalWorkspaceAccess` policy
to grant access to any workspace to e.g. other authenticated users.
This is necessary to build a preview mechanism without an authenticated
backend user to share the state of your content with external previewers.

`TASK: Do not ignore errors when converting values in node import service <https://github.com/neos/neos-development-collection/pull/713>`_
------------------------------------------------------------------------------------------------------------------------------------------

With this change errors during element conversion are no longer silently ignored but
throw an exception during import. Before the value was simply converted to null.

* Resolves: `#711 <https://github.com/neos/neos-development-collection/issues/711>`_ 

`TASK: Remove duplicate privilege check from NodeController <https://github.com/neos/neos-development-collection/pull/689>`_
----------------------------------------------------------------------------------------------------------------------------

This check is already handled by policies:
- TYPO3.Neos:PublicFrontendAccess
- TYPO3.Neos:Backend.GeneralAccess

If that redundancy is removed it makes it possible to use the
`TYPO3.Neos:Backend.OtherUsersPersonalWorkspaceAccess` policy
to grant access to any workspace to e.g. other authenticated users.
This is necessary to build a preview mechanism without an authenticated
backend user to share the state of your content with external previewers.

`TASK: Add __type when converting assets to array <https://github.com/neos/neos-development-collection/pull/632>`_
------------------------------------------------------------------------------------------------------------------

`TASK: Add warning about breaking change in 2.3 <https://github.com/neos/neos-development-collection/pull/1170>`_
-----------------------------------------------------------------------------------------------------------------

Added warning about breaking change in 2.3

`TASK: Replace ImageEditor button labels by icons <https://github.com/neos/neos-development-collection/pull/1200>`_
-------------------------------------------------------------------------------------------------------------------

Replaces the ImageEditor button labels by corresponding icons in order to avoid
buttons from breaking the design in languages with longer word and in order to
improve UX in general.

* Resolves: `#1199 <https://github.com/neos/neos-development-collection/issues/1199>`_

`TASK: document @ignoreProperties in TYPO3.TypoScript:Array <https://github.com/neos/neos-development-collection/pull/1201>`_
-----------------------------------------------------------------------------------------------------------------------------

`FEATURE: New behat node operation features <https://github.com/neos/neos-development-collection/pull/1146>`_
-------------------------------------------------------------------------------------------------------------

Adds new features for behat tests using nodes

`TASK: Correct ContentCollection reference <https://github.com/neos/neos-development-collection/pull/1197>`_
------------------------------------------------------------------------------------------------------------

`BUGFIX: Wrong Namespace for Template in docs <https://github.com/neos/neos-development-collection/pull/1192>`_
---------------------------------------------------------------------------------------------------------------

It's `TYPO3.TypoScript:Template` instead of `TYPO3.Neos:Template`

`BUGFIX: Fix static compilation of ThumbnailGeneratorStrategy <https://github.com/neos/neos-development-collection/pull/1182>`_
-------------------------------------------------------------------------------------------------------------------------------

This fixes `ThumbnailGeneratorStrategy::getThumbnailGeneratorClassNames()` making the
method `public`.
Without this fix, the method is silently skipped from static compilation and will always
use reflection to determine classes implementing `ThumbnailGeneratorInterface`.

Note: With resolution of neos/flow-development-collection#662 this will prevent compilation
in Production context

`TASK: Fix typo, fix path to TextFieldEditor <https://github.com/neos/neos-development-collection/pull/1181>`_
--------------------------------------------------------------------------------------------------------------

The path to the `TextFieldEditor` is missing the `Inspector` path part.

`BUGFIX: fix typos in sample code of Translate NodeTypes documentation <https://github.com/neos/neos-development-collection/pull/1173>`_
----------------------------------------------------------------------------------------------------------------------------------------

It fixes small typos where trans-unit tag in sample code is not properly closed.

So it changes `</trans-uni>` to `</trans-unit>`

* Packages: ``github``

`BUGFIX: Allow determination of \`\`ReadNodePrivilege\`\` <https://github.com/neos/neos-development-collection/pull/649>`_
--------------------------------------------------------------------------------------------------------------------------

Previously the `ReadNodePrivilege` did not implement a `matchesSubject()`
method falling back to the default behavior of _not_ matching any subject.

Usually this is not an issue because nodes protected by this privilege will
normally not be loaded anyways, but it prevents "pro-active" lookups for
this privilege using the `PrivilegeManager`::

```
$privilegeManager->isGranted(ReadNodePrivilege::class, $node)
```

Without this fix, the above will always return FALSE.

* Related: `NEOS-945 <https://jira.neos.io/browse/NEOS-945>`_

`BUGFIX: Re-add CSS class in edit asset view <https://github.com/neos/neos-development-collection/pull/1171>`_
--------------------------------------------------------------------------------------------------------------

This label class got lost during an upmerge in commit
`a4f1091d25f2d53a1bd31566081ef16c517d47cf <https://github.com/neos/neos-development-collection/commit/a4f1091d25f2d53a1bd31566081ef16c517d47cf>`_.

`BUGFIX: Use up-to-date translation method in history module <https://github.com/neos/neos-development-collection/pull/1168>`_
------------------------------------------------------------------------------------------------------------------------------

Removal of `TranslationHelper::translateById` in Flow `3.3.4` (https://github.com/neos/flow/commit/`09deb9e1e0041f20b7f3ec54af8f1fcbef92e6f0 <https://github.com/neos/neos-development-collection/commit/09deb9e1e0041f20b7f3ec54af8f1fcbef92e6f0>`_) broke the `UserInitialsViewHelper` and therefore the history module.

`BUGFIX: Fix and amend example in NodeType definition <https://github.com/neos/neos-development-collection/pull/1164>`_
-----------------------------------------------------------------------------------------------------------------------

`TASK: Add github templates <https://github.com/neos/neos-development-collection/pull/752>`_
--------------------------------------------------------------------------------------------

* Packages: ``github``

`BUGFIX: Discard selected nodes which were moved corrupts workspace <https://github.com/neos/neos-development-collection/pull/756>`_
------------------------------------------------------------------------------------------------------------------------------------

The "discard selected nodes" feature in the Workspace Review module
leaves orphaned nodes after discarding moved document nodes. The result
is a seemingly empty workspace which in fact still contains nodes.
The workspace can't be deleted. The discarded document node still may
appear in the Content Module's navigation but won't render.

Steps to reproduce based on the Neos demo site:
- start with a clean user workspace
- move the page Download into the page Try me
- go to the review module (Publish Menu -> Review changes)
- select all changes
- press "Discard selected changes"

The document node has been removed, but the child nodes, including the
corresponding shadow nodes, still exist in the database.

Closes #953

`BUGFIX: Unpublished new nodes still have shadow nodes after removal <https://github.com/neos/neos-development-collection/pull/1167>`_
--------------------------------------------------------------------------------------------------------------------------------------

When an editor creates a new page and then deletes the page again,
the workspace module will show pending changes because shadow nodes
exist for that delete page. Because the page has never been published,
Neos should just really delete the respective nodes from the user's
workspace instead of creating shadow nodes.

This change checks if a node marked for removal exists at all in one
of the base workspaces and if it doesn't, removes it completely instead
of creating a shadow node.

* Resolves: `#1163 <https://github.com/neos/neos-development-collection/issues/1163>`_

`BUGFIX: Test using the 2.3 branch of the distribution <https://github.com/neos/neos-development-collection/pull/1166>`_
------------------------------------------------------------------------------------------------------------------------

`TASK: Fix wrong namespaces <https://github.com/neos/neos-development-collection/pull/1162>`_
---------------------------------------------------------------------------------------------

`BUGFIX: Show delete asset dialog in edit asset media view <https://github.com/neos/neos-development-collection/pull/1158>`_
----------------------------------------------------------------------------------------------------------------------------

When clicking the delete asset button in the footer of the edit asset view in the media browser/module the dialog isn't shown due to overflow on the sticky footer is hidden. To circumvent this the dialog html is placed outside the footer.

`BUGFIX: Return default for loadMinifiedJavaScript <https://github.com/neos/neos-development-collection/pull/707>`_
-------------------------------------------------------------------------------------------------------------------

If config for `TYPO3.Neos.userInterface.loadMinifiedJavaScript` is not set, we return TRUE as default.

`BUGFIX: Prevent overflow issue when showing delete dialog in sites edit view <https://github.com/neos/neos-development-collection/pull/1157>`_
-----------------------------------------------------------------------------------------------------------------------------------------------

When clicking the delete site button in the sites administration module's edit view, the following buttons jump a little due to overflow issues. This is circumvented by moving the dialog html outside of the footer.

`TASK: Media browser fixes and improvements <https://github.com/neos/neos-development-collection/pull/532>`_
------------------------------------------------------------------------------------------------------------

Fixes and improves a bunch of different issues related to the media browser.
- Dropdown menu overflow
- Dropdown font size
- Notifications not shown inside media browser (iframe)
- Missing jQuery library when showing asset usages in media browser (iframe)
- Clicking image thumbnail again to close leads to an error
- Clicking image thumbnail and then usages and then cancel goes to overview instead of details
- Clicking image thumbnail in inspector and then clicking the close button leads to an error (fixes #1135)
- Translate labels
- No file selected in upload / replace doesn't display any error
- Make "Asset in use / not in use more clear"
- Clicking image thumbnail and then cancel goes to overview and then clicking an asset leads to an error
- Adjust styling of asset details in thumbnail view
- Translate flash message when deleting used asset

`TASK: Clean up and fix .gitgnore files a bit <https://github.com/neos/neos-development-collection/pull/1154>`_
---------------------------------------------------------------------------------------------------------------

`BUGFIX: Re-add ContentModule-built.js <https://github.com/neos/neos-development-collection/pull/1153>`_
--------------------------------------------------------------------------------------------------------

The ContentModule-built.js has accidentally be removed during an upmerge
from 2.1 to 2.2 in commit `4efb95cf46db796d2171d63279f93d970405bef8 <https://github.com/neos/neos-development-collection/commit/4efb95cf46db796d2171d63279f93d970405bef8>`_.

This change adds a recently compiled file again.

`BUGFIX: Undefined variable in AssetController <https://github.com/neos/neos-development-collection/pull/1152>`_
----------------------------------------------------------------------------------------------------------------

The upmerge from 2.2 to 2.3 introduced a regression because of
an undefined variable. This was probably introduced because of
a merge conflict with `427d0ed70e5365fa906f4196c936e4c9271d266e <https://github.com/neos/neos-development-collection/commit/427d0ed70e5365fa906f4196c936e4c9271d266e>`_

`TASK: Require the correct flow version dev-master <https://github.com/neos/neos-development-collection/pull/1151>`_
--------------------------------------------------------------------------------------------------------------------

`BUGFIX: Image upload is broken: Asset instead of ImageInterface <https://github.com/neos/neos-development-collection/pull/1150>`_
----------------------------------------------------------------------------------------------------------------------------------

This fixes an issue with the Asset converter which resulted in a broken
image upload function.

During the refactoring from `Resource` to `PersistentResource`, the
remaining occurrences of `Resource` haven't been adjusted in
`AssetInterfaceConverter`. This didn't lead to a direct error, but
the condition where `Resource` was still used, could never match.

* Fixes: `#1149 <https://github.com/neos/neos-development-collection/issues/1149>`_

`BUGFIX: Personal workspace is always deleted when user is deleted <https://github.com/neos/neos-development-collection/pull/1140>`_
------------------------------------------------------------------------------------------------------------------------------------

The `TYPO3.Neos:Editor` role isn't always necessary for a user to have a personal workspace.

If there doesn't exist a workspace for that user, it will be handled in `deletePersonalWorkspace()` anyway.

`BUGFIX: Check for null values after translation of FlashMessages <https://github.com/neos/neos-development-collection/pull/1147>`_
-----------------------------------------------------------------------------------------------------------------------------------

To make sure that after translation no null value is given as argument
to `parent::addFlashMessage` we should prevent null values.

`BUGFIX: Hide "Create new workspace" button when not authorized <https://github.com/neos/neos-development-collection/pull/676>`_
--------------------------------------------------------------------------------------------------------------------------------

`BUGFIX: node:repair breaks at dimensions with fallbacks <https://github.com/neos/neos-development-collection/pull/755>`_
-------------------------------------------------------------------------------------------------------------------------

* Fixes: `NEOS-1888 <https://jira.neos.io/browse/NEOS-1888>`_

`BUGFIX: Two node publishing issues <https://github.com/neos/neos-development-collection/pull/763>`_
----------------------------------------------------------------------------------------------------

- Flush routing cache when a node is discarded
- Use publishing service to publish workspace in workspaces module

`TASK: Refactor absolute namespaces in Media / Domain <https://github.com/neos/neos-development-collection/pull/727>`_
----------------------------------------------------------------------------------------------------------------------

`TASK: Refactor absolute namespaces in Media / Tests <https://github.com/neos/neos-development-collection/pull/728>`_
---------------------------------------------------------------------------------------------------------------------

`TASK: Refactor absolute namesace in neos cr / security <https://github.com/neos/neos-development-collection/pull/745>`_
------------------------------------------------------------------------------------------------------------------------

`TASK: Refactor absolute namespaces in Media package <https://github.com/neos/neos-development-collection/pull/726>`_
---------------------------------------------------------------------------------------------------------------------

`TASK: Refactor absolute namespaces Neos / Domain <https://github.com/neos/neos-development-collection/pull/734>`_
------------------------------------------------------------------------------------------------------------------

`TASK: Refactor absolute namespaces in Neos / Service <https://github.com/neos/neos-development-collection/pull/732>`_
----------------------------------------------------------------------------------------------------------------------

`TASK: Refactor absolute namespace in neos cr / domain <https://github.com/neos/neos-development-collection/pull/741>`_
-----------------------------------------------------------------------------------------------------------------------

`TASK: Refactor absolute namepscae in neos cr / eel <https://github.com/neos/neos-development-collection/pull/742>`_
--------------------------------------------------------------------------------------------------------------------

`TASK: Refactor absolute namespace in neos fusion <https://github.com/neos/neos-development-collection/pull/749>`_
------------------------------------------------------------------------------------------------------------------

`TASK: Refactor absolute namespace in neos fusion tests <https://github.com/neos/neos-development-collection/pull/750>`_
------------------------------------------------------------------------------------------------------------------------

`TASK: Refactor absolute namespaces in Neos / Kickstarter <https://github.com/neos/neos-development-collection/pull/740>`_
--------------------------------------------------------------------------------------------------------------------------

`BUGFIX: Ignore null for references property in NodeConverter <https://github.com/neos/neos-development-collection/pull/1143>`_
-------------------------------------------------------------------------------------------------------------------------------

This change makes the NodeConverter accept null for references properties,
a behavior also present for other property types (e.g. DateTime).

* Fixes: `#1142 <https://github.com/neos/neos-development-collection/issues/1142>`_

`TASK: Refactor absolute namespace in neos cr / functional tests <https://github.com/neos/neos-development-collection/pull/747>`_
---------------------------------------------------------------------------------------------------------------------------------

`TASK: Refactor absolute namespace in neos cr / unit tests <https://github.com/neos/neos-development-collection/pull/748>`_
---------------------------------------------------------------------------------------------------------------------------

`TASK: Refactor absolute namepsace in neos cr / exception <https://github.com/neos/neos-development-collection/pull/743>`_
--------------------------------------------------------------------------------------------------------------------------

`TASK: Refactor to absolute namespace in neos cr <https://github.com/neos/neos-development-collection/pull/746>`_
-----------------------------------------------------------------------------------------------------------------

`TASK: Refactor absolute namespace in neos cr / migration <https://github.com/neos/neos-development-collection/pull/744>`_
--------------------------------------------------------------------------------------------------------------------------

`TASK: Refactor absolute namespaces in Neos <https://github.com/neos/neos-development-collection/pull/739>`_
------------------------------------------------------------------------------------------------------------

`TASK: Refactor absolute namespaces in Neos / Validation <https://github.com/neos/neos-development-collection/pull/738>`_
-------------------------------------------------------------------------------------------------------------------------

`TASK: TASK: Refactor absolute namespaces in Neos / Aspects <https://github.com/neos/neos-development-collection/pull/737>`_
----------------------------------------------------------------------------------------------------------------------------

`TASK: Refactor absolute namespaces in Neos / Controller <https://github.com/neos/neos-development-collection/pull/736>`_
-------------------------------------------------------------------------------------------------------------------------

`TASK: Refactor absolute namespaces Neos / Command <https://github.com/neos/neos-development-collection/pull/735>`_
-------------------------------------------------------------------------------------------------------------------

`TASK: Refactor absolute namespaces in Neos / Routing <https://github.com/neos/neos-development-collection/pull/733>`_
----------------------------------------------------------------------------------------------------------------------

`TASK: Refactor absolute namespaces in Neos / Eventlog <https://github.com/neos/neos-development-collection/pull/731>`_
-----------------------------------------------------------------------------------------------------------------------

`TASK: Refactor absolute namespaces in Neos / Tests <https://github.com/neos/neos-development-collection/pull/730>`_
--------------------------------------------------------------------------------------------------------------------

`TASK: Refactor absolute namespaces in Neos / VH <https://github.com/neos/neos-development-collection/pull/729>`_
-----------------------------------------------------------------------------------------------------------------

`BUGFIX: Replace stylesheets with less side-effects <https://github.com/neos/neos-development-collection/pull/764>`_
--------------------------------------------------------------------------------------------------------------------

Improves the replacement of stylesheets by avoiding removing them unless actually changed between page loads. Without it a FOUC (flash of unstyled content) appears under some conditions like slow connection, device, server or similar.

Regression introduced with #375 which takes a very basic approach to solve the issue.

`BUGFIX: Fix styling for asset details in thumbnail view <https://github.com/neos/neos-development-collection/pull/665>`_
-------------------------------------------------------------------------------------------------------------------------

This fixes the appearance of the asset details within the media browser.

`BUGFIX: Clickable labels in the media views <https://github.com/neos/neos-development-collection/pull/761>`_
-------------------------------------------------------------------------------------------------------------

Since Fluid generates the `name` attribute based on the object relation, some of the fields need to be assigned a id to match their label tag.

`BUGFIX: Prevent nesting level too deep error in checkbox view helper <https://github.com/neos/neos-development-collection/pull/762>`_
--------------------------------------------------------------------------------------------------------------------------------------

To prevent a recursive comparison which can lead to this error, strict comparison is used which only compares the reference.

This issue occurs in the edit asset collection view in the media module.

`BUGFIX: Cancel in editing user settings links to user module <https://github.com/neos/neos-development-collection/pull/753>`_
------------------------------------------------------------------------------------------------------------------------------

Cancel in editing user settings links to user module instead of management module.

`BUGFIX: Only show pointer cursor for label tags with for attribute <https://github.com/neos/neos-development-collection/pull/760>`_
------------------------------------------------------------------------------------------------------------------------------------

Instead of showing a pointer cursor for all labels, only show for those that actually have a `for` attribute making them clickable.

`BUGFIX: add missing label for the document group <https://github.com/neos/neos-development-collection/pull/758>`_
------------------------------------------------------------------------------------------------------------------

Currently the label is missing:

!`image <https://cloud.githubusercontent.com/assets/837032/18599421/138ab352-7c61-11e6-9066-877973d872f3.png>`_

`TASK: Update issue information in Readme.rst <https://github.com/neos/neos-development-collection/pull/765>`_
--------------------------------------------------------------------------------------------------------------

`BUGFIX: Encode array properties passed in NodesController.showAction <https://github.com/neos/neos-development-collection/pull/751>`_
--------------------------------------------------------------------------------------------------------------------------------------

`TASK: Require correct version of flow-development-collection <https://github.com/neos/neos-development-collection/pull/705>`_
------------------------------------------------------------------------------------------------------------------------------

`BUGFIX: Fix wrong Flow version in \`\`composer.json\`\` <https://github.com/neos/neos-development-collection/pull/719>`_
-------------------------------------------------------------------------------------------------------------------------

This will fix the dependency for the Flow version to correct one and prevent `composer update` to upgrade to unwanted minor releases.

`TASK: Remove references to typo3.org <https://github.com/neos/neos-development-collection/pull/723>`_
------------------------------------------------------------------------------------------------------

Replaces references to typo3.org with matching references to neos.io.

`BUGFIX: Missing translation of label in media edit view <https://github.com/neos/neos-development-collection/pull/721>`_
-------------------------------------------------------------------------------------------------------------------------

`BUGFIX: Add missing translation keys for media actions menu <https://github.com/neos/neos-development-collection/pull/714>`_
-----------------------------------------------------------------------------------------------------------------------------

`BUGFIX: Require Flow 3.3 instead of dev-master <https://github.com/neos/neos-development-collection/pull/720>`_
----------------------------------------------------------------------------------------------------------------

`BUGFIX: Use \`\`NodeData::createShadow\`\` to repair shadow nodes <https://github.com/neos/neos-development-collection/pull/718>`_
-----------------------------------------------------------------------------------------------------------------------------------

`BUGFIX: Make \`\`NodeData::createShadow\`\` public again <https://github.com/neos/neos-development-collection/pull/717>`_
--------------------------------------------------------------------------------------------------------------------------

The `NodeData::createShadow` method was changed to protected
visibility in 2.2, as it is vital to repair certain constellations
of nodes it is changed back to public.

`BUGFIX: Trim date value to prevent problems in node import <https://github.com/neos/neos-development-collection/pull/712>`_
----------------------------------------------------------------------------------------------------------------------------

Adds a trim around all `DateTime` string values to prevent problems with DateTimeConverter.

* Fixes: `#710 <https://github.com/neos/neos-development-collection/issues/710>`_

`BUGFIX: Use strict comparison in policies and UserService <https://github.com/neos/neos-development-collection/pull/715>`_
---------------------------------------------------------------------------------------------------------------------------

This fixes potential nesting level too deep errors caused
by comparing objects recursively.

`BUGFIX: createShadow cannot be called from outside as it's protected <https://github.com/neos/neos-development-collection/pull/690>`_
--------------------------------------------------------------------------------------------------------------------------------------

As this is not possible the call is replaced by code duplicated from
`NodeData` for now.

`TASK: Update contributor list <https://github.com/neos/neos-development-collection/pull/697>`_
-----------------------------------------------------------------------------------------------

`TASK: Non-strings are not valid Json. <https://github.com/neos/neos-development-collection/pull/700>`_
-------------------------------------------------------------------------------------------------------

`BUGFIX: Aloha format options <https://github.com/neos/neos-development-collection/pull/699>`_
----------------------------------------------------------------------------------------------

There internal selectedValue of the tag name selection for aloha get's out of sync when changing via cursor/mouse. Since aloha already handles "changes" to same state well, no need to have this logic again.

NEOS-1883 #close

`BUGFIX: Workspace publishing fails after node:repair <https://github.com/neos/neos-development-collection/pull/706>`_
----------------------------------------------------------------------------------------------------------------------

This change addresses an issue which results in a fatal error caused
by foreign key constraints when a user tries to publish her changes
to another workspace. The root cause is that the task in node:repair
which fixes "unstable" node identifiers of auto-created child nodes
only changes identifiers of nodes in a specific workspace (by default
the "live" workspace) and by that irreversibly disconnects corresponding
nodes in other workspaces.

The fix consists of two parts: First, the "create missing child nodes"
task of node:repair is modified so that node identifiers are always
changed accross all workspaces. Second, there is a new node:repair
task which detects and fixes inconsistencies caused by this bug.

If you experience the symptom described earlier, simply run a
node:repair to fix the inconsistencies.

The steps to reproduce the bug based on the Neos Demo site (as of
August 1st, 2016) are:
1. Log in to the backend and modify the title of the page "Forms". Don't
   publish the change yet.
2. From the command line call node:repair and see that child node
   identifiers are changed.
3. Try to publish the changes to the live workspace.

The UI will report an error which is caused by a failed SQL update.
With this patch applied, the changes should be able to publish without
any errors.

`BUGFIX: Fix condition in \`getRequestPathByNode\` <https://github.com/neos/neos-development-collection/pull/691>`_
-------------------------------------------------------------------------------------------------------------------

First check that the node is still of type NodeInterface and until then
get the parentPath.

`TASK: Fixed typos in documention <https://github.com/neos/neos-development-collection/pull/703>`_
--------------------------------------------------------------------------------------------------

@aertmann @hlubek To cleanup also the source of the content for the TS Reference.

`TASK: Add TYPO3.TypoScript:Debug to Reference <https://github.com/neos/neos-development-collection/pull/702>`_
---------------------------------------------------------------------------------------------------------------

`FEATURE: Add new NodePrivilege \`isAncestorNodeOf\` <https://github.com/neos/neos-development-collection/pull/477>`_
---------------------------------------------------------------------------------------------------------------------

This adds a new NodePrivilege `isAncestorNodeOf` which allows to define easily a whitelist approach for the node tree

`Point to a Neos LICENSE file in Readme.rst <https://github.com/neos/neos-development-collection/pull/694>`_
------------------------------------------------------------------------------------------------------------

Point to a Neos LICENSE file in Readme.rst instead of pointing to the neos packagist presence

`TASK: set sane defaults for \`TYPO3.TypoScript:Collection\` <https://github.com/neos/neos-development-collection/pull/669>`_
-----------------------------------------------------------------------------------------------------------------------------

May be breaking, but in super rare occurrences like:

```
test = T:Collection {
  collection = ${xyz}
  iteratorName = 'iterator'
  itemRenderer = T:Collection {
    collection = ${q(item).children().get()}
    itemRenderer = ${iterator.cycle}
  }
}
```

Still would like to have it in 2.3.

`TASK: RelatedNodes template need to be more solid <https://github.com/neos/neos-development-collection/pull/658>`_
-------------------------------------------------------------------------------------------------------------------

This change check if the relatedNode.contextDocumentNode exist before
creating the link. Without this change the editor is in front of
an exception.

`BUGFIX: Add translation keys to replace asset view <https://github.com/neos/neos-development-collection/pull/678>`_
--------------------------------------------------------------------------------------------------------------------

Replaced remaining texts with translation keys to allow translating the replace asset view.

Neos-1878 #close

`BUGFIX: Render item label section correctly <https://github.com/neos/neos-development-collection/pull/679>`_
-------------------------------------------------------------------------------------------------------------

This change fixes a wrong usage if the render- viewhelper for the dimensions menu `itemLabel` section

`BUGFIX: Remove duplicate \`\`elseif\`\` statement <https://github.com/neos/neos-development-collection/pull/664>`_
-------------------------------------------------------------------------------------------------------------------

`BUGFIX: Fix merge accident breaking findByProperties() <https://github.com/neos/neos-development-collection/pull/675>`_
------------------------------------------------------------------------------------------------------------------------

`BUGFIX: Fix version constraints/numbers from merge accident <https://github.com/neos/neos-development-collection/pull/670>`_
-----------------------------------------------------------------------------------------------------------------------------

A merge into master that was done with too little cleanup changed the branch
and version numbers in a few places where they should have been left
unchanged.

Also some changelog files were added that are not supposed to be in master.

`BUGFIX: fix sorting in Media module <https://github.com/neos/neos-development-collection/pull/668>`_
-----------------------------------------------------------------------------------------------------

Check that asset is selected before reloading the preview image.

NEOS-1882 #close

`BUGFIX: Fix strtolower bug introduced by latest upmerge <https://github.com/neos/neos-development-collection/pull/671>`_
-------------------------------------------------------------------------------------------------------------------------

`fix wrong hint meaning <https://github.com/neos/neos-development-collection/pull/667>`_
----------------------------------------------------------------------------------------

replaces https://github.com/neos/neos-development-collection/pull/663. Now for 2.0 instead of master.

`BUGFIX: Node property search with PostgreSQL 9.5 <https://github.com/neos/neos-development-collection/pull/652>`_
------------------------------------------------------------------------------------------------------------------

Adds an explicit string conversion which is needed for PostgreSQL > 9.4
to convert a JSON type to string. This is needed when matching a string
pattern in the NodeSearchService against the node properties.

NEOS-1873 #resolve

`FEATURE: Support search by property & exact value in NodeDataRepository <https://github.com/neos/neos-development-collection/pull/1>`_
---------------------------------------------------------------------------------------------------------------------------------------

Currently it is only possible to search through the properties by
giving a string that matches for any key or value found in the
jsonified properties field.

With this change, the term can also be an array to match exactly on a
given key / value combination.
The search term could be given as `['key' => 'value']`.

NEOS-1460 #close

`!!! TASK: Give Neos session (cookie) a distinct name <https://github.com/neos/neos-development-collection/pull/605>`_
----------------------------------------------------------------------------------------------------------------------

Changes the session name from the default (TYPO3_Flow_Session) to
"Neos_Session".

This is breaking in case you configured your hosting in relation to the cookie
name (e.g. Varnish rules).

`TASK: Make the site export tidy by default <https://github.com/neos/neos-development-collection/pull/640>`_
------------------------------------------------------------------------------------------------------------

This change will make site exports via `./flow site:export` tidy by default.

NEOS-1430 #resolve

`BUGFIX: FileTypeIconService should have only static methods <https://github.com/neos/neos-development-collection/pull/662>`_
-----------------------------------------------------------------------------------------------------------------------------

The `getDocumentIconSize` method is called in `getIcon` which is static, therefore
it should be static as well.

NEOS-1879 #resolve

`TASK: Add new login screen for Neos 2.3 <https://github.com/neos/neos-development-collection/pull/661>`_
---------------------------------------------------------------------------------------------------------

`BUGFIX: Remove a comma causing a parse error from YAML in the editor reference <https://github.com/neos/neos-development-collection/pull/660>`_
------------------------------------------------------------------------------------------------------------------------------------------------

`TASK: Adjust requestPattern settings to new syntax <https://github.com/neos/neos-development-collection/pull/648>`_
--------------------------------------------------------------------------------------------------------------------

Adjusts the `requestPattern` configuration to the new
syntax introduced with https://github.com/neos/flow-development-collection/pull/130

* Related: `FLOW-412 <https://jira.neos.io/browse/FLOW-412>`_

`TASK: Allow translation of text field editor placeholder <https://github.com/neos/neos-development-collection/pull/619>`_
--------------------------------------------------------------------------------------------------------------------------

`TASK: Adjust unit tests to use "real mocks" <https://github.com/neos/neos-development-collection/pull/656>`_
-------------------------------------------------------------------------------------------------------------

Mocking a "virtual" class is no longer allowed, so we use real classes.

`FEATURE: node repair - remove nodes with invalid workspaces <https://github.com/neos/neos-development-collection/pull/644>`_
-----------------------------------------------------------------------------------------------------------------------------

This change introduces a new check into `node:repair` which scans all
nodes which have `null` as their workspace and offers to removed them.

When workspaces have been deleted manually or users have been deleted
in a non-standard way, the user's nodes will be left behind. Because
there is a constraint configured in the database between workspaces
and the workspace field in Node Data, the result of such an operation
will be that the respective nodes end up with `null` in their workspace
field.

`BUGFIX: Fix error message when creating new site package <https://github.com/neos/neos-development-collection/pull/645>`_
--------------------------------------------------------------------------------------------------------------------------

The previous error message did not say, that the format `Vendor.PackageKey` is mandatory.

`BUGFIX: Replace document stylesheets after loading a page <https://github.com/neos/neos-development-collection/pull/375>`_
---------------------------------------------------------------------------------------------------------------------------

This change adds a marker class to the Neos CSS link tag and will remove
and append all stylesheets into the document after loading a page in
the content module. This solves issues with document dependent CSS
includes on a site as well as the initial rendering of shortcut documents.

NEOS-830 #close
NEOS-99 #close

`FEATURE: Implement repair of shadow nodes  <https://github.com/neos/neos-development-collection/pull/654>`_
------------------------------------------------------------------------------------------------------------

This will reconstruct missing shadow nodes in case something went
wrong in creating or publishing them.

Important is to select a workspace other than live to repair as
shadow nodes only appear in non base workspaces.

`BUGFIX: Shadow nodes need to be published as well <https://github.com/neos/neos-development-collection/pull/650>`_
-------------------------------------------------------------------------------------------------------------------

Shadow nodes were only ever deleted on publish which leads
to strange results in case you publish into a workspace that
has another base workspace as then the shadow node is still
needed for proper function of the CR. With this change the
workspace checks if the shadow node is still needed and adjusts
it to the new workspace.

`BUGFIX: Layered workspaces should retain removed nodes <https://github.com/neos/neos-development-collection/pull/647>`_
------------------------------------------------------------------------------------------------------------------------

In a multi-layered workspace scenario a removed node should only ever
really be removed when publishing into the root workspace (live).
When publishing in a workspace that has a base workspace we should
instead publish a removed node into that workspace to overlay any
existing nodes in the base workspace.

Additionally cleans the code as some of the checks are done deeper
down again and also rely on too much internal knowledge when done
in the Workspace publish methods.

NEOS-1872 #resolve

`BUGFIX: Fix regressions introduced by skip/only change <https://github.com/neos/neos-development-collection/pull/653>`_
------------------------------------------------------------------------------------------------------------------------

The pull request #643 introduced two regressions where the
argument order of methods was no longer correct.

`TASK: Update CreatingAPlugin.rst <https://github.com/neos/neos-development-collection/pull/655>`_
--------------------------------------------------------------------------------------------------

correction of indentation in Routes.yaml

`BUGFIX: \`references\` property type not properly converted <https://github.com/neos/neos-development-collection/pull/651>`_
-----------------------------------------------------------------------------------------------------------------------------

This results in `references` properties to not get wrapped with ContentElementWrappingService correctly.

Steps to reproduce: edit some property of a node of type `references`, hit apply, the property will become empty again.

`BUGFIX: Fix \`asset-with-metadata\` endpoint for images <https://github.com/neos/neos-development-collection/pull/642>`_
-------------------------------------------------------------------------------------------------------------------------

This adjusts the `Backend\\ContentController` to set the
`CONFIGURATION_OVERRIDE_TARGET_TYPE_ALLOWED` property mapping flag
for incoming assets.

Background:
When selecting a single `Asset` in the Neos backend, its metadata
is retrieved via the `/neos/content/asset-with-metadata` endpoint.
This expects a list of asset identifiers.
However, in the case of `ImageInterface`-assets we instead send an
object `{__identity: <uuid>, __type: <type>}`.

Note: The fix is backported from #102

`FEATURE: Introduce --skip and --only to node:repair command <https://github.com/neos/neos-development-collection/pull/643>`_
-----------------------------------------------------------------------------------------------------------------------------

This change introduces two new options for the `node:repair` command
which allows for selective execution of `node:repair` checks.

The `--skip` option accepts one or more check names (identifiers) which
should be skipped.

If the `--only` option is used, only the the checks which are specified
in `--only` will be executed.

The identifier for each check can be looked up in the `node:repair` help
screen. If multiple check identifiers are specified, they need to be
separated by commas.

`FEATURE: node:repair: remove nodes with invalid dimension values <https://github.com/neos/neos-development-collection/pull/627>`_
----------------------------------------------------------------------------------------------------------------------------------

This change contains an improvement for node:repair which runs an
additional check for nodes which have dimension values which are not
allowed according to the current dimension configuration.

These nodes can be either removed or the user can decide to migrate them
by other means (for example a node migration).

`TASK: Document abstract and aggregate nodetype options <https://github.com/neos/neos-development-collection/pull/608>`_
------------------------------------------------------------------------------------------------------------------------

`BUGFIX: Escape preg_replace placeholders to prevent accidentally replacements <https://github.com/neos/neos-development-collection/pull/616>`_
-----------------------------------------------------------------------------------------------------------------------------------------------

Escapes all `$` dollar signs to prevent accidentally replacement of placeholders like `$0` within the preg_replace of HtmlAugmenter.

NEOS-1865 #close

`BUGFIX: Day incorrectly formatted in media browser <https://github.com/neos/neos-development-collection/pull/634>`_
--------------------------------------------------------------------------------------------------------------------

Resolves a bug that caused the month to be returned in a textual and numeric representation, by removing the months numeric representation and replacing it with the day.

`FEATURE: Dynamic cached segments <https://github.com/neos/neos-development-collection/pull/101>`_
--------------------------------------------------------------------------------------------------

This change adds a new type of cache mode, the so called `dynamic`.
It will always trigger a new evaluation at runtime but the results are
cached again. The configuration for a `dynamic` segment has a
new property `entryDiscriminator`. This defines how the cached entries
for this segment are discerned from one another at runtime.
Usually you will use an EEL expression, but this can only use global
context variables like the request.

An example configuration for segment that is separately cached depending
on a GET argument `someArgument` could look like this::

```
@cache {
    mode = 'dynamic'
    entryIdentifier {
        node = ${node}
    }
    entryDiscriminator = ${request.httpRequest.arguments.someArgument}
    context {
        1 = 'node'
    }
}
```

`TASK: Free memory after disallowed child nodes removal <https://github.com/neos/neos-development-collection/pull/609>`_
------------------------------------------------------------------------------------------------------------------------

Free memory after removing disallowed child nodes after each dimension combination

NEOS-1852 #comment This does not the resolve the issue of much memory being used per node but prevents multiplying memory usage by the number of dimension combinations available

`BUGFIX: Fix crossdomain-linking error <https://github.com/neos/neos-development-collection/pull/635>`_
-------------------------------------------------------------------------------------------------------

The `FrontendNodeRoutePartHandler` caused an php error when it was called with a node that originated from another site than the site in the content context. Since a comparison between the current-node and the siteNode was used as an exit-condition for the url-path generation the method did not detect the siteNode of the external node properly and traversed up to the /sites node where an error occurred because no uri-path-segment could be found.

This fix avoids this by detecting the siteNodes by checking wether the parentPath of of the node equals `SiteService::SITES_ROOT_PATH`

`BUGFIX: Correctly remove NodeDimension association in setDimensions <https://github.com/neos/neos-development-collection/pull/611>`_
-------------------------------------------------------------------------------------------------------------------------------------

The setDimensions method on NodeData did simply replace the ArrayCollection
with a new one. This left previously attached NodeDimension entities in the
database, leading to issues.

This change fixes that by no longer replacing the full collection but working on
the contained entries instead.

This fix was the base for a new task to node:repair that removes any content
dimensions set on those nodes. Because when the root or the sites node have
content dimensions assigned, this can lead to issues with nodes not being found
when traversing from the root node.

`BUGFIX: Require I18n in EmailAddressValidator <https://github.com/neos/neos-development-collection/pull/626>`_
---------------------------------------------------------------------------------------------------------------

`TASK: Some smaller code and comment tweaks <https://github.com/neos/neos-development-collection/pull/631>`_
------------------------------------------------------------------------------------------------------------

`BUGFIX: Fix typo in error message <https://github.com/neos/neos-development-collection/pull/630>`_
---------------------------------------------------------------------------------------------------

`BUGFIX: Site switch fails with "session not started" <https://github.com/neos/neos-development-collection/pull/629>`_
----------------------------------------------------------------------------------------------------------------------

This fixes a regression introduced in #591 (commit:
`1fd3fcabf61f922f9019773341d74ac17b04887d <https://github.com/neos/neos-development-collection/commit/1fd3fcabf61f922f9019773341d74ac17b04887d>`_) which results in an internal
server error if a user tries to switch from one site to another using
the Neos user interface.

The code assumed that `$this->session` is already the new session the
`tokenLoginAction` is about to switch to and that this session is
already initialized. However, `$this->session` more often than not
is the session the user is about to leave and is not currently running.

The fix now unsets the `lastVisitedNode` in the new session the user
is about to switch to and makes sure that it is fully initialized.

`BUGFIX: node:repair also removes valid nodes <https://github.com/neos/neos-development-collection/pull/621>`_
--------------------------------------------------------------------------------------------------------------

This fixes an issue with node:repair which also removes valid and
healthy nodes while deleting nodes which are abstract or assigned to
an unknown node type.

removeAbstractAndUndefinedNodes() correctly found invalid nodes, but
only used the node path and workspace name as an identifier for removing
them. If there are further nodes matching this criteria, for example
with different dimension values, these would be deleted as well,
even though they may be completely valid.

This patch introduces a new method which allows for removal of a node
specified by node identifier and dimension hash.

`FEATURE: \`\`sort()\`\` FlowQuery operation <https://github.com/neos/neos-development-collection/pull/604>`_
-------------------------------------------------------------------------------------------------------------

Adds a sort FlowQuery operation to sort TYPO3CR nodes by given property and `ASC` or `DESC` sort order: `sort(propertyName, order)` 

`BUGFIX: Add message fallback for \`addFlashmessage\` in AssetController <https://github.com/neos/neos-development-collection/pull/617>`_
-----------------------------------------------------------------------------------------------------------------------------------------

Adding a flash message in `AssetController` results in an exception if the tranlsator service returns null for a label. If the service returns null the label will be returned as a fallback.

This change also removes an unecessary method `addFlashMessage` as it implements just the same logic as `parent::addFlashMessage`. This method also calls right now the parent method with an already translated id wich can not be translated again.

`[TASK] Add trait to avoid duplicate code in ViewHelpers <https://github.com/neos/neos-development-collection/pull/3>`_
-----------------------------------------------------------------------------------------------------------------------

The new `TypoScriptContextTrait` can be used to get
variables from the TypoScript runtime context inside a
ViewHelper as long as it's used inside a
`TypoScriptAwareView`. This helps to avoid code duplication
while avoiding long inheritance chains.

`TASK: Add chapter about contributing to documentation <https://github.com/neos/neos-development-collection/pull/467>`_
-----------------------------------------------------------------------------------------------------------------------

`FEATURE: DimensionsMenu to handle multiple dimensions switching <https://github.com/neos/neos-development-collection/pull/282>`_
---------------------------------------------------------------------------------------------------------------------------------

This implements a DimensionsMenu that can render all available node variants
for possible dimension combinations.

It is a drop-in replacement for the existing DimensionMenu but keeps other active
dimensions in the generated links.

`TASK: Fix code sample in content cache configuration <https://github.com/neos/neos-development-collection/pull/614>`_
----------------------------------------------------------------------------------------------------------------------

The path `page.content.main` is "invalid", the missing `body` segment can be annoying when reading the documentation.

`BUGFIX: Bust cache for content dimensions configuration <https://github.com/neos/neos-development-collection/pull/613>`_
-------------------------------------------------------------------------------------------------------------------------

Bust the cache for content dimensions settings so changes are visible in the backend instantly.

`TASK: \`TYPO3.Neos:Menu\` entryLevel should respect a starting point <https://github.com/neos/neos-development-collection/pull/610>`_
--------------------------------------------------------------------------------------------------------------------------------------

If a starting point for a `TYPO3.Neos:Menu` is set the entryLevel won't work out of the box in all cases because it defaults to the first level of the site. If the starting point is below that you won't see any menu items.

This changes the default behaviour of the entryLevel. It will be set to 0 if there is a startingPoint configured otherwise stick to 1.

NEOS-1838 #resolve

`BUGFIX: Skip private node properties in ContentElementWrappingService <https://github.com/neos/neos-development-collection/pull/607>`_
---------------------------------------------------------------------------------------------------------------------------------------

If a nodetype has "virtual" properties configured (like when Elasticsearch
is used with Neos), trying to access those properties resulted in

```
The property "…" on the subject was not accessible.
```

This change introduces a check for property names starting with `__` and
skips those, like already done in the `NodePropertyConverterService`

NEOS-1860 #close

`TASK: Introduce RequireJS mapping for Views <https://github.com/neos/neos-development-collection/pull/531>`_
-------------------------------------------------------------------------------------------------------------

This change introduce a mapping configuration for RequireJS for
`nodeInfo.view`. With this change the configuration is mode consistent
with Editors, Handlers and Validation.

`FEATURE: Allow setting a new Node name in move operations <https://github.com/neos/neos-development-collection/pull/549>`_
---------------------------------------------------------------------------------------------------------------------------

It would be convenient to change the name of a node while moving
it to a new destination. To avoid exceptions due to existing nodes
you only need to find an available name at the target location then.

`BUGFIX: Allow to change owner of workspace <https://github.com/neos/neos-development-collection/pull/598>`_
------------------------------------------------------------------------------------------------------------

This configures the property mapping when updating a workspace so that
the owner can be mapped properly.

NEOS-1804 #close

`!!! BUGFIX: Keep supertypes unset in supertypes unset <https://github.com/neos/neos-development-collection/pull/599>`_
-----------------------------------------------------------------------------------------------------------------------

No, the title is not an error. Here is what happens:
- You define a node type and inherit from "Document"
- In that NodeType unset a supertype declared in "Document"
- Now inherit from that nodetype again, and whatever the unset supertype
  declared, will be back

This is caused by how the inherited supertypes are read using the method
getDeclaredSuperTypes, which only returns the used supertypes, not the
ones not used - even if "actively not used".

This change fixes that and is marked breaking because there might be things
disappearing from your nodetypes, depending on the nesting of your hierarchy.

`BUGFIX: Correct typo in workspaces documentation <https://github.com/neos/neos-development-collection/pull/602>`_
------------------------------------------------------------------------------------------------------------------

`FEATURE: Make neos login-screen logo configurable <https://github.com/neos/neos-development-collection/pull/545>`_
-------------------------------------------------------------------------------------------------------------------

With this change it is possible to easily change the logo rendered above the login form. To do so you can adjust the `partialRootPathPattern` for the LoginController in your `Views.yaml` and include your custom logo partial

`BUGFIX: reset lastVisitedNode on site switch <https://github.com/neos/neos-development-collection/pull/591>`_
--------------------------------------------------------------------------------------------------------------

This fixes an error when trying to switch from a subnode of one site to another site.

The lastVisitedNode session variable is always pointing to the node that was last open in frontend to redirect to that page. 
If you visit a subpage from one site and switch to another, Neos opens the last node in the new site. In most cases this will fail.

`BUGFIX: Make the login screen more adaptive to changes <https://github.com/neos/neos-development-collection/pull/567>`_
------------------------------------------------------------------------------------------------------------------------

Complete overhaul for the login screen element alignment by making use of `flexible boxes`. Especially smaller devices will benefit from this and everyone involved in theming the login screen. This also fixes the login screen mobile view.

`FEATURE: Additional configuration for multi column elements <https://github.com/neos/neos-development-collection/pull/554>`_
-----------------------------------------------------------------------------------------------------------------------------

Provides the iteration information for multi column elements per default as
context variable with the name `columnIteration`.
Also provides the selected `layout` value of the column container to the
columns via context variable named `columnLayout`.

`TASK: Add a hint for cache clearing to the Node Type Constraints docs <https://github.com/neos/neos-development-collection/pull/585>`_
---------------------------------------------------------------------------------------------------------------------------------------

There are sometimes browser caching issues when working with node type constraints. This hint should help prevent some of them.

`TASK: De-Duplicate site and domain logic <https://github.com/neos/neos-development-collection/pull/578>`_
----------------------------------------------------------------------------------------------------------

The logic to fetch site and domain for the `ContentContext` was
duplicated in several parts of Neos. This duplication is rather useless
as the values derived by it can be seen as default values for the two
properties. Therefore the logic was refactored to the
`ContentContextFactory` and removed from other places in favor of
letting the factory set it as default.

`BUGFIX: Fix like queries using paths in NodeDataRepository <https://github.com/neos/neos-development-collection/pull/583>`_
----------------------------------------------------------------------------------------------------------------------------

When querying for nodes based on (parent) paths, a LIKE query was used in
certain cases. This query would include unrelated nodes, if the paths involved
would share a common prefix:

```
/some/node-12
/some/node-123
```

Nodes below both paths would be included because of:

```
LIKE "/some/nodes-12%"
```

Now those queries append a slash, to read:

```
LIKE "/some/nodes-12/%"
```

NEOS-1849 #close

`BUGFIX: Add background color to select option <https://github.com/neos/neos-development-collection/pull/586>`_
---------------------------------------------------------------------------------------------------------------

Add background color to select option for the electronic addresses select box, because it was white text on white background for Windows users.

NEOS-1823 #close

`BUGFIX: Align displaced expand icons in node tree <https://github.com/neos/neos-development-collection/pull/587>`_
-------------------------------------------------------------------------------------------------------------------

The expand icons in the node tree where off a few pixels along the y-axis (open and folded).

NEOS-1844 #close

`FEATURE: Allow relation between arbitrary entities and nodes <https://github.com/neos/neos-development-collection/pull/102>`_
------------------------------------------------------------------------------------------------------------------------------

  This removes all special type handling to format node properties for
  the Neos user interface and replaces it with using `PropertyMapper`.
  The introduced `NodePropertyConverterService` is fully responsible to
  provide a portable representation of the Node properties.

  Node property types can be configured to use specific `TypeConverter`
  implementations to give all necessary information to the inspector
  editor. Additionally a fallback `defaultValue` for property types
  can be added in Settings.

  Please note that we introduce some default values in case you didn't set
  a default value in your `NodeTypes.yaml`. All of those are common sense
  but you might want to check if they work for you in all cases.

  This allows to map arbitrary objects to node properties and interact with
  them in the Neos user interface.

  NEOS-381 #close

`BUGFIX: Include removed nodes if requested in \`\`filterNodeDataByBestMatchInContext\`\` <https://github.com/neos/neos-development-collection/pull/597>`_
----------------------------------------------------------------------------------------------------------------------------------------------------------

Even when removed nodes were requested, the method looking for the best match
in a context (`filterNodeDataByBestMatchInContext`) excluded them. This made it
impossible to fetch those nodes, e.g. for publishing changes.

This change fixes that by passing on the request for removed nodes so they can
be included as needed.

NEOS-1858 #close
NEOS-1841 #comment Fixes regression introduced by this fix

`TASK: Correct documentation of data sources <https://github.com/neos/neos-development-collection/pull/596>`_
-------------------------------------------------------------------------------------------------------------

`BUGFIX: Check for expected context in ParentsOperation <https://github.com/neos/neos-development-collection/pull/595>`_
------------------------------------------------------------------------------------------------------------------------

The ParentsOperation in Neos expects a Neos `ContentContext` to work with,
so `canEvaluate()` should check for it to allow for proper function and
fallback handling if a "normal" CR `Context` is given.

`BUGFIX: Fix resizing of images with "extreme" ratios <https://github.com/neos/neos-development-collection/pull/564>`_
----------------------------------------------------------------------------------------------------------------------

Images that have extreme dimensions (e.g. 2000x2) could cause exceptions
when scaling because of a zero width or height when calculating the
resulting thumbnail size.

This change introduces a custom Imagine Box implementation that prevents
boxes with zero width or height when scaling a box.

NEOS-576 #comment PR 564 is related to this

`BUGFIX: Fix structure in \`\`Sites.xml\`\` for generated site packages <https://github.com/neos/neos-development-collection/pull/593>`_
----------------------------------------------------------------------------------------------------------------------------------------

Fixes an error so freshly kickstarted site packages can be imported again

Regression of `1dcf1f2e0db3d0d7bd5f31f033be975227aa9cd0 <https://github.com/neos/neos-development-collection/commit/1dcf1f2e0db3d0d7bd5f31f033be975227aa9cd0>`_

`TASK: change caching behaviour when no \`entryIdentifier\` is set <https://github.com/neos/neos-development-collection/pull/592>`_
-----------------------------------------------------------------------------------------------------------------------------------

The old behaviour was to try to construct the entryIdentifier from all
context vars, which did not make a lot of sense.

With the new behaviour, the entryIdentifier is filled with identifiers from the
`TYPO3.TypoScript:GlobalCacheIdentifiers` prototype.

So in many cases, it would not be necessary to provide any
entryIdentifiers at all and just configure GlobalCacheIdentifiers.

`TASK: set a default value of \`itemName\` in the \`TYPO3.TypoScript:Collection\` object <https://github.com/neos/neos-development-collection/pull/589>`_
---------------------------------------------------------------------------------------------------------------------------------------------------------

This change sets a default value of `itemName` to `item`, so you can use `TYPO3.TypoScript:Collection` object without specifying it each time:

```
helloLoop = TYPO3.TypoScript:Collection {
  collection = ${[1, 2, 3]}
  itemRenderer = ${item + '<br>'}
}
```

This change is backwards compatible, as your value for `itemName` would always override the default value.

`BUGFIX: Protect content cache against segment tokens in content <https://github.com/neos/neos-development-collection/pull/581>`_
---------------------------------------------------------------------------------------------------------------------------------

This change adds a random cache marker directly to the content cache
which will be used after cache segment tokens to add a better protection
against content that contains one of these characters. The parser will
only match against the cache segment tokens with added marker, so the
chance of accidentally breaking the content cache should be very low.

NEOS-365 #close

`TASK: Add signals to notify on asset add / update / remove <https://github.com/neos/neos-development-collection/pull/514>`_
----------------------------------------------------------------------------------------------------------------------------

In order to implement additional tasks for asset handling,
like meta data management, these new signals in the
central point of asset handling - the meta data repository -
notify on asset created / updated / removed.

Moved assetCreated and thumbnailCreated to the corresponding
services for consistency.

`BUGFIX: Add support for ImageMagick 7 <https://github.com/neos/neos-development-collection/pull/580>`_
-------------------------------------------------------------------------------------------------------

ImageMagick 7 has some breaking changes and Imagick has reacted on this. Some of these changes are also breaking changes. Using ImageMagick >= 7.0 makes it mandatory to use Imagick >= 3.4.3RC1.

In case of running Neos with these versions the `DocumentThumbnailGenerator` throws fatal errors, because of missing class constant `\\Imagick::ALPHACHANNEL_RESET` and missing method `Imagick::flattenImages`.

NEOS-1850 #close

`BUGFIX: Allow the deletion of the primary domain <https://github.com/neos/neos-development-collection/pull/569>`_
------------------------------------------------------------------------------------------------------------------

Currently it's not possible to prune a site with a primary domain or delete a primary domain in the Neos backend.

This change will first unset the primary domain of a site if it's the one which should be deleted and then deletes it.

NEOS-1839 #close

`TASK: Document multiple EEL filter usage <https://github.com/neos/neos-development-collection/pull/572>`_
----------------------------------------------------------------------------------------------------------

`TASK: Fix typo in custom view helpers documentation example <https://github.com/neos/neos-development-collection/pull/582>`_
-----------------------------------------------------------------------------------------------------------------------------

There was a typo in the section about "Context and Children". In the `if` block the variable `$title` got assigned and not checked.

`FEATURE: \`\`TYPO3.TypoScript:Debug\`\` TypoScript-Object <https://github.com/neos/neos-development-collection/pull/517>`_
---------------------------------------------------------------------------------------------------------------------------

A TypoScript Object "Debug" is added as an equivalent to the `f:debug` view helper.
The Object will display the value of all child-keys in a debug window.

```
tsPath = TYPO3.TypoScript:Debug {
    # optional: set title for the debug output
    # title = 'Debug'

    # optional: show result as plaintext
    # plaintext = TRUE

    # If only the value-key is given it is debugged directly,
    # otherwise all keys except title an plaintext are debugged.
    value = "hello neos world"

    # Additional values for debugging
    documentTitle = ${q(documentNode).property('title')}
    documentPath = ${documentNode.path}
}
```

`TASK: Apply fixes from StyleCI <https://github.com/neos/neos-development-collection/pull/575>`_
------------------------------------------------------------------------------------------------

This pull request applies code style fixes from an analysis carried out by StyleCI.

For details see https://styleci.io/analyses/8nep21.

`TASK: Apply fixes from StyleCI <https://github.com/neos/neos-development-collection/pull/576>`_
------------------------------------------------------------------------------------------------

This pull request applies code style fixes from an analysis carried out by StyleCI.

For details see https://styleci.io/analyses/zRPZYK.

`TASK: Apply fixes from StyleCI <https://github.com/neos/neos-development-collection/pull/577>`_
------------------------------------------------------------------------------------------------

This pull request applies code style fixes from an analysis carried out by StyleCI.

For details see https://styleci.io/analyses/8LZLMk.

`BUGFIX: correct documentation mistakes regarding the usage of namespaces <https://github.com/neos/neos-development-collection/pull/570>`_
------------------------------------------------------------------------------------------------------------------------------------------

1) Missing colon in namespace definition
2) Namespaces are defined globally, and not for the scope of the current file

`BUGFIX: Remove double negative from error message <https://github.com/neos/neos-development-collection/pull/568>`_
-------------------------------------------------------------------------------------------------------------------

When writing `include: NodeTypes/**/*` in `Root.ts2` a misleading exception shows up, if the directory does not exist.

`BUGFIX: Node fallbacks not properly checking for variants <https://github.com/neos/neos-development-collection/pull/559>`_
---------------------------------------------------------------------------------------------------------------------------

This adds a check for better matching node variants to path traversal
queries of the NodeDataRepository to prevent fallbacks showing up
even if a better matching variant exists.

NEOS-1841 #resolve

`TASK: Apply fixes from StyleCI <https://github.com/neos/neos-development-collection/pull/561>`_
------------------------------------------------------------------------------------------------

This pull request applies code style fixes from an analysis carried out by StyleCI.

For details see https://styleci.io/analyses/zGPEL2

`FEATURE: Add \`\`TYPO3.Neos:ContentElementEditable\`\` TypoScript-Object <https://github.com/neos/neos-development-collection/pull/529>`_
------------------------------------------------------------------------------------------------------------------------------------------

This change extracts the functionality of the neos:contentElement.editable viewHelper into a service and adds an equivalent TypoScript-Prototype.

TypoScript Example:

```
element = TYPO3.TypoScript:Array {
    title = TYPO3.TypoScript:Tag {
        tagName = 'h1'
        content = ${q(node).property('title')}
        @process.contentElementEditable = TYPO3.Neos:ContentElementEditable
        @process.contentElementEditable.property = 'title'
    }
    @process.contentElementWrapping = TYPO3.Neos:ContentElementWrapping
}
```

`BUGFIX: Add missing default configuration <https://github.com/neos/neos-development-collection/pull/556>`_
-----------------------------------------------------------------------------------------------------------

The ConfigurationContentDimensionPresetSource in TYPO3CR did not have its
configuration set by default (as opposed to the Neos implementation).

`BUGFIX: Initialize dimension preset config with empty array <https://github.com/neos/neos-development-collection/pull/540>`_
-----------------------------------------------------------------------------------------------------------------------------

`TASK: Streamline generated Site packages <https://github.com/neos/neos-development-collection/pull/555>`_
----------------------------------------------------------------------------------------------------------

Removes useless text node to prevent complications with dimensions,
the breadcrumb that these days is seldom used and uses fully qualified
prototype names for all used TypoScript objects to make understanding
easier.

`TASK: Update content cache docs <https://github.com/neos/neos-development-collection/pull/552>`_
-------------------------------------------------------------------------------------------------

Update content cache documentation to include a remark that the
node identifier of the current node should be included in most cases.

`TASK: Small code cleanup <https://github.com/neos/neos-development-collection/pull/553>`_
------------------------------------------------------------------------------------------

`TASK: Removed duplicate condition in Login template <https://github.com/neos/neos-development-collection/pull/550>`_
---------------------------------------------------------------------------------------------------------------------

`TASK: Fix code style to make styleci happy <https://github.com/neos/neos-development-collection/pull/551>`_
------------------------------------------------------------------------------------------------------------

`BUGFIX: Service NodeController does not set all context properties <https://github.com/neos/neos-development-collection/pull/548>`_
------------------------------------------------------------------------------------------------------------------------------------

The service `NodeController` does not add the `currentSite` and `currentDomain` properties to the node context if a page is searched with `searchPageAction()`. Without them the uri can not be resolved.
This methos is also marked as deprecated with this change since it is never used and will be removed with 3.0

`BUGFIX: Restrict global 404 handling in UI to page loads only <https://github.com/neos/neos-development-collection/pull/544>`_
-------------------------------------------------------------------------------------------------------------------------------

This fixes an issue that causes the backend UI to recursively find a valid URI
in the document tree and load it, whenever a 404 response occurs to the
HTTPClient or HTTPRestClient.

That behavior is now only applied, when an actual page load is requested
and remains silent for all other requests.

NEOS-1533 #close
NEOS-1831 #close

`BUGFIX: Allow installation of typo3/media into Flow 2.x project <https://github.com/neos/neos-development-collection/pull/535>`_
---------------------------------------------------------------------------------------------------------------------------------

When installing `typo3/media` into an existing Flow 2.x project, a schema
migration relies on an old table name, which does not exist anymore.

This change fixes that by checking for the table name and target the
FK to create on the correct table.

NEOS-1341 #close

`TASK: Respect caption field for asset search <https://github.com/neos/neos-development-collection/pull/539>`_
--------------------------------------------------------------------------------------------------------------

The caption field is not respected, when you are searching for assets.

NEOS-1837 #close

`BUGFIX: Add autoload to composer again <https://github.com/neos/neos-development-collection/pull/543>`_
--------------------------------------------------------------------------------------------------------

In `a86591d459cb9a0f87daae72839019415b6fb1a6 <https://github.com/neos/neos-development-collection/commit/a86591d459cb9a0f87daae72839019415b6fb1a6>`_ the autoload
section was removed, as there had been no classes at that time.

`BUGFIX: Allow \`\`tel:\`\` and \`\`callto:\`\` link protocols in inline editing <https://github.com/neos/neos-development-collection/pull/533>`_
-------------------------------------------------------------------------------------------------------------------------------------------------

Allows the user to link telephone numbers and Skype usernames with Aloha.

NEOS-512 #close

`TASK: Use tooltip for additional information about account roles <https://github.com/neos/neos-development-collection/pull/525>`_
----------------------------------------------------------------------------------------------------------------------------------

This cleans up the UI and improves the contrast when displaying the role identifiers.

`BUGFIX: Multi-line links in inline editing <https://github.com/neos/neos-development-collection/pull/536>`_
------------------------------------------------------------------------------------------------------------

When creating a multi-line link to using inline editing, only the
first link is created correctly unless a whole URL is specified.

The issue lies in Aloha and an issue with a fix has been pushed to
their backlog. Until that is merged it is hotfixed in Neos.

https://github.com/alohaeditor/Aloha-Editor/issues/1525

`BUGFIX: Avoid fetching meta data when \`\`AssetEditor\`\` is empty <https://github.com/neos/neos-development-collection/pull/538>`_
------------------------------------------------------------------------------------------------------------------------------------

If the `AssetInspector` is used for a single asset used and the asset is removed the inspector will call the `assetMetadataEndpoint` without any asset identifier. This changes it to only call the fetch the meta data if there is an asset.

`BUGFIX: Fix schema error that prevented the validation of aloha configurations <https://github.com/neos/neos-development-collection/pull/521>`_
------------------------------------------------------------------------------------------------------------------------------------------------

The schema was altered before to allow setting the properties to NULL in a derived nodeType. This was done incompletely and lead the situation where the schema validation only validates that the
value of properties was a dictionary or null.

The `additionalProperties` were ignored because that property is only evaluated inside
a dictionary schema.

The underlying intent to allow resetting the properties in derived node types by setting `NodeType.properties: null` is not supported any more. The correct syntax to achieve this
is instead `NodeType.properties: []`.

This is not marked as breaking since it will not break functionality. Nevertheless it alters
what is marked as a defect configuration.

`FEATURE: Use data source to list forms in inspector <https://github.com/neos/neos-development-collection/pull/506>`_
---------------------------------------------------------------------------------------------------------------------

Currently form identifiers need to be defined manually extending
the properties of `TYPO3.Neos.NodeTypes:Form` .
This change adds a data source which uses the
`TYPO3\\Form\\Persistence\\YamlPersistenceManager::listForms`
to list all available forms automatically.

`TASK: Cleanup NodeTypes package and templates <https://github.com/neos/neos-development-collection/pull/516>`_
---------------------------------------------------------------------------------------------------------------

Removes the unnecessary `AssetListImplementation` and
simplifies NodeType templates.
Additionally sets a dependency to the `form` package.

`TASK: Add documentation for default TypoScript context variables <https://github.com/neos/neos-development-collection/pull/513>`_
----------------------------------------------------------------------------------------------------------------------------------

Add documentation describing how to use node, documentNode, site and request within TS

`TASK: Small improvements for the replace asset feature <https://github.com/neos/neos-development-collection/pull/528>`_
------------------------------------------------------------------------------------------------------------------------

- Unhides the action buttons in the media browser
- Use bigger filetype icon
- Made action names more consistent
- Made typehinting more consistent

`TASK: Aloha bugfix update <https://github.com/neos/neos-development-collection/pull/523>`_
-------------------------------------------------------------------------------------------

Updates Aloha Editor to latest release of `1.2` (`1.2.42` to `1.2.47`)

Additionally includes an important bugfix only included in currently maintained versions (`1.3`/`1.4`)

NEOS-1822 #close

`BUGFIX: Documentation markup fixes <https://github.com/neos/neos-development-collection/pull/526>`_
----------------------------------------------------------------------------------------------------

`BUGFIX: Aloha list style class not sanitized <https://github.com/neos/neos-development-collection/pull/522>`_
--------------------------------------------------------------------------------------------------------------

When using Aloha list styles, the class attribute was sanitized automatically making the feature unusable.

NEOS-854

`BUGFIX: Use correct relative paths in built CSS files <https://github.com/neos/neos-development-collection/pull/524>`_
-----------------------------------------------------------------------------------------------------------------------

The built CSS file concatenated library CSS files without
rewriting the relative URLs, leading to missing assets.

One example is the missing down caret for the Aloha list styles.

NEOS-1618 #close

`TASK: Add startingPoint property to menu node type <https://github.com/neos/neos-development-collection/pull/515>`_
--------------------------------------------------------------------------------------------------------------------

`TASK: Adjust configuration to render the neos-viewhelper reference automatically <https://github.com/neos/neos-development-collection/pull/520>`_
--------------------------------------------------------------------------------------------------------------------------------------------------

In `6cc5ad24997a55cc31fceacb62188e5c6feec640 <https://github.com/neos/neos-development-collection/commit/6cc5ad24997a55cc31fceacb62188e5c6feec640>`_ the configuration for the rendering of the neos-viewhelpers was added. This commit adds this configuration to the list of references that is automatically updated for neos.

`BUGFIX: Empty references editor should not send query <https://github.com/neos/neos-development-collection/pull/519>`_
-----------------------------------------------------------------------------------------------------------------------

When a references editor has no selected values it queries the
backend without any identifiers, leading to an exception on the
server side.

Regression of `b906930ca056823c75462fffddefa6278ef54e16 <https://github.com/neos/neos-development-collection/commit/b906930ca056823c75462fffddefa6278ef54e16>`_

NEOS-1828 #close
NEOS-1261 #regression

`BUGFIX: Values not selected in select box editor when added asynchronously <https://github.com/neos/neos-development-collection/pull/518>`_
--------------------------------------------------------------------------------------------------------------------------------------------

When options are populated asynchronously to the select box editor (e.g.
when using data source or in the plugin view editors) the value wasn't
updated properly.

Regression introduced in `2b79b585b63f3d07153af404721a77798e47cf3a <https://github.com/neos/neos-development-collection/commit/2b79b585b63f3d07153af404721a77798e47cf3a>`_

`BUGFIX: Publishable Node Context considers dimension fallbacks <https://github.com/neos/neos-development-collection/pull/512>`_
--------------------------------------------------------------------------------------------------------------------------------

The Context created for Nodes in a workspace in the `PublishingService`
was derived from the `NodeData` entities dimension values, which should only
be the target values of the context but (wrongly) doesn't consider fallbacks
configured in presets.

To solve this a new method in the PresetSource allows to find best matching
presets based on target values for dimensions. Those are then used to
get a `Context` with fallback rules for dimensions, avoiding errors with
missing nodes in the root path as these might only exist within a `Context`
that considers fallback rules.

The `ContentDimensionPresetSourceInterface` is not declared public `@api`
so the change is not marked breaking.

`FEATURE: Extensible asset validation <https://github.com/neos/neos-development-collection/pull/507>`_
------------------------------------------------------------------------------------------------------

This change allows extending the validation of assets. It is done by
creating a model validator for asset entity types. The validator
extends the conjunction validator and loads all validators that implement
the `\\TYPO3\\Media\\Domain\\Validator\\AssetValidatorInterface`.

`BUGFIX: Show installed version of packages in package manager backend module <https://github.com/neos/neos-development-collection/pull/511>`_
----------------------------------------------------------------------------------------------------------------------------------------------

Show the actually installed version of each package instead of the defined version in the composer manifest.

NEOS-1826 #close

`MERGE: 2.2 into master <https://github.com/neos/neos-development-collection/pull/509>`_
----------------------------------------------------------------------------------------

`TASK: Remove redundant fetching of user locale <https://github.com/neos/neos-development-collection/pull/508>`_
----------------------------------------------------------------------------------------------------------------

This change removes the redundant fetching of user locale introduced
in `8b5c9ff395d6a5ff54aa2f861b2a13a310ffac08 <https://github.com/neos/neos-development-collection/commit/8b5c9ff395d6a5ff54aa2f861b2a13a310ffac08>`_.

`FEATURE: Asset usage strategies <https://github.com/neos/neos-development-collection/pull/483>`_
-------------------------------------------------------------------------------------------------

This change allows to register asset usage strategies that
define if an asset is still in use and how many times.

`TASK: Translate flash messages for asset management <https://github.com/neos/neos-development-collection/pull/502>`_
---------------------------------------------------------------------------------------------------------------------

This change translates flash messages for the AssetController by
translation id. The Neos backend module controller first resolves to
translations in the Modules.xlf of the TYPO3.Neos package, if no
translation is found transaltions are done based on the TYPO3.Media
package translations.

The Neos module take the users language preference into account.

`BUGFIX: Handle missing node type group gracefully <https://github.com/neos/neos-development-collection/pull/505>`_
-------------------------------------------------------------------------------------------------------------------

Gracefully handle a node type configured configured with a non-existing
node type group.

Additionally changes the behavior when the group is set to null,
making it possible to hide the node type. If the group is not set,
it will default to the "general" group as previously.

Regression of `54aa91f19c8776a96003a631c23d8c1556fb33fe <https://github.com/neos/neos-development-collection/commit/54aa91f19c8776a96003a631c23d8c1556fb33fe>`_

NEOS-786 #comment Fix regression

`BUGFIX: Close insert node panel when pressing esc button <https://github.com/neos/neos-development-collection/pull/504>`_
--------------------------------------------------------------------------------------------------------------------------

Regression of `8ec441266bd7fac9a99539bc78c6ae36d382a1b9 <https://github.com/neos/neos-development-collection/commit/8ec441266bd7fac9a99539bc78c6ae36d382a1b9>`_

`TASK: Remove unused class imports <https://github.com/neos/neos-development-collection/pull/503>`_
---------------------------------------------------------------------------------------------------

This change removes unused class imports throughout the neos code.

`BUGFIX: Support empty dimension values for default fallbacks <https://github.com/neos/neos-development-collection/pull/498>`_
------------------------------------------------------------------------------------------------------------------------------

Implement support for empty dimension values (for any number of dimensions) of a node variant.
This allows to have nodes like `/sites` that will always be found, independent from the dimensions
of the context.

Another case is the transition to new dimensions that will be much easier because existing nodes
are already visible.

NEOS-1633 #close

`TASK: Missing \`\`@api\`\` and clean up of Site model <https://github.com/neos/neos-development-collection/pull/495>`_
-----------------------------------------------------------------------------------------------------------------------

`FEATURE: Filetype icon view helper <https://github.com/neos/neos-development-collection/pull/482>`_
----------------------------------------------------------------------------------------------------

This change introduces a Filetype icon viewhelper
that renders a simple image tag with an icon for the
type of a given asset based on it's mediatypes and
given maximum dimensions.

Besides that it moves the logic for retrieving the icon
to a service that can be used outside of the thumbnail
generator service too.

`BUGFIX: WorkspacesController uses NodeJsonView <https://github.com/neos/neos-development-collection/pull/494>`_
----------------------------------------------------------------------------------------------------------------

When requesting workspace data in JSON format from the WorkspacesController
null would be returned, since the controller was configured to use the
NodeJsonView.

This adds the missing WorkspaceJsonView and configures it to be used.

`TASK: Add fallback path for media package templates <https://github.com/neos/neos-development-collection/pull/481>`_
---------------------------------------------------------------------------------------------------------------------

This change adds a fallback path to the template path
of media package like it is already in place for partials
and layout paths.

`TASK: CodeBlock formating for image configuration examples in media module <https://github.com/neos/neos-development-collection/pull/493>`_
--------------------------------------------------------------------------------------------------------------------------------------------

`TASK: Add release notes for 2.1 and 2.2 <https://github.com/neos/neos-development-collection/pull/489>`_
---------------------------------------------------------------------------------------------------------

`TASK: Add \`\`Neos.RedirectHandler\`\` to command reference settings <https://github.com/neos/neos-development-collection/pull/491>`_
--------------------------------------------------------------------------------------------------------------------------------------

Add `Neos.RedirectHandler` to command reference settings so it will be added to the general command reference

`BUGFIX: Use 2.1 branch in .travis.yml <https://github.com/neos/neos-development-collection/pull/490>`_
-------------------------------------------------------------------------------------------------------

`TASK: Adjust .editorconfig to use tabs for JS files <https://github.com/neos/neos-development-collection/pull/411>`_
---------------------------------------------------------------------------------------------------------------------

`FEATURE: Automatic redirects for modified nodes <https://github.com/neos/neos-development-collection/pull/323>`_
-----------------------------------------------------------------------------------------------------------------

This introduces a `NodeRedirectService` that is invoked as soon
as a node is being published to the "live" workspace.
If the URI for a page node has been changed the `NodeRedirectService`
automatically flushes related Routing Caches and creates a Redirect
from the old URI to the new one.

In addition the service creates a `410` redirection for removed nodes so
that clients get a `410` response code rather than `404` when trying to
navigate to a node that has been there before.

Redirects can be managed via new commands::

```
./flow redirect:list
./flow redirect:add source/path target/path 307
./flow redirect:remove source/path
./flow redirect:removeall
./flow redirect:removebyhost hostname.tld
```

In addition redirects can be imported and exported as `CSV` using::

```
./flow redirect:export
./flow redirect:import
```

NEOS-721 #close

`[TASK] Create .codeclimate.yml <https://github.com/neos/neos-development-collection/pull/6>`_
----------------------------------------------------------------------------------------------

Adds a codeclimate configuration excluding Migrations, Tests and
JavaScript libraries.

`BUGFIX: Prevent database constraint violation during site prune with existing domains <https://github.com/neos/neos-development-collection/pull/488>`_
-------------------------------------------------------------------------------------------------------------------------------------------------------

Deleting a site, e.g. using the `site:prune` command, fails due a database constraint violation.
This is due to Doctrine delete ordering, the site is deleted before the domains.

NEOS-178

`BUGFIX: Placement of initial translation dialog <https://github.com/neos/neos-development-collection/pull/487>`_
-----------------------------------------------------------------------------------------------------------------

`BUGFIX: Select box editor unselect styling <https://github.com/neos/neos-development-collection/pull/485>`_
------------------------------------------------------------------------------------------------------------

Regression from the new dropdown styling.

`BUGFIX: Radio buttons active state <https://github.com/neos/neos-development-collection/pull/484>`_
----------------------------------------------------------------------------------------------------

Fixes the styling of the radio buttons and synchronizes
the styling with the new styling for the checkboxes.

`TASK: \`\`LoginController\`\` respects JSON on authentication failure <https://github.com/neos/neos-development-collection/pull/480>`_
---------------------------------------------------------------------------------------------------------------------------------------

Adds a JSON output of `"success" => false` if authentication failed.

NEOS-1510 #close

`BUGFIX: Call to getIdentifier on non object in usage references <https://github.com/neos/neos-development-collection/pull/479>`_
---------------------------------------------------------------------------------------------------------------------------------

In the usages overview for assets in the media module a list is rendered
with a path to the node where an asset is still used. This leads to a
call to getIdentifier() on a non object if the parent document node
is removed in the live / current users workspace.

As we can not display the title of the document in the other users workspace
this change leaves out the breadcrumb to the node in the overview.

`BUGFIX: Adjust to new Neos.Demo site package <https://github.com/neos/neos-development-collection/pull/478>`_
--------------------------------------------------------------------------------------------------------------

Adjusts Behat tests and documentation to the new Neos.Demo site package.

`FEATURE: Automatic conversion of images from CMYK into RGB colorspace <https://github.com/neos/neos-development-collection/pull/376>`_
---------------------------------------------------------------------------------------------------------------------------------------

Images in CMYK colorspace will be converted into RGB colorspace during the processing of images. The original image will still been kept in the original colorspace.

The conversion could be disabled by setting the configuration `TYPO3.Media.image.convertCMYKToRGB` to false.

Not applicable when using GD as it doesn't support CMYK.

NEOS-1778 #close

`TASK: Add schema definition for the inspector group icons <https://github.com/neos/neos-development-collection/pull/468>`_
---------------------------------------------------------------------------------------------------------------------------

Before that the nodeType validation produced some errors.

`TASK: Polish reference section of documentation <https://github.com/neos/neos-development-collection/pull/465>`_
-----------------------------------------------------------------------------------------------------------------

The typoscript view-helper is added to the autogenereated neos-reference.  
Additionally the section names in the reference are made a little more consistent.

`TASK: Introduce interface to customize the default TS prototype <https://github.com/neos/neos-development-collection/pull/473>`_
---------------------------------------------------------------------------------------------------------------------------------

This change introduces a new interface `DefaultPrototypeGeneratorInterface`.
By implementing this interface you can change the default TypoScript prototypes
generated by Neos for every NodeType.

`FEATURE: Implement new Login-Screen <https://github.com/neos/neos-development-collection/pull/472>`_
-----------------------------------------------------------------------------------------------------

`[TASK] Resolve test trait paths relatively <https://github.com/neos/neos-development-collection/pull/7>`_
----------------------------------------------------------------------------------------------------------

In order to accomodate running the tests with the new joined
repositories as well as the read-only ones the require path
must be relative to the current path to avoid passing the
Application/Neos folder.

`BUGFIX: Fix default expression to generate node labels <https://github.com/neos/neos-development-collection/pull/466>`_
------------------------------------------------------------------------------------------------------------------------

The PR #448 changed the default expression used to generate the label by
adding a preg_replace. The way the pattern is specified breaks with the
php-yaml extension.

This changes fixes it by removing the backslash characters before the
slashes delimiting the pattern.

NEOS-1818 #close

`TASK: Make loadingDepth of structure tree configurable <https://github.com/neos/neos-development-collection/pull/451>`_
------------------------------------------------------------------------------------------------------------------------

Like the node tree the structure tree has a configurable initial loading
depth now.

NEOS-1361 #comment Adjust structure tree handling

`TASK: Use and improve node label <https://github.com/neos/neos-development-collection/pull/448>`_
--------------------------------------------------------------------------------------------------

Use the newly available node label in more parts of the UI and improve how the default node label
is generated.

NEOS-1811 #close

`FEATURE: Inspector group icon <https://github.com/neos/neos-development-collection/pull/455>`_
-----------------------------------------------------------------------------------------------

Add icons to inspector groups using a new `icon` attribute.

Also includes various improvements related to icons.

NEOS-1406 #close

`TASK: Improve styling of checkboxes <https://github.com/neos/neos-development-collection/pull/457>`_
-----------------------------------------------------------------------------------------------------

- Changes the check icon
- Always show a check icon
- Improves hover / focus states

`FEATURE: Cross-site linking <https://github.com/neos/neos-development-collection/pull/439>`_
---------------------------------------------------------------------------------------------

Adds `scheme` and `port` parameters to site domains to enable setting them for cross-site linking.

Additionally adds a primary flag to site domains to enable selecting the primary domain for a site.

Lastly linking to a node using the `LinkingService` the primary domain of the site the node belongs
to is taking into account. This allows cross-site linking instead of creating an invalid link to a non-existing
node with the existing site's URL.

NEOS-976 #close
NEOS-178 #close

`TASK: Only update changed model properties <https://github.com/neos/neos-development-collection/pull/450>`_
------------------------------------------------------------------------------------------------------------

When updating a properties for a node, only post the properties
that have actually changed. This improves performance since
fewer `setProperty` calls are needed. The more node properties
the bigger the impact.

`TASK: Improve & streamline styling of dropdowns <https://github.com/neos/neos-development-collection/pull/459>`_
-----------------------------------------------------------------------------------------------------------------

`TASK: Find workspacePosition by comparing names <https://github.com/neos/neos-development-collection/pull/454>`_
-----------------------------------------------------------------------------------------------------------------

Two places use workspaces in `array_search` to find find the positions of a
workspace. This fails if two instances of the same workspace are used,
and even though this should not happen, the error is not "needed". When
using the name to compare the workspaces, everything works fine (as is to
be expected, since the name is the identifier).

`BUGFIX: Aloha table mode issues <https://github.com/neos/neos-development-collection/pull/447>`_
-------------------------------------------------------------------------------------------------

Fix broken insert/cut/copy/paste actions when the Aloha table mode is active.

Prevent Aloha table mode from remaining active after selecting a new node
in the structure tree.

`FEATURE: Center all dialogs vertically <https://github.com/neos/neos-development-collection/pull/434>`_
--------------------------------------------------------------------------------------------------------

Center all dialogs vertically with flexbox. 
Dialogs using the old markup will maintain the old positioning as fallback.

`TASK: Make help message icon more visible <https://github.com/neos/neos-development-collection/pull/453>`_
-----------------------------------------------------------------------------------------------------------

Adds a hover effect and increases the size in the insert new panels

`TASK: Improve exception error notifications <https://github.com/neos/neos-development-collection/pull/424>`_
-------------------------------------------------------------------------------------------------------------

Generalises and improves the output of exception errors.

Removes unuseful custom AJAX error handling and thus avoids displaying multiple error notifications for a single error.

NEOS-185 #close

`FEATURE: Support search by property & exact value in NodeDataRepository <https://github.com/neos/neos-development-collection/pull/1>`_
---------------------------------------------------------------------------------------------------------------------------------------

Currently it is only possible to search through the properties by
giving a string that matches for any key or value found in the
jsonified properties field.

With this change, the term can also be an array to match exactly on a
given key / value combination.
The search term could be given as `['key' => 'value']`.

NEOS-1460 #close

`BUGFIX: Don't show error notification on cancelled page loads <https://github.com/neos/neos-development-collection/pull/449>`_
-------------------------------------------------------------------------------------------------------------------------------

Due to the improved AJAX error handling an error was shown for
cancelled requests.

`FEATURE: Preview in target workspace instead of live <https://github.com/neos/neos-development-collection/pull/399>`_
----------------------------------------------------------------------------------------------------------------------

The Neos UI has a button to preview the current page in the live
workspace. When using nested workspaces, this is not helpful, because
one usually wants to see the published state in the current target
workspace.

So this changes the preview to show the current target workspace
instead.

`Detailed log <https://github.com/neos/neos-development-collection/compare/5.3.0...7.0.0>`_
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
