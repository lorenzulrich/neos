=====
7.0.0
=====

Neos 7.0 is the next major version and comes with numerous changes, and a few additional features.
Since some refactoring has happeend, developers will need to get familiar with a few changes.


Raise the minimum PHP version to 7.3
====================================
Since PHP 7.2 is End-Of-Live in November 2020, we phased out the support for this version.


Relative position to non-existing key throws exception
======================================================
Until now, an element positioned relative to a non-existing key would just be skipped silently.
Now it will throw an exception to bring awareness to the "inactive" array element.
This is a breaking change because previously referring to a non existing position would be ignored.


Faster frontend routing
=======================
The ``FrontendNodeRoutePartHandler`` was grown into a beast.

We moved most of the logic of the ``LinkingService::createNodeUri()`` into the Route Part Handler
(so that it is cached), remove the context-related logic from the handler (since it is only used for
public workspaces anyways) and reduce the redundant frontend route definitions from three to a single one.

* `PR 3168 <https://github.com/neos/neos-development-collection/pull/3168>`_
* `PR 3218 <https://github.com/neos/neos-development-collection/pull/3218>`_


Improvements for AFX
====================

Catch AFX parser exceptions
---------------------------
Previously only AFX exceptions were converted to fusion exceptions, which hid valuable information
about the user's error source. This change will also catch for AFX parser exceptions and
convert those to Fusion Exceptions.

`PR 3235 <https://github.com/neos/neos-development-collection/pull/3235>`_

Add AFX template for SiteKickstarter
------------------------------------
We made the SiteKickstarter more versatile. Now you can easily add a custom generator package and
kickstart some sorts of sites with one package:

* Add possibility to use more than one template for the site kickstarter
* Replace AFX template with the fluid template
* Add the generator selection to the backend module for site packages
* Removed the old generic generator service (this is breaking)

`PR 3089 <https://github.com/neos/neos-development-collection/pull/3089>`_

Include AFX in the development collection
-----------------------------------------
Now it is much easier to implement changes that need synchronous alterations in AFX and Fusion
and will reduce the number different of version constraints we have to deal with.

`PR 3205 <https://github.com/neos/neos-development-collection/pull/3205>`_

StaticResource EEL Helper
-------------------------
Now it is possible to include static resources like this:

.. code-block:: HTML

  <link rel="stylesheet" href={StaticResource.uri('Neos.Demo', 'Public/Styles/Main.css')} media="all" />
  <style>{StaticResource.content('Neos.Demo', 'Public/Styles/Main.css')}</style>

`PR 3134 <https://github.com/neos/neos-development-collection/pull/3134>`_



<tbd>:
======

Introduce NodeTypePresetPostprocessor
=====================================

`PR 3087 <https://github.com/neos/neos-development-collection/pull/3087>`_


Respect language plurals also in XliffService
=============================================
`PR 3166 <https://github.com/neos/neos-development-collection/pull/3166>`_


Lazy loading images
===================
`PR 3149 <https://github.com/neos/neos-development-collection/pull/3149>`_


Allow users to log in without access to the content module.
===========================================================
`PR 3123 <https://github.com/neos/neos-development-collection/pull/3123>`_


Add getIconUri & getDescription to AssetSourceInterface
=======================================================
Extends the ``Neos\\Media\\Domain\\Model\\AssetSource\\ AssetSourceInterface`` by the two methods ``getIconUri()`` and ``getDescription()``.

This is a breaking change if you created a custom Asset source (implementing the `AssetSourceInterface`) and didn't implement these methods yet.

`PR 3211 <https://github.com/neos/neos-development-collection/pull/3211>`_


Remove default prototype generator
==================================
`PR 3210 <https://github.com/neos/neos-development-collection/pull/3210>`_


Add third parameter "sortFlags" for FlowQuery sort()
====================================================
Now you are able the pass a third parameter to the ``sort()`` method. According to the sort
flags of `arsort() <https://www.php.net/manual/en/function.sort>`_ the sort options are:

.. code-block:: PHP

  'SORT_REGULAR'
  'SORT_NUMERIC'
  'SORT_STRING'
  'SORT_LOCALE_STRING'
  'SORT_NATURAL'
  'SORT_FLAG_CASE' (use as last option with SORT_STRING, SORT_LOCALE_STRING, or SORT_NATURAL)


A single sort option can be supplied as a string. Multiple sort options are supplied as an array.
Omitting the third parameter leaves FlowQuery ``sort()`` in ``SORT_REGULAR`` sort mode.

`PR 2989 <https://github.com/neos/neos-development-collection/pull/2989>`_



~~~~~~~~~~~~~~~~~~~~
Upgrade instructions
~~~~~~~~~~~~~~~~~~~~

See https://www.neos.io/download-and-extend/upgrade-instructions-5-3-7-0.html

~~~~~~~~~~~~~~~~~~~~
!!! Breaking changes
~~~~~~~~~~~~~~~~~~~~

As this is a major release, a few breaking changes have gone in. All of them can be found
in the ChangeLog, but everything important should be listed above and in the upgrade instructions.

In case you have any problems with this guide, please get in touch with us
via `discuss.neos.io <https://discuss.neos.io/>`_ or on `Slack <https://neos-project.slack.com/>`_.

.. note::

   Additionally, all changes in Flow 7.0 apply; see the release notes to further information.
   See http://flowframework.readthedocs.org/en/7.0/TheDefinitiveGuide/PartV/ReleaseNotes/700.html
